<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2016-10-06
 â€” 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2016-10-06' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:25 UTC</pre>
<pre><a href="/bitcoin-core-dev/2016-09-06">&lt;</a><span class='header'>   October 2016   </span><a href="/bitcoin-core-dev/2016-11-06">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;                   <a class="" href="/bitcoin-core-dev/2016-10-01">1</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2016-10-02">2</a>  <a class="" href="/bitcoin-core-dev/2016-10-03">3</a>  <a class="" href="/bitcoin-core-dev/2016-10-04">4</a>  <a class="" href="/bitcoin-core-dev/2016-10-05">5</a>  <a class="current" href="/bitcoin-core-dev/2016-10-06">6</a>  <a class="" href="/bitcoin-core-dev/2016-10-07">7</a>  <a class="" href="/bitcoin-core-dev/2016-10-08">8</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2016-10-09">9</a> <a class="" href="/bitcoin-core-dev/2016-10-10">10</a> <a class="" href="/bitcoin-core-dev/2016-10-11">11</a> <a class="" href="/bitcoin-core-dev/2016-10-12">12</a> <a class="" href="/bitcoin-core-dev/2016-10-13">13</a> <a class="" href="/bitcoin-core-dev/2016-10-14">14</a> <a class="" href="/bitcoin-core-dev/2016-10-15">15</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2016-10-16">16</a> <a class="" href="/bitcoin-core-dev/2016-10-17">17</a> <a class="" href="/bitcoin-core-dev/2016-10-18">18</a> <a class="" href="/bitcoin-core-dev/2016-10-19">19</a> <a class="" href="/bitcoin-core-dev/2016-10-20">20</a> <a class="" href="/bitcoin-core-dev/2016-10-21">21</a> <a class="" href="/bitcoin-core-dev/2016-10-22">22</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2016-10-23">23</a> <a class="" href="/bitcoin-core-dev/2016-10-24">24</a> <a class="" href="/bitcoin-core-dev/2016-10-25">25</a> <a class="" href="/bitcoin-core-dev/2016-10-26">26</a> <a class="" href="/bitcoin-core-dev/2016-10-27">27</a> <a class="" href="/bitcoin-core-dev/2016-10-28">28</a> <a class="" href="/bitcoin-core-dev/2016-10-29">29</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2016-10-30">30</a> <a class="" href="/bitcoin-core-dev/2016-10-31">31</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1475719560' id='499525'>
<a class='timestamp' href='#499525'><time timestamp='2016-10-06T02:06:00Z'>02:06</time></a>
&lt;<span class='nick nick-8'> Dabs</span>&gt;
uh. md5? isn&#x27;t that &quot;broken&quot; ?
<br>
</div>

<div class='talk op-msg' data-timestamp='1475720760' id='499526'>
<a class='timestamp' href='#499526'><time timestamp='2016-10-06T02:26:00Z'>02:26</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
Dabs: not because of its speed
<br>
</div>

<div class='talk op-msg' data-timestamp='1475722680' id='499527'>
<a class='timestamp' href='#499527'><time timestamp='2016-10-06T02:58:00Z'>02:58</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
Dabs: probably not if you use a unique secret salt
<br>
</div>

<div class='talk op-msg' data-timestamp='1475723520' id='499528'>
<a class='timestamp' href='#499528'><time timestamp='2016-10-06T03:12:00Z'>03:12</time></a>
&lt;<span class='nick nick-8'> Dabs</span>&gt;
yeah, but ... you&#x27;ll have to always justify using a &quot;broken&quot; primitive. ... anyway. I guess it depends on the purpose.. hmac md5 or something.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475723880' id='499529'>
<a class='timestamp' href='#499529'><time timestamp='2016-10-06T03:18:00Z'>03:18</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
Dabs: I&#x27;m not seriously advocating using it... but it&#x27;s really not broken in this use case.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475723880' id='499530'>
<a class='timestamp' href='#499530'><time timestamp='2016-10-06T03:18:00Z'>03:18</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
Dabs: For the same reason RIPEMD-160 is OK
<br>
</div>

<div class='talk op-msg' data-timestamp='1475723940' id='499531'>
<a class='timestamp' href='#499531'><time timestamp='2016-10-06T03:19:00Z'>03:19</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
oops RIPEMD != RIPEMD-160
<br>
</div>

<div class='talk op-msg' data-timestamp='1475724000' id='499532'>
<a class='timestamp' href='#499532'><time timestamp='2016-10-06T03:20:00Z'>03:20</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
Anyways, most of those collisions require the attacker to fully control both documents being hashed
<br>
</div>

<div class='talk op-msg' data-timestamp='1475724000' id='499533'>
<a class='timestamp' href='#499533'><time timestamp='2016-10-06T03:20:00Z'>03:20</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
to collide their hashes
<br>
</div>

<div class='talk op-msg' data-timestamp='1475725680' id='499534'>
<a class='timestamp' href='#499534'><time timestamp='2016-10-06T03:48:00Z'>03:48</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
Dabs: MD5 is not a primitive of BLAKE2b, they just have similar speeds
<br>
</div>

<div class='talk op-msg' data-timestamp='1475734740' id='499535'>
<a class='timestamp' href='#499535'><time timestamp='2016-10-06T06:19:00Z'>06:19</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
please don&#x27;t use md5 in new code
<br>
</div>

<div class='talk op-msg' data-timestamp='1475734740' id='499536'>
<a class='timestamp' href='#499536'><time timestamp='2016-10-06T06:19:00Z'>06:19</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
it&#x27;s, at its current level of brokenness still fine for some continuing legacy usages, but for new designs it should be avoided
<br>
</div>

<div class='talk op-msg' data-timestamp='1475734920' id='499537'>
<a class='timestamp' href='#499537'><time timestamp='2016-10-06T06:22:00Z'>06:22</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
there are modern fast and secure hash functions (indeed as BLAKE), and if speed trumps cryptographic security there are tons of other options
<br>
</div>

<div class='talk op-msg' data-timestamp='1475734980' id='499538'>
<a class='timestamp' href='#499538'><time timestamp='2016-10-06T06:23:00Z'>06:23</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
     
<br>
</div>

<div class='talk op-msg' data-timestamp='1475738880' id='499539'>
<a class='timestamp' href='#499539'><time timestamp='2016-10-06T07:28:00Z'>07:28</time></a>
&lt;<span class='nick nick-10'> GitHub95</span>&gt;
[bitcoin] MarcoFalke pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/223f4c2dd5fa...61d191fbf953" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/223f4c2dd5fa...61d191fbf953</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1475738880' id='499540'>
<a class='timestamp' href='#499540'><time timestamp='2016-10-06T07:28:00Z'>07:28</time></a>
&lt;<span class='nick nick-10'> GitHub95</span>&gt;
bitcoin/master 7d8afb4 fanquake: [Doc] Improve GitHub issue template
<br>
</div>

<div class='talk op-msg' data-timestamp='1475738880' id='499541'>
<a class='timestamp' href='#499541'><time timestamp='2016-10-06T07:28:00Z'>07:28</time></a>
&lt;<span class='nick nick-10'> GitHub95</span>&gt;
bitcoin/master 61d191f MarcoFalke: Merge #8887: [Doc] Improve GitHub issue template...
<br>
</div>

<div class='talk op-msg' data-timestamp='1475738880' id='499542'>
<a class='timestamp' href='#499542'><time timestamp='2016-10-06T07:28:00Z'>07:28</time></a>
&lt;<span class='nick nick-10'> GitHub95</span>&gt;
[bitcoin] MarcoFalke closed pull request #8887: [Doc] Improve GitHub issue template (master...link-stackexchange) <a href="https://github.com/bitcoin/bitcoin/pull/8887" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/8887</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1475747880' id='499543'>
<a class='timestamp' href='#499543'><time timestamp='2016-10-06T09:58:00Z'>09:58</time></a>
&lt;<span class='nick nick-7'> NicolasDorier</span>&gt;
roasbeef: You can now measure your size <a href="https://testnet.smartbit.com.au/block/0000000000001280a3d758cb956e565daffd5af0e6b6723f28e1cbcda0da8652" class="link" target="_blank">https://testnet.smartbit.com.au/block/0000000000001280a3d758cb956e565daffd5af0e6b6723f28e1cbcda0da8652</a> ;)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475748000' id='499544'>
<a class='timestamp' href='#499544'><time timestamp='2016-10-06T10:00:00Z'>10:00</time></a>
&lt;<span class='nick nick-6'> btcdrak</span>&gt;
ah, great it&#x27;s been made segwitty
<br>
</div>

<div class='talk op-msg' data-timestamp='1475763840' id='499545'>
<a class='timestamp' href='#499545'><time timestamp='2016-10-06T14:24:00Z'>14:24</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: sorry i missed discussion yesterday on the cuckoo sigcache.  jeremyrubin and i did put a LOT of work into different designs.   but i do think this design if far better than the existing sig cache.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475763840' id='499546'>
<a class='timestamp' href='#499546'><time timestamp='2016-10-06T14:24:00Z'>14:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
morcos: i don&#x27;t think there is doubt that it&#x27;s better :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475763900' id='499547'>
<a class='timestamp' href='#499547'><time timestamp='2016-10-06T14:25:00Z'>14:25</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
it might be fine to reduce the depth limit or untie it from the size of the table.  but i seriously doubt it impacts the performance of ATMP.  (once we saw how inefficient the old deleting behavior was anyway)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475763900' id='499548'>
<a class='timestamp' href='#499548'><time timestamp='2016-10-06T14:25:00Z'>14:25</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
wumpus: it wasn&#x27;t a serious suggestion ;) 
<br>
</div>

<div class='talk op-msg' data-timestamp='1475763960' id='499549'>
<a class='timestamp' href='#499549'><time timestamp='2016-10-06T14:26:00Z'>14:26</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
one thing to keep in mind is that with a 40MB sigcache, it probably isn&#x27;t going to get full except in the event of an attack.  i ran a simulation over 6 months, and i was getting very close to the maximal possible hit rate on a 40MB cache.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475763960' id='499550'>
<a class='timestamp' href='#499550'><time timestamp='2016-10-06T14:26:00Z'>14:26</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
the fact that we delete sigs that were in blocks makes a HUGE difference
<br>
</div>

<div class='talk op-msg' data-timestamp='1475763960' id='499551'>
<a class='timestamp' href='#499551'><time timestamp='2016-10-06T14:26:00Z'>14:26</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
morcos: yes... but we should know how it behaves in case of an attack as well
<br>
</div>

<div class='talk op-msg' data-timestamp='1475763960' id='499552'>
<a class='timestamp' href='#499552'><time timestamp='2016-10-06T14:26:00Z'>14:26</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
without attack, i expect the size of the cache to not even matter that much
<br>
</div>

<div class='talk op-msg' data-timestamp='1475763960' id='499553'>
<a class='timestamp' href='#499553'><time timestamp='2016-10-06T14:26:00Z'>14:26</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
as we&#x27;ll only ever have live entries in it
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764020' id='499554'>
<a class='timestamp' href='#499554'><time timestamp='2016-10-06T14:27:00Z'>14:27</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
my idea for how to make it even more fool proof from ever getting full would be to implement a Rolling version where you have 2 and insert and check in both of them and then alternately clear them after some amount of time
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764020' id='499555'>
<a class='timestamp' href='#499555'><time timestamp='2016-10-06T14:27:00Z'>14:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
morcos: ha, the old rolling bloom filter design :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764020' id='499556'>
<a class='timestamp' href='#499556'><time timestamp='2016-10-06T14:27:00Z'>14:27</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
sipa: in the absence of attack there are still txs that get generated but are never mined (replaced, doublespent, too low fee)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764020' id='499557'>
<a class='timestamp' href='#499557'><time timestamp='2016-10-06T14:27:00Z'>14:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
right
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764020' id='499558'>
<a class='timestamp' href='#499558'><time timestamp='2016-10-06T14:27:00Z'>14:27</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
sipa: yeah i just didn&#x27;t think it was worth the complication for the first PR
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764080' id='499559'>
<a class='timestamp' href='#499559'><time timestamp='2016-10-06T14:28:00Z'>14:28</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
morcos: completely agreed
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764080' id='499560'>
<a class='timestamp' href='#499560'><time timestamp='2016-10-06T14:28:00Z'>14:28</time></a>
&lt;<span class='nick nick-4'> * sipa</span>&gt;
just hopes 0.13.1 is out the door soon
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764080' id='499561'>
<a class='timestamp' href='#499561'><time timestamp='2016-10-06T14:28:00Z'>14:28</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
generations are better than rolling I think
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764080' id='499562'>
<a class='timestamp' href='#499562'><time timestamp='2016-10-06T14:28:00Z'>14:28</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jeremyrubin: yes, i think so
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764140' id='499563'>
<a class='timestamp' href='#499563'><time timestamp='2016-10-06T14:29:00Z'>14:29</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
especially given your entries are already 128-256 bits, adding a few bits for a generation number doesn&#x27;t add much
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764140' id='499564'>
<a class='timestamp' href='#499564'><time timestamp='2016-10-06T14:29:00Z'>14:29</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
using two staggered sets effectively makes your entries twice the size
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764140' id='499565'>
<a class='timestamp' href='#499565'><time timestamp='2016-10-06T14:29:00Z'>14:29</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
or even 4 times
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764200' id='499566'>
<a class='timestamp' href='#499566'><time timestamp='2016-10-06T14:30:00Z'>14:30</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
sure, sounds good to me too
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764200' id='499567'>
<a class='timestamp' href='#499567'><time timestamp='2016-10-06T14:30:00Z'>14:30</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
as in the worst case time, you just emptied one, and the other one is half full, so you have 25% utilization of your entire set
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764200' id='499568'>
<a class='timestamp' href='#499568'><time timestamp='2016-10-06T14:30:00Z'>14:30</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
Also fee is maybe even better than generations
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764260' id='499569'>
<a class='timestamp' href='#499569'><time timestamp='2016-10-06T14:31:00Z'>14:31</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
use an ARC :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764260' id='499570'>
<a class='timestamp' href='#499570'><time timestamp='2016-10-06T14:31:00Z'>14:31</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
You can also emulate generations
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764260' id='499571'>
<a class='timestamp' href='#499571'><time timestamp='2016-10-06T14:31:00Z'>14:31</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
by createnewblocking a 10mb block or something from mempool
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764260' id='499572'>
<a class='timestamp' href='#499572'><time timestamp='2016-10-06T14:31:00Z'>14:31</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
after deleting a bunch of things randomly
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764260' id='499573'>
<a class='timestamp' href='#499573'><time timestamp='2016-10-06T14:31:00Z'>14:31</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
if you want 0 memory overhead
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764260' id='499574'>
<a class='timestamp' href='#499574'><time timestamp='2016-10-06T14:31:00Z'>14:31</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
<a href="https://en.wikipedia.org/wiki/Adaptive_replacement_cache" class="link" target="_blank">https://en.wikipedia.org/wiki/Adaptive_replacement_cache</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764320' id='499575'>
<a class='timestamp' href='#499575'><time timestamp='2016-10-06T14:32:00Z'>14:32</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
sipa: ah, not automatic reference counting
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764320' id='499576'>
<a class='timestamp' href='#499576'><time timestamp='2016-10-06T14:32:00Z'>14:32</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
ARC seems not to work for this use case?
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764320' id='499577'>
<a class='timestamp' href='#499577'><time timestamp='2016-10-06T14:32:00Z'>14:32</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
Things are write once read once?
<br>
</div>

<div class='talk op-msg' data-timestamp='1475764380' id='499578'>
<a class='timestamp' href='#499578'><time timestamp='2016-10-06T14:33:00Z'>14:33</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ah, i&#x27;m confusing with the coin cache
<br>
</div>

<div class='talk op-msg' data-timestamp='1475773560' id='499579'>
<a class='timestamp' href='#499579'><time timestamp='2016-10-06T17:06:00Z'>17:06</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: part of the reason I was asking questions is that I wasn&#x27;t sure if we knew how it would perform once someone sent in a huge set of junk transactions. But have no doubt, I&#x27;m sure its much better than what we currently have.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475773620' id='499580'>
<a class='timestamp' href='#499580'><time timestamp='2016-10-06T17:07:00Z'>17:07</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I&#x27;m surprised it didn&#x27;t bencmark out as faster with only a single thread.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475773680' id='499581'>
<a class='timestamp' href='#499581'><time timestamp='2016-10-06T17:08:00Z'>17:08</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: it was ever so slightly faster (1%) for a single thread, but thats within noise.  i just think the amount of time taken in either case is small, it was only the lock contention that was a true problem.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475773740' id='499582'>
<a class='timestamp' href='#499582'><time timestamp='2016-10-06T17:09:00Z'>17:09</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
but now you inspired a hopefully efficient generation keeping design that will never get full, but only delete old generations if it needs to..   :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475773860' id='499583'>
<a class='timestamp' href='#499583'><time timestamp='2016-10-06T17:11:00Z'>17:11</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: re generation number, I had just assumed the entries would be changed to 252 bits, so you&#x27;d only lose at most 6% at a time, and would only delete things if it had to.  
<br>
</div>

<div class='talk op-msg' data-timestamp='1475774100' id='499584'>
<a class='timestamp' href='#499584'><time timestamp='2016-10-06T17:15:00Z'>17:15</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
the idea jeremyrubin and i want to try is actually a separate bit vector that just keeps track of whehter each entry is in the current generation or not.  that&#x27;s only touched during insert, so its lock free.  and then use a simple heuristic to trigger an occasional testforcleanup.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475774160' id='499585'>
<a class='timestamp' href='#499585'><time timestamp='2016-10-06T17:16:00Z'>17:16</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
when doing that you just loop that vector and the garbage collection vector and if the current generation not marked for deletion is &gt; 25% of capacity then mark for deletion old generation and increase generation.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475774220' id='499586'>
<a class='timestamp' href='#499586'><time timestamp='2016-10-06T17:17:00Z'>17:17</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
that has the nice property that you don&#x27;t actually delete old things unless you have to, but under an attack you&#x27;ll delete them often enough to stop yourself getting full.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475775900' id='499587'>
<a class='timestamp' href='#499587'><time timestamp='2016-10-06T17:45:00Z'>17:45</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I wish we could easily delete based on an entry being in the top of the mempool or not.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475775900' id='499588'>
<a class='timestamp' href='#499588'><time timestamp='2016-10-06T17:45:00Z'>17:45</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
hm. I suppose that when we evict something from the mempool, we could revalidate it again with the cache in delete mode. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1475775900' id='499589'>
<a class='timestamp' href='#499589'><time timestamp='2016-10-06T17:45:00Z'>17:45</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
that would be kinda like that.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475775960' id='499590'>
<a class='timestamp' href='#499590'><time timestamp='2016-10-06T17:46:00Z'>17:46</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
or insert things with a lower feerate 1 or two generations behind the current generation. (assuming many generations)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776200' id='499591'>
<a class='timestamp' href='#499591'><time timestamp='2016-10-06T17:50:00Z'>17:50</time></a>
&lt;<span class='nick nick-10'> michagogo</span>&gt;
Today&#x27;s lesson in my programming lessons: threading is hard
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776260' id='499592'>
<a class='timestamp' href='#499592'><time timestamp='2016-10-06T17:51:00Z'>17:51</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
gmaxwell: i was thinking about doing that (revalidate in delete mode) for things that we don&#x27;t accept to our mempool, as well
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776260' id='499593'>
<a class='timestamp' href='#499593'><time timestamp='2016-10-06T17:51:00Z'>17:51</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: with a 40MB cache, it&#x27;s just not necessary to make further optimizations.  someone would have to flood you with 250k excess signatures in order for you to start marking for deletion things older than when the flood started.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776260' id='499594'>
<a class='timestamp' href='#499594'><time timestamp='2016-10-06T17:51:00Z'>17:51</time></a>
&lt;<span class='nick nick-10'> michagogo</span>&gt;
(Also, each iteration of a for loop has its own scope for local variables, and those variables stick around even after the iteration is done and the name is reused for something else)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776320' id='499595'>
<a class='timestamp' href='#499595'><time timestamp='2016-10-06T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
if that time frame is recent enough that its causing a problem for your cache hit rate, then i think that implies your bigger problem is the tx flood and the DoS on checking all those sigs in the first place
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776320' id='499596'>
<a class='timestamp' href='#499596'><time timestamp='2016-10-06T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-10'> michagogo</span>&gt;
(or rather, reused for the next iteration)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776440' id='499597'>
<a class='timestamp' href='#499597'><time timestamp='2016-10-06T17:54:00Z'>17:54</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: okay, for some reason I thought sipa&#x27;s measurements had shown that we still had a needlessly low hitrate.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776560' id='499598'>
<a class='timestamp' href='#499598'><time timestamp='2016-10-06T17:56:00Z'>17:56</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: hmm, i&#x27;d be interested to see that, but i think any low hit rates we have are probably due to txs we never accepted to our mempool in the first place, not sigs that we accidentally evicted.. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776620' id='499599'>
<a class='timestamp' href='#499599'><time timestamp='2016-10-06T17:57:00Z'>17:57</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
yea, I may be conflating things. it might be that right now its from things we never accept, and when sipa tried validating everything, we found it tainted the cache.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776680' id='499600'>
<a class='timestamp' href='#499600'><time timestamp='2016-10-06T17:58:00Z'>17:58</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: i attempted an approximation by inserting 10 random signatures for every tx my node saw and deleting those same 10 if the tx appeared in a block
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776740' id='499601'>
<a class='timestamp' href='#499601'><time timestamp='2016-10-06T17:59:00Z'>17:59</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
i ran that for 6 months and the hit rate was 98.35% on average, whereas perfect would have been 98.38% and the existing algo was 97.99%.  with 40MB
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776800' id='499602'>
<a class='timestamp' href='#499602'><time timestamp='2016-10-06T18:00:00Z'>18:00</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
hm. why was the existing algo lower? 
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776800' id='499603'>
<a class='timestamp' href='#499603'><time timestamp='2016-10-06T18:00:00Z'>18:00</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
in reality many of those txs probably wouldn&#x27;t have passed ATMP and made it into the cache, leading to a lower hit rate in practice, but not due to cache filling
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776800' id='499604'>
<a class='timestamp' href='#499604'><time timestamp='2016-10-06T18:00:00Z'>18:00</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: primarily because you can cram more signatures in 40MB with the new design
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776800' id='499605'>
<a class='timestamp' href='#499605'><time timestamp='2016-10-06T18:00:00Z'>18:00</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
and partially because on a reorg the old algo doesn&#x27;t have them, but the new one does with high probability
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776800' id='499606'>
<a class='timestamp' href='#499606'><time timestamp='2016-10-06T18:00:00Z'>18:00</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Makes sense.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776860' id='499607'>
<a class='timestamp' href='#499607'><time timestamp='2016-10-06T18:01:00Z'>18:01</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
yea, I&#x27;m really happy about the delete flag. I really didn&#x27;t like the current code&#x27;s behavior under reorg.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776860' id='499608'>
<a class='timestamp' href='#499608'><time timestamp='2016-10-06T18:01:00Z'>18:01</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
not good for network convergence for reorg to be much slower.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776920' id='499609'>
<a class='timestamp' href='#499609'><time timestamp='2016-10-06T18:02:00Z'>18:02</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: heh, probably MANY things to improve there
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776920' id='499610'>
<a class='timestamp' href='#499610'><time timestamp='2016-10-06T18:02:00Z'>18:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
yes. but any improvement is good. :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475776980' id='499611'>
<a class='timestamp' href='#499611'><time timestamp='2016-10-06T18:03:00Z'>18:03</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I&#x27;d take a wag that the validation performance limiter is now the additional sha256 used in the lookup.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475777280' id='499612'>
<a class='timestamp' href='#499612'><time timestamp='2016-10-06T18:08:00Z'>18:08</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: as far as jeremyrubin and i can tell, the biggest limiter now is how much you blow out your various machine caches with different permutations of coinsviewcache size and flushing algo, sig cache lookup pattern, etc..  although this tends to affect performance AFTER validation has finished. i.e. slows down removeForBlock
<br>
</div>

<div class='talk op-msg' data-timestamp='1475777340' id='499613'>
<a class='timestamp' href='#499613'><time timestamp='2016-10-06T18:09:00Z'>18:09</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
to really get better performance we&#x27;ll need to switch data representations to eliminate so much allocating, deallocating and copying of vectors.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475777400' id='499614'>
<a class='timestamp' href='#499614'><time timestamp='2016-10-06T18:10:00Z'>18:10</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
but sdaftuar&#x27;s idea is the next lowest hanging fruit is to just speed the path from validation finished to actually relaying to new peers, which isn&#x27;t optimized at all right now
<br>
</div>

<div class='talk op-msg' data-timestamp='1475777400' id='499615'>
<a class='timestamp' href='#499615'><time timestamp='2016-10-06T18:10:00Z'>18:10</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
well BIP152 allows you to send the block before its verified.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475777400' id='499616'>
<a class='timestamp' href='#499616'><time timestamp='2016-10-06T18:10:00Z'>18:10</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
so that would be an obvious thing to actually do.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475777460' id='499617'>
<a class='timestamp' href='#499617'><time timestamp='2016-10-06T18:11:00Z'>18:11</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
sure.  same issue still applies though.  you&#x27;re just deciding to send it earlier.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475777580' id='499618'>
<a class='timestamp' href='#499618'><time timestamp='2016-10-06T18:13:00Z'>18:13</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
i think gmaxwell&#x27;s point is that the way you&#x27;d do that would be in the handling of eg ProcessNewBlock, so it&#x27;d actually go out earlier (rather than in SendMessages)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475777580' id='499619'>
<a class='timestamp' href='#499619'><time timestamp='2016-10-06T18:13:00Z'>18:13</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
that&#x27;s basically what i was planning to do
<br>
</div>

<div class='talk op-msg' data-timestamp='1475777580' id='499620'>
<a class='timestamp' href='#499620'><time timestamp='2016-10-06T18:13:00Z'>18:13</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
well it gets the whole validation process out of that critical path.
<br>
</div>

<div class='talk op-msg' data-timestamp='1475780460' id='499621'>
<a class='timestamp' href='#499621'><time timestamp='2016-10-06T19:01:00Z'>19:01</time></a>
&lt;<span class='nick nick-10'> michagogo</span>&gt;
(Go figure... After a bunch of weeks of having something else every time, this week I&#x27;m around but the meeting is cancelled)
<br>
</div>

<div class='talk op-msg' data-timestamp='1475781600' id='499622'>
<a class='timestamp' href='#499622'><time timestamp='2016-10-06T19:20:00Z'>19:20</time></a>
&lt;<span class='nick nick-2'> jeremyrubin</span>&gt;
gmaxwell: note you don&#x27;t actually have to re-evaluate the signature, just see if it&#x27;s hash is present on eviction (but you still need to eval script to extract signatures)
<br>
</div>

</div>
</section>

</body>
</html>
