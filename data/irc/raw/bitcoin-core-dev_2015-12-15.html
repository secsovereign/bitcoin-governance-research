<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2015-12-15
 — 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2015-12-15' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:27 UTC</pre>
<pre><a href="/bitcoin-core-dev/2015-11-15">&lt;</a><span class='header'>  December 2015   </span><a href="/bitcoin-core-dev/2016-01-15">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;       <a class="" href="/bitcoin-core-dev/2015-12-01">1</a>  <a class="" href="/bitcoin-core-dev/2015-12-02">2</a>  <a class="" href="/bitcoin-core-dev/2015-12-03">3</a>  <a class="" href="/bitcoin-core-dev/2015-12-04">4</a>  <a class="" href="/bitcoin-core-dev/2015-12-05">5</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2015-12-06">6</a>  <a class="" href="/bitcoin-core-dev/2015-12-07">7</a>  <a class="" href="/bitcoin-core-dev/2015-12-08">8</a>  <a class="" href="/bitcoin-core-dev/2015-12-09">9</a> <a class="" href="/bitcoin-core-dev/2015-12-10">10</a> <a class="" href="/bitcoin-core-dev/2015-12-11">11</a> <a class="" href="/bitcoin-core-dev/2015-12-12">12</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2015-12-13">13</a> <a class="" href="/bitcoin-core-dev/2015-12-14">14</a> <a class="current" href="/bitcoin-core-dev/2015-12-15">15</a> <a class="" href="/bitcoin-core-dev/2015-12-16">16</a> <a class="" href="/bitcoin-core-dev/2015-12-17">17</a> <a class="" href="/bitcoin-core-dev/2015-12-18">18</a> <a class="" href="/bitcoin-core-dev/2015-12-19">19</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2015-12-20">20</a> <a class="" href="/bitcoin-core-dev/2015-12-21">21</a> <a class="" href="/bitcoin-core-dev/2015-12-22">22</a> <a class="" href="/bitcoin-core-dev/2015-12-23">23</a> <a class="" href="/bitcoin-core-dev/2015-12-24">24</a> <a class="" href="/bitcoin-core-dev/2015-12-25">25</a> <a class="" href="/bitcoin-core-dev/2015-12-26">26</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2015-12-27">27</a> <a class="" href="/bitcoin-core-dev/2015-12-28">28</a> <a class="" href="/bitcoin-core-dev/2015-12-29">29</a> <a class="" href="/bitcoin-core-dev/2015-12-30">30</a> <a class="" href="/bitcoin-core-dev/2015-12-31">31</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1450143120' id='444525'>
<a class='timestamp' href='#444525'><time timestamp='2015-12-15T01:32:00Z'>01:32</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
sipa: FYI, there are actually people and miners using master in production (albeit not many enough that it should be a problem)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450147020' id='444526'>
<a class='timestamp' href='#444526'><time timestamp='2015-12-15T02:37:00Z'>02:37</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: indeed
<br>
</div>

<div class='talk op-msg' data-timestamp='1450147020' id='444527'>
<a class='timestamp' href='#444527'><time timestamp='2015-12-15T02:37:00Z'>02:37</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
uh, Luke-Jr*
<br>
</div>

<div class='talk op-msg' data-timestamp='1450147080' id='444528'>
<a class='timestamp' href='#444528'><time timestamp='2015-12-15T02:38:00Z'>02:38</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
but, those same cases are probably running custom policies anyway
<br>
</div>

<div class='talk op-msg' data-timestamp='1450148580' id='444529'>
<a class='timestamp' href='#444529'><time timestamp='2015-12-15T03:03:00Z'>03:03</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
dcousens: yes, that guy&#x27;s problem was clearly unrelated to these facts
<br>
</div>

<div class='talk op-msg' data-timestamp='1450150560' id='444530'>
<a class='timestamp' href='#444530'><time timestamp='2015-12-15T03:36:00Z'>03:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
Luke-Jr: ok, good to know?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450150620' id='444531'>
<a class='timestamp' href='#444531'><time timestamp='2015-12-15T03:37:00Z'>03:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
s/\?//
<br>
</div>

<div class='talk op-msg' data-timestamp='1450154160' id='444532'>
<a class='timestamp' href='#444532'><time timestamp='2015-12-15T04:36:00Z'>04:36</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
Luke-Jr: why is the ECDSA mess in Fedora relevant?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450154160' id='444533'>
<a class='timestamp' href='#444533'><time timestamp='2015-12-15T04:36:00Z'>04:36</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
dcousens: because it&#x27;s impossible to support building it against the OS as a result…………….nevermind, we switched to libsecp256k1
<br>
</div>

<div class='talk op-msg' data-timestamp='1450154220' id='444534'>
<a class='timestamp' href='#444534'><time timestamp='2015-12-15T04:37:00Z'>04:37</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
right
<br>
</div>

<div class='talk op-msg' data-timestamp='1450179480' id='444535'>
<a class='timestamp' href='#444535'><time timestamp='2015-12-15T11:38:00Z'>11:38</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
jonasschnelli: simple_prodname updated for more testing
<br>
</div>

<div class='talk op-msg' data-timestamp='1450180920' id='444536'>
<a class='timestamp' href='#444536'><time timestamp='2015-12-15T12:02:00Z'>12:02</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Luke-Jr: okay. Thanks,... will build again.
<br>
</div>

<div class='talk op-msg' data-timestamp='1450183380' id='444537'>
<a class='timestamp' href='#444537'><time timestamp='2015-12-15T12:43:00Z'>12:43</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
wumpus, i assume CWallet::fFileBacked is used for test harness stuff?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450183680' id='444538'>
<a class='timestamp' href='#444538'><time timestamp='2015-12-15T12:48:00Z'>12:48</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
phantomcircuit: IMO, the fFileBackend is legacy stuff and unused.
<br>
</div>

<div class='talk op-msg' data-timestamp='1450183860' id='444539'>
<a class='timestamp' href='#444539'><time timestamp='2015-12-15T12:51:00Z'>12:51</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
jonasschnelli, it&#x27;s used by the recovery code apparently
<br>
</div>

<div class='talk op-msg' data-timestamp='1450183860' id='444540'>
<a class='timestamp' href='#444540'><time timestamp='2015-12-15T12:51:00Z'>12:51</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
CWallet dummyWallet;
<br>
</div>

<div class='talk op-msg' data-timestamp='1450184040' id='444541'>
<a class='timestamp' href='#444541'><time timestamp='2015-12-15T12:54:00Z'>12:54</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
phantomcircuit: that might be possible... right
<br>
</div>

<div class='talk op-msg' data-timestamp='1450184220' id='444542'>
<a class='timestamp' href='#444542'><time timestamp='2015-12-15T12:57:00Z'>12:57</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
jonasschnelli, lol there&#x27;s no good reason for it either
<br>
</div>

<div class='talk op-msg' data-timestamp='1450184280' id='444543'>
<a class='timestamp' href='#444543'><time timestamp='2015-12-15T12:58:00Z'>12:58</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
and it&#x27;s also used in wallet_tests.cpp
<br>
</div>

<div class='talk op-msg' data-timestamp='1450184280' id='444544'>
<a class='timestamp' href='#444544'><time timestamp='2015-12-15T12:58:00Z'>12:58</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
wallet_test does use it over a file backend? not?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450184340' id='444545'>
<a class='timestamp' href='#444545'><time timestamp='2015-12-15T12:59:00Z'>12:59</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
test_bitcoin.cpp calls &#x27;pwalletMain = new CWallet(&quot;wallet.dat&quot;);&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1450184340' id='444546'>
<a class='timestamp' href='#444546'><time timestamp='2015-12-15T12:59:00Z'>12:59</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
jonasschnelli, src/wallet/wallet_tests.cpp
<br>
</div>

<div class='talk op-msg' data-timestamp='1450184400' id='444547'>
<a class='timestamp' href='#444547'><time timestamp='2015-12-15T13:00:00Z'>13:00</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Arg. Right: static CWallet wallet;
<br>
</div>

<div class='talk op-msg' data-timestamp='1450184400' id='444548'>
<a class='timestamp' href='#444548'><time timestamp='2015-12-15T13:00:00Z'>13:00</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Maybe for test reasons it could make sense... although, even there we could inject a tmp file
<br>
</div>

<div class='talk op-msg' data-timestamp='1450184400' id='444549'>
<a class='timestamp' href='#444549'><time timestamp='2015-12-15T13:00:00Z'>13:00</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
(and get rid of the fFileBackend stuff)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450185420' id='444550'>
<a class='timestamp' href='#444550'><time timestamp='2015-12-15T13:17:00Z'>13:17</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Luke-Jr: background has now to tiffs,... but does not appear on my mac. Maybe a DSStore problem? Why did you change the DS_Store file anyway? Because of the icon position (based on the filename)?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450188240' id='444551'>
<a class='timestamp' href='#444551'><time timestamp='2015-12-15T14:04:00Z'>14:04</time></a>
&lt;<span class='nick nick-16'> GitHub138</span>&gt;
[bitcoin] tnull opened pull request #7216: Removed offline testnet DNSSeed &#x27;alexykot.me&#x27;. (master...delete_offline_dnsseed) <a href="https://github.com/bitcoin/bitcoin/pull/7216" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/7216</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1450203000' id='444552'>
<a class='timestamp' href='#444552'><time timestamp='2015-12-15T18:10:00Z'>18:10</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
if anyone is up for reviewing 7062, it could use some review (one of last two PRs tagged for 0.12 that&#x27;s not yet merged).
<br>
</div>

<div class='talk op-msg' data-timestamp='1450209660' id='444553'>
<a class='timestamp' href='#444553'><time timestamp='2015-12-15T20:01:00Z'>20:01</time></a>
&lt;<span class='nick nick-9'> desantis</span>&gt;
honest question: How does this channel differ from bitcoin-dev?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450209780' id='444554'>
<a class='timestamp' href='#444554'><time timestamp='2015-12-15T20:03:00Z'>20:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
This is specifically about the Bitcoin Core software, and its implementation details
<br>
</div>

<div class='talk op-msg' data-timestamp='1450209780' id='444555'>
<a class='timestamp' href='#444555'><time timestamp='2015-12-15T20:03:00Z'>20:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
#bitcoin-dev is more for development of the protocol
<br>
</div>

<div class='talk op-msg' data-timestamp='1450210620' id='444556'>
<a class='timestamp' href='#444556'><time timestamp='2015-12-15T20:17:00Z'>20:17</time></a>
&lt;<span class='nick nick-9'> desantis</span>&gt;
sipa: thanks!
<br>
</div>

<div class='talk op-msg' data-timestamp='1450210980' id='444557'>
<a class='timestamp' href='#444557'><time timestamp='2015-12-15T20:23:00Z'>20:23</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
why do blocks with more sigops than MAX_BLOCK_SIGOPS not get marked as failed (BLOCK_FAILED_VALID)?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450211580' id='444558'>
<a class='timestamp' href='#444558'><time timestamp='2015-12-15T20:33:00Z'>20:33</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
sdaftuar: thry should!
<br>
</div>

<div class='talk op-msg' data-timestamp='1450211580' id='444559'>
<a class='timestamp' href='#444559'><time timestamp='2015-12-15T20:33:00Z'>20:33</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
sipa: ah, good to know
<br>
</div>

<div class='talk op-msg' data-timestamp='1450212360' id='444560'>
<a class='timestamp' href='#444560'><time timestamp='2015-12-15T20:46:00Z'>20:46</time></a>
&lt;<span class='nick nick-9'> GitHub85</span>&gt;
[bitcoin] sdaftuar opened pull request #7217: Mark blocks with too many sigops as failed (master...fix-sigops-rejection) <a href="https://github.com/bitcoin/bitcoin/pull/7217" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/7217</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218120' id='444561'>
<a class='timestamp' href='#444561'><time timestamp='2015-12-15T22:22:00Z'>22:22</time></a>
&lt;<span class='nick nick-4'> job_</span>&gt;
BlueMatt gmaxwell good seeing you guys last night. a few quick questions about getblocktemplate when you&#x27;ve got a sec
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218180' id='444562'>
<a class='timestamp' href='#444562'><time timestamp='2015-12-15T22:23:00Z'>22:23</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
go for it
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218240' id='444563'>
<a class='timestamp' href='#444563'><time timestamp='2015-12-15T22:24:00Z'>22:24</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
i) what, in particular, about getblocktemplate requires holding cs_main? is it just that CreateNewBlock needs it, or do we want a consistent snapshot of the txs to include in the template?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218240' id='444564'>
<a class='timestamp' href='#444564'><time timestamp='2015-12-15T22:24:00Z'>22:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yeah, consistent snapshot
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218300' id='444565'>
<a class='timestamp' href='#444565'><time timestamp='2015-12-15T22:25:00Z'>22:25</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and later verification of the constructed block
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218300' id='444566'>
<a class='timestamp' href='#444566'><time timestamp='2015-12-15T22:25:00Z'>22:25</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which needs access to the utxo set
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218300' id='444567'>
<a class='timestamp' href='#444567'><time timestamp='2015-12-15T22:25:00Z'>22:25</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
okay, so we need a consistent view of the utxo set to validate the block template we&#x27;ve just constructed
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218420' id='444568'>
<a class='timestamp' href='#444568'><time timestamp='2015-12-15T22:27:00Z'>22:27</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
ii) under what circumstances do we want to rebuild this blocktemplate cache we&#x27;re talking about replacing the `CreateNewBlock` routine with?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218420' id='444569'>
<a class='timestamp' href='#444569'><time timestamp='2015-12-15T22:27:00Z'>22:27</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jamesob: yes, CreateNewBlock needs a consistent snapshot of the utxo
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218420' id='444570'>
<a class='timestamp' href='#444570'><time timestamp='2015-12-15T22:27:00Z'>22:27</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
so getblocktemplate shouldn&#x27;t take cs_main, but CreateNewBlock will, ofc, have to
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218420' id='444571'>
<a class='timestamp' href='#444571'><time timestamp='2015-12-15T22:27:00Z'>22:27</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
e.g. on new chain tip, on new txs, periodically?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218420' id='444572'>
<a class='timestamp' href='#444572'><time timestamp='2015-12-15T22:27:00Z'>22:27</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
or some/all of the above
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218420' id='444573'>
<a class='timestamp' href='#444573'><time timestamp='2015-12-15T22:27:00Z'>22:27</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
hmm? no, keep CreateNewBlock, just cache its output in a field that getblocktemplate reads from
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218480' id='444574'>
<a class='timestamp' href='#444574'><time timestamp='2015-12-15T22:28:00Z'>22:28</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
as for rebuilding, just call CreateNewBlock on a timer for now
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218480' id='444575'>
<a class='timestamp' href='#444575'><time timestamp='2015-12-15T22:28:00Z'>22:28</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
we can get smarter later :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218480' id='444576'>
<a class='timestamp' href='#444576'><time timestamp='2015-12-15T22:28:00Z'>22:28</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
right on
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218480' id='444577'>
<a class='timestamp' href='#444577'><time timestamp='2015-12-15T22:28:00Z'>22:28</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
so should we start with a PR that moves CreateNewBlock to a time-rebuilt cache, then iterate from there?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218480' id='444578'>
<a class='timestamp' href='#444578'><time timestamp='2015-12-15T22:28:00Z'>22:28</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
and the timer can be aggressive as long as CreateNewBlock aggressively gives up cs_main and just fails when a new block is coming in
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218540' id='444579'>
<a class='timestamp' href='#444579'><time timestamp='2015-12-15T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
I&#x27;d assume all three things from last night can fit into one pr
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218540' id='444580'>
<a class='timestamp' href='#444580'><time timestamp='2015-12-15T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
I&#x27;d hope its not much code, though, again, I havent looked at it
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218540' id='444581'>
<a class='timestamp' href='#444581'><time timestamp='2015-12-15T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
problem with moving CNB to a background-thread by itself is you end up with way more cs_main time :(
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218540' id='444582'>
<a class='timestamp' href='#444582'><time timestamp='2015-12-15T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
it looks like there&#x27;s gonna be some shuffling... might have to factor the innards of the rpc definition out into some separate bit that we can call from some scheduled routine
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218600' id='444583'>
<a class='timestamp' href='#444583'><time timestamp='2015-12-15T22:30:00Z'>22:30</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
BlueMatt yeah, that&#x27;s what I was thinking...
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218600' id='444584'>
<a class='timestamp' href='#444584'><time timestamp='2015-12-15T22:30:00Z'>22:30</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
like, if we&#x27;ve got this thing acquiring cs_main on an aggressive regular schedule, that may cause MORE contention
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218600' id='444585'>
<a class='timestamp' href='#444585'><time timestamp='2015-12-15T22:30:00Z'>22:30</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
yea, I figured half of the rpc code would have to be moved out
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218600' id='444586'>
<a class='timestamp' href='#444586'><time timestamp='2015-12-15T22:30:00Z'>22:30</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
that wouldnt surprise me
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218660' id='444587'>
<a class='timestamp' href='#444587'><time timestamp='2015-12-15T22:31:00Z'>22:31</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
yup, hence the requirement to drop cs_main and fail mid-process if there is &quot;important&quot; contention (ie a new block came in)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218660' id='444588'>
<a class='timestamp' href='#444588'><time timestamp='2015-12-15T22:31:00Z'>22:31</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
contention around cs_main for other things sucks, but doesnt matter too much to most users
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218660' id='444589'>
<a class='timestamp' href='#444589'><time timestamp='2015-12-15T22:31:00Z'>22:31</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
ah, right. is there some existing pattern for saying &quot;hey, this is a low-prio lock acquisition, allow interrupts&quot;?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218720' id='444590'>
<a class='timestamp' href='#444590'><time timestamp='2015-12-15T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
nope
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218720' id='444591'>
<a class='timestamp' href='#444591'><time timestamp='2015-12-15T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
a large portion of the cs_main locking is actually due to ProcessMessage/SendMessage, which don&#x27;t actually need cs_main (they could get their own locks that lock node-specific data)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218720' id='444592'>
<a class='timestamp' href='#444592'><time timestamp='2015-12-15T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
(and dont go overengineering there, either, which would be easy to do)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218720' id='444593'>
<a class='timestamp' href='#444593'><time timestamp='2015-12-15T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
ahhhhh, scope creep
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218720' id='444594'>
<a class='timestamp' href='#444594'><time timestamp='2015-12-15T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
heh
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218780' id='444595'>
<a class='timestamp' href='#444595'><time timestamp='2015-12-15T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
this one is wayyyy too easy to scope-creep on
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218780' id='444596'>
<a class='timestamp' href='#444596'><time timestamp='2015-12-15T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
don&#x27;t worry, I&#x27;m just tryin&#x27; to hold onto my ass for now -- not going to go on any cosmic refactoring adventures ;)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218780' id='444597'>
<a class='timestamp' href='#444597'><time timestamp='2015-12-15T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
adding a global boolean called fAboutToLockCSMainForBlockProcessing sucks, but.....more than that is gonna lead to bike shedding
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218900' id='444598'>
<a class='timestamp' href='#444598'><time timestamp='2015-12-15T22:35:00Z'>22:35</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
so, I forget: your suggestion was to set fAboutToLock...=true once you&#x27;re going to rebuild the cache, and drop out of the process if some other thread has set that flag to false, i.e. signifying that there&#x27;s some more important op that needs that lock?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218960' id='444599'>
<a class='timestamp' href='#444599'><time timestamp='2015-12-15T22:36:00Z'>22:36</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
no, set the flag to true in ProcessMessage or AcceptNewBlock or wherever cs_main is first locked for block acceptance (from RPC or net, you really need to check both)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450218960' id='444600'>
<a class='timestamp' href='#444600'><time timestamp='2015-12-15T22:36:00Z'>22:36</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
then CNB will poll that flag a bunch while its running, and if it sees it, bail out
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219020' id='444601'>
<a class='timestamp' href='#444601'><time timestamp='2015-12-15T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
gotcha
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219020' id='444602'>
<a class='timestamp' href='#444602'><time timestamp='2015-12-15T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
once you get cs_main for new block processing, you can then drop the flag and let the background CNB thread wait for its turn for cs_main
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219020' id='444603'>
<a class='timestamp' href='#444603'><time timestamp='2015-12-15T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
note that such a flag technically would require its own lock :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219020' id='444604'>
<a class='timestamp' href='#444604'><time timestamp='2015-12-15T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
yup :(
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219020' id='444605'>
<a class='timestamp' href='#444605'><time timestamp='2015-12-15T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
or an atomic bool (but c++11 isn&#x27;t quite there yet...)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219020' id='444606'>
<a class='timestamp' href='#444606'><time timestamp='2015-12-15T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
yea, this is muchhh nicer with atomics
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219020' id='444607'>
<a class='timestamp' href='#444607'><time timestamp='2015-12-15T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
since atomic bool is guaranteed to be lock-free
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219080' id='444608'>
<a class='timestamp' href='#444608'><time timestamp='2015-12-15T22:38:00Z'>22:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
is it?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219080' id='444609'>
<a class='timestamp' href='#444609'><time timestamp='2015-12-15T22:38:00Z'>22:38</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
fGonnaLockHereRealSoonNow = true; LOCK(cs_main); fGonnaLockHereRealSoonNow = false;
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219140' id='444610'>
<a class='timestamp' href='#444610'><time timestamp='2015-12-15T22:39:00Z'>22:39</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
oops, no, sorry, atomic_flag is guaranteed, atomic_bool is not
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219140' id='444611'>
<a class='timestamp' href='#444611'><time timestamp='2015-12-15T22:39:00Z'>22:39</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
cool. iii) how do we want to handle this periodic rebuild; is this going to hook into the CScheduler abstraction somehow, or would we dedicate a whole new thread for it (which I doubt)?
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219140' id='444612'>
<a class='timestamp' href='#444612'><time timestamp='2015-12-15T22:39:00Z'>22:39</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
use CScheduler
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219200' id='444613'>
<a class='timestamp' href='#444613'><time timestamp='2015-12-15T22:40:00Z'>22:40</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
roger
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219740' id='444614'>
<a class='timestamp' href='#444614'><time timestamp='2015-12-15T22:49:00Z'>22:49</time></a>
&lt;<span class='nick nick-4'> jamesob</span>&gt;
good seeing you last night as well, sipa. hope you got some sleep :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1450219800' id='444615'>
<a class='timestamp' href='#444615'><time timestamp='2015-12-15T22:50:00Z'>22:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i did!
<br>
</div>

</div>
</section>

</body>
</html>
