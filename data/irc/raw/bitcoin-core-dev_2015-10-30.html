<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2015-10-30
 â€” 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2015-10-30' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:27 UTC</pre>
<pre><a href="/bitcoin-core-dev/2015-09-30">&lt;</a><span class='header'>   October 2015   </span><a href="/bitcoin-core-dev/2015-11-30">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;             <a class="" href="/bitcoin-core-dev/2015-10-01">1</a>  <a class="" href="/bitcoin-core-dev/2015-10-02">2</a>  <a class="" href="/bitcoin-core-dev/2015-10-03">3</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2015-10-04">4</a>  <a class="" href="/bitcoin-core-dev/2015-10-05">5</a>  <a class="" href="/bitcoin-core-dev/2015-10-06">6</a>  <a class="" href="/bitcoin-core-dev/2015-10-07">7</a>  <a class="" href="/bitcoin-core-dev/2015-10-08">8</a>  <a class="" href="/bitcoin-core-dev/2015-10-09">9</a> <a class="" href="/bitcoin-core-dev/2015-10-10">10</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2015-10-11">11</a> <a class="" href="/bitcoin-core-dev/2015-10-12">12</a> <a class="" href="/bitcoin-core-dev/2015-10-13">13</a> <a class="" href="/bitcoin-core-dev/2015-10-14">14</a> <a class="" href="/bitcoin-core-dev/2015-10-15">15</a> <a class="" href="/bitcoin-core-dev/2015-10-16">16</a> <a class="" href="/bitcoin-core-dev/2015-10-17">17</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2015-10-18">18</a> <a class="" href="/bitcoin-core-dev/2015-10-19">19</a> <a class="" href="/bitcoin-core-dev/2015-10-20">20</a> <a class="" href="/bitcoin-core-dev/2015-10-21">21</a> <a class="" href="/bitcoin-core-dev/2015-10-22">22</a> <a class="" href="/bitcoin-core-dev/2015-10-23">23</a> <a class="" href="/bitcoin-core-dev/2015-10-24">24</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2015-10-25">25</a> <a class="" href="/bitcoin-core-dev/2015-10-26">26</a> <a class="" href="/bitcoin-core-dev/2015-10-27">27</a> <a class="" href="/bitcoin-core-dev/2015-10-28">28</a> <a class="" href="/bitcoin-core-dev/2015-10-29">29</a> <a class="current" href="/bitcoin-core-dev/2015-10-30">30</a> <a class="" href="/bitcoin-core-dev/2015-10-31">31</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1446163620' id='433489'>
<a class='timestamp' href='#433489'><time timestamp='2015-10-30T00:07:00Z'>00:07</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: ^ are you setup to produce windows binaries right now?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163620' id='433490'>
<a class='timestamp' href='#433490'><time timestamp='2015-10-30T00:07:00Z'>00:07</time></a>
&lt;<span class='nick nick-3'> warren</span>&gt;
gmaxwell: here?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163680' id='433491'>
<a class='timestamp' href='#433491'><time timestamp='2015-10-30T00:08:00Z'>00:08</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
right.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163680' id='433492'>
<a class='timestamp' href='#433492'><time timestamp='2015-10-30T00:08:00Z'>00:08</time></a>
&lt;<span class='nick nick-3'> warren</span>&gt;
gmaxwell: sorry the split wasn&#x27;t entirely clear to me.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163680' id='433493'>
<a class='timestamp' href='#433493'><time timestamp='2015-10-30T00:08:00Z'>00:08</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
warren: this channel should be for bitcoin core exclusive discussion.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163680' id='433494'>
<a class='timestamp' href='#433494'><time timestamp='2015-10-30T00:08:00Z'>00:08</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
no one else gives a hoot at how our rpc auth works. :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163740' id='433495'>
<a class='timestamp' href='#433495'><time timestamp='2015-10-30T00:09:00Z'>00:09</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
Fedora does apparently
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163740' id='433496'>
<a class='timestamp' href='#433496'><time timestamp='2015-10-30T00:09:00Z'>00:09</time></a>
&lt;<span class='nick nick-4'> * Luke-Jr</span>&gt;
hides
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163740' id='433497'>
<a class='timestamp' href='#433497'><time timestamp='2015-10-30T00:09:00Z'>00:09</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: do i get 30 minutes to find a bug? :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163800' id='433498'>
<a class='timestamp' href='#433498'><time timestamp='2015-10-30T00:10:00Z'>00:10</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: hahah
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163800' id='433499'>
<a class='timestamp' href='#433499'><time timestamp='2015-10-30T00:10:00Z'>00:10</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: I don&#x27;t want it merged; there is a user that manged to get pubkey &quot;&quot; in his wallet on bct, and I want to give him a binary to see if it rejects it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163860' id='433500'>
<a class='timestamp' href='#433500'><time timestamp='2015-10-30T00:11:00Z'>00:11</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
warren: as far as selinux policy, I think it&#x27;s unfortunate that you cannot confine bitcoin core to have no access outside of its own directory.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163920' id='433501'>
<a class='timestamp' href='#433501'><time timestamp='2015-10-30T00:12:00Z'>00:12</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
though maybe that should be a boolean.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163920' id='433502'>
<a class='timestamp' href='#433502'><time timestamp='2015-10-30T00:12:00Z'>00:12</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
since its only needed for the walletimport/backup stuff.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163980' id='433503'>
<a class='timestamp' href='#433503'><time timestamp='2015-10-30T00:13:00Z'>00:13</time></a>
&lt;<span class='nick nick-3'> warren</span>&gt;
Would it be bad if the system-level systemd service were named something like bitcoinsys.service, with a selinux context bitcoinsys_t, and a bitcoin-cli wrapper named something like /usr/bin/bitcoinsys_cli that only adds the --datadir /path/to/system/datadir/
<br>
</div>

<div class='talk op-msg' data-timestamp='1446163980' id='433504'>
<a class='timestamp' href='#433504'><time timestamp='2015-10-30T00:13:00Z'>00:13</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
and what if the user wants bitcoind run per-user? :P
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164160' id='433505'>
<a class='timestamp' href='#433505'><time timestamp='2015-10-30T00:16:00Z'>00:16</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
warren: what happens if a second datadir is specified to bitcoin-cli?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164160' id='433506'>
<a class='timestamp' href='#433506'><time timestamp='2015-10-30T00:16:00Z'>00:16</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
warren: it&#x27;s all ugly, bitcoin core is currently not intended for system level operation. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164220' id='433507'>
<a class='timestamp' href='#433507'><time timestamp='2015-10-30T00:17:00Z'>00:17</time></a>
&lt;<span class='nick nick-3'> warren</span>&gt;
gmaxwell: hence why i&#x27;m against shipping a .service file at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164400' id='433508'>
<a class='timestamp' href='#433508'><time timestamp='2015-10-30T00:20:00Z'>00:20</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
in any case that doesn&#x27;t sound too horrible but the wrapper would need to not prevent you from overriding the datadir, and it needs to be tested with e.g. super long inputs.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164460' id='433509'>
<a class='timestamp' href='#433509'><time timestamp='2015-10-30T00:21:00Z'>00:21</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
better perhaps would be a compile time setting to adjust the default datadir. Do we have one of those?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164580' id='433510'>
<a class='timestamp' href='#433510'><time timestamp='2015-10-30T00:23:00Z'>00:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
not afaik
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164580' id='433511'>
<a class='timestamp' href='#433511'><time timestamp='2015-10-30T00:23:00Z'>00:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: bug found, will build
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164580' id='433512'>
<a class='timestamp' href='#433512'><time timestamp='2015-10-30T00:23:00Z'>00:23</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
lol okay.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164640' id='433513'>
<a class='timestamp' href='#433513'><time timestamp='2015-10-30T00:24:00Z'>00:24</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
warren: doesn&#x27;t systemd support per-user services?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164640' id='433514'>
<a class='timestamp' href='#433514'><time timestamp='2015-10-30T00:24:00Z'>00:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
Luke-Jr: systemd would be a great operating system, if it only contained a service manager
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164640' id='433515'>
<a class='timestamp' href='#433515'><time timestamp='2015-10-30T00:24:00Z'>00:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
s/if it only/if only it/
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164640' id='433516'>
<a class='timestamp' href='#433516'><time timestamp='2015-10-30T00:24:00Z'>00:24</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
don&#x27;t get me wrong, I hate systemd. but I thought this was one of the few benefits to it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164760' id='433517'>
<a class='timestamp' href='#433517'><time timestamp='2015-10-30T00:26:00Z'>00:26</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Seperate subject; <a href="https://github.com/bitcoin/bitcoin/pull/6902" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6902</a>  I feel that changes like this make the software more opaque.  Now to understand whats being done there you must read two places instead of one.  If you only look at policy.h you will likely erroniously believe it applies to p2sh somehow.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164820' id='433518'>
<a class='timestamp' href='#433518'><time timestamp='2015-10-30T00:27:00Z'>00:27</time></a>
&lt;<span class='nick nick-3'> warren</span>&gt;
Luke-Jr: yes it&#x27;s possible
<br>
</div>

<div class='talk op-msg' data-timestamp='1446164880' id='433519'>
<a class='timestamp' href='#433519'><time timestamp='2015-10-30T00:28:00Z'>00:28</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
It&#x27;s of a class of change where I purposfully try to keep my opinion to myself to avoid amplifying bikeshedding, because it fundimentally does not matter.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446165120' id='433520'>
<a class='timestamp' href='#433520'><time timestamp='2015-10-30T00:32:00Z'>00:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: 32-bit or 64-bit?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446165180' id='433521'>
<a class='timestamp' href='#433521'><time timestamp='2015-10-30T00:33:00Z'>00:33</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: will take a while to build dependencies
<br>
</div>

<div class='talk op-msg' data-timestamp='1446165240' id='433522'>
<a class='timestamp' href='#433522'><time timestamp='2015-10-30T00:34:00Z'>00:34</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
user say &quot;or&quot; so 64-bit I guess.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166200' id='433523'>
<a class='timestamp' href='#433523'><time timestamp='2015-10-30T00:50:00Z'>00:50</time></a>
&lt;<span class='nick nick-6'> GitHub198</span>&gt;
[bitcoin] nathanimpact opened pull request #6909: 0.8 (master...0.8) <a href="https://github.com/bitcoin/bitcoin/pull/6909" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6909</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166200' id='433524'>
<a class='timestamp' href='#433524'><time timestamp='2015-10-30T00:50:00Z'>00:50</time></a>
&lt;<span class='nick nick-7'> GitHub180</span>&gt;
[bitcoin] gmaxwell closed pull request #6909: 0.8 (master...0.8) <a href="https://github.com/bitcoin/bitcoin/pull/6909" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6909</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166200' id='433525'>
<a class='timestamp' href='#433525'><time timestamp='2015-10-30T00:50:00Z'>00:50</time></a>
&lt;<span class='nick nick-8'> GitHub190</span>&gt;
[bitcoin] nathanimpact opened pull request #6910: 0.9 (master...0.9) <a href="https://github.com/bitcoin/bitcoin/pull/6910" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6910</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166260' id='433526'>
<a class='timestamp' href='#433526'><time timestamp='2015-10-30T00:51:00Z'>00:51</time></a>
&lt;<span class='nick nick-12'> GitHub40</span>&gt;
[bitcoin] nathanimpact opened pull request #6911: 0.10 (master...0.10) <a href="https://github.com/bitcoin/bitcoin/pull/6911" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6911</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166260' id='433527'>
<a class='timestamp' href='#433527'><time timestamp='2015-10-30T00:51:00Z'>00:51</time></a>
&lt;<span class='nick nick-4'> GitHub112</span>&gt;
[bitcoin] gmaxwell closed pull request #6910: 0.9 (master...0.9) <a href="https://github.com/bitcoin/bitcoin/pull/6910" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6910</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166260' id='433528'>
<a class='timestamp' href='#433528'><time timestamp='2015-10-30T00:51:00Z'>00:51</time></a>
&lt;<span class='nick nick-14'> GitHub69</span>&gt;
[bitcoin] nathanimpact opened pull request #6912: 0.11 (master...0.11) <a href="https://github.com/bitcoin/bitcoin/pull/6912" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6912</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166260' id='433529'>
<a class='timestamp' href='#433529'><time timestamp='2015-10-30T00:51:00Z'>00:51</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I wish github would let you block these.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166260' id='433530'>
<a class='timestamp' href='#433530'><time timestamp='2015-10-30T00:51:00Z'>00:51</time></a>
&lt;<span class='nick nick-13'> GitHub93</span>&gt;
[bitcoin] gmaxwell closed pull request #6911: 0.10 (master...0.10) <a href="https://github.com/bitcoin/bitcoin/pull/6911" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6911</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166320' id='433531'>
<a class='timestamp' href='#433531'><time timestamp='2015-10-30T00:52:00Z'>00:52</time></a>
&lt;<span class='nick nick-6'> GitHub198</span>&gt;
[bitcoin] gmaxwell closed pull request #6912: 0.11 (master...0.11) <a href="https://github.com/bitcoin/bitcoin/pull/6912" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6912</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166320' id='433532'>
<a class='timestamp' href='#433532'><time timestamp='2015-10-30T00:52:00Z'>00:52</time></a>
&lt;<span class='nick nick-5'> GitHub45</span>&gt;
[bitcoin] nathanimpact opened pull request #6913: 0.11 (master...0.11) <a href="https://github.com/bitcoin/bitcoin/pull/6913" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6913</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166440' id='433533'>
<a class='timestamp' href='#433533'><time timestamp='2015-10-30T00:54:00Z'>00:54</time></a>
&lt;<span class='nick nick-2'> belcher</span>&gt;
you can block them(!) on the settings panel somewhere in github you can configure these to happen or not
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166440' id='433534'>
<a class='timestamp' href='#433534'><time timestamp='2015-10-30T00:54:00Z'>00:54</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
belcher: what specifically does it block?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166440' id='433535'>
<a class='timestamp' href='#433535'><time timestamp='2015-10-30T00:54:00Z'>00:54</time></a>
&lt;<span class='nick nick-2'> belcher</span>&gt;
turns off or on these bots
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166500' id='433536'>
<a class='timestamp' href='#433536'><time timestamp='2015-10-30T00:55:00Z'>00:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
belcher: we want to block the PRs, not the reporting here :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166500' id='433537'>
<a class='timestamp' href='#433537'><time timestamp='2015-10-30T00:55:00Z'>00:55</time></a>
&lt;<span class='nick nick-2'> belcher</span>&gt;
i see, im not sure thats possible
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166500' id='433538'>
<a class='timestamp' href='#433538'><time timestamp='2015-10-30T00:55:00Z'>00:55</time></a>
&lt;<span class='nick nick-2'> belcher</span>&gt;
if you know they&#x27;re coming you could set the channel mode +n (i think) which stops them being able to message without joining
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166560' id='433539'>
<a class='timestamp' href='#433539'><time timestamp='2015-10-30T00:56:00Z'>00:56</time></a>
&lt;<span class='nick nick-7'> petertodd</span>&gt;
gmaxwell: ACK re your thoughts on #6902 - this isn&#x27;t a constant that you can change after all!
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166620' id='433540'>
<a class='timestamp' href='#433540'><time timestamp='2015-10-30T00:57:00Z'>00:57</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
the bots we want, just not the pointless PRs to merge entire (sometimes altcoin) branches into master.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166740' id='433541'>
<a class='timestamp' href='#433541'><time timestamp='2015-10-30T00:59:00Z'>00:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: building qt failed, sorry
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166740' id='433542'>
<a class='timestamp' href='#433542'><time timestamp='2015-10-30T00:59:00Z'>00:59</time></a>
&lt;<span class='nick nick-7'> petertodd</span>&gt;
gmaxwell: er, scrap that, no policy, not script, dumb of me...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446166740' id='433543'>
<a class='timestamp' href='#433543'><time timestamp='2015-10-30T00:59:00Z'>00:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
not going to spend time investigating
<br>
</div>

<div class='talk op-msg' data-timestamp='1446168540' id='433544'>
<a class='timestamp' href='#433544'><time timestamp='2015-10-30T01:29:00Z'>01:29</time></a>
&lt;<span class='nick nick-10'> GitHub139</span>&gt;
[bitcoin] sipa opened pull request #6914: [WIP] Add pre-allocated vector type and use it for CScript (master...prevector) <a href="https://github.com/bitcoin/bitcoin/pull/6914" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6914</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446168660' id='433545'>
<a class='timestamp' href='#433545'><time timestamp='2015-10-30T01:31:00Z'>01:31</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: why doesn&#x27;t it bounds check?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446168660' id='433546'>
<a class='timestamp' href='#433546'><time timestamp='2015-10-30T01:31:00Z'>01:31</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: because i&#x27;m lazy
<br>
</div>

<div class='talk op-msg' data-timestamp='1446168720' id='433547'>
<a class='timestamp' href='#433547'><time timestamp='2015-10-30T01:32:00Z'>01:32</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: 13% faster with script checking enabled?!
<br>
</div>

<div class='talk op-msg' data-timestamp='1446168720' id='433548'>
<a class='timestamp' href='#433548'><time timestamp='2015-10-30T01:32:00Z'>01:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: disabled
<br>
</div>

<div class='talk op-msg' data-timestamp='1446168720' id='433549'>
<a class='timestamp' href='#433549'><time timestamp='2015-10-30T01:32:00Z'>01:32</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
oh disabled good.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446168720' id='433550'>
<a class='timestamp' href='#433550'><time timestamp='2015-10-30T01:32:00Z'>01:32</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
okay. Yea, missed that on first read.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446168780' id='433551'>
<a class='timestamp' href='#433551'><time timestamp='2015-10-30T01:33:00Z'>01:33</time></a>
&lt;<span class='nick nick-7'> GitHub7</span>&gt;
[bitcoin] sdaftuar opened pull request #6915: [Mempool] Improve removal of invalid transactions after reorgs (master...fix-reorg-handling) <a href="https://github.com/bitcoin/bitcoin/pull/6915" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6915</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446168840' id='433552'>
<a class='timestamp' href='#433552'><time timestamp='2015-10-30T01:34:00Z'>01:34</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the only place where we actually use ::at() is in CScript::IsPayToScriptHash(), and it&#x27;s prefixed with a size check there
<br>
</div>

<div class='talk op-msg' data-timestamp='1446168900' id='433553'>
<a class='timestamp' href='#433553'><time timestamp='2015-10-30T01:35:00Z'>01:35</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
maybe just get rid of the at and make it not compile if its used? Rationale: providing something thats almost vector but less safe in some subtle way will be forgotten. :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446169020' id='433554'>
<a class='timestamp' href='#433554'><time timestamp='2015-10-30T01:37:00Z'>01:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: did you fix the scriptcheck on reindex generally or just patch it out? if the former can you PR the fix?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446169020' id='433555'>
<a class='timestamp' href='#433555'><time timestamp='2015-10-30T01:37:00Z'>01:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i just patched it out
<br>
</div>

<div class='talk op-msg' data-timestamp='1446169020' id='433556'>
<a class='timestamp' href='#433556'><time timestamp='2015-10-30T01:37:00Z'>01:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
(that particular misbehavior is a beautiful interaction with the always need to reindex issue in windows I bet. :-/ )
<br>
</div>

<div class='talk op-msg' data-timestamp='1446170220' id='433557'>
<a class='timestamp' href='#433557'><time timestamp='2015-10-30T01:57:00Z'>01:57</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: building 6906 (+6900, since windows building is broken on modern mingw without 6900)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446170280' id='433558'>
<a class='timestamp' href='#433558'><time timestamp='2015-10-30T01:58:00Z'>01:58</time></a>
&lt;<span class='nick nick-9'> CodeShark</span>&gt;
are you guys trying to reproduce the windows db corruption issues? :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446170280' id='433559'>
<a class='timestamp' href='#433559'><time timestamp='2015-10-30T01:58:00Z'>01:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
not at the moment.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446170280' id='433560'>
<a class='timestamp' href='#433560'><time timestamp='2015-10-30T01:58:00Z'>01:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
CodeShark: warren was talking about that earlier.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446170340' id='433561'>
<a class='timestamp' href='#433561'><time timestamp='2015-10-30T01:59:00Z'>01:59</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I&#x27;m trying to debug a wallet that ended up with a corrupted pubkey in it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446170340' id='433562'>
<a class='timestamp' href='#433562'><time timestamp='2015-10-30T01:59:00Z'>01:59</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
which is in possession of an end user who is helpful but needed a binary.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446170340' id='433563'>
<a class='timestamp' href='#433563'><time timestamp='2015-10-30T01:59:00Z'>01:59</time></a>
&lt;<span class='nick nick-9'> CodeShark</span>&gt;
ah
<br>
</div>

<div class='talk op-msg' data-timestamp='1446170580' id='433564'>
<a class='timestamp' href='#433564'><time timestamp='2015-10-30T02:03:00Z'>02:03</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
As an aside, same user is running a 0.8GB wallet with hundreds of thousands of transactions, on windows.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446170640' id='433565'>
<a class='timestamp' href='#433565'><time timestamp='2015-10-30T02:04:00Z'>02:04</time></a>
&lt;<span class='nick nick-9'> CodeShark</span>&gt;
hah
<br>
</div>

<div class='talk op-msg' data-timestamp='1446170640' id='433566'>
<a class='timestamp' href='#433566'><time timestamp='2015-10-30T02:04:00Z'>02:04</time></a>
&lt;<span class='nick nick-9'> CodeShark</span>&gt;
doesn&#x27;t sound very pleasant on multiple fronts :p
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171540' id='433567'>
<a class='timestamp' href='#433567'><time timestamp='2015-10-30T02:19:00Z'>02:19</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: around?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171540' id='433568'>
<a class='timestamp' href='#433568'><time timestamp='2015-10-30T02:19:00Z'>02:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171600' id='433569'>
<a class='timestamp' href='#433569'><time timestamp='2015-10-30T02:20:00Z'>02:20</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: 23% less memory, sounds like its simply a matter of the allocator being more exact instead of allocating more generously etc
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171600' id='433570'>
<a class='timestamp' href='#433570'><time timestamp='2015-10-30T02:20:00Z'>02:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171660' id='433571'>
<a class='timestamp' href='#433571'><time timestamp='2015-10-30T02:21:00Z'>02:21</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: conceptually, how does <a href="https://github.com/bitcoin/bitcoin/pull/6914" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6914</a> save memory, except that in some cases it is allocated on the stack?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171660' id='433572'>
<a class='timestamp' href='#433572'><time timestamp='2015-10-30T02:21:00Z'>02:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
dcousens: well it uses 32-bit instead of 64-bit sizes
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171660' id='433573'>
<a class='timestamp' href='#433573'><time timestamp='2015-10-30T02:21:00Z'>02:21</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
(and ignoring the 4/8 byte pointer)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171660' id='433574'>
<a class='timestamp' href='#433574'><time timestamp='2015-10-30T02:21:00Z'>02:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so it always saves 4 to 8 bytes
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171660' id='433575'>
<a class='timestamp' href='#433575'><time timestamp='2015-10-30T02:21:00Z'>02:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
apart from that, the only way it saves is by not allocating on the heap
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171720' id='433576'>
<a class='timestamp' href='#433576'><time timestamp='2015-10-30T02:22:00Z'>02:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which has a 16-32 byte overhead
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171720' id='433577'>
<a class='timestamp' href='#433577'><time timestamp='2015-10-30T02:22:00Z'>02:22</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
and the hunch is that takes up 23% of available memory?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171720' id='433578'>
<a class='timestamp' href='#433578'><time timestamp='2015-10-30T02:22:00Z'>02:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so the old structure is on average 40 + N bytes storage
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171780' id='433579'>
<a class='timestamp' href='#433579'><time timestamp='2015-10-30T02:23:00Z'>02:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
sorry, 48 + N
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171780' id='433580'>
<a class='timestamp' href='#433580'><time timestamp='2015-10-30T02:23:00Z'>02:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the new one is 32 for N&lt;=28, and 56 + N for N &gt; 28
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171840' id='433581'>
<a class='timestamp' href='#433581'><time timestamp='2015-10-30T02:24:00Z'>02:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
since almost all CScripts in memory are P2PKH or P2SH, which are less than 28 bytes, this is an improvement
<br>
</div>

<div class='talk op-msg' data-timestamp='1446171900' id='433582'>
<a class='timestamp' href='#433582'><time timestamp='2015-10-30T02:25:00Z'>02:25</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: aren&#x27;t the N objects seperately heap allocated?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172020' id='433583'>
<a class='timestamp' href='#433583'><time timestamp='2015-10-30T02:27:00Z'>02:27</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: any reason not to just use union a std::array and std::vector?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172020' id='433584'>
<a class='timestamp' href='#433584'><time timestamp='2015-10-30T02:27:00Z'>02:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: no
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172080' id='433585'>
<a class='timestamp' href='#433585'><time timestamp='2015-10-30T02:28:00Z'>02:28</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
dcousens: that would be much larger
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172080' id='433586'>
<a class='timestamp' href='#433586'><time timestamp='2015-10-30T02:28:00Z'>02:28</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the trick here is to share the size variable between the two approaches
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172080' id='433587'>
<a class='timestamp' href='#433587'><time timestamp='2015-10-30T02:28:00Z'>02:28</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which you can&#x27;t do if you use the standard std::vector
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172200' id='433588'>
<a class='timestamp' href='#433588'><time timestamp='2015-10-30T02:30:00Z'>02:30</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: hm for some reason I thought it was, so that the removal of objects could be supported without invalidating pointers.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172200' id='433589'>
<a class='timestamp' href='#433589'><time timestamp='2015-10-30T02:30:00Z'>02:30</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: could the same memory savings be achieved by just abstracting a CScript specialised for smaller sizes?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172260' id='433590'>
<a class='timestamp' href='#433590'><time timestamp='2015-10-30T02:31:00Z'>02:31</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
Eh, that&#x27;d be as bad nvm
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172260' id='433591'>
<a class='timestamp' href='#433591'><time timestamp='2015-10-30T02:31:00Z'>02:31</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
dcousens: perhaps i failed to highlihght the largest advantage: reducing load on the heap
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172260' id='433592'>
<a class='timestamp' href='#433592'><time timestamp='2015-10-30T02:31:00Z'>02:31</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which results in worse memory locality and memory fragmentation :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172260' id='433593'>
<a class='timestamp' href='#433593'><time timestamp='2015-10-30T02:31:00Z'>02:31</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: you&#x27;re thinking about a linked list...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172260' id='433594'>
<a class='timestamp' href='#433594'><time timestamp='2015-10-30T02:31:00Z'>02:31</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
indeed, probably where the 13% speedup came from
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172320' id='433595'>
<a class='timestamp' href='#433595'><time timestamp='2015-10-30T02:32:00Z'>02:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
dcousens: and simpler copying
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172320' id='433596'>
<a class='timestamp' href='#433596'><time timestamp='2015-10-30T02:32:00Z'>02:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: a vector can&#x27;t delete elements without invalidating iterators
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172500' id='433597'>
<a class='timestamp' href='#433597'><time timestamp='2015-10-30T02:35:00Z'>02:35</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: is push_back used at all?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172500' id='433598'>
<a class='timestamp' href='#433598'><time timestamp='2015-10-30T02:35:00Z'>02:35</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
no clue
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172560' id='433599'>
<a class='timestamp' href='#433599'><time timestamp='2015-10-30T02:36:00Z'>02:36</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
just wondering, maybe drop the capacity functionality if we don&#x27;t need it
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172560' id='433600'>
<a class='timestamp' href='#433600'><time timestamp='2015-10-30T02:36:00Z'>02:36</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
I feel like we&#x27; wouldn&#x27;t be re-allocating these vectors very often
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172560' id='433601'>
<a class='timestamp' href='#433601'><time timestamp='2015-10-30T02:36:00Z'>02:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
well i wanted something API compatible :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172560' id='433602'>
<a class='timestamp' href='#433602'><time timestamp='2015-10-30T02:36:00Z'>02:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so it&#x27;s not a huge burden to go review whether it can be used or not
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172620' id='433603'>
<a class='timestamp' href='#433603'><time timestamp='2015-10-30T02:37:00Z'>02:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if you just want a compact vector, there are other changes you can make
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172620' id='433604'>
<a class='timestamp' href='#433604'><time timestamp='2015-10-30T02:37:00Z'>02:37</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: I guess if you&#x27;re looking for public compatibility
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172620' id='433605'>
<a class='timestamp' href='#433605'><time timestamp='2015-10-30T02:37:00Z'>02:37</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: IMHO for a change like this, we should start with the smallest subset of changes, optimize on that, then introduce public API compatibility
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172680' id='433606'>
<a class='timestamp' href='#433606'><time timestamp='2015-10-30T02:38:00Z'>02:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the subset of changes is as small as it can be
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172680' id='433607'>
<a class='timestamp' href='#433607'><time timestamp='2015-10-30T02:38:00Z'>02:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the PR contains a few not-strictly necessary changes to just break the assumption that CScript is a vector
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172920' id='433608'>
<a class='timestamp' href='#433608'><time timestamp='2015-10-30T02:42:00Z'>02:42</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
ooi, why free vs new?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172920' id='433609'>
<a class='timestamp' href='#433609'><time timestamp='2015-10-30T02:42:00Z'>02:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
because i need realloc
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172980' id='433610'>
<a class='timestamp' href='#433610'><time timestamp='2015-10-30T02:43:00Z'>02:43</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and this works at a lower level: it&#x27;s allocating memory, not objects
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172980' id='433611'>
<a class='timestamp' href='#433611'><time timestamp='2015-10-30T02:43:00Z'>02:43</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
new is for allocating objects
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172980' id='433612'>
<a class='timestamp' href='#433612'><time timestamp='2015-10-30T02:43:00Z'>02:43</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
? you have a clear type though
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172980' id='433613'>
<a class='timestamp' href='#433613'><time timestamp='2015-10-30T02:43:00Z'>02:43</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446172980' id='433614'>
<a class='timestamp' href='#433614'><time timestamp='2015-10-30T02:43:00Z'>02:43</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
the realloc might not be necessary if you don&#x27;t need the push_back/change_capacity etc
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173040' id='433615'>
<a class='timestamp' href='#433615'><time timestamp='2015-10-30T02:44:00Z'>02:44</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
T
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173040' id='433616'>
<a class='timestamp' href='#433616'><time timestamp='2015-10-30T02:44:00Z'>02:44</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
no, that would call T&#x27;s constructor
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173040' id='433617'>
<a class='timestamp' href='#433617'><time timestamp='2015-10-30T02:44:00Z'>02:44</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the reserved but unused memory doesn&#x27;t contain constructed T objects
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173040' id='433618'>
<a class='timestamp' href='#433618'><time timestamp='2015-10-30T02:44:00Z'>02:44</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
True, but isn&#x27;t T in this case always a char*?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173040' id='433619'>
<a class='timestamp' href='#433619'><time timestamp='2015-10-30T02:44:00Z'>02:44</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i don&#x27;t plan to just use this for char
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173100' id='433620'>
<a class='timestamp' href='#433620'><time timestamp='2015-10-30T02:45:00Z'>02:45</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
hmmm, well, code looks good, tentativee ACK simply cause I&#x27;m still not sure its the best way, but, it is a solution, and it exists :) wd
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173340' id='433621'>
<a class='timestamp' href='#433621'><time timestamp='2015-10-30T02:49:00Z'>02:49</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: did the prior stl instrumentation you did before allow you to easily measure vector overhead in a useful way to go find the biggest offenders?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173340' id='433622'>
<a class='timestamp' href='#433622'><time timestamp='2015-10-30T02:49:00Z'>02:49</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
if we broke the API compatibility, I feel like we could just use managed pointers [at the CSCript level] quite easily with a pooled stack allocator for small scripts, but, if this might be easier if you have other future plans for other areas
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173400' id='433623'>
<a class='timestamp' href='#433623'><time timestamp='2015-10-30T02:50:00Z'>02:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
dcousens: that would indeed by an improvement; CBlock could have its own pool for example, and CTransaction could couple a pool too
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173400' id='433624'>
<a class='timestamp' href='#433624'><time timestamp='2015-10-30T02:50:00Z'>02:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
dcousens: but it&#x27;s a much more invasive change to do well
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173400' id='433625'>
<a class='timestamp' href='#433625'><time timestamp='2015-10-30T02:50:00Z'>02:50</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
indeed
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173400' id='433626'>
<a class='timestamp' href='#433626'><time timestamp='2015-10-30T02:50:00Z'>02:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: define offender?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173460' id='433627'>
<a class='timestamp' href='#433627'><time timestamp='2015-10-30T02:51:00Z'>02:51</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: I guess the benefit of this change, with API compatibility, is it doesn&#x27;t hinder that path in any (except maybe making it look less attractive haha)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173460' id='433628'>
<a class='timestamp' href='#433628'><time timestamp='2015-10-30T02:51:00Z'>02:51</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I do not see why we&#x27;d want <u>_any_</u> overhead of having constant allocation indirection for data where 99.999% of the time its a fixed size. even having the extra pointer is overhead we don&#x27;t need.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173580' id='433629'>
<a class='timestamp' href='#433629'><time timestamp='2015-10-30T02:53:00Z'>02:53</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
gmaxwell: as mentioned above, to do that (I assume you mean using fixed size CScripts), it&#x27;d be a more invasive change
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173580' id='433630'>
<a class='timestamp' href='#433630'><time timestamp='2015-10-30T02:53:00Z'>02:53</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: places where many vectors with a total amount of data them that is almost always small with respect to 40 bytes.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173580' id='433631'>
<a class='timestamp' href='#433631'><time timestamp='2015-10-30T02:53:00Z'>02:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: vectors have 40 byte overhead on average (including the malloc overhead) per vector
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173580' id='433632'>
<a class='timestamp' href='#433632'><time timestamp='2015-10-30T02:53:00Z'>02:53</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
gmaxwell: or by extra pointer did you mean cap?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173640' id='433633'>
<a class='timestamp' href='#433633'><time timestamp='2015-10-30T02:54:00Z'>02:54</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
dcousens: what sipa is doing now is almost a fixed size cscript, no-- only when its an exceptional cscript does it fail over to using an allocation.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173700' id='433634'>
<a class='timestamp' href='#433634'><time timestamp='2015-10-30T02:55:00Z'>02:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i&#x27;m using 28 bytes as cutoff; there are many scripts larger (nearly every scriptSig)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173700' id='433635'>
<a class='timestamp' href='#433635'><time timestamp='2015-10-30T02:55:00Z'>02:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but in places where storage matters, more than 28 is a minority
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173760' id='433636'>
<a class='timestamp' href='#433636'><time timestamp='2015-10-30T02:56:00Z'>02:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i used 36 earlier, and that was still a net benefit, but a smaller one
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173760' id='433637'>
<a class='timestamp' href='#433637'><time timestamp='2015-10-30T02:56:00Z'>02:56</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
ah, I did forget this was used for ScriptSig too.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173880' id='433638'>
<a class='timestamp' href='#433638'><time timestamp='2015-10-30T02:58:00Z'>02:58</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
it&#x27;s kind of amusing how we can optimize for the current set of data and have that not be a huge issue... since it will never change
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173880' id='433639'>
<a class='timestamp' href='#433639'><time timestamp='2015-10-30T02:58:00Z'>02:58</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if we&#x27;d switch to a P3SH with a 256-bit hash, we may need to change it :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173940' id='433640'>
<a class='timestamp' href='#433640'><time timestamp='2015-10-30T02:59:00Z'>02:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
we could use this for valtype inside the script evaluator too, set to 72 bytes (as we rarely have larger script elements), or to 520 (as we don&#x27;t support larger at all)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173940' id='433641'>
<a class='timestamp' href='#433641'><time timestamp='2015-10-30T02:59:00Z'>02:59</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
heh
<br>
</div>

<div class='talk op-msg' data-timestamp='1446173940' id='433642'>
<a class='timestamp' href='#433642'><time timestamp='2015-10-30T02:59:00Z'>02:59</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, sure but like if block_height &lt; 350000 then vectortype = x else vectortype = y
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174000' id='433643'>
<a class='timestamp' href='#433643'><time timestamp='2015-10-30T03:00:00Z'>03:00</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
obviously it needs to be autoadaptive. :P
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174000' id='433644'>
<a class='timestamp' href='#433644'><time timestamp='2015-10-30T03:00:00Z'>03:00</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
:)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174120' id='433645'>
<a class='timestamp' href='#433645'><time timestamp='2015-10-30T03:02:00Z'>03:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Another obvious thing to try is to breakpoint at the validation of block X, then breakpoint at malloc/new  and catch every place it hits the heap allocator during verification of that block.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174600' id='433646'>
<a class='timestamp' href='#433646'><time timestamp='2015-10-30T03:10:00Z'>03:10</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
ignoring memory, I wonder if you just fixed size it to 520 bytes
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174600' id='433647'>
<a class='timestamp' href='#433647'><time timestamp='2015-10-30T03:10:00Z'>03:10</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
dcousens: it can be larger than 520 bytes.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174660' id='433648'>
<a class='timestamp' href='#433648'><time timestamp='2015-10-30T03:11:00Z'>03:11</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
gmaxwell, how?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174660' id='433649'>
<a class='timestamp' href='#433649'><time timestamp='2015-10-30T03:11:00Z'>03:11</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
0_o
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174660' id='433650'>
<a class='timestamp' href='#433650'><time timestamp='2015-10-30T03:11:00Z'>03:11</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
CScript can be larger than 520 bytes
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174660' id='433651'>
<a class='timestamp' href='#433651'><time timestamp='2015-10-30T03:11:00Z'>03:11</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
script stack elements can;t
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174660' id='433652'>
<a class='timestamp' href='#433652'><time timestamp='2015-10-30T03:11:00Z'>03:11</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
phantomcircuit: this is the full script pubkey in a transaction or a full scriptsig in a transaction.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174720' id='433653'>
<a class='timestamp' href='#433653'><time timestamp='2015-10-30T03:12:00Z'>03:12</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
scriptsigs larger than that are probably not even all that uncommon. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174720' id='433654'>
<a class='timestamp' href='#433654'><time timestamp='2015-10-30T03:12:00Z'>03:12</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
ohh
<br>
</div>

<div class='talk op-msg' data-timestamp='1446174780' id='433655'>
<a class='timestamp' href='#433655'><time timestamp='2015-10-30T03:13:00Z'>03:13</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
i thought you were just optimizing for the push data
<br>
</div>

<div class='talk op-msg' data-timestamp='1446176880' id='433656'>
<a class='timestamp' href='#433656'><time timestamp='2015-10-30T03:48:00Z'>03:48</time></a>
&lt;<span class='nick nick-3'> warren</span>&gt;
gmaxwell: a safe wrapper that passes all parameters to some other program is simple like: <a href="http://pkgs.fedoraproject.org/cgit/couchdb.git/tree/couchdb.temporary.sh" class="link" target="_blank">http://pkgs.fedoraproject.org/cgit/couchdb.git/tree/couchdb.temporary.sh</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446176880' id='433657'>
<a class='timestamp' href='#433657'><time timestamp='2015-10-30T03:48:00Z'>03:48</time></a>
&lt;<span class='nick nick-3'> warren</span>&gt;
<a href="https://fedoraproject.org/wiki/BITCOIN" class="link" target="_blank">https://fedoraproject.org/wiki/BITCOIN</a>  
<br>
</div>

<div class='talk op-msg' data-timestamp='1446177000' id='433658'>
<a class='timestamp' href='#433658'><time timestamp='2015-10-30T03:50:00Z'>03:50</time></a>
&lt;<span class='nick nick-3'> warren</span>&gt;
I wrote down what I think would be good for the two different ways in which people want to use bitcoind, as a user and as a system service.  Both would need separate SELinux contexts, and a wrapper like <a href="http://pkgs.fedoraproject.org/cgit/couchdb.git/tree/couchdb.temporary.sh" class="link" target="_blank">http://pkgs.fedoraproject.org/cgit/couchdb.git/tree/couchdb.temporary.sh</a>  to launch the system service under the different context.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446192900' id='433659'>
<a class='timestamp' href='#433659'><time timestamp='2015-10-30T08:15:00Z'>08:15</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
ping <a href="https://github.com/bitcoin/bitcoin/pull/6780" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6780</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446192900' id='433660'>
<a class='timestamp' href='#433660'><time timestamp='2015-10-30T08:15:00Z'>08:15</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
should get in before it gets outdated
<br>
</div>

<div class='talk op-msg' data-timestamp='1446194400' id='433661'>
<a class='timestamp' href='#433661'><time timestamp='2015-10-30T08:40:00Z'>08:40</time></a>
&lt;<span class='nick nick-10'> GitHub158</span>&gt;
[bitcoin] laanwj closed pull request #6913: 0.11 (master...0.11) <a href="https://github.com/bitcoin/bitcoin/pull/6913" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6913</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446198660' id='433662'>
<a class='timestamp' href='#433662'><time timestamp='2015-10-30T09:51:00Z'>09:51</time></a>
&lt;<span class='nick nick-3'> * wumpus</span>&gt;
has an old crappy laptop with windows now, let the carnage begin...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446198960' id='433663'>
<a class='timestamp' href='#433663'><time timestamp='2015-10-30T09:56:00Z'>09:56</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
I&#x27;m sure it comes with rootkits and malware pre-installed to simulate a true, out in the wild windows environment
<br>
</div>

<div class='talk op-msg' data-timestamp='1446199020' id='433664'>
<a class='timestamp' href='#433664'><time timestamp='2015-10-30T09:57:00Z'>09:57</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
:P
<br>
</div>

<div class='talk op-msg' data-timestamp='1446200100' id='433665'>
<a class='timestamp' href='#433665'><time timestamp='2015-10-30T10:15:00Z'>10:15</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
wumpus: what would you say an average time for re-index is?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446200160' id='433666'>
<a class='timestamp' href='#433666'><time timestamp='2015-10-30T10:16:00Z'>10:16</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
(ballpark, obv. very dependent on hardware)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446210720' id='433667'>
<a class='timestamp' href='#433667'><time timestamp='2015-10-30T13:12:00Z'>13:12</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
sipa: i&#x27;ve been trying to track down some odd slowness in ConnectBlock and I found something I think interesting
<br>
</div>

<div class='talk op-msg' data-timestamp='1446210780' id='433668'>
<a class='timestamp' href='#433668'><time timestamp='2015-10-30T13:13:00Z'>13:13</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
When we do UpdateCoins and we need to add the outputs for the new coins we are now creating.  We call ModifyCoins(new tx hash) which will end up doing a database read.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446210840' id='433669'>
<a class='timestamp' href='#433669'><time timestamp='2015-10-30T13:14:00Z'>13:14</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
so even if our cache is completely up to date, we have to read the database anyway
<br>
</div>

<div class='talk op-msg' data-timestamp='1446210840' id='433670'>
<a class='timestamp' href='#433670'><time timestamp='2015-10-30T13:14:00Z'>13:14</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
There is already an existince check for BIP30 earlier
<br>
</div>

<div class='talk op-msg' data-timestamp='1446210840' id='433671'>
<a class='timestamp' href='#433671'><time timestamp='2015-10-30T13:14:00Z'>13:14</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
I&#x27;m wondering if we should have some sort of negative cache too
<br>
</div>

<div class='talk op-msg' data-timestamp='1446210960' id='433672'>
<a class='timestamp' href='#433672'><time timestamp='2015-10-30T13:16:00Z'>13:16</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Also do we need to persist the BIP30 check?  Is it still possible to violate that or now that the old duplicate coinbases are sufficiently buried, its not necessary
<br>
</div>

<div class='talk op-msg' data-timestamp='1446210960' id='433673'>
<a class='timestamp' href='#433673'><time timestamp='2015-10-30T13:16:00Z'>13:16</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Anwyay, I have to go afk.  I&#x27;ll look into it more later.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446215460' id='433674'>
<a class='timestamp' href='#433674'><time timestamp='2015-10-30T14:31:00Z'>14:31</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
sipa: still afk, but yep, thats a cause of SIGNIFICANT slowness in ConnectBlock.  I think we&#x27;d have to change/remove the BIP30 check to really eliminate it, which might be the harder part, bc I think adjusting ModifyCoins to know its a new tx and not lookup seems easy and safe?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217440' id='433675'>
<a class='timestamp' href='#433675'><time timestamp='2015-10-30T15:04:00Z'>15:04</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
cfields: what would be the best way to include the windows determinism postprocessing in the gitian build (in <a href="https://github.com/bitcoin/bitcoin/pull/6900)" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6900)</a> - call it from the descriptor or &#x27;make&#x27;?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217500' id='433676'>
<a class='timestamp' href='#433676'><time timestamp='2015-10-30T15:05:00Z'>15:05</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: since that&#x27;s really only useful for gitian (and a specific version of binutils), i&#x27;d say in the descriptor is fine
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217500' id='433677'>
<a class='timestamp' href='#433677'><time timestamp='2015-10-30T15:05:00Z'>15:05</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yeah, thought as much
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217560' id='433678'>
<a class='timestamp' href='#433678'><time timestamp='2015-10-30T15:06:00Z'>15:06</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
do wonder how to make it output the linker map though
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217560' id='433679'>
<a class='timestamp' href='#433679'><time timestamp='2015-10-30T15:06:00Z'>15:06</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: i haven&#x27;t taken a good look yet, but i&#x27;m surprised that you can&#x27;t find the necessary offsets with objdump/nm/etc. I suppose you tried all those first?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217560' id='433680'>
<a class='timestamp' href='#433680'><time timestamp='2015-10-30T15:06:00Z'>15:06</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
objdump and friends all report virtual addresses
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217620' id='433681'>
<a class='timestamp' href='#433681'><time timestamp='2015-10-30T15:07:00Z'>15:07</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
mm, ok
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217620' id='433682'>
<a class='timestamp' href='#433682'><time timestamp='2015-10-30T15:07:00Z'>15:07</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
and within a section they&#x27;re no help at all, for finding the offset, it&#x27;s not like there&#x27;s a pointer to this variable (the other option may be to parse DWARF information, but hm...)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217680' id='433683'>
<a class='timestamp' href='#433683'><time timestamp='2015-10-30T15:08:00Z'>15:08</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
that may not even work, I don&#x27;t think gdb has an offset to it, it reports it as GS_ExceptionPointers+8/16
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217680' id='433684'>
<a class='timestamp' href='#433684'><time timestamp='2015-10-30T15:08:00Z'>15:08</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: another fleeting thought.. in the mailing-list link you posted, some of my binutils changes are listed in the same changelog...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217680' id='433685'>
<a class='timestamp' href='#433685'><time timestamp='2015-10-30T15:08:00Z'>15:08</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
you completely sure that this is the only hack necessary?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217740' id='433686'>
<a class='timestamp' href='#433686'><time timestamp='2015-10-30T15:09:00Z'>15:09</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
iirc it was the one that removed timestamps from windres
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217740' id='433687'>
<a class='timestamp' href='#433687'><time timestamp='2015-10-30T15:09:00Z'>15:09</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
well I found no other differences between multiple builds
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217740' id='433688'>
<a class='timestamp' href='#433688'><time timestamp='2015-10-30T15:09:00Z'>15:09</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
remember, we still use faketime
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217800' id='433689'>
<a class='timestamp' href='#433689'><time timestamp='2015-10-30T15:10:00Z'>15:10</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
ah, right
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217800' id='433690'>
<a class='timestamp' href='#433690'><time timestamp='2015-10-30T15:10:00Z'>15:10</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
the tor folks build binutils themselves
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217860' id='433691'>
<a class='timestamp' href='#433691'><time timestamp='2015-10-30T15:11:00Z'>15:11</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
but anyhow, the current script works, so I&#x27;ll just integrate that for now
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217860' id='433692'>
<a class='timestamp' href='#433692'><time timestamp='2015-10-30T15:11:00Z'>15:11</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
sounds good
<br>
</div>

<div class='talk op-msg' data-timestamp='1446217980' id='433693'>
<a class='timestamp' href='#433693'><time timestamp='2015-10-30T15:13:00Z'>15:13</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: one last quick thought, another option might be using LD_PRELOAD to wrap malloc (or whatever is leaving unsanitized data)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218220' id='433694'>
<a class='timestamp' href='#433694'><time timestamp='2015-10-30T15:17:00Z'>15:17</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
hehe.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218280' id='433695'>
<a class='timestamp' href='#433695'><time timestamp='2015-10-30T15:18:00Z'>15:18</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
wonder if  mallopt(M_PERTURB,...) can be set from the environment
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218280' id='433696'>
<a class='timestamp' href='#433696'><time timestamp='2015-10-30T15:18:00Z'>15:18</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
I think so! it should do exactly this
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218340' id='433697'>
<a class='timestamp' href='#433697'><time timestamp='2015-10-30T15:19:00Z'>15:19</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
hah! neat. I was just doing a quick malloc-&gt;calloc wrapper. That looks smarter :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218520' id='433698'>
<a class='timestamp' href='#433698'><time timestamp='2015-10-30T15:22:00Z'>15:22</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
 &#x27;export MALLOC_PERTURB_=23&#x27;  seems to work
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218520' id='433699'>
<a class='timestamp' href='#433699'><time timestamp='2015-10-30T15:22:00Z'>15:22</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
(at least outside of gitian, let&#x27;s try inside)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218520' id='433700'>
<a class='timestamp' href='#433700'><time timestamp='2015-10-30T15:22:00Z'>15:22</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
that was an awesome idea
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218580' id='433701'>
<a class='timestamp' href='#433701'><time timestamp='2015-10-30T15:23:00Z'>15:23</time></a>
&lt;<span class='nick nick-3'> * wumpus</span>&gt;
resents having written a PE parser :-)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218640' id='433702'>
<a class='timestamp' href='#433702'><time timestamp='2015-10-30T15:24:00Z'>15:24</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
should probably wrap the linker in a script and export it there, rather than globally. It&#x27;s hard to imagine anything build-side dependent on that, but i&#x27;d hate to see something like the debian-openssl thing crop up again :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218640' id='433703'>
<a class='timestamp' href='#433703'><time timestamp='2015-10-30T15:24:00Z'>15:24</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
also reduces the performance hit
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218700' id='433704'>
<a class='timestamp' href='#433704'><time timestamp='2015-10-30T15:25:00Z'>15:25</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
yep
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218760' id='433705'>
<a class='timestamp' href='#433705'><time timestamp='2015-10-30T15:26:00Z'>15:26</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: nice find on MALLOC_PERTURB_. that makes this very simple :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218820' id='433706'>
<a class='timestamp' href='#433706'><time timestamp='2015-10-30T15:27:00Z'>15:27</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
but the linker is invoked as &#x27;g++&#x27; isn&#x27;t it?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218820' id='433707'>
<a class='timestamp' href='#433707'><time timestamp='2015-10-30T15:27:00Z'>15:27</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
g++ invokes ld
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218880' id='433708'>
<a class='timestamp' href='#433708'><time timestamp='2015-10-30T15:28:00Z'>15:28</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
oh yes it&#x27;s even worse for mingw, it invokes collect2, which is a wrapper for ld. I wonder if it&#x27;s possible to interpose somehwere there
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218880' id='433709'>
<a class='timestamp' href='#433709'><time timestamp='2015-10-30T15:28:00Z'>15:28</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
(well obviously, by replacing the executable... but I wonder if it uses path somewhree)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446218940' id='433710'>
<a class='timestamp' href='#433710'><time timestamp='2015-10-30T15:29:00Z'>15:29</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
uhmm, you can specify your own linker i believe
<br>
</div>

<div class='talk op-msg' data-timestamp='1446219000' id='433711'>
<a class='timestamp' href='#433711'><time timestamp='2015-10-30T15:30:00Z'>15:30</time></a>
&lt;<span class='nick nick-4'> * Luke-Jr</span>&gt;
imagines each of these is used for a reason
<br>
</div>

<div class='talk op-msg' data-timestamp='1446219060' id='433712'>
<a class='timestamp' href='#433712'><time timestamp='2015-10-30T15:31:00Z'>15:31</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
Luke-Jr: &#x27;collect2&#x27; is MS&#x27;s linker, which for mingw is emulated by ld
<br>
</div>

<div class='talk op-msg' data-timestamp='1446219120' id='433713'>
<a class='timestamp' href='#433713'><time timestamp='2015-10-30T15:32:00Z'>15:32</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
oh, it&#x27;s just emulating it?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446219180' id='433714'>
<a class='timestamp' href='#433714'><time timestamp='2015-10-30T15:33:00Z'>15:33</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes - it could really use MS&#x27;s linker, if you have it available
<br>
</div>

<div class='talk op-msg' data-timestamp='1446219180' id='433715'>
<a class='timestamp' href='#433715'><time timestamp='2015-10-30T15:33:00Z'>15:33</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
interesting
<br>
</div>

<div class='talk op-msg' data-timestamp='1446219420' id='433716'>
<a class='timestamp' href='#433716'><time timestamp='2015-10-30T15:37:00Z'>15:37</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: yup, looks like it checks for &#x27;real-ld&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1446219480' id='433717'>
<a class='timestamp' href='#433717'><time timestamp='2015-10-30T15:38:00Z'>15:38</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
and ${prefix}-real-ld
<br>
</div>

<div class='talk op-msg' data-timestamp='1446219600' id='433718'>
<a class='timestamp' href='#433718'><time timestamp='2015-10-30T15:40:00Z'>15:40</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
I haven&#x27;t been able to trick it yet into running a different linker outside the $prefix (created all sorts of variants of collect2 and ld in my PATH)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446219660' id='433719'>
<a class='timestamp' href='#433719'><time timestamp='2015-10-30T15:41:00Z'>15:41</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
one remaning option would be to override gcc&#x27;s specs, but bleh
<br>
</div>

<div class='talk op-msg' data-timestamp='1446219960' id='433720'>
<a class='timestamp' href='#433720'><time timestamp='2015-10-30T15:46:00Z'>15:46</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
seems it only looks for &#x27;linker&#x27; outside its hardcoded path  /usr/lib/gcc/x86_64-w64-mingw32/4.8 if it cannot find it there
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220080' id='433721'>
<a class='timestamp' href='#433721'><time timestamp='2015-10-30T15:48:00Z'>15:48</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
what works is: &#x27;gcc -dumpspecs &gt; specsfile&#x27; &#x27;sed -i s/collect2/mycollect2/g specsfile&#x27; &#x27;gcc -specs=specsfile&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220080' id='433722'>
<a class='timestamp' href='#433722'><time timestamp='2015-10-30T15:48:00Z'>15:48</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
then put mycollect2 somewhere in the path...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220080' id='433723'>
<a class='timestamp' href='#433723'><time timestamp='2015-10-30T15:48:00Z'>15:48</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
it&#x27;s kind of stupid though
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220140' id='433724'>
<a class='timestamp' href='#433724'><time timestamp='2015-10-30T15:49:00Z'>15:49</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
hmm overrding GCC_EXEC_PREFIX may work too
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220140' id='433725'>
<a class='timestamp' href='#433725'><time timestamp='2015-10-30T15:49:00Z'>15:49</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
but that means copying the other files
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220140' id='433726'>
<a class='timestamp' href='#433726'><time timestamp='2015-10-30T15:49:00Z'>15:49</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
oh there is COMPILER_PATH  too, where it will look for subprograms if it cannot find in EXEC_PREFIX
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220140' id='433727'>
<a class='timestamp' href='#433727'><time timestamp='2015-10-30T15:49:00Z'>15:49</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
great, this may yet be solvable
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220200' id='433728'>
<a class='timestamp' href='#433728'><time timestamp='2015-10-30T15:50:00Z'>15:50</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: heh, was just testing that one
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220200' id='433729'>
<a class='timestamp' href='#433729'><time timestamp='2015-10-30T15:50:00Z'>15:50</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
no luck
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220260' id='433730'>
<a class='timestamp' href='#433730'><time timestamp='2015-10-30T15:51:00Z'>15:51</time></a>
&lt;<span class='nick nick-3'> * wumpus</span>&gt;
considers just defining the malloc perturb globally and be done with it...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220260' id='433731'>
<a class='timestamp' href='#433731'><time timestamp='2015-10-30T15:51:00Z'>15:51</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wait, that worked :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220260' id='433732'>
<a class='timestamp' href='#433732'><time timestamp='2015-10-30T15:51:00Z'>15:51</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
export COMPILER_PATH=`pwd`
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220260' id='433733'>
<a class='timestamp' href='#433733'><time timestamp='2015-10-30T15:51:00Z'>15:51</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
then wrap ./collect2
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220320' id='433734'>
<a class='timestamp' href='#433734'><time timestamp='2015-10-30T15:52:00Z'>15:52</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
according to the docs it only looks there if it cannot find it in the EXEC_PREFIX, but will try
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220320' id='433735'>
<a class='timestamp' href='#433735'><time timestamp='2015-10-30T15:52:00Z'>15:52</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yep, seems to work!
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220680' id='433736'>
<a class='timestamp' href='#433736'><time timestamp='2015-10-30T15:58:00Z'>15:58</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
cfields: something like this? <a href="https://gist.github.com/laanwj/10b0981d9d75510a124f" class="link" target="_blank">https://gist.github.com/laanwj/10b0981d9d75510a124f</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220680' id='433737'>
<a class='timestamp' href='#433737'><time timestamp='2015-10-30T15:58:00Z'>15:58</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: <a href="http://pastebin.com/W350ZGK5" class="link" target="_blank">http://pastebin.com/W350ZGK5</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220680' id='433738'>
<a class='timestamp' href='#433738'><time timestamp='2015-10-30T15:58:00Z'>15:58</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
hah!
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220740' id='433739'>
<a class='timestamp' href='#433739'><time timestamp='2015-10-30T15:59:00Z'>15:59</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
looks great
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220740' id='433740'>
<a class='timestamp' href='#433740'><time timestamp='2015-10-30T15:59:00Z'>15:59</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
ah yes, $CC -print-prog-name=collect is nice
<br>
</div>

<div class='talk op-msg' data-timestamp='1446220980' id='433741'>
<a class='timestamp' href='#433741'><time timestamp='2015-10-30T16:03:00Z'>16:03</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
updated to use that <a href="https://gist.github.com/laanwj/10b0981d9d75510a124f" class="link" target="_blank">https://gist.github.com/laanwj/10b0981d9d75510a124f</a>  (now request the path of the collect2 tool while creating the wrapper script instead of hardcoding it in the descriptor)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221040' id='433742'>
<a class='timestamp' href='#433742'><time timestamp='2015-10-30T16:04:00Z'>16:04</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: need to unset COMPILER_PATH or you get an infinite loop
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221040' id='433743'>
<a class='timestamp' href='#433743'><time timestamp='2015-10-30T16:04:00Z'>16:04</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
COMPILER_PATH is not set at that point yet :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221100' id='433744'>
<a class='timestamp' href='#433744'><time timestamp='2015-10-30T16:05:00Z'>16:05</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
it&#x27;s set in the per-host build loop later on
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221160' id='433745'>
<a class='timestamp' href='#433745'><time timestamp='2015-10-30T16:06:00Z'>16:06</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
oh heh, you&#x27;re finding the path outside of the script. nm :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221160' id='433746'>
<a class='timestamp' href='#433746'><time timestamp='2015-10-30T16:06:00Z'>16:06</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes I look up the path upfront
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221160' id='433747'>
<a class='timestamp' href='#433747'><time timestamp='2015-10-30T16:06:00Z'>16:06</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
well that&#x27;s nice and simple if it works
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221340' id='433748'>
<a class='timestamp' href='#433748'><time timestamp='2015-10-30T16:09:00Z'>16:09</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: just to be on the paranoid side, should probably compare before/after to make sure that only the expected bytes changed.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221400' id='433749'>
<a class='timestamp' href='#433749'><time timestamp='2015-10-30T16:10:00Z'>16:10</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
well if more bytes change then we should definitely skip trusty, agreed
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221520' id='433750'>
<a class='timestamp' href='#433750'><time timestamp='2015-10-30T16:12:00Z'>16:12</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
(i just mean eyeballing it once, ofc. not suggesting scripting that part)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221760' id='433751'>
<a class='timestamp' href='#433751'><time timestamp='2015-10-30T16:16:00Z'>16:16</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
leaking heap data into output is really ugly, can be e.g. a privacy issue, I&#x27;m happy it was solved two years ago ;)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221760' id='433752'>
<a class='timestamp' href='#433752'><time timestamp='2015-10-30T16:16:00Z'>16:16</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
MS office had some legendary fuckups in this regard
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221820' id='433753'>
<a class='timestamp' href='#433753'><time timestamp='2015-10-30T16:17:00Z'>16:17</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: assuming mingw is self-hosted,  we can check the bins for leaks and see if the dev had anything interesting in mem :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446221940' id='433754'>
<a class='timestamp' href='#433754'><time timestamp='2015-10-30T16:19:00Z'>16:19</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
hehe
<br>
</div>

<div class='talk op-msg' data-timestamp='1446222000' id='433755'>
<a class='timestamp' href='#433755'><time timestamp='2015-10-30T16:20:00Z'>16:20</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
well in this case it seems it leaks some internal address; could be used to bypass ASLR, if it was a longer running process
<br>
</div>

<div class='talk op-msg' data-timestamp='1446222600' id='433756'>
<a class='timestamp' href='#433756'><time timestamp='2015-10-30T16:30:00Z'>16:30</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
morcos: we should get rid of the bip30 check; it&#x27;s superseeded by bip34
<br>
</div>

<div class='talk op-msg' data-timestamp='1446222660' id='433757'>
<a class='timestamp' href='#433757'><time timestamp='2015-10-30T16:31:00Z'>16:31</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: for the qt fix, can that ifdef just be c/p to the header as well?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446222780' id='433758'>
<a class='timestamp' href='#433758'><time timestamp='2015-10-30T16:33:00Z'>16:33</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
cfields: yes I suppose the same principle can be used to use either PIDLIST_ABSOLUTE or ITEMIDLIST
<br>
</div>

<div class='talk op-msg' data-timestamp='1446222840' id='433759'>
<a class='timestamp' href='#433759'><time timestamp='2015-10-30T16:34:00Z'>16:34</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
(just copy pasting won&#x27;t work though because the typedef won&#x27;t help_
<br>
</div>

<div class='talk op-msg' data-timestamp='1446222900' id='433760'>
<a class='timestamp' href='#433760'><time timestamp='2015-10-30T16:35:00Z'>16:35</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
wumpus: ok. mind PRing that separate? or I can? That needs fixing regardless of when we switch gitian
<br>
</div>

<div class='talk op-msg' data-timestamp='1446222900' id='433761'>
<a class='timestamp' href='#433761'><time timestamp='2015-10-30T16:35:00Z'>16:35</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
no problem if you do :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446222900' id='433762'>
<a class='timestamp' href='#433762'><time timestamp='2015-10-30T16:35:00Z'>16:35</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
i&#x27;m happy to do it, not trying to con you into that one :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446222900' id='433763'>
<a class='timestamp' href='#433763'><time timestamp='2015-10-30T16:35:00Z'>16:35</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
sure, will do
<br>
</div>

<div class='talk op-msg' data-timestamp='1446222960' id='433764'>
<a class='timestamp' href='#433764'><time timestamp='2015-10-30T16:36:00Z'>16:36</time></a>
&lt;<span class='nick nick-3'> * wumpus</span>&gt;
just crashed a windows PC in the middle of initial sync, came back fine after reboot...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446223080' id='433765'>
<a class='timestamp' href='#433765'><time timestamp='2015-10-30T16:38:00Z'>16:38</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
&quot;NotMyFault: Use this executable and driver to crash your system in several different ways&quot; lovely
<br>
</div>

<div class='talk op-msg' data-timestamp='1446223680' id='433766'>
<a class='timestamp' href='#433766'><time timestamp='2015-10-30T16:48:00Z'>16:48</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
the only thing hard to reproduce with a laptop would be a direct power failure
<br>
</div>

<div class='talk op-msg' data-timestamp='1446223860' id='433767'>
<a class='timestamp' href='#433767'><time timestamp='2015-10-30T16:51:00Z'>16:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
remove the battery :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446223980' id='433768'>
<a class='timestamp' href='#433768'><time timestamp='2015-10-30T16:53:00Z'>16:53</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
I&#x27;m not sure that&#x27;s possible with this one without disassembling it
<br>
</div>

<div class='talk op-msg' data-timestamp='1446224040' id='433769'>
<a class='timestamp' href='#433769'><time timestamp='2015-10-30T16:54:00Z'>16:54</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
and not sure bitcoin core should be resilient to motherboard-bends-while-application-is-running crashes :-)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226200' id='433770'>
<a class='timestamp' href='#433770'><time timestamp='2015-10-30T17:30:00Z'>17:30</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
cfields: it worked! windows trusty build is now deterministic <a href="http://s7.postimg.org/bhrf0eui3/Naamloos.png" class="link" target="_blank">http://s7.postimg.org/bhrf0eui3/Naamloos.png</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226200' id='433771'>
<a class='timestamp' href='#433771'><time timestamp='2015-10-30T17:30:00Z'>17:30</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
woohoo :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226200' id='433772'>
<a class='timestamp' href='#433772'><time timestamp='2015-10-30T17:30:00Z'>17:30</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
but... wtf am i looking at?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226260' id='433773'>
<a class='timestamp' href='#433773'><time timestamp='2015-10-30T17:31:00Z'>17:31</time></a>
&lt;<span class='nick nick-3'> mcelrath</span>&gt;
What&#x27;s that usha256?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226260' id='433774'>
<a class='timestamp' href='#433774'><time timestamp='2015-10-30T17:31:00Z'>17:31</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
my hex-as-unicode-blockelements hack
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226320' id='433775'>
<a class='timestamp' href='#433775'><time timestamp='2015-10-30T17:32:00Z'>17:32</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
(somewhat easier to compare patterns than letters/numbers)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226380' id='433776'>
<a class='timestamp' href='#433776'><time timestamp='2015-10-30T17:33:00Z'>17:33</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
ah, neat
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226440' id='433777'>
<a class='timestamp' href='#433777'><time timestamp='2015-10-30T17:34:00Z'>17:34</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
&quot;Fout bij openen blokkendatabase&quot; ah, this time I crashed windows and the block database got corrupted
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226500' id='433778'>
<a class='timestamp' href='#433778'><time timestamp='2015-10-30T17:35:00Z'>17:35</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
usha256: <a href="https://gist.github.com/laanwj/3a142c48046ef862bf91" class="link" target="_blank">https://gist.github.com/laanwj/3a142c48046ef862bf91</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226560' id='433779'>
<a class='timestamp' href='#433779'><time timestamp='2015-10-30T17:36:00Z'>17:36</time></a>
&lt;<span class='nick nick-13'> helo</span>&gt;
corrupted your error messages too! ;)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226620' id='433780'>
<a class='timestamp' href='#433780'><time timestamp='2015-10-30T17:37:00Z'>17:37</time></a>
&lt;<span class='nick nick-7'> zooko</span>&gt;
wtf-8
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226680' id='433781'>
<a class='timestamp' href='#433781'><time timestamp='2015-10-30T17:38:00Z'>17:38</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
lol zooko
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226680' id='433782'>
<a class='timestamp' href='#433782'><time timestamp='2015-10-30T17:38:00Z'>17:38</time></a>
&lt;<span class='nick nick-7'> zooko</span>&gt;
Seriously, what is this for ?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226800' id='433783'>
<a class='timestamp' href='#433783'><time timestamp='2015-10-30T17:40:00Z'>17:40</time></a>
&lt;<span class='nick nick-7'> zooko</span>&gt;
Wow.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226800' id='433784'>
<a class='timestamp' href='#433784'><time timestamp='2015-10-30T17:40:00Z'>17:40</time></a>
&lt;<span class='nick nick-7'> zooko</span>&gt;
Intriguing.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226860' id='433785'>
<a class='timestamp' href='#433785'><time timestamp='2015-10-30T17:41:00Z'>17:41</time></a>
&lt;<span class='nick nick-3'> mcelrath</span>&gt;
I can&#x27;t decide whether that&#x27;s easier to differentiate or not. Better let the computer decide: sha256sum a b | awk &#x27;{print $1}&#x27; | uniq
<br>
</div>

<div class='talk op-msg' data-timestamp='1446226980' id='433786'>
<a class='timestamp' href='#433786'><time timestamp='2015-10-30T17:43:00Z'>17:43</time></a>
&lt;<span class='nick nick-3'> mcelrath</span>&gt;
Also diff -q
<br>
</div>

<div class='talk op-msg' data-timestamp='1446227520' id='433787'>
<a class='timestamp' href='#433787'><time timestamp='2015-10-30T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
mcelrath: what I don&#x27;t like about that is that in the succesful case it provides no output, so I can never be sure whether it crashed (and hence produced no output) or succeeded
<br>
</div>

<div class='talk op-msg' data-timestamp='1446227520' id='433788'>
<a class='timestamp' href='#433788'><time timestamp='2015-10-30T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-3'> mcelrath</span>&gt;
What provides no output?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446227520' id='433789'>
<a class='timestamp' href='#433789'><time timestamp='2015-10-30T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
diff, when files match
<br>
</div>

<div class='talk op-msg' data-timestamp='1446227580' id='433790'>
<a class='timestamp' href='#433790'><time timestamp='2015-10-30T17:53:00Z'>17:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
wumpus: how many such block elements are there?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446227640' id='433791'>
<a class='timestamp' href='#433791'><time timestamp='2015-10-30T17:54:00Z'>17:54</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
sipa: I used the 16 2x2 ones to get 16 bits - but there are also e.g. 1/8th horizontal/vertical full ones, see <a href="https://en.wikipedia.org/wiki/Block_Elements" class="link" target="_blank">https://en.wikipedia.org/wiki/Block_Elements</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446227640' id='433792'>
<a class='timestamp' href='#433792'><time timestamp='2015-10-30T17:54:00Z'>17:54</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
to get 4 bits*
<br>
</div>

<div class='talk op-msg' data-timestamp='1446227700' id='433793'>
<a class='timestamp' href='#433793'><time timestamp='2015-10-30T17:55:00Z'>17:55</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
and if you combine with reverse-video you can get even more, e.g. &quot;right one eights block&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1446227760' id='433794'>
<a class='timestamp' href='#433794'><time timestamp='2015-10-30T17:56:00Z'>17:56</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
most console applications that use thsese, use them for progress bars/gauges etc
<br>
</div>

<div class='talk op-msg' data-timestamp='1446227940' id='433795'>
<a class='timestamp' href='#433795'><time timestamp='2015-10-30T17:59:00Z'>17:59</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
you could also do a kind of Chernof faces visualization using emojis, esp. on mac consoles which render those silly things in color
<br>
</div>

<div class='talk op-msg' data-timestamp='1446228720' id='433796'>
<a class='timestamp' href='#433796'><time timestamp='2015-10-30T18:12:00Z'>18:12</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
&quot;2015-10-30 17:30:05 Corruption: error in middle of record&quot; that&#x27;s the error with the windows chainstate db after crash
<br>
</div>

<div class='talk op-msg' data-timestamp='1446228900' id='433797'>
<a class='timestamp' href='#433797'><time timestamp='2015-10-30T18:15:00Z'>18:15</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
this happens while reading the log, so it is a partial record error
<br>
</div>

<div class='talk op-msg' data-timestamp='1446228900' id='433798'>
<a class='timestamp' href='#433798'><time timestamp='2015-10-30T18:15:00Z'>18:15</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
partial write*
<br>
</div>

<div class='talk op-msg' data-timestamp='1446230220' id='433799'>
<a class='timestamp' href='#433799'><time timestamp='2015-10-30T18:37:00Z'>18:37</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/blob/master/src/leveldb/util/env_win.cc#L587" class="link" target="_blank">https://github.com/bitcoin/bitcoin/blob/master/src/leveldb/util/env_win.cc#L587</a>  shouldn&#x27;t the FlushFuleBuffers and FlushViewOfFile be the other way around?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446230220' id='433800'>
<a class='timestamp' href='#433800'><time timestamp='2015-10-30T18:37:00Z'>18:37</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
the former syncs changes in the file to disk, the latter changes in the memory map to the file
<br>
</div>

<div class='talk op-msg' data-timestamp='1446230220' id='433801'>
<a class='timestamp' href='#433801'><time timestamp='2015-10-30T18:37:00Z'>18:37</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
I may be misunderstanding something of course...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446230340' id='433802'>
<a class='timestamp' href='#433802'><time timestamp='2015-10-30T18:39:00Z'>18:39</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
wumpus: that code may well be wrong
<br>
</div>

<div class='talk op-msg' data-timestamp='1446230400' id='433803'>
<a class='timestamp' href='#433803'><time timestamp='2015-10-30T18:40:00Z'>18:40</time></a>
&lt;<span class='nick nick-3'> * wumpus</span>&gt;
wants to implement a WritableFile with just the win32 base file API and none of this fancy mapping stuff
<br>
</div>

<div class='talk op-msg' data-timestamp='1446230400' id='433804'>
<a class='timestamp' href='#433804'><time timestamp='2015-10-30T18:40:00Z'>18:40</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
like PosixWritableFile but for windows... oh wait, maybe I can even just copy PosixWritableFile and rely on mingw to do the rest for me
<br>
</div>

<div class='talk op-msg' data-timestamp='1446233100' id='433805'>
<a class='timestamp' href='#433805'><time timestamp='2015-10-30T19:25:00Z'>19:25</time></a>
&lt;<span class='nick nick-11'> GitHub92</span>&gt;
[bitcoin] sipa opened pull request #6916: Remove BIP30 enforcement, as it is impossible to trigger since BIP34 (master...nobip30) <a href="https://github.com/bitcoin/bitcoin/pull/6916" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6916</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446233160' id='433806'>
<a class='timestamp' href='#433806'><time timestamp='2015-10-30T19:26:00Z'>19:26</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
wumpus: we should do that, I think
<br>
</div>

<div class='talk op-msg' data-timestamp='1446234900' id='433807'>
<a class='timestamp' href='#433807'><time timestamp='2015-10-30T19:55:00Z'>19:55</time></a>
&lt;<span class='nick nick-14'> GitHub118</span>&gt;
[bitcoin] sipa closed pull request #6916: Remove BIP30 enforcement, as it is impossible to trigger since BIP34 (master...nobip30) <a href="https://github.com/bitcoin/bitcoin/pull/6916" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6916</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446234960' id='433808'>
<a class='timestamp' href='#433808'><time timestamp='2015-10-30T19:56:00Z'>19:56</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
:)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235080' id='433809'>
<a class='timestamp' href='#433809'><time timestamp='2015-10-30T19:58:00Z'>19:58</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: i&#x27;m trying to think whether enforcing it for all blocks (except those two) that don&#x27;t have BIP34 is safe
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235140' id='433810'>
<a class='timestamp' href='#433810'><time timestamp='2015-10-30T19:59:00Z'>19:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
as BIP34 is only sufficient when there are no actual duplicate coinbases
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235140' id='433811'>
<a class='timestamp' href='#433811'><time timestamp='2015-10-30T19:59:00Z'>19:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but there are
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235140' id='433812'>
<a class='timestamp' href='#433812'><time timestamp='2015-10-30T19:59:00Z'>19:59</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: if we ship a wad of the 32 least significant bits of the block hashes up to the height bip 34 activates; and then require that, that would be sufficient.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235260' id='433813'>
<a class='timestamp' href='#433813'><time timestamp='2015-10-30T20:01:00Z'>20:01</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that&#x27;s not very different from a checkpoint...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235320' id='433814'>
<a class='timestamp' href='#433814'><time timestamp='2015-10-30T20:02:00Z'>20:02</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
sipa: ok so i have an even stranger one for you
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235380' id='433815'>
<a class='timestamp' href='#433815'><time timestamp='2015-10-30T20:03:00Z'>20:03</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
when TestBlockValidity ends, between then and when control returns to CreateNewBlock, consistently takes 10-15 ms
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235380' id='433816'>
<a class='timestamp' href='#433816'><time timestamp='2015-10-30T20:03:00Z'>20:03</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
if you recently flushed your cache, i think this number can be 20-25 ms
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235440' id='433817'>
<a class='timestamp' href='#433817'><time timestamp='2015-10-30T20:04:00Z'>20:04</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: checkpoints don&#x27;t fix this, since the corruption can slip in between them.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235440' id='433818'>
<a class='timestamp' href='#433818'><time timestamp='2015-10-30T20:04:00Z'>20:04</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
is it spending 10-15ms in free? :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235440' id='433819'>
<a class='timestamp' href='#433819'><time timestamp='2015-10-30T20:04:00Z'>20:04</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
but i have no idea what if anything should be happening then, the CCoinsViewCache destructor runs, but what else
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235440' id='433820'>
<a class='timestamp' href='#433820'><time timestamp='2015-10-30T20:04:00Z'>20:04</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: is that possible?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235440' id='433821'>
<a class='timestamp' href='#433821'><time timestamp='2015-10-30T20:04:00Z'>20:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and that destructor doesn&#x27;t do anything...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235500' id='433822'>
<a class='timestamp' href='#433822'><time timestamp='2015-10-30T20:05:00Z'>20:05</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
except deleting cacheCoins
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235500' id='433823'>
<a class='timestamp' href='#433823'><time timestamp='2015-10-30T20:05:00Z'>20:05</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
morcos: you could try to do a cacheCoins.clean() in the CCoinsViewCache destructor, and time that?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235500' id='433824'>
<a class='timestamp' href='#433824'><time timestamp='2015-10-30T20:05:00Z'>20:05</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
ok
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235560' id='433825'>
<a class='timestamp' href='#433825'><time timestamp='2015-10-30T20:06:00Z'>20:06</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
or add a .Clean() method that dispatches to cacheCoins.clear()
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235560' id='433826'>
<a class='timestamp' href='#433826'><time timestamp='2015-10-30T20:06:00Z'>20:06</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: it&#x27;s possible e.g. freeing a kazillion and one tiny objects. I&#x27;d done some profiling in the past that suggested to me we were losing a lot of time in the allocator.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235560' id='433827'>
<a class='timestamp' href='#433827'><time timestamp='2015-10-30T20:06:00Z'>20:06</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
#6914 should help there too
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235920' id='433828'>
<a class='timestamp' href='#433828'><time timestamp='2015-10-30T20:12:00Z'>20:12</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
yep, clearing the cache takes 10+ ms
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235980' id='433829'>
<a class='timestamp' href='#433829'><time timestamp='2015-10-30T20:13:00Z'>20:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
try with #6914 :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235980' id='433830'>
<a class='timestamp' href='#433830'><time timestamp='2015-10-30T20:13:00Z'>20:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
actually, it can at most give a 2x speedup
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235980' id='433831'>
<a class='timestamp' href='#433831'><time timestamp='2015-10-30T20:13:00Z'>20:13</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
now the confusing thing is it sometimes takes twice as long if pcoinsTip (the base cache, had recently been semi-flushed)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446235980' id='433832'>
<a class='timestamp' href='#433832'><time timestamp='2015-10-30T20:13:00Z'>20:13</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
i wonder if thats a memory thrashing thing,or it has something to do with the flags on those coins
<br>
</div>

<div class='talk op-msg' data-timestamp='1446236640' id='433833'>
<a class='timestamp' href='#433833'><time timestamp='2015-10-30T20:24:00Z'>20:24</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
replaced the leveldb win32 writable file, let&#x27;s see how it goes <a href="https://github.com/laanwj/bitcoin/commit/86050deaabe7ca0a19db1c5a65e3174c9cb14511" class="link" target="_blank">https://github.com/laanwj/bitcoin/commit/86050deaabe7ca0a19db1c5a65e3174c9cb14511</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446236700' id='433834'>
<a class='timestamp' href='#433834'><time timestamp='2015-10-30T20:25:00Z'>20:25</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
\O/ always good to see a fix that removes a lot of code.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446236760' id='433835'>
<a class='timestamp' href='#433835'><time timestamp='2015-10-30T20:26:00Z'>20:26</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
it is! it&#x27;s extremely simple now, the only thing I&#x27;m not sure about is Sync() versus Flush(), they both do a sync to disk now
<br>
</div>

<div class='talk op-msg' data-timestamp='1446236820' id='433836'>
<a class='timestamp' href='#433836'><time timestamp='2015-10-30T20:27:00Z'>20:27</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
that&#x27;s probably overkill but it cannot hurt either
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237060' id='433837'>
<a class='timestamp' href='#433837'><time timestamp='2015-10-30T20:31:00Z'>20:31</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
going to let it sync a bit and then cause another IRQL_NOT_LESS error and see if it avoids ending up in broken state
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237120' id='433838'>
<a class='timestamp' href='#433838'><time timestamp='2015-10-30T20:32:00Z'>20:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
great!
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237120' id='433839'>
<a class='timestamp' href='#433839'><time timestamp='2015-10-30T20:32:00Z'>20:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
we don&#x27;t need particularly good write performance, i guess
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237120' id='433840'>
<a class='timestamp' href='#433840'><time timestamp='2015-10-30T20:32:00Z'>20:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
as we mostly do batch writes
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237180' id='433841'>
<a class='timestamp' href='#433841'><time timestamp='2015-10-30T20:33:00Z'>20:33</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: so the easy simple thing re: BIP 30 would to just be to disable it for blocks after a certain height right?  
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237240' id='433842'>
<a class='timestamp' href='#433842'><time timestamp='2015-10-30T20:34:00Z'>20:34</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
eh, never mind
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237300' id='433843'>
<a class='timestamp' href='#433843'><time timestamp='2015-10-30T20:35:00Z'>20:35</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
agreed
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237300' id='433844'>
<a class='timestamp' href='#433844'><time timestamp='2015-10-30T20:35:00Z'>20:35</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
we could disable it for blocks that have a certain block as their ancestor
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237300' id='433845'>
<a class='timestamp' href='#433845'><time timestamp='2015-10-30T20:35:00Z'>20:35</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
such block being after BIP 34 and the pre existing duplicate coinbases diverged and were buried
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237300' id='433846'>
<a class='timestamp' href='#433846'><time timestamp='2015-10-30T20:35:00Z'>20:35</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
morcos: fundamentally, the bip30 check can be disabled for any transaction that depends on a bip34 coinbase
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237360' id='433847'>
<a class='timestamp' href='#433847'><time timestamp='2015-10-30T20:36:00Z'>20:36</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: the existing BIP30 violations overwrote without proliferation.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237360' id='433848'>
<a class='timestamp' href='#433848'><time timestamp='2015-10-30T20:36:00Z'>20:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but there have been duplicated coinbases in the past, so there can be transactions that spend such a duplicate, which can become duplicated as well
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237360' id='433849'>
<a class='timestamp' href='#433849'><time timestamp='2015-10-30T20:36:00Z'>20:36</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
meaning there can be no duplicate children.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237360' id='433850'>
<a class='timestamp' href='#433850'><time timestamp='2015-10-30T20:36:00Z'>20:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: if you know the chain
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237360' id='433851'>
<a class='timestamp' href='#433851'><time timestamp='2015-10-30T20:36:00Z'>20:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you can be fed an alternative chain in which that&#x27;s not the case
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237420' id='433852'>
<a class='timestamp' href='#433852'><time timestamp='2015-10-30T20:37:00Z'>20:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
no?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237420' id='433853'>
<a class='timestamp' href='#433853'><time timestamp='2015-10-30T20:37:00Z'>20:37</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
right so if we only disable if you have an ancestor block which sufficietnly buries those, then you&#x27;re good on the main chain
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237420' id='433854'>
<a class='timestamp' href='#433854'><time timestamp='2015-10-30T20:37:00Z'>20:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Right but we could enforce BIP30 for all chains until the point where BIP34 activates.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237420' id='433855'>
<a class='timestamp' href='#433855'><time timestamp='2015-10-30T20:37:00Z'>20:37</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
andif you&#x27;re fed an alternate chain you won&#x27;t disable the check
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237420' id='433856'>
<a class='timestamp' href='#433856'><time timestamp='2015-10-30T20:37:00Z'>20:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
oh I see if it proliferates its not enough.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237420' id='433857'>
<a class='timestamp' href='#433857'><time timestamp='2015-10-30T20:37:00Z'>20:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: BIP34 or not is not enough
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237480' id='433858'>
<a class='timestamp' href='#433858'><time timestamp='2015-10-30T20:38:00Z'>20:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
even post BIP34, a transaction that spends a previous duplicate coinbase is possible (in an alternative chain)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237480' id='433859'>
<a class='timestamp' href='#433859'><time timestamp='2015-10-30T20:38:00Z'>20:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so a checkpoint would work
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237480' id='433860'>
<a class='timestamp' href='#433860'><time timestamp='2015-10-30T20:38:00Z'>20:38</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
yea, so we could disable BIP30 when BIP34 acitivates if and only if the the ancestor chain is the real one.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237480' id='433861'>
<a class='timestamp' href='#433861'><time timestamp='2015-10-30T20:38:00Z'>20:38</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
yes, thats what i was trying to say
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237540' id='433862'>
<a class='timestamp' href='#433862'><time timestamp='2015-10-30T20:39:00Z'>20:39</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
thats the best kind of checkpoint it doesn&#x27;t require you to actually be on the real chain, it just saves you some work if you are
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237540' id='433863'>
<a class='timestamp' href='#433863'><time timestamp='2015-10-30T20:39:00Z'>20:39</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
indeed
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237660' id='433864'>
<a class='timestamp' href='#433864'><time timestamp='2015-10-30T20:41:00Z'>20:41</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
the constant ancestor tests are slightly annoying but much better than running bip30 everywhere.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237840' id='433865'>
<a class='timestamp' href='#433865'><time timestamp='2015-10-30T20:44:00Z'>20:44</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
so erasing these caches is absurdly expensive.  sometimes its 40ms+ 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237900' id='433866'>
<a class='timestamp' href='#433866'><time timestamp='2015-10-30T20:45:00Z'>20:45</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
but why is it higher shortly after the underlying cache has been erased, that i don&#x27;t understand
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237900' id='433867'>
<a class='timestamp' href='#433867'><time timestamp='2015-10-30T20:45:00Z'>20:45</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
how many entries?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237900' id='433868'>
<a class='timestamp' href='#433868'><time timestamp='2015-10-30T20:45:00Z'>20:45</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
the 10ms case was on the order of 5000 entries
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237960' id='433869'>
<a class='timestamp' href='#433869'><time timestamp='2015-10-30T20:46:00Z'>20:46</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
maybe we need a special throw-away-cache which uses an append-only pooled allocation
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237960' id='433870'>
<a class='timestamp' href='#433870'><time timestamp='2015-10-30T20:46:00Z'>20:46</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
... though again, a per-txout cache would be better for that
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237960' id='433871'>
<a class='timestamp' href='#433871'><time timestamp='2015-10-30T20:46:00Z'>20:46</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
but the number of entries is irrelevant, its the number of txins in those entries i guess right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446237960' id='433872'>
<a class='timestamp' href='#433872'><time timestamp='2015-10-30T20:46:00Z'>20:46</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
txouts
<br>
</div>

<div class='talk op-msg' data-timestamp='1446238020' id='433873'>
<a class='timestamp' href='#433873'><time timestamp='2015-10-30T20:47:00Z'>20:47</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
yeah, 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446238680' id='433874'>
<a class='timestamp' href='#433874'><time timestamp='2015-10-30T20:58:00Z'>20:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
what are the heap allocated objects in it? the entries themselves. scripts inside them (largely fixed by pieters alt-vector)? what else? 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446238740' id='433875'>
<a class='timestamp' href='#433875'><time timestamp='2015-10-30T20:59:00Z'>20:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: one allocation in the hashmap per txid; for each txid there is one allocation for a vector of txouts; for each txout there is one allocation for the script (partially fixed by prevector)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446238800' id='433876'>
<a class='timestamp' href='#433876'><time timestamp='2015-10-30T21:00:00Z'>21:00</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
interesting that we always load all the txouts but are still taking per-txout allocation overhead.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446238920' id='433877'>
<a class='timestamp' href='#433877'><time timestamp='2015-10-30T21:02:00Z'>21:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
so in any case if transactions are tending to gather from many distinct txids, then you potentially have a huge blowup in allocations; it&#x27;s e.g. two heap allocations for each txout, ... so if you gather from a 100 txout transaction there is 200 heap allocations for each txin that does that.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446238980' id='433878'>
<a class='timestamp' href='#433878'><time timestamp='2015-10-30T21:03:00Z'>21:03</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
(well, 201) and pieter&#x27;s vector thingy would reduce that to 101 heap allocations.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239040' id='433879'>
<a class='timestamp' href='#433879'><time timestamp='2015-10-30T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
They&#x27;re probably destroyed in the same order they&#x27;re created, which is probably a fairly expensive order for malloc too.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239100' id='433880'>
<a class='timestamp' href='#433880'><time timestamp='2015-10-30T21:05:00Z'>21:05</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
as an aside, after thinking about the heap behavior; I would guess a non-trivial amount of the &#x27;remove on replace&#x27; memory savings is ficticious.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239160' id='433881'>
<a class='timestamp' href='#433881'><time timestamp='2015-10-30T21:06:00Z'>21:06</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Due to fragmentation.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239280' id='433882'>
<a class='timestamp' href='#433882'><time timestamp='2015-10-30T21:08:00Z'>21:08</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
&quot;remove on replace&quot;?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239340' id='433883'>
<a class='timestamp' href='#433883'><time timestamp='2015-10-30T21:09:00Z'>21:09</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
attempts to remove cache entries for transactions evicted from the mempool.  Remove on reject is probably effective, since it&#x27;s removing things it just added.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239400' id='433884'>
<a class='timestamp' href='#433884'><time timestamp='2015-10-30T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
ah yes, well the whole thing i&#x27;m trying to accomplish here is making that unnecessary
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239400' id='433885'>
<a class='timestamp' href='#433885'><time timestamp='2015-10-30T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
if flushing the cache more often is doable (b/c you don&#x27;t flush out the hot entries you&#x27;re about to use)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239400' id='433886'>
<a class='timestamp' href='#433886'><time timestamp='2015-10-30T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: so an append only arena that we can dump as a single operation would ... be a thing that could be done, <u>_but_</u> it leaves us in a world were the only management thing we can do is flush() which would be unfortunate.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239400' id='433887'>
<a class='timestamp' href='#433887'><time timestamp='2015-10-30T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
then instead of worrying about what you&#x27;re adding, just check far more often that you&#x27;re not too big.  most of the time you wont&#x27; have new stuff to write to the DB anyway
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239460' id='433888'>
<a class='timestamp' href='#433888'><time timestamp='2015-10-30T21:11:00Z'>21:11</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: it would be awesome for blocks, not for the mempool
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239460' id='433889'>
<a class='timestamp' href='#433889'><time timestamp='2015-10-30T21:11:00Z'>21:11</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
but for some reason, the cache clearing of the child cache is slower if you&#x27;ve done one of these controlled flushes on the parent cache (or a real full flush) right before you create the child cache
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239460' id='433890'>
<a class='timestamp' href='#433890'><time timestamp='2015-10-30T21:11:00Z'>21:11</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
that makes no sense to me
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239580' id='433891'>
<a class='timestamp' href='#433891'><time timestamp='2015-10-30T21:13:00Z'>21:13</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: hm. even for blocks, say you process block 100 and read in transactions X,Y,Z. then you flush. Then block 101 needs transactions Y and Z again. I&#x27;m not sure how often that happens, but I would be that its way way more common than chance.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239700' id='433892'>
<a class='timestamp' href='#433892'><time timestamp='2015-10-30T21:15:00Z'>21:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: i mean for the scripts in a block
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239760' id='433893'>
<a class='timestamp' href='#433893'><time timestamp='2015-10-30T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: the scriptSigs
<br>
</div>

<div class='talk op-msg' data-timestamp='1446239760' id='433894'>
<a class='timestamp' href='#433894'><time timestamp='2015-10-30T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
not talking about UTXO set or mempool
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240000' id='433895'>
<a class='timestamp' href='#433895'><time timestamp='2015-10-30T21:20:00Z'>21:20</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
ah, indeed. you even have a nice figure on the size of the arena to allocate: just allocate the size of the block, and then it never needs to be realloced.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240060' id='433896'>
<a class='timestamp' href='#433896'><time timestamp='2015-10-30T21:21:00Z'>21:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
even for a single transaction it&#x27;s probably worth it
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240060' id='433897'>
<a class='timestamp' href='#433897'><time timestamp='2015-10-30T21:21:00Z'>21:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
as they&#x27;re immutable
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240060' id='433898'>
<a class='timestamp' href='#433898'><time timestamp='2015-10-30T21:21:00Z'>21:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
hell, a whole transaction could be a single malloced block
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240120' id='433899'>
<a class='timestamp' href='#433899'><time timestamp='2015-10-30T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
with some internal offsets/pointers in it
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240240' id='433900'>
<a class='timestamp' href='#433900'><time timestamp='2015-10-30T21:24:00Z'>21:24</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: thats really what I&#x27;d prefer to see. I don&#x27;t think having one allocation per transaction is unreasonable; but these nested allocations are goofy.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240420' id='433901'>
<a class='timestamp' href='#433901'><time timestamp='2015-10-30T21:27:00Z'>21:27</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: similar to that: AFAIK utxo cache entries cannot change in size. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240480' id='433902'>
<a class='timestamp' href='#433902'><time timestamp='2015-10-30T21:28:00Z'>21:28</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
individual txouts no; the per-tx ones can
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240600' id='433903'>
<a class='timestamp' href='#433903'><time timestamp='2015-10-30T21:30:00Z'>21:30</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: why? the only operation is that they can have entries spent, but that can be a flag that doesn&#x27;t require resizing the object.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240660' id='433904'>
<a class='timestamp' href='#433904'><time timestamp='2015-10-30T21:31:00Z'>21:31</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
(and the operation flushes the dirty part could resize the object when it does so, I suppose, as it will already have exclusive access to it, no?)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240720' id='433905'>
<a class='timestamp' href='#433905'><time timestamp='2015-10-30T21:32:00Z'>21:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: you want to remove the allocated scripts for spent entries, no?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240780' id='433906'>
<a class='timestamp' href='#433906'><time timestamp='2015-10-30T21:33:00Z'>21:33</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: otherwise a full in-memory sync from scratch needs memory for every UTXO every created, rather than a working set
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240840' id='433907'>
<a class='timestamp' href='#433907'><time timestamp='2015-10-30T21:34:00Z'>21:34</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: not quite, if it&#x27;s spent completely you just drop the object. So how much partially spent would there be?  Thats also an unusual case. In any case, it could trigger a rebuild at any time you have exclusive acccess. basically batching the malloc overhead. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240900' id='433908'>
<a class='timestamp' href='#433908'><time timestamp='2015-10-30T21:35:00Z'>21:35</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you always have exclusive access
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240960' id='433909'>
<a class='timestamp' href='#433909'><time timestamp='2015-10-30T21:36:00Z'>21:36</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
e.g. when you spend an entry you set a dity flag and increment a wasted bytes counter. Then if the wastes bytes are over X when you spend from it, you rebuild in place and realloc.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240960' id='433910'>
<a class='timestamp' href='#433910'><time timestamp='2015-10-30T21:36:00Z'>21:36</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
partial spent (of transaction outputs) are quite common
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240960' id='433911'>
<a class='timestamp' href='#433911'><time timestamp='2015-10-30T21:36:00Z'>21:36</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
there are lots of transactions with many outputs
<br>
</div>

<div class='talk op-msg' data-timestamp='1446240960' id='433912'>
<a class='timestamp' href='#433912'><time timestamp='2015-10-30T21:36:00Z'>21:36</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
And if it&#x27;s spent completely, you just free it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241020' id='433913'>
<a class='timestamp' href='#433913'><time timestamp='2015-10-30T21:37:00Z'>21:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
but say a block spends the 100 outputs in order in a block, it makes no sense to resize the object 100 times and then free it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241080' id='433914'>
<a class='timestamp' href='#433914'><time timestamp='2015-10-30T21:38:00Z'>21:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
vectors never reallocate on shrink
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241080' id='433915'>
<a class='timestamp' href='#433915'><time timestamp='2015-10-30T21:38:00Z'>21:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
only on grow
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241140' id='433916'>
<a class='timestamp' href='#433916'><time timestamp='2015-10-30T21:39:00Z'>21:39</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: With a vector we instead have 201 mallocs and 201 frees in that case. (and probably a few reallocs along the way)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241260' id='433917'>
<a class='timestamp' href='#433917'><time timestamp='2015-10-30T21:41:00Z'>21:41</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
where as if the cache entry is a single fixed size object, which never grows, and shrinks only in a deferred way when the amount of memory saved by shrinking would be non-trivial, it&#x27;s 1 malloc, 1 free, and a few reallocs for shrinking along the way... and always in chunks large enough where its meaningful (e.g. where fragmentation doesn&#x27;t prevent the freed memory from being used anyways).
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241380' id='433918'>
<a class='timestamp' href='#433918'><time timestamp='2015-10-30T21:43:00Z'>21:43</time></a>
&lt;<span class='nick nick-12'> GitHub21</span>&gt;
[bitcoin] laanwj opened pull request #6917: leveldb: Win32WritableFile without memory mapping (master...2015_10_leveldb_win_nomap) <a href="https://github.com/bitcoin/bitcoin/pull/6917" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6917</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241440' id='433919'>
<a class='timestamp' href='#433919'><time timestamp='2015-10-30T21:44:00Z'>21:44</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
seems to have worked...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241440' id='433920'>
<a class='timestamp' href='#433920'><time timestamp='2015-10-30T21:44:00Z'>21:44</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
\O/
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241560' id='433921'>
<a class='timestamp' href='#433921'><time timestamp='2015-10-30T21:46:00Z'>21:46</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
too bad the chainstate obfscuation is a bit invasive; it would be nice to have a 0.11.2 that fixes all known corruption issues for windows users.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241620' id='433922'>
<a class='timestamp' href='#433922'><time timestamp='2015-10-30T21:47:00Z'>21:47</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i think it&#x27;s backportable
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241680' id='433923'>
<a class='timestamp' href='#433923'><time timestamp='2015-10-30T21:48:00Z'>21:48</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
it&#x27;s not too bad
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241740' id='433924'>
<a class='timestamp' href='#433924'><time timestamp='2015-10-30T21:49:00Z'>21:49</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
(it wasn&#x27;t that interesting to consider when the leveldb ones remained)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241920' id='433925'>
<a class='timestamp' href='#433925'><time timestamp='2015-10-30T21:52:00Z'>21:52</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
warren: if you want to do a bounty, instead of fixing windows (which wumpus just did, and we should send him flowers)-- perhaps the bounty we should ask for is this:  A NBD server that sakes an initial disk image file (compatible with loopback mount) and logs all writes to it, instead of actually writing them, and then applies the writes as a patch in memory (doesn&#x27;t matter if uses lots of ram).
<br>
</div>

<div class='talk op-msg' data-timestamp='1446241920' id='433926'>
<a class='timestamp' href='#433926'><time timestamp='2015-10-30T21:52:00Z'>21:52</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
  Then it lets you restart it with a image + old log + N and it will truncate the last N writes off the old log.  This would let you construct a test harness where we start a node against an existing chain, sync one block, and shut down. Then attempt to restart with one write less. and so on, for every single write back to the first one, and make sure the node can restart at every point. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242280' id='433927'>
<a class='timestamp' href='#433927'><time timestamp='2015-10-30T21:58:00Z'>21:58</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes, that could be useful
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242580' id='433928'>
<a class='timestamp' href='#433928'><time timestamp='2015-10-30T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
without that kind of test harness I dunno how <u>_anyone_</u> manages to write database software that actually works (well: answer, according to that usenix paper, they mostly just fail. :) )
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242640' id='433929'>
<a class='timestamp' href='#433929'><time timestamp='2015-10-30T22:04:00Z'>22:04</time></a>
&lt;<span class='nick nick-3'> warren</span>&gt;
gmaxwell: you might have convinced me that I shouldn&#x27;t be spending personal income on bounties anymore, I&#x27;d be happy to specify it though =)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242640' id='433930'>
<a class='timestamp' href='#433930'><time timestamp='2015-10-30T22:04:00Z'>22:04</time></a>
&lt;<span class='nick nick-3'> warren</span>&gt;
kanzure: ping
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242700' id='433931'>
<a class='timestamp' href='#433931'><time timestamp='2015-10-30T22:05:00Z'>22:05</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
pong
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242700' id='433932'>
<a class='timestamp' href='#433932'><time timestamp='2015-10-30T22:05:00Z'>22:05</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
for which thing have i been summoned?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242820' id='433933'>
<a class='timestamp' href='#433933'><time timestamp='2015-10-30T22:07:00Z'>22:07</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
there are a few debugging and reverse engineering tools that can rewind execution in memory, but I know of no file systems that can rewind/replay operations explicitly in fine granularity. You&#x27;d say that with journalling file systems it should be possible by truncating/rewinding the journal, but never been able to find reports of anyone doing that...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242820' id='433934'>
<a class='timestamp' href='#433934'><time timestamp='2015-10-30T22:07:00Z'>22:07</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
kanzure: ever seen people who own both a parrot and a dog, ... and the parrot will sometimes call the dog just to see it come?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242820' id='433935'>
<a class='timestamp' href='#433935'><time timestamp='2015-10-30T22:07:00Z'>22:07</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
there was a linux tool for replay but requires kernel module, does replay and rewind of execution state, very bizarre alien thing
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242820' id='433936'>
<a class='timestamp' href='#433936'><time timestamp='2015-10-30T22:07:00Z'>22:07</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
wumpus: I wasted a bunch of time searching and could find nothing.  But it seems to me that this is probably only a few days work on top of a simplistic NBD server.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242820' id='433937'>
<a class='timestamp' href='#433937'><time timestamp='2015-10-30T22:07:00Z'>22:07</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
<a href="http://velvetpulse.com/2012/11/27/scribe-the-deterministic-transparent-record-replay-engine/" class="link" target="_blank">http://velvetpulse.com/2012/11/27/scribe-the-deterministic-transparent-record-replay-engine/</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242880' id='433938'>
<a class='timestamp' href='#433938'><time timestamp='2015-10-30T22:08:00Z'>22:08</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
and maybe <a href="http://rr-project.org/" class="link" target="_blank">http://rr-project.org/</a> but more the last link
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242880' id='433939'>
<a class='timestamp' href='#433939'><time timestamp='2015-10-30T22:08:00Z'>22:08</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes, for execution state for example pandare can do that
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242880' id='433940'>
<a class='timestamp' href='#433940'><time timestamp='2015-10-30T22:08:00Z'>22:08</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
this could possibly be extended to windows vm things but w/e
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242880' id='433941'>
<a class='timestamp' href='#433941'><time timestamp='2015-10-30T22:08:00Z'>22:08</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
RR is awesome, and can do this for execution state, but we need it for disk state seperate from execution. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242880' id='433942'>
<a class='timestamp' href='#433942'><time timestamp='2015-10-30T22:08:00Z'>22:08</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
can&#x27;t find pandare, please link?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242940' id='433943'>
<a class='timestamp' href='#433943'><time timestamp='2015-10-30T22:09:00Z'>22:09</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
but that&#x27;s not really what we want here - we want to restart the application at every point of disk writing
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242940' id='433944'>
<a class='timestamp' href='#433944'><time timestamp='2015-10-30T22:09:00Z'>22:09</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
kanzure: <a href="https://github.com/moyix/panda" class="link" target="_blank">https://github.com/moyix/panda</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242940' id='433945'>
<a class='timestamp' href='#433945'><time timestamp='2015-10-30T22:09:00Z'>22:09</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I expect most of the work related to my NBD suggestion will be discovering that all filesystems are broken, and being unable to get results against bitcoin until the file systems are fixed. :(
<br>
</div>

<div class='talk op-msg' data-timestamp='1446242940' id='433946'>
<a class='timestamp' href='#433946'><time timestamp='2015-10-30T22:09:00Z'>22:09</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
yeah probably just write your own fusefs plugin or something
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243000' id='433947'>
<a class='timestamp' href='#433947'><time timestamp='2015-10-30T22:10:00Z'>22:10</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
and ramfs with snapshotting or something
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243000' id='433948'>
<a class='timestamp' href='#433948'><time timestamp='2015-10-30T22:10:00Z'>22:10</time></a>
&lt;<span class='nick nick-2'> * kanzure</span>&gt;
handwaves
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243000' id='433949'>
<a class='timestamp' href='#433949'><time timestamp='2015-10-30T22:10:00Z'>22:10</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
NBD is bascially the perfect interface for this. It is a remote block device whos primitives are &quot;read this block&quot; and &quot;write this block&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243060' id='433950'>
<a class='timestamp' href='#433950'><time timestamp='2015-10-30T22:11:00Z'>22:11</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
&quot;network block device&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243060' id='433951'>
<a class='timestamp' href='#433951'><time timestamp='2015-10-30T22:11:00Z'>22:11</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
i hope this isn&#x27;t samba
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243060' id='433952'>
<a class='timestamp' href='#433952'><time timestamp='2015-10-30T22:11:00Z'>22:11</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
so the code becomes  if read  check the log replay hashtable, no hits? go to the read only backing device. if hit return that.  if write, append log, and add to the hashtable.   On restart, replay old log into hashtable up to the cutoff point.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243120' id='433953'>
<a class='timestamp' href='#433953'><time timestamp='2015-10-30T22:12:00Z'>22:12</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
samba is not a network block device, but a network filesystem :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243120' id='433954'>
<a class='timestamp' href='#433954'><time timestamp='2015-10-30T22:12:00Z'>22:12</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
(samba is many things)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243240' id='433955'>
<a class='timestamp' href='#433955'><time timestamp='2015-10-30T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
the test harness is, mount the thing, sync a block. shut down. unmount. restart daemon with -1, mount, start daemon sync next block and record success, unmount, go back to the original oldlog, start with -2 ... and so on. for each offset. If there are a million writes made while syncing that first block, you restart a million times.   Once that starts failing, you change the behavior so that it 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243240' id='433956'>
<a class='timestamp' href='#433956'><time timestamp='2015-10-30T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
turns the last write to line-noise... and try it again.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243360' id='433957'>
<a class='timestamp' href='#433957'><time timestamp='2015-10-30T22:16:00Z'>22:16</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
and then you know that, absent reordering at lower levels, there is no point where unclean termination can leave the state irrecoverable in the log-under-test. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243360' id='433958'>
<a class='timestamp' href='#433958'><time timestamp='2015-10-30T22:16:00Z'>22:16</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
obviously this could model reordering too, if barriers get communicated across NBD (I dunno if they do)... but the state space becomes huge fast, so I think you could only try random cases, and not an exhaustive test.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243480' id='433959'>
<a class='timestamp' href='#433959'><time timestamp='2015-10-30T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
warren: random pings in the future are much appreciated, thank you
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243540' id='433960'>
<a class='timestamp' href='#433960'><time timestamp='2015-10-30T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
wumpus: please post test binaries with the leveldb fix. 99.9% of windows users won&#x27;t test from source.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243600' id='433961'>
<a class='timestamp' href='#433961'><time timestamp='2015-10-30T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
the randomized brute force approach would be to crash, restart, crash, restart a VM running bitcoind in a loop, then a zillion times, trying to get it into a state where it won&#x27;t recover
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243600' id='433962'>
<a class='timestamp' href='#433962'><time timestamp='2015-10-30T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-1'> GitHub91</span>&gt;
[bitcoin] sipa opened pull request #6918: Make sigcache faster, more efficient, larger (master...smallsigcache) <a href="https://github.com/bitcoin/bitcoin/pull/6918" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6918</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243600' id='433963'>
<a class='timestamp' href='#433963'><time timestamp='2015-10-30T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
gmaxwell: maybe jonasschnelli would like to post executables; I don&#x27;t have the infrastrcuture for that at the moment
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243600' id='433964'>
<a class='timestamp' href='#433964'><time timestamp='2015-10-30T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: &quot;faster, stronger, better!&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243660' id='433965'>
<a class='timestamp' href='#433965'><time timestamp='2015-10-30T22:21:00Z'>22:21</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
you could selectively break parts of the vm maybe
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243660' id='433966'>
<a class='timestamp' href='#433966'><time timestamp='2015-10-30T22:21:00Z'>22:21</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
e.g. increase unreliability of different system calls
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243780' id='433967'>
<a class='timestamp' href='#433967'><time timestamp='2015-10-30T22:23:00Z'>22:23</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: hitrate could be improved further if you store the height at the time an entry is added the random eviction picks N entries and drops the one with the lowest height.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243840' id='433968'>
<a class='timestamp' href='#433968'><time timestamp='2015-10-30T22:24:00Z'>22:24</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: even with it 10x larger, hitrate for a transactions in the current mempool will not be 100% and thats nuts. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446243960' id='433969'>
<a class='timestamp' href='#433969'><time timestamp='2015-10-30T22:26:00Z'>22:26</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: around 99.3% hitrate on average for the last 8000 entries
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244080' id='433970'>
<a class='timestamp' href='#433970'><time timestamp='2015-10-30T22:28:00Z'>22:28</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
so lets say the block has 2000 signatures drawn from the last 8000, and a 99.3% hitrate. So 14 misses.  If a verify takes 420 microseconds (as it does for openssl), then thats 6 ms added to block processing. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244080' id='433971'>
<a class='timestamp' href='#433971'><time timestamp='2015-10-30T22:28:00Z'>22:28</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the last 1000 have 99.9% hitrate
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244140' id='433972'>
<a class='timestamp' href='#433972'><time timestamp='2015-10-30T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
one way to do it would be to use a unordered_map to int64_t, which just increases sequentially
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244140' id='433973'>
<a class='timestamp' href='#433973'><time timestamp='2015-10-30T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and when removing, randomly find 4 entries and sort them by that number
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244140' id='433974'>
<a class='timestamp' href='#433974'><time timestamp='2015-10-30T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
or 1%-6% slowdown (depending on how much we speed up the rest of block processing).
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244140' id='433975'>
<a class='timestamp' href='#433975'><time timestamp='2015-10-30T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
maintaining a fully ordered index adds a lot of memory
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244140' id='433976'>
<a class='timestamp' href='#433976'><time timestamp='2015-10-30T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I was basically suggesting that but using height, because I think we actually want the oldest of the ones at the current height usually.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244200' id='433977'>
<a class='timestamp' href='#433977'><time timestamp='2015-10-30T22:30:00Z'>22:30</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
otherwise we need to pass down height through several layers of code that are currently height-oblivious
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244200' id='433978'>
<a class='timestamp' href='#433978'><time timestamp='2015-10-30T22:30:00Z'>22:30</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
so map to int32_t, with the height at insertion time. and then pull four entries and reject the lowest height. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244260' id='433979'>
<a class='timestamp' href='#433979'><time timestamp='2015-10-30T22:31:00Z'>22:31</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
oh well meh, true. though block height advance is the magical event that should cause entries to become useless. Not age.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244260' id='433980'>
<a class='timestamp' href='#433980'><time timestamp='2015-10-30T22:31:00Z'>22:31</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
we could make it wipe entries on block verify
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244260' id='433981'>
<a class='timestamp' href='#433981'><time timestamp='2015-10-30T22:31:00Z'>22:31</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that&#x27;s trivial
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244380' id='433982'>
<a class='timestamp' href='#433982'><time timestamp='2015-10-30T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sounds even better. I think with that we could avoid increasing its memory usage, and stay at 10mb. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244440' id='433983'>
<a class='timestamp' href='#433983'><time timestamp='2015-10-30T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: if we can do that, then we could also have that same event trigger a counter that a block has been accepted, no?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244440' id='433984'>
<a class='timestamp' href='#433984'><time timestamp='2015-10-30T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: it&#x27;s a boolean passed down saying whether we want to store or not
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244440' id='433985'>
<a class='timestamp' href='#433985'><time timestamp='2015-10-30T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
per entry
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244440' id='433986'>
<a class='timestamp' href='#433986'><time timestamp='2015-10-30T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
er
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244440' id='433987'>
<a class='timestamp' href='#433987'><time timestamp='2015-10-30T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
    bool Encrypt(const CKeyingMaterial&amp; vchPlaintext, std::vector&lt;unsigned char&gt; &amp;vchCiphertext);
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244500' id='433988'>
<a class='timestamp' href='#433988'><time timestamp='2015-10-30T22:35:00Z'>22:35</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
actually nvm
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244500' id='433989'>
<a class='timestamp' href='#433989'><time timestamp='2015-10-30T22:35:00Z'>22:35</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
i had them reversed in my brain
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244560' id='433990'>
<a class='timestamp' href='#433990'><time timestamp='2015-10-30T22:36:00Z'>22:36</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: the eviction is probably enough, though it still has a bias towards the more recent inserts rather than a bias towards preserving the oldest inserts which are since the prior block.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244560' id='433991'>
<a class='timestamp' href='#433991'><time timestamp='2015-10-30T22:36:00Z'>22:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: meh
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244620' id='433992'>
<a class='timestamp' href='#433992'><time timestamp='2015-10-30T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I don&#x27;t think it matters much, but evict on verify will make that sighash single trick for spending dustspam slow to verify.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244860' id='433993'>
<a class='timestamp' href='#433993'><time timestamp='2015-10-30T22:41:00Z'>22:41</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: what is the average hit rate for a transactions 6000 to 8000 ago?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446244920' id='433994'>
<a class='timestamp' href='#433994'><time timestamp='2015-10-30T22:42:00Z'>22:42</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
gmaxwell, to verify that im reading this right, each time an encrypted wallet is unlocked the first key in mapCryptedKeys is checked against it&#x27;s pubkey and the first time the wallet is unlocked all of the keys are checked against their pubkey, correct?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245040' id='433995'>
<a class='timestamp' href='#433995'><time timestamp='2015-10-30T22:44:00Z'>22:44</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
phantomcircuit: thats my recollection of what it does, yes.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245100' id='433996'>
<a class='timestamp' href='#433996'><time timestamp='2015-10-30T22:45:00Z'>22:45</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
it&#x27;s a slow and not very good test-- the problem, of course, is you get no verification at all if the wallet is never unlocked.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245160' id='433997'>
<a class='timestamp' href='#433997'><time timestamp='2015-10-30T22:46:00Z'>22:46</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
gmaxwell, right
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245160' id='433998'>
<a class='timestamp' href='#433998'><time timestamp='2015-10-30T22:46:00Z'>22:46</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
how about make a list for eviction and evict only when a block is completely verified?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245220' id='433999'>
<a class='timestamp' href='#433999'><time timestamp='2015-10-30T22:47:00Z'>22:47</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
phantomcircuit: complicated and screws up the layering.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245220' id='434000'>
<a class='timestamp' href='#434000'><time timestamp='2015-10-30T22:47:00Z'>22:47</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
phantomcircuit: I&#x27;d rather have a hash basked check that stays with the key, and gets checked on load and any time its used.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245280' id='434001'>
<a class='timestamp' href='#434001'><time timestamp='2015-10-30T22:48:00Z'>22:48</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
gmaxwell, no i meant for the sigcache thing
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245280' id='434002'>
<a class='timestamp' href='#434002'><time timestamp='2015-10-30T22:48:00Z'>22:48</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
phantomcircuit: I know, mutiple threads of discussion.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245280' id='434003'>
<a class='timestamp' href='#434003'><time timestamp='2015-10-30T22:48:00Z'>22:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
phantomcircuit: complicated and screws up the layering :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245280' id='434004'>
<a class='timestamp' href='#434004'><time timestamp='2015-10-30T22:48:00Z'>22:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
phantomcircuit: the sigcache code doesn&#x27;t know about a &#x27;block&#x27; concept at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245340' id='434005'>
<a class='timestamp' href='#434005'><time timestamp='2015-10-30T22:49:00Z'>22:49</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: I don&#x27;t see why the sigcache couldn&#x27;t just have a counter in it, and every time you verify a block you take a lock on the sigcache and increment that counter.  And the current counter value rides with the entries in an ordered map, and does the biased eviction I suggested.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245400' id='434006'>
<a class='timestamp' href='#434006'><time timestamp='2015-10-30T22:50:00Z'>22:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: perfectly doable
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245400' id='434007'>
<a class='timestamp' href='#434007'><time timestamp='2015-10-30T22:50:00Z'>22:50</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
that won&#x27;t require passing anything height around, it&#x27;s not hight anymore then, it&#x27;s just &#x27;sigcache epoch&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245400' id='434008'>
<a class='timestamp' href='#434008'><time timestamp='2015-10-30T22:50:00Z'>22:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
going to benchmark without it to see how large the sigcache actually gets
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245460' id='434009'>
<a class='timestamp' href='#434009'><time timestamp='2015-10-30T22:51:00Z'>22:51</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
well it will get to the maximum size, since there is no eviction except on full. :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245520' id='434010'>
<a class='timestamp' href='#434010'><time timestamp='2015-10-30T22:52:00Z'>22:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
with the evict-when-seen-in-block rule
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245640' id='434011'>
<a class='timestamp' href='#434011'><time timestamp='2015-10-30T22:54:00Z'>22:54</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
gmaxwell, heh
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245640' id='434012'>
<a class='timestamp' href='#434012'><time timestamp='2015-10-30T22:54:00Z'>22:54</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
k, that does have that patalogical performance I mentioned. sadly I don&#x27;t see a nice way to fix that, except perhaps having a one entry FIFO for the last evicted item.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245700' id='434013'>
<a class='timestamp' href='#434013'><time timestamp='2015-10-30T22:55:00Z'>22:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: hmm, what pathological performance?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245760' id='434014'>
<a class='timestamp' href='#434014'><time timestamp='2015-10-30T22:56:00Z'>22:56</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: There is, for example, a block with a 1MB tx of SIGHASH_SINGLE bug using transactions that have all the same signature.   If it&#x27;s cached its almost instant to verify ... otherwise....
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245820' id='434015'>
<a class='timestamp' href='#434015'><time timestamp='2015-10-30T22:57:00Z'>22:57</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
oh!
<br>
</div>

<div class='talk op-msg' data-timestamp='1446245820' id='434016'>
<a class='timestamp' href='#434016'><time timestamp='2015-10-30T22:57:00Z'>22:57</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
similar OP_DUP2 CHECKSIG OP_DUP2 CHECKSIG ... (or checkmultisig with the same pubkey).
<br>
</div>

<div class='talk op-msg' data-timestamp='1446246180' id='434017'>
<a class='timestamp' href='#434017'><time timestamp='2015-10-30T23:03:00Z'>23:03</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
we still end up calling SignatureHash even with the sigcache right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446246240' id='434018'>
<a class='timestamp' href='#434018'><time timestamp='2015-10-30T23:04:00Z'>23:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1446246300' id='434019'>
<a class='timestamp' href='#434019'><time timestamp='2015-10-30T23:05:00Z'>23:05</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
any reason CryptedKeyMap is in keystore.h instead of src/wallet/crypter.h ? (it&#x27;s not used anywhere outside of src/wallet/crypter.{h,cpp})
<br>
</div>

<div class='talk op-msg' data-timestamp='1446246360' id='434020'>
<a class='timestamp' href='#434020'><time timestamp='2015-10-30T23:06:00Z'>23:06</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
nope
<br>
</div>

<div class='talk op-msg' data-timestamp='1446246360' id='434021'>
<a class='timestamp' href='#434021'><time timestamp='2015-10-30T23:06:00Z'>23:06</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
CKeyStore itself should move to script/sign.h
<br>
</div>

<div class='talk op-msg' data-timestamp='1446246360' id='434022'>
<a class='timestamp' href='#434022'><time timestamp='2015-10-30T23:06:00Z'>23:06</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
CBasicKeyStore can stay
<br>
</div>

<div class='talk op-msg' data-timestamp='1446246360' id='434023'>
<a class='timestamp' href='#434023'><time timestamp='2015-10-30T23:06:00Z'>23:06</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and CCryptoKeyStore can indeed move to wallet/crypter
<br>
</div>

<div class='talk op-msg' data-timestamp='1446246720' id='434024'>
<a class='timestamp' href='#434024'><time timestamp='2015-10-30T23:12:00Z'>23:12</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
gmaxwell, also yes that was my basic plan for adding hashing for ckey entries
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248040' id='434025'>
<a class='timestamp' href='#434025'><time timestamp='2015-10-30T23:34:00Z'>23:34</time></a>
&lt;<span class='nick nick-14'> GitHub83</span>&gt;
[bitcoin] laanwj closed pull request #6893: forward-declare univalue in rpcclient + remove include in rpcserver.cpp (master...univalue) <a href="https://github.com/bitcoin/bitcoin/pull/6893" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6893</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248280' id='434026'>
<a class='timestamp' href='#434026'><time timestamp='2015-10-30T23:38:00Z'>23:38</time></a>
&lt;<span class='nick nick-2'> GitHub43</span>&gt;
[bitcoin] laanwj pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/725539ea0376...d482c0a7b246" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/725539ea0376...d482c0a7b246</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248280' id='434027'>
<a class='timestamp' href='#434027'><time timestamp='2015-10-30T23:38:00Z'>23:38</time></a>
&lt;<span class='nick nick-2'> GitHub43</span>&gt;
bitcoin/master e9e6163 Pieter Wuille: Make -checkmempool=1 not fail through int32 overflow
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248280' id='434028'>
<a class='timestamp' href='#434028'><time timestamp='2015-10-30T23:38:00Z'>23:38</time></a>
&lt;<span class='nick nick-2'> GitHub43</span>&gt;
bitcoin/master d482c0a Wladimir J. van der Laan: Merge pull request #6896...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248340' id='434029'>
<a class='timestamp' href='#434029'><time timestamp='2015-10-30T23:39:00Z'>23:39</time></a>
&lt;<span class='nick nick-12'> GitHub192</span>&gt;
[bitcoin] laanwj closed pull request #6896: Make -checkmempool=1 not fail through int32 overflow (master...fixchainsize) <a href="https://github.com/bitcoin/bitcoin/pull/6896" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6896</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248400' id='434030'>
<a class='timestamp' href='#434030'><time timestamp='2015-10-30T23:40:00Z'>23:40</time></a>
&lt;<span class='nick nick-2'> GitHub164</span>&gt;
[bitcoin] laanwj pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/d482c0a7b246...48b5b84ee511" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/d482c0a7b246...48b5b84ee511</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248400' id='434031'>
<a class='timestamp' href='#434031'><time timestamp='2015-10-30T23:40:00Z'>23:40</time></a>
&lt;<span class='nick nick-2'> GitHub164</span>&gt;
bitcoin/master 30d9662 Gregory Maxwell: Reject invalid pubkeys when reading ckey items from the wallet....
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248400' id='434032'>
<a class='timestamp' href='#434032'><time timestamp='2015-10-30T23:40:00Z'>23:40</time></a>
&lt;<span class='nick nick-2'> GitHub164</span>&gt;
bitcoin/master 48b5b84 Wladimir J. van der Laan: Merge pull request #6906...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248400' id='434033'>
<a class='timestamp' href='#434033'><time timestamp='2015-10-30T23:40:00Z'>23:40</time></a>
&lt;<span class='nick nick-16'> GitHub146</span>&gt;
[bitcoin] laanwj closed pull request #6906: Reject invalid pubkeys when reading ckey items from the wallet. (master...ckey_pubkey_check) <a href="https://github.com/bitcoin/bitcoin/pull/6906" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6906</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248940' id='434034'>
<a class='timestamp' href='#434034'><time timestamp='2015-10-30T23:49:00Z'>23:49</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sipa: don&#x27;t mind my nits
<br>
</div>

<div class='talk op-msg' data-timestamp='1446248940' id='434035'>
<a class='timestamp' href='#434035'><time timestamp='2015-10-30T23:49:00Z'>23:49</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
dcousens: you&#x27;re welcome to ask questions :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249000' id='434036'>
<a class='timestamp' href='#434036'><time timestamp='2015-10-30T23:50:00Z'>23:50</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
PR is super clean, the only semantics that weren&#x27;t clear to me was the logic around `store`
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249120' id='434037'>
<a class='timestamp' href='#434037'><time timestamp='2015-10-30T23:52:00Z'>23:52</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
What does it represent? A data &#x27;store&#x27;, or, whether to allow the sigCache to be used?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249120' id='434038'>
<a class='timestamp' href='#434038'><time timestamp='2015-10-30T23:52:00Z'>23:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
store==true is set for mempool transactions, store==false is set for block validation
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249180' id='434039'>
<a class='timestamp' href='#434039'><time timestamp='2015-10-30T23:53:00Z'>23:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the original intent was that we wouldn&#x27;t store validations done during block validation, only query the cache
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249240' id='434040'>
<a class='timestamp' href='#434040'><time timestamp='2015-10-30T23:54:00Z'>23:54</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
So the current usage is whether or not it should use a cache at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249240' id='434041'>
<a class='timestamp' href='#434041'><time timestamp='2015-10-30T23:54:00Z'>23:54</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
no
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249240' id='434042'>
<a class='timestamp' href='#434042'><time timestamp='2015-10-30T23:54:00Z'>23:54</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
with store==false, the cache is still queried; the result of validation is just not stored
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249240' id='434043'>
<a class='timestamp' href='#434043'><time timestamp='2015-10-30T23:54:00Z'>23:54</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
But the cache would be empty no?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249360' id='434044'>
<a class='timestamp' href='#434044'><time timestamp='2015-10-30T23:56:00Z'>23:56</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
The set only gets inserted into if `store == true`
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249360' id='434045'>
<a class='timestamp' href='#434045'><time timestamp='2015-10-30T23:56:00Z'>23:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it gets filled by mempool validations
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249360' id='434046'>
<a class='timestamp' href='#434046'><time timestamp='2015-10-30T23:56:00Z'>23:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and queried for block validations
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249360' id='434047'>
<a class='timestamp' href='#434047'><time timestamp='2015-10-30T23:56:00Z'>23:56</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
AH
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249360' id='434048'>
<a class='timestamp' href='#434048'><time timestamp='2015-10-30T23:56:00Z'>23:56</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
bloody inline statics
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249360' id='434049'>
<a class='timestamp' href='#434049'><time timestamp='2015-10-30T23:56:00Z'>23:56</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
sorry, missed the static
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249360' id='434050'>
<a class='timestamp' href='#434050'><time timestamp='2015-10-30T23:56:00Z'>23:56</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
That makes sense now
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249420' id='434051'>
<a class='timestamp' href='#434051'><time timestamp='2015-10-30T23:57:00Z'>23:57</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
Though signatureCache was a member of CachingTransactionSignatureChecker
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249420' id='434052'>
<a class='timestamp' href='#434052'><time timestamp='2015-10-30T23:57:00Z'>23:57</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
Thought*
<br>
</div>

<div class='talk op-msg' data-timestamp='1446249540' id='434053'>
<a class='timestamp' href='#434053'><time timestamp='2015-10-30T23:59:00Z'>23:59</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
I&#x27;m too used to just never having globals haha, anyway, cheers for answering questions :)
<br>
</div>

</div>
</section>

</body>
</html>
