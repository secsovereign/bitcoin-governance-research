<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2020-09-09
 ‚Äî 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2020-09-09' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:17 UTC</pre>
<pre><a href="/bitcoin-core-dev/2020-08-09">&lt;</a><span class='header'>  September 2020  </span><a href="/bitcoin-core-dev/2020-10-09">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;       <a class="" href="/bitcoin-core-dev/2020-09-01">1</a>  <a class="" href="/bitcoin-core-dev/2020-09-02">2</a>  <a class="" href="/bitcoin-core-dev/2020-09-03">3</a>  <a class="" href="/bitcoin-core-dev/2020-09-04">4</a>  <a class="" href="/bitcoin-core-dev/2020-09-05">5</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2020-09-06">6</a>  <a class="" href="/bitcoin-core-dev/2020-09-07">7</a>  <a class="" href="/bitcoin-core-dev/2020-09-08">8</a>  <a class="current" href="/bitcoin-core-dev/2020-09-09">9</a> <a class="" href="/bitcoin-core-dev/2020-09-10">10</a> <a class="" href="/bitcoin-core-dev/2020-09-11">11</a> <a class="" href="/bitcoin-core-dev/2020-09-12">12</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2020-09-13">13</a> <a class="" href="/bitcoin-core-dev/2020-09-14">14</a> <a class="" href="/bitcoin-core-dev/2020-09-15">15</a> <a class="" href="/bitcoin-core-dev/2020-09-16">16</a> <a class="" href="/bitcoin-core-dev/2020-09-17">17</a> <a class="" href="/bitcoin-core-dev/2020-09-18">18</a> <a class="" href="/bitcoin-core-dev/2020-09-19">19</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2020-09-20">20</a> <a class="" href="/bitcoin-core-dev/2020-09-21">21</a> <a class="" href="/bitcoin-core-dev/2020-09-22">22</a> <a class="" href="/bitcoin-core-dev/2020-09-23">23</a> <a class="" href="/bitcoin-core-dev/2020-09-24">24</a> <a class="" href="/bitcoin-core-dev/2020-09-25">25</a> <a class="" href="/bitcoin-core-dev/2020-09-26">26</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2020-09-27">27</a> <a class="" href="/bitcoin-core-dev/2020-09-28">28</a> <a class="" href="/bitcoin-core-dev/2020-09-29">29</a> <a class="" href="/bitcoin-core-dev/2020-09-30">30</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1599619260' id='402912'>
<a class='timestamp' href='#402912'><time timestamp='2020-09-09T02:41:00Z'>02:41</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] sipa closed pull request #19695: [do not merge] Test impact of secp256k1 endianness detection change (master...202008_test_appveyer_secp256k1) <a href="https://github.com/bitcoin/bitcoin/pull/19695" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/19695</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599633000' id='402913'>
<a class='timestamp' href='#402913'><time timestamp='2020-09-09T06:30:00Z'>06:30</time></a>
&lt;<span class='nick nick-5'> vasild</span>&gt;
Next step to TORv3 is at #19845, waiting for some reviewers to shoot it down :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599633000' id='402914'>
<a class='timestamp' href='#402914'><time timestamp='2020-09-09T06:30:00Z'>06:30</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/19845" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/19845</a> | net: CNetAddr: add support to (un)serialize as ADDRv2 by vasild ¬∑ Pull Request #19845 ¬∑ bitcoin/bitcoin ¬∑ GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1599633240' id='402915'>
<a class='timestamp' href='#402915'><time timestamp='2020-09-09T06:34:00Z'>06:34</time></a>
&lt;<span class='nick nick-14'> jonatack</span>&gt;
üëç
<br>
</div>

<div class='talk op-msg' data-timestamp='1599635340' id='402916'>
<a class='timestamp' href='#402916'><time timestamp='2020-09-09T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] MarcoFalke pushed 3 commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/4f229d8904f8...564e1ab0f3dc" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/4f229d8904f8...564e1ab0f3dc</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599635340' id='402917'>
<a class='timestamp' href='#402917'><time timestamp='2020-09-09T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master fa39c62 MarcoFalke: test: inline hashToHex
<br>
</div>

<div class='talk op-msg' data-timestamp='1599635340' id='402918'>
<a class='timestamp' href='#402918'><time timestamp='2020-09-09T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master fa188c9 MarcoFalke: test: Use MiniWalet in p2p_feefilter
<br>
</div>

<div class='talk op-msg' data-timestamp='1599635340' id='402919'>
<a class='timestamp' href='#402919'><time timestamp='2020-09-09T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 564e1ab MarcoFalke: Merge #19800: test: Mockwallet
<br>
</div>

<div class='talk op-msg' data-timestamp='1599635340' id='402920'>
<a class='timestamp' href='#402920'><time timestamp='2020-09-09T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] MarcoFalke merged pull request #19800: test: Mockwallet (master...2008-testMiniWallet) <a href="https://github.com/bitcoin/bitcoin/pull/19800" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/19800</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599638280' id='402921'>
<a class='timestamp' href='#402921'><time timestamp='2020-09-09T07:58:00Z'>07:58</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
How is the process of merging &quot;back&quot; the state from the GUI repository? Is there a planed timeframe? Will there just be one PR to the main repository that includes all changes (like a backport PR)? Is that process documented already?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599638280' id='402922'>
<a class='timestamp' href='#402922'><time timestamp='2020-09-09T07:58:00Z'>07:58</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
^ MarcoFalke
<br>
</div>

<div class='talk op-msg' data-timestamp='1599638760' id='402923'>
<a class='timestamp' href='#402923'><time timestamp='2020-09-09T08:06:00Z'>08:06</time></a>
&lt;<span class='nick nick-8'> promag</span>&gt;
jonasschnelli: +1
<br>
</div>

<div class='talk op-msg' data-timestamp='1599640020' id='402924'>
<a class='timestamp' href='#402924'><time timestamp='2020-09-09T08:27:00Z'>08:27</time></a>
&lt;<span class='nick nick-16'> jnewbery</span>&gt;
#proposed meeting topic: stategies for removing recursive locking in the mempool (<a href="https://github.com/bitcoin/bitcoin/pull/19872#issuecomment-688852261" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/19872#issuecomment-688852261</a>)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599641040' id='402925'>
<a class='timestamp' href='#402925'><time timestamp='2020-09-09T08:44:00Z'>08:44</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] MarcoFalke opened pull request #19922: test: Run rpc_txoutproof.py even with wallet disabled (master...2009-testMoreMiniWallet) <a href="https://github.com/bitcoin/bitcoin/pull/19922" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/19922</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599647940' id='402926'>
<a class='timestamp' href='#402926'><time timestamp='2020-09-09T10:39:00Z'>10:39</time></a>
&lt;<span class='nick nick-8'> promag</span>&gt;
jnewbery: +1
<br>
</div>

<div class='talk op-msg' data-timestamp='1599649620' id='402927'>
<a class='timestamp' href='#402927'><time timestamp='2020-09-09T11:07:00Z'>11:07</time></a>
&lt;<span class='nick nick-10'> elichai2</span>&gt;
MarcoFalke: I can&#x27;t manage to reproduce the error in #19920, instead I&#x27;m getting a really weird bug without the full details, any idea why? (I&#x27;m getting this: <a href="https://pastebin.com/raw/MBzJ0ixB)" class="link" target="_blank">https://pastebin.com/raw/MBzJ0ixB)</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599649620' id='402928'>
<a class='timestamp' href='#402928'><time timestamp='2020-09-09T11:07:00Z'>11:07</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/19920" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/19920</a> | test: Fuzzing siphash against reference implementation [Request for feedback] by elichai ¬∑ Pull Request #19920 ¬∑ bitcoin/bitcoin ¬∑ GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1599650160' id='402929'>
<a class='timestamp' href='#402929'><time timestamp='2020-09-09T11:16:00Z'>11:16</time></a>
&lt;<span class='nick nick-10'> elichai2</span>&gt;
found the bug :) you&#x27;re not allowed to do `&amp;*it` on null üòÖ
<br>
</div>

<div class='talk op-msg' data-timestamp='1599661500' id='402930'>
<a class='timestamp' href='#402930'><time timestamp='2020-09-09T14:25:00Z'>14:25</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] hebasto opened pull request #19926: gui: Add Tor icon (master...200909-tor) <a href="https://github.com/bitcoin/bitcoin/pull/19926" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/19926</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599671280' id='402931'>
<a class='timestamp' href='#402931'><time timestamp='2020-09-09T17:08:00Z'>17:08</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] dongcarl opened pull request #19927: validation: Reduce direct g_chainman usage (master...2020-09-reduce-g_chainman-usage) <a href="https://github.com/bitcoin/bitcoin/pull/19927" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/19927</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599672000' id='402932'>
<a class='timestamp' href='#402932'><time timestamp='2020-09-09T17:20:00Z'>17:20</time></a>
&lt;<span class='nick nick-10'> ariard</span>&gt;
jonasschnelli: just replied on bip324, AFAICT real-or-random and I favor MACing the length a la noise, even if as Lloyd is pointing we don&#x27;t a concrete exploitation of it
<br>
</div>

<div class='talk op-msg' data-timestamp='1599672420' id='402933'>
<a class='timestamp' href='#402933'><time timestamp='2020-09-09T17:27:00Z'>17:27</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
jonasschnelli: IIRC PRs merged to the GUI repo are also pushed to the main repo simultaneously
<br>
</div>

<div class='talk op-msg' data-timestamp='1599677820' id='402934'>
<a class='timestamp' href='#402934'><time timestamp='2020-09-09T18:57:00Z'>18:57</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
wtf :/ <a href="https://github.com/bitcoin/bitcoin/issues/19928" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/19928</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678000' id='402935'>
<a class='timestamp' href='#402935'><time timestamp='2020-09-09T19:00:00Z'>19:00</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
luke-jr: O.o
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678000' id='402936'>
<a class='timestamp' href='#402936'><time timestamp='2020-09-09T19:00:00Z'>19:00</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
the filenames are hardcoded...
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678060' id='402937'>
<a class='timestamp' href='#402937'><time timestamp='2020-09-09T19:01:00Z'>19:01</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
achow101: isn&#x27;t this the directory name, actually?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678120' id='402938'>
<a class='timestamp' href='#402938'><time timestamp='2020-09-09T19:02:00Z'>19:02</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
<a href="https://twitter.com/2btc10000pizzas/status/1303767335258542085" class="link" target="_blank">https://twitter.com/2btc10000pizzas/status/1303767335258542085</a> would indicate it effects the wallet.dat file
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678180' id='402939'>
<a class='timestamp' href='#402939'><time timestamp='2020-09-09T19:03:00Z'>19:03</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
although the previous tweet also suggests the directory name
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678180' id='402940'>
<a class='timestamp' href='#402940'><time timestamp='2020-09-09T19:03:00Z'>19:03</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
ackup.dat doesn&#x27;t
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678180' id='402941'>
<a class='timestamp' href='#402941'><time timestamp='2020-09-09T19:03:00Z'>19:03</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] vasild opened pull request #19929: sync: use proper TSA attributes (master...use_proper_tsa_attributes) <a href="https://github.com/bitcoin/bitcoin/pull/19929" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/19929</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678240' id='402942'>
<a class='timestamp' href='#402942'><time timestamp='2020-09-09T19:04:00Z'>19:04</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
right
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678240' id='402943'>
<a class='timestamp' href='#402943'><time timestamp='2020-09-09T19:04:00Z'>19:04</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
allet.dat does but maybe he specified wallet.dat and not just &quot;&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678240' id='402944'>
<a class='timestamp' href='#402944'><time timestamp='2020-09-09T19:04:00Z'>19:04</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
so that would mean it&#x27;s a wallet name handling thing
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678240' id='402945'>
<a class='timestamp' href='#402945'><time timestamp='2020-09-09T19:04:00Z'>19:04</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
&quot;&quot; is never on disk :p
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678300' id='402946'>
<a class='timestamp' href='#402946'><time timestamp='2020-09-09T19:05:00Z'>19:05</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
you saw that apparently the actual on-disk filenames are being renamed, right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678300' id='402947'>
<a class='timestamp' href='#402947'><time timestamp='2020-09-09T19:05:00Z'>19:05</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678300' id='402948'>
<a class='timestamp' href='#402948'><time timestamp='2020-09-09T19:05:00Z'>19:05</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
I&#x27;m not 100% sure they know what they&#x27;re talking about in that regard, but it&#x27;s weird
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678360' id='402949'>
<a class='timestamp' href='#402949'><time timestamp='2020-09-09T19:06:00Z'>19:06</time></a>
&lt;<span class='nick nick-4'> gwillen</span>&gt;
off the top of my head, one way to eat the first character of a path component would be issues with quoting and backslash as a path separator on Windows
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678360' id='402950'>
<a class='timestamp' href='#402950'><time timestamp='2020-09-09T19:06:00Z'>19:06</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
hmm
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678420' id='402951'>
<a class='timestamp' href='#402951'><time timestamp='2020-09-09T19:07:00Z'>19:07</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
&quot;It would have been Gentoo Linux with the wallet files on an NTFS partition.&quot; lol totally unexpected
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678420' id='402952'>
<a class='timestamp' href='#402952'><time timestamp='2020-09-09T19:07:00Z'>19:07</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
I doubt the other guy has the same setup tho
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678420' id='402953'>
<a class='timestamp' href='#402953'><time timestamp='2020-09-09T19:07:00Z'>19:07</time></a>
&lt;<span class='nick nick-4'> gwillen</span>&gt;
iiiiiinteresting
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678420' id='402954'>
<a class='timestamp' href='#402954'><time timestamp='2020-09-09T19:07:00Z'>19:07</time></a>
&lt;<span class='nick nick-4'> gwillen</span>&gt;
could be an issue in the NTFS driver, that thing was always marked &#x27;experimental&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678480' id='402955'>
<a class='timestamp' href='#402955'><time timestamp='2020-09-09T19:08:00Z'>19:08</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
what&#x27;s the chance the other guy had Linux+NTFS tho
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678480' id='402956'>
<a class='timestamp' href='#402956'><time timestamp='2020-09-09T19:08:00Z'>19:08</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
luke-jr: yeah, other guy is Win 10
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678480' id='402957'>
<a class='timestamp' href='#402957'><time timestamp='2020-09-09T19:08:00Z'>19:08</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
could be a NTFS issue
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678540' id='402958'>
<a class='timestamp' href='#402958'><time timestamp='2020-09-09T19:09:00Z'>19:09</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
seems unlikely
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678540' id='402959'>
<a class='timestamp' href='#402959'><time timestamp='2020-09-09T19:09:00Z'>19:09</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
it&#x27;s not like Windows and Linux share the same NTFS code
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678600' id='402960'>
<a class='timestamp' href='#402960'><time timestamp='2020-09-09T19:10:00Z'>19:10</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
if he only see the problem on knots, then we could probably find the problem by looking at the diff?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678600' id='402961'>
<a class='timestamp' href='#402961'><time timestamp='2020-09-09T19:10:00Z'>19:10</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
achow101: the second guy had it on Core
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678600' id='402962'>
<a class='timestamp' href='#402962'><time timestamp='2020-09-09T19:10:00Z'>19:10</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
I think
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678600' id='402963'>
<a class='timestamp' href='#402963'><time timestamp='2020-09-09T19:10:00Z'>19:10</time></a>
&lt;<span class='nick nick-4'> gwillen</span>&gt;
any chance the win 10 guy is using WSL or something weird like that?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678660' id='402964'>
<a class='timestamp' href='#402964'><time timestamp='2020-09-09T19:11:00Z'>19:11</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
maybe if the Linux guy was using Captive NTFS.. he did say it was a long time ago
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678720' id='402965'>
<a class='timestamp' href='#402965'><time timestamp='2020-09-09T19:12:00Z'>19:12</time></a>
&lt;<span class='nick nick-4'> gwillen</span>&gt;
in that case why doesn&#x27;t every windows user see it, though
<br>
</div>

<div class='talk op-msg' data-timestamp='1599678720' id='402966'>
<a class='timestamp' href='#402966'><time timestamp='2020-09-09T19:12:00Z'>19:12</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
even the same user couldn&#x27;t reproduce :/
<br>
</div>

<div class='talk op-msg' data-timestamp='1599681480' id='402967'>
<a class='timestamp' href='#402967'><time timestamp='2020-09-09T19:58:00Z'>19:58</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
anybody know how many transaction outputs are in the chain? (not utxo, txo)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599681600' id='402968'>
<a class='timestamp' href='#402968'><time timestamp='2020-09-09T20:00:00Z'>20:00</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
years ago it was half a billion iirc
<br>
</div>

<div class='talk op-msg' data-timestamp='1599682680' id='402969'>
<a class='timestamp' href='#402969'><time timestamp='2020-09-09T20:18:00Z'>20:18</time></a>
&lt;<span class='nick nick-8'> andytoshi</span>&gt;
i have a simple script i used for my mimblewimble presentation, i can get this number in a couple hours
<br>
</div>

<div class='talk op-msg' data-timestamp='1599682680' id='402970'>
<a class='timestamp' href='#402970'><time timestamp='2020-09-09T20:18:00Z'>20:18</time></a>
&lt;<span class='nick nick-8'> andytoshi</span>&gt;
it seems to be taking 2-3 seconds per 100 blocks to scan, i don&#x27;t remember it being so slow
<br>
</div>

<div class='talk op-msg' data-timestamp='1599683760' id='402971'>
<a class='timestamp' href='#402971'><time timestamp='2020-09-09T20:36:00Z'>20:36</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
andytoshi, i&#x27;ve rigged up rescanblockchain to tell me
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685200' id='402972'>
<a class='timestamp' href='#402972'><time timestamp='2020-09-09T21:00:00Z'>21:00</time></a>
&lt;<span class='nick nick-8'> andytoshi</span>&gt;
ok cool. i had rigged the `getblock` rpc to dump the number of txouts per block and was using bash from there, but this is pretty brutal ... in the 40 minutes since i last spoke i&#x27;m up to block 200k. so it&#x27;ll finish tonight :P
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685200' id='402973'>
<a class='timestamp' href='#402973'><time timestamp='2020-09-09T21:00:00Z'>21:00</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
andytoshi: it may not... there are barely any transactions before 200k i think
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685320' id='402974'>
<a class='timestamp' href='#402974'><time timestamp='2020-09-09T21:02:00Z'>21:02</time></a>
&lt;<span class='nick nick-3'> aj</span>&gt;
maybe update the coin stats index from #19521 and use that?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685320' id='402975'>
<a class='timestamp' href='#402975'><time timestamp='2020-09-09T21:02:00Z'>21:02</time></a>
&lt;<span class='nick nick-8'> andytoshi</span>&gt;
hmm, so, i definitely did this in fall 2016 for scaling bitcoin milan and it only took a few hours
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685320' id='402976'>
<a class='timestamp' href='#402976'><time timestamp='2020-09-09T21:02:00Z'>21:02</time></a>
&lt;<span class='nick nick-8'> andytoshi</span>&gt;
i guess it&#x27;s been 4 years :P
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685320' id='402977'>
<a class='timestamp' href='#402977'><time timestamp='2020-09-09T21:02:00Z'>21:02</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/19521" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/19521</a> | Coinstats Index (without UTXO set hash) by fjahr ¬∑ Pull Request #19521 ¬∑ bitcoin/bitcoin ¬∑ GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685380' id='402978'>
<a class='timestamp' href='#402978'><time timestamp='2020-09-09T21:03:00Z'>21:03</time></a>
&lt;<span class='nick nick-3'> aj</span>&gt;
andytoshi: (maybe rusty&#x27;s bitcoin-iterate is faster?)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685440' id='402979'>
<a class='timestamp' href='#402979'><time timestamp='2020-09-09T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
7316308 transactions up to block 200000
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685440' id='402980'>
<a class='timestamp' href='#402980'><time timestamp='2020-09-09T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
out of 566745810 in total
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685500' id='402981'>
<a class='timestamp' href='#402981'><time timestamp='2020-09-09T21:05:00Z'>21:05</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
phantomcircuit: given that there have been more transactions now than my claimed earlier historical number for the total txouts, you can safely disregard it
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685500' id='402982'>
<a class='timestamp' href='#402982'><time timestamp='2020-09-09T21:05:00Z'>21:05</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
luke-jr: Maybe worth adding a check for it?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685500' id='402983'>
<a class='timestamp' href='#402983'><time timestamp='2020-09-09T21:05:00Z'>21:05</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
&quot;if wallet.dat doesn&#x27;t exist and allet.dat does, show a message box&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685560' id='402984'>
<a class='timestamp' href='#402984'><time timestamp='2020-09-09T21:06:00Z'>21:06</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
&quot;Hi, a very rare bug has occured. We would be happy if you could email us at asd@asd.com and tell us what filesystem drivers you&#x27;re using. To fix it, open that folder and rename allet.dat again.&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685560' id='402985'>
<a class='timestamp' href='#402985'><time timestamp='2020-09-09T21:06:00Z'>21:06</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
bit hacky though
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685860' id='402986'>
<a class='timestamp' href='#402986'><time timestamp='2020-09-09T21:11:00Z'>21:11</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
i think we&#x27;ve regressed on IBD somewhere, i have a server that&#x27;s comically overpowered and there doesn&#x27;t seem to be anything that&#x27;s bottlenecking
<br>
</div>

<div class='talk op-msg' data-timestamp='1599685980' id='402987'>
<a class='timestamp' href='#402987'><time timestamp='2020-09-09T21:13:00Z'>21:13</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
running steady at about 100mbps cpu and disk basically idle on a 1gbps connection
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686040' id='402988'>
<a class='timestamp' href='#402988'><time timestamp='2020-09-09T21:14:00Z'>21:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
phantomcircuit: do you have good peers to sync from?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686040' id='402989'>
<a class='timestamp' href='#402989'><time timestamp='2020-09-09T21:14:00Z'>21:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the stalling detection logic can kick out the worst peers, but whether you get actually good ones can be hit or miss
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686280' id='402990'>
<a class='timestamp' href='#402990'><time timestamp='2020-09-09T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
what&#x27;s usually the bottleneck for IBD? DB sync?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686340' id='402991'>
<a class='timestamp' href='#402991'><time timestamp='2020-09-09T21:19:00Z'>21:19</time></a>
&lt;<span class='nick nick-3'> aj</span>&gt;
phantomcircuit: i often find i&#x27;m stuck on block X from a slow peer, while the other peers are on block X+500 or so
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686400' id='402992'>
<a class='timestamp' href='#402992'><time timestamp='2020-09-09T21:20:00Z'>21:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yanmaani: depends... with lots of cache it&#x27;s either network or (in-memory) utxo datastructure maintenance; with low cache it can be disk I/O
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686400' id='402993'>
<a class='timestamp' href='#402993'><time timestamp='2020-09-09T21:20:00Z'>21:20</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, it must be the eviction logic cause im sure it would otherwise be network limited
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686460' id='402994'>
<a class='timestamp' href='#402994'><time timestamp='2020-09-09T21:21:00Z'>21:21</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
how much disk I/O do you need? It&#x27;s just 300gb or so right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686520' id='402995'>
<a class='timestamp' href='#402995'><time timestamp='2020-09-09T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-3'> aj</span>&gt;
yanmaani: disk io is mostly updating the utxo set, which is mitigated by cache
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686520' id='402996'>
<a class='timestamp' href='#402996'><time timestamp='2020-09-09T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
Can&#x27;t you disable disk IO during IBD for utxo set?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686520' id='402997'>
<a class='timestamp' href='#402997'><time timestamp='2020-09-09T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yanmaani: yes, by making your cache big enough for the entire utxo set :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686520' id='402998'>
<a class='timestamp' href='#402998'><time timestamp='2020-09-09T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which is 8 GB or so
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686580' id='402999'>
<a class='timestamp' href='#402999'><time timestamp='2020-09-09T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
No I mean can&#x27;t you turn off DB sync and so?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686580' id='403000'>
<a class='timestamp' href='#403000'><time timestamp='2020-09-09T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
Or will it just need to spill to disk regardless?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686580' id='403001'>
<a class='timestamp' href='#403001'><time timestamp='2020-09-09T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
well the UTXOs need to be stored somewhere!
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686580' id='403002'>
<a class='timestamp' href='#403002'><time timestamp='2020-09-09T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
how will you validate transactions otherwise?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686580' id='403003'>
<a class='timestamp' href='#403003'><time timestamp='2020-09-09T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
yeah, but there&#x27;s no need to sync the database
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686580' id='403004'>
<a class='timestamp' href='#403004'><time timestamp='2020-09-09T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
You can have MongoDB tier safety
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686640' id='403005'>
<a class='timestamp' href='#403005'><time timestamp='2020-09-09T21:24:00Z'>21:24</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
(during IBD)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686640' id='403006'>
<a class='timestamp' href='#403006'><time timestamp='2020-09-09T21:24:00Z'>21:24</time></a>
&lt;<span class='nick nick-3'> aj</span>&gt;
you have to have a database, it can be in memory or on disk; if it&#x27;s in memory, it&#x27;s in cache
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686640' id='403007'>
<a class='timestamp' href='#403007'><time timestamp='2020-09-09T21:24:00Z'>21:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if you set the cache big enough to keep the entire utxo set in memory, there will be no database I/O whatsoever during IBD
<br>
</div>

<div class='talk op-msg' data-timestamp='1599686640' id='403008'>
<a class='timestamp' href='#403008'><time timestamp='2020-09-09T21:24:00Z'>21:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and it&#x27;ll be flushed once at the end
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687300' id='403009'>
<a class='timestamp' href='#403009'><time timestamp='2020-09-09T21:35:00Z'>21:35</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
yanmaani, if you set the dbcache high enough you will only write to disk once when you shutdown the node
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687420' id='403010'>
<a class='timestamp' href='#403010'><time timestamp='2020-09-09T21:37:00Z'>21:37</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
If I set it say 99% of the way, will I notice a sharp slowdown, or is it smart enough to cache as much as possible?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687540' id='403011'>
<a class='timestamp' href='#403011'><time timestamp='2020-09-09T21:39:00Z'>21:39</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s a sawtooth function; our cache is kind of a weird mix between a buffer and a cache
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687540' id='403012'>
<a class='timestamp' href='#403012'><time timestamp='2020-09-09T21:39:00Z'>21:39</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
once it fills up, it&#x27;s written entirely to disk, and cleared
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687600' id='403013'>
<a class='timestamp' href='#403013'><time timestamp='2020-09-09T21:40:00Z'>21:40</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
(the reason for this is an unusual design that lets us remove entries from the cache if they&#x27;re created and deleted between flushes, without them ever hitting disk)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687600' id='403014'>
<a class='timestamp' href='#403014'><time timestamp='2020-09-09T21:40:00Z'>21:40</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and at least years ago, we tried several alternative designs that kept some part in memory when flushing, but this turned out to be always worse
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687600' id='403015'>
<a class='timestamp' href='#403015'><time timestamp='2020-09-09T21:40:00Z'>21:40</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
And I&#x27;m guessing the database is being interacted with by fwrite() rather than mmap
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687660' id='403016'>
<a class='timestamp' href='#403016'><time timestamp='2020-09-09T21:41:00Z'>21:41</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s leveldb
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687660' id='403017'>
<a class='timestamp' href='#403017'><time timestamp='2020-09-09T21:41:00Z'>21:41</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so whatever leveldb uses, which is a mix (iirc it&#x27;s all fwrite on 32-bit platforms, and a combination of fwrite and mmap on 64-bit ones)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687660' id='403018'>
<a class='timestamp' href='#403018'><time timestamp='2020-09-09T21:41:00Z'>21:41</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
So it&#x27;s leveldb but with a custom cache?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687720' id='403019'>
<a class='timestamp' href='#403019'><time timestamp='2020-09-09T21:42:00Z'>21:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s probably better to call it an in-memory database, backed by an on-disk leveldb database
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687720' id='403020'>
<a class='timestamp' href='#403020'><time timestamp='2020-09-09T21:42:00Z'>21:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
leveldb has its own caching too
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687780' id='403021'>
<a class='timestamp' href='#403021'><time timestamp='2020-09-09T21:43:00Z'>21:43</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
wouldn&#x27;t a file-backed mmap be better?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687780' id='403022'>
<a class='timestamp' href='#403022'><time timestamp='2020-09-09T21:43:00Z'>21:43</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
it&#x27;s like malloc but with explicit swap handled by the OS
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687780' id='403023'>
<a class='timestamp' href='#403023'><time timestamp='2020-09-09T21:43:00Z'>21:43</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you&#x27;re welcome to try, but we&#x27;re really talking about different layers
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687840' id='403024'>
<a class='timestamp' href='#403024'><time timestamp='2020-09-09T21:44:00Z'>21:44</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the on-disk caching layer is a byte array
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687840' id='403025'>
<a class='timestamp' href='#403025'><time timestamp='2020-09-09T21:44:00Z'>21:44</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
No, I mean isntead of the RAM blob being used for in-ram caching
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687840' id='403026'>
<a class='timestamp' href='#403026'><time timestamp='2020-09-09T21:44:00Z'>21:44</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
there is no RAM blob
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687840' id='403027'>
<a class='timestamp' href='#403027'><time timestamp='2020-09-09T21:44:00Z'>21:44</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
there is an in-memory database, with expanded, efficient, data structures
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687840' id='403028'>
<a class='timestamp' href='#403028'><time timestamp='2020-09-09T21:44:00Z'>21:44</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
not serialized bytes
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687900' id='403029'>
<a class='timestamp' href='#403029'><time timestamp='2020-09-09T21:45:00Z'>21:45</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
Isn&#x27;t the in-memory database in RAM????
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687900' id='403030'>
<a class='timestamp' href='#403030'><time timestamp='2020-09-09T21:45:00Z'>21:45</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes, but it&#x27;s not a blob
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687900' id='403031'>
<a class='timestamp' href='#403031'><time timestamp='2020-09-09T21:45:00Z'>21:45</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
no need to yell
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687900' id='403032'>
<a class='timestamp' href='#403032'><time timestamp='2020-09-09T21:45:00Z'>21:45</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
It&#x27;s several mallocs?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687900' id='403033'>
<a class='timestamp' href='#403033'><time timestamp='2020-09-09T21:45:00Z'>21:45</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687960' id='403034'>
<a class='timestamp' href='#403034'><time timestamp='2020-09-09T21:46:00Z'>21:46</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
so, wouldn&#x27;t it make more sense to replace them with backed mmaps that you never flush? Then the OS would have a lot more liberty to optimize
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687960' id='403035'>
<a class='timestamp' href='#403035'><time timestamp='2020-09-09T21:46:00Z'>21:46</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
than if you force it into RAM
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687960' id='403036'>
<a class='timestamp' href='#403036'><time timestamp='2020-09-09T21:46:00Z'>21:46</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
seriouysly, you&#x27;re welcome to try
<br>
</div>

<div class='talk op-msg' data-timestamp='1599687960' id='403037'>
<a class='timestamp' href='#403037'><time timestamp='2020-09-09T21:46:00Z'>21:46</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i&#x27;ve spent months on optizing that stuff
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688020' id='403038'>
<a class='timestamp' href='#403038'><time timestamp='2020-09-09T21:47:00Z'>21:47</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s a highly unusual design, but yes, based on the experiments we did back then, it works very well
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688020' id='403039'>
<a class='timestamp' href='#403039'><time timestamp='2020-09-09T21:47:00Z'>21:47</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
huh
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688080' id='403040'>
<a class='timestamp' href='#403040'><time timestamp='2020-09-09T21:48:00Z'>21:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the unusual part is that the UTXOs really have a create-lookuponce-deleteimmediate cycle
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688080' id='403041'>
<a class='timestamp' href='#403041'><time timestamp='2020-09-09T21:48:00Z'>21:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which is very strange for databases
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688080' id='403042'>
<a class='timestamp' href='#403042'><time timestamp='2020-09-09T21:48:00Z'>21:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
usual things aren&#x27;t designed to take advantage of the degree to which looked up entries are immediately deleted
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688140' id='403043'>
<a class='timestamp' href='#403043'><time timestamp='2020-09-09T21:49:00Z'>21:49</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
(and they&#x27;ll instead create some sort of log that contains the creation and deletion, which still get written to disk at flush time)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688200' id='403044'>
<a class='timestamp' href='#403044'><time timestamp='2020-09-09T21:50:00Z'>21:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
by having an allocation per entry, you can just throw it away instantly when spent, and forget about its existence entirely
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688260' id='403045'>
<a class='timestamp' href='#403045'><time timestamp='2020-09-09T21:51:00Z'>21:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if you have a few hundred MB or more of cache, it means most UTXOs never hit disk at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688320' id='403046'>
<a class='timestamp' href='#403046'><time timestamp='2020-09-09T21:52:00Z'>21:52</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
Wouldn&#x27;t mmaps do this nearly as efficiently? Or is the OS too eager to flush changes?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688320' id='403047'>
<a class='timestamp' href='#403047'><time timestamp='2020-09-09T21:52:00Z'>21:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
sigh
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688320' id='403048'>
<a class='timestamp' href='#403048'><time timestamp='2020-09-09T21:52:00Z'>21:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you&#x27;re talking about a different layer
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688320' id='403049'>
<a class='timestamp' href='#403049'><time timestamp='2020-09-09T21:52:00Z'>21:52</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
No, I mean that the malloc is replaced by a mmap
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688380' id='403050'>
<a class='timestamp' href='#403050'><time timestamp='2020-09-09T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
And the mmap&#x27;d file is then treated like a RAM buffer of 8 GB
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688380' id='403051'>
<a class='timestamp' href='#403051'><time timestamp='2020-09-09T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
then you&#x27;d get inconsistent state on disk in case of a crash
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688380' id='403052'>
<a class='timestamp' href='#403052'><time timestamp='2020-09-09T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
Yeah, is that a problem?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688380' id='403053'>
<a class='timestamp' href='#403053'><time timestamp='2020-09-09T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688380' id='403054'>
<a class='timestamp' href='#403054'><time timestamp='2020-09-09T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
Can&#x27;t you just remove the UTXO state in case of a crash?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688380' id='403055'>
<a class='timestamp' href='#403055'><time timestamp='2020-09-09T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
at least during IBD
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688380' id='403056'>
<a class='timestamp' href='#403056'><time timestamp='2020-09-09T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and sync from scratch? :o
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688380' id='403057'>
<a class='timestamp' href='#403057'><time timestamp='2020-09-09T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
if you make it fast enough it should be a gain on net
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688380' id='403058'>
<a class='timestamp' href='#403058'><time timestamp='2020-09-09T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
and dropping ACID guarantees and giving it the MongoDB treatment seems like it would make things faster
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688380' id='403059'>
<a class='timestamp' href='#403059'><time timestamp='2020-09-09T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
in pruned mode, you&#x27;d need to start over redownloading even
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688440' id='403060'>
<a class='timestamp' href='#403060'><time timestamp='2020-09-09T21:54:00Z'>21:54</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
yeah, that&#x27;s true. For pruned mode, you&#x27;d need to make sure it was synced properly.
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688440' id='403061'>
<a class='timestamp' href='#403061'><time timestamp='2020-09-09T21:54:00Z'>21:54</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
Although if you&#x27;re substituting malloc() for mmap() of a temporary file, isn&#x27;t the persistence as good? &quot;The synced stuff stays, the stuff in RAM doesn&#x27;t&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688500' id='403062'>
<a class='timestamp' href='#403062'><time timestamp='2020-09-09T21:55:00Z'>21:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
there is no guarantee that mmap flushing happens in the same order as writes
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688500' id='403063'>
<a class='timestamp' href='#403063'><time timestamp='2020-09-09T21:55:00Z'>21:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
is there?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688620' id='403064'>
<a class='timestamp' href='#403064'><time timestamp='2020-09-09T21:57:00Z'>21:57</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
no
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688680' id='403065'>
<a class='timestamp' href='#403065'><time timestamp='2020-09-09T21:58:00Z'>21:58</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
if it crashes, your mmap will be garbage
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688680' id='403066'>
<a class='timestamp' href='#403066'><time timestamp='2020-09-09T21:58:00Z'>21:58</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
but if you&#x27;re using it to substitute malloc it should be fine
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688680' id='403067'>
<a class='timestamp' href='#403067'><time timestamp='2020-09-09T21:58:00Z'>21:58</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
since there&#x27;s no expectation malloc persists on crash
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688680' id='403068'>
<a class='timestamp' href='#403068'><time timestamp='2020-09-09T21:58:00Z'>21:58</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ah, i see
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688860' id='403069'>
<a class='timestamp' href='#403069'><time timestamp='2020-09-09T22:01:00Z'>22:01</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
what advantages would this have? if used with the same cache size as you&#x27;d use now, it wouldn&#x27;t be any faster or have other advantages i think
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688920' id='403070'>
<a class='timestamp' href='#403070'><time timestamp='2020-09-09T22:02:00Z'>22:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;d permit you to make a cache larger than your ram, which may or may not be better
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688920' id='403071'>
<a class='timestamp' href='#403071'><time timestamp='2020-09-09T22:02:00Z'>22:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
depending on how fast disk is etc
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688920' id='403072'>
<a class='timestamp' href='#403072'><time timestamp='2020-09-09T22:02:00Z'>22:02</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
If used with the same cache size as you have now, it&#x27;s roughly identical, but uses less RAM/is more fair
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688920' id='403073'>
<a class='timestamp' href='#403073'><time timestamp='2020-09-09T22:02:00Z'>22:02</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
(OS can swap it out as it needs if there&#x27;s a deficit of RAM)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688920' id='403074'>
<a class='timestamp' href='#403074'><time timestamp='2020-09-09T22:02:00Z'>22:02</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
if used with the max cache size*
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688980' id='403075'>
<a class='timestamp' href='#403075'><time timestamp='2020-09-09T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that assumes the OS can predict better what&#x27;s useful to have cached
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688980' id='403076'>
<a class='timestamp' href='#403076'><time timestamp='2020-09-09T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
it has some caching algorithm on a block level, yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688980' id='403077'>
<a class='timestamp' href='#403077'><time timestamp='2020-09-09T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
and users who are using zram/zswap will benefit from compression
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688980' id='403078'>
<a class='timestamp' href='#403078'><time timestamp='2020-09-09T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
it&#x27;ll avoid sync disk writes in the cases where cache is too small
<br>
</div>

<div class='talk op-msg' data-timestamp='1599688980' id='403079'>
<a class='timestamp' href='#403079'><time timestamp='2020-09-09T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
sure, but it doesn&#x27;t know for example that after deleting some UTXO entry it&#x27;s no longer useful to keep it around
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689040' id='403080'>
<a class='timestamp' href='#403080'><time timestamp='2020-09-09T22:04:00Z'>22:04</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
after deleting the utxo entry, the ram is filled with something else surely?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689040' id='403081'>
<a class='timestamp' href='#403081'><time timestamp='2020-09-09T22:04:00Z'>22:04</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
(or it&#x27;s never touched again, in which case the OS won&#x27;t give it a very high priority)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689040' id='403082'>
<a class='timestamp' href='#403082'><time timestamp='2020-09-09T22:04:00Z'>22:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
at some point, sure
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689100' id='403083'>
<a class='timestamp' href='#403083'><time timestamp='2020-09-09T22:05:00Z'>22:05</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
anyway, you&#x27;re welcome to try and benchmark :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689160' id='403084'>
<a class='timestamp' href='#403084'><time timestamp='2020-09-09T22:06:00Z'>22:06</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
yeah. Where is the cache?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689160' id='403085'>
<a class='timestamp' href='#403085'><time timestamp='2020-09-09T22:06:00Z'>22:06</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
i.e. what file
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689160' id='403086'>
<a class='timestamp' href='#403086'><time timestamp='2020-09-09T22:06:00Z'>22:06</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
is it src/index/*/
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689220' id='403087'>
<a class='timestamp' href='#403087'><time timestamp='2020-09-09T22:07:00Z'>22:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
CCoinsViewCache in src/coins.h
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689340' id='403088'>
<a class='timestamp' href='#403088'><time timestamp='2020-09-09T22:09:00Z'>22:09</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
right, thanks!
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689580' id='403089'>
<a class='timestamp' href='#403089'><time timestamp='2020-09-09T22:13:00Z'>22:13</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
mallocs can get swapped out too..
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689580' id='403090'>
<a class='timestamp' href='#403090'><time timestamp='2020-09-09T22:13:00Z'>22:13</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
Only if you have swap enabled
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689580' id='403091'>
<a class='timestamp' href='#403091'><time timestamp='2020-09-09T22:13:00Z'>22:13</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
Otherwise it&#x27;ll go straight to thrashing
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689640' id='403092'>
<a class='timestamp' href='#403092'><time timestamp='2020-09-09T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
With a file-backed mmap, it can flush the pages to disk without consuming your swap
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689640' id='403093'>
<a class='timestamp' href='#403093'><time timestamp='2020-09-09T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yanmaani: it would add I/O though, because the OS will start writing dirty pages from the mmap to disk, and then you&#x27;ll read them again and write them again when flushing to the &quot;real&quot; database on disk
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689640' id='403094'>
<a class='timestamp' href='#403094'><time timestamp='2020-09-09T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
though that wouldn&#x27;t be I/O on the critical latency path
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689760' id='403095'>
<a class='timestamp' href='#403095'><time timestamp='2020-09-09T22:16:00Z'>22:16</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
yes, but so does normal thrashing
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689820' id='403096'>
<a class='timestamp' href='#403096'><time timestamp='2020-09-09T22:17:00Z'>22:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if the cache is so large that it gets swapped out to disk, you&#x27;re better off picking a smaller cache
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689820' id='403097'>
<a class='timestamp' href='#403097'><time timestamp='2020-09-09T22:17:00Z'>22:17</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
yanmaani: did you see my recent PR?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689820' id='403098'>
<a class='timestamp' href='#403098'><time timestamp='2020-09-09T22:17:00Z'>22:17</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
there&#x27;s two options with malloc: either swap (if that&#x27;s enabled), or thrashing (swap out libc). With mmap, you can also flush it
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689880' id='403099'>
<a class='timestamp' href='#403099'><time timestamp='2020-09-09T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
sipa: not necessarily - it might figure out which bits aren&#x27;t so useful, and swap out those, for a net gain
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689880' id='403100'>
<a class='timestamp' href='#403100'><time timestamp='2020-09-09T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
#19873
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689880' id='403101'>
<a class='timestamp' href='#403101'><time timestamp='2020-09-09T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/19873" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/19873</a> | [WIP] Flush dbcache early if system is under memory pressure by luke-jr ¬∑ Pull Request #19873 ¬∑ bitcoin/bitcoin ¬∑ GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689940' id='403102'>
<a class='timestamp' href='#403102'><time timestamp='2020-09-09T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
That might also work. I don&#x27;t know which approach is better.
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689940' id='403103'>
<a class='timestamp' href='#403103'><time timestamp='2020-09-09T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yanmaani: given that every piece of data in the cache is accessed exactly once - when it&#x27;s spent, i don&#x27;t see how the OS could predict what is useful and what isn&#x27;t
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689940' id='403104'>
<a class='timestamp' href='#403104'><time timestamp='2020-09-09T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
I suppose I&#x27;ll have to benchmark it
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689940' id='403105'>
<a class='timestamp' href='#403105'><time timestamp='2020-09-09T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yeah, it&#x27;d be interesting to know
<br>
</div>

<div class='talk op-msg' data-timestamp='1599689940' id='403106'>
<a class='timestamp' href='#403106'><time timestamp='2020-09-09T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you&#x27;ll need some mmap-backed allocator i guess
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690000' id='403107'>
<a class='timestamp' href='#403107'><time timestamp='2020-09-09T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
I think a more likely improvement would be to flag cache entries rather than delete them, when writing to db
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690000' id='403108'>
<a class='timestamp' href='#403108'><time timestamp='2020-09-09T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
luke-jr: ?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690000' id='403109'>
<a class='timestamp' href='#403109'><time timestamp='2020-09-09T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
I wonder if it&#x27;d make more sense to write everything to DB and have it in some extremely lax sync mode
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690000' id='403110'>
<a class='timestamp' href='#403110'><time timestamp='2020-09-09T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
so, take out the cache, and set the DB to MongoDB mode
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690000' id='403111'>
<a class='timestamp' href='#403111'><time timestamp='2020-09-09T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
sipa: after flushing changes to db, keep them in memory in case they&#x27;re read soon
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690000' id='403112'>
<a class='timestamp' href='#403112'><time timestamp='2020-09-09T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
write during IBD, then flush when synced
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690000' id='403113'>
<a class='timestamp' href='#403113'><time timestamp='2020-09-09T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
luke-jr: i tried that
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690000' id='403114'>
<a class='timestamp' href='#403114'><time timestamp='2020-09-09T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
flag them so you know they don&#x27;t need to be written anymore
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690060' id='403115'>
<a class='timestamp' href='#403115'><time timestamp='2020-09-09T22:21:00Z'>22:21</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
sipa: why didn&#x27;t it work?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690060' id='403116'>
<a class='timestamp' href='#403116'><time timestamp='2020-09-09T22:21:00Z'>22:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
luke-jr: at least a few years ago, it will never a win; the reason is that there is less memory available to exploit the &quot;newly created entries that get deleted before ever hitting disk&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690120' id='403117'>
<a class='timestamp' href='#403117'><time timestamp='2020-09-09T22:22:00Z'>22:22</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
sipa: you&#x27;d delete the flagged entries when you need more space?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690120' id='403118'>
<a class='timestamp' href='#403118'><time timestamp='2020-09-09T22:22:00Z'>22:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
luke-jr: yes, i believe i tried something like that
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690120' id='403119'>
<a class='timestamp' href='#403119'><time timestamp='2020-09-09T22:22:00Z'>22:22</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
I don&#x27;t see how this can be a lose :/
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690180' id='403120'>
<a class='timestamp' href='#403120'><time timestamp='2020-09-09T22:23:00Z'>22:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
where the flushing is done in two tiers; in one, you&#x27;d flush everything, but keep the most recently created half around
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690180' id='403121'>
<a class='timestamp' href='#403121'><time timestamp='2020-09-09T22:23:00Z'>22:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and in the second tier, when the memory is full, delete all non-dirty entries
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690180' id='403122'>
<a class='timestamp' href='#403122'><time timestamp='2020-09-09T22:23:00Z'>22:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
luke-jr: because of extra CPU to walk the cache and find things to delete
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690240' id='403123'>
<a class='timestamp' href='#403123'><time timestamp='2020-09-09T22:24:00Z'>22:24</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
std::move it to a second cache? :x
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690240' id='403124'>
<a class='timestamp' href='#403124'><time timestamp='2020-09-09T22:24:00Z'>22:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
there are definitely more combinations that could be tried, not claiming it&#x27;s a certain loss
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690240' id='403125'>
<a class='timestamp' href='#403125'><time timestamp='2020-09-09T22:24:00Z'>22:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but after trying half a dozen things, i think it was time to give up :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690300' id='403126'>
<a class='timestamp' href='#403126'><time timestamp='2020-09-09T22:25:00Z'>22:25</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it may also depend on relative speeds of RAM/CPU/disk
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690300' id='403127'>
<a class='timestamp' href='#403127'><time timestamp='2020-09-09T22:25:00Z'>22:25</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
this was also pre-pertxout that was added in 0.15; that may have changed things
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690300' id='403128'>
<a class='timestamp' href='#403128'><time timestamp='2020-09-09T22:25:00Z'>22:25</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
hmm
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690360' id='403129'>
<a class='timestamp' href='#403129'><time timestamp='2020-09-09T22:26:00Z'>22:26</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i did have a design a few years ago that i&#x27;d like to get back to at some point, which would permit flushing in the background without invalidating on-disk cache
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690360' id='403130'>
<a class='timestamp' href='#403130'><time timestamp='2020-09-09T22:26:00Z'>22:26</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, nvm for some reason my gateway&lt;-&gt;modem was in 100 not 1000
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690360' id='403131'>
<a class='timestamp' href='#403131'><time timestamp='2020-09-09T22:26:00Z'>22:26</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
&lt;.&lt;
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690360' id='403132'>
<a class='timestamp' href='#403132'><time timestamp='2020-09-09T22:26:00Z'>22:26</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
eh, on-disk storage
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690360' id='403133'>
<a class='timestamp' href='#403133'><time timestamp='2020-09-09T22:26:00Z'>22:26</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
&gt;.&gt;
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690360' id='403134'>
<a class='timestamp' href='#403134'><time timestamp='2020-09-09T22:26:00Z'>22:26</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
hmmmm
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690420' id='403135'>
<a class='timestamp' href='#403135'><time timestamp='2020-09-09T22:27:00Z'>22:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so you could be continuously writing the oldest entries, outside of the latency critical path
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690420' id='403136'>
<a class='timestamp' href='#403136'><time timestamp='2020-09-09T22:27:00Z'>22:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
though it&#x27;d need extra memory to keep things ordered
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690420' id='403137'>
<a class='timestamp' href='#403137'><time timestamp='2020-09-09T22:27:00Z'>22:27</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
Is std::unordered_map really the fastest in-memory kv store around?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690420' id='403138'>
<a class='timestamp' href='#403138'><time timestamp='2020-09-09T22:27:00Z'>22:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s nontrivial to make it work correctly with reorgs etc though, but not impossible, if i remember
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690480' id='403139'>
<a class='timestamp' href='#403139'><time timestamp='2020-09-09T22:28:00Z'>22:28</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yanmaani: it&#x27;s not
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690540' id='403140'>
<a class='timestamp' href='#403140'><time timestamp='2020-09-09T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-6'> yanmaani</span>&gt;
But it&#x27;s advantageous for some other reason? Or is it just being used for some small part?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690660' id='403141'>
<a class='timestamp' href='#403141'><time timestamp='2020-09-09T22:31:00Z'>22:31</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i think people have tried some variations
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690720' id='403142'>
<a class='timestamp' href='#403142'><time timestamp='2020-09-09T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the biggest differency would come from using different allocation strategies, i think
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690720' id='403143'>
<a class='timestamp' href='#403143'><time timestamp='2020-09-09T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
this was tried before though: <a href="https://github.com/bitcoin/bitcoin/pull/16801" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/16801</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690720' id='403144'>
<a class='timestamp' href='#403144'><time timestamp='2020-09-09T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
#16801
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690720' id='403145'>
<a class='timestamp' href='#403145'><time timestamp='2020-09-09T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/16801" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/16801</a> | faster &amp; less memory for sync: bulk pool allocator for node based containers by martinus ¬∑ Pull Request #16801 ¬∑ bitcoin/bitcoin ¬∑ GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690720' id='403146'>
<a class='timestamp' href='#403146'><time timestamp='2020-09-09T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
how do I make a const unsigned char* into a span?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690780' id='403147'>
<a class='timestamp' href='#403147'><time timestamp='2020-09-09T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: do you have its length?
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690780' id='403148'>
<a class='timestamp' href='#403148'><time timestamp='2020-09-09T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690780' id='403149'>
<a class='timestamp' href='#403149'><time timestamp='2020-09-09T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
Span&lt;const unsigned char&gt;(ptr, len) should work
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690780' id='403150'>
<a class='timestamp' href='#403150'><time timestamp='2020-09-09T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
ah, thanks
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690840' id='403151'>
<a class='timestamp' href='#403151'><time timestamp='2020-09-09T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
post c++17 we can add type inference, and you can use Span(ptr, len)
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690840' id='403152'>
<a class='timestamp' href='#403152'><time timestamp='2020-09-09T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
doesn&#x27;t C++17 include std::span anyway? :P
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690840' id='403153'>
<a class='timestamp' href='#403153'><time timestamp='2020-09-09T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
luke-jr: no, that&#x27;s only in c++20
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690840' id='403154'>
<a class='timestamp' href='#403154'><time timestamp='2020-09-09T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: if you&#x27;re passing to a function that takes a Span&lt;const unsigned char&gt; already, you can use fn({ptr, len})
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690840' id='403155'>
<a class='timestamp' href='#403155'><time timestamp='2020-09-09T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
oh :x
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690900' id='403156'>
<a class='timestamp' href='#403156'><time timestamp='2020-09-09T22:35:00Z'>22:35</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: even better
<br>
</div>

<div class='talk op-msg' data-timestamp='1599690900' id='403157'>
<a class='timestamp' href='#403157'><time timestamp='2020-09-09T22:35:00Z'>22:35</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
or {beginptr, endptr}
<br>
</div>

<div class='talk op-msg' data-timestamp='1599691440' id='403158'>
<a class='timestamp' href='#403158'><time timestamp='2020-09-09T22:44:00Z'>22:44</time></a>
&lt;<span class='nick nick-6'> jb55</span>&gt;
is there something in 0.20.0 -&gt; 0.20.1 that would cause it to redownload the blockchain? trying to figure out why it&#x27;s doing that after I upgraded my kernel+bitcoin. no configs changed ...
<br>
</div>

<div class='talk op-msg' data-timestamp='1599691440' id='403159'>
<a class='timestamp' href='#403159'><time timestamp='2020-09-09T22:44:00Z'>22:44</time></a>
&lt;<span class='nick nick-6'> jb55</span>&gt;
maybe this ? <a href="https://jb55.com/s/a8e916c5b6f0404b.txt" class="link" target="_blank">https://jb55.com/s/a8e916c5b6f0404b.txt</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1599691560' id='403160'>
<a class='timestamp' href='#403160'><time timestamp='2020-09-09T22:46:00Z'>22:46</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jb55: there shouldn&#x27;t be any changes relates to that in minor releases
<br>
</div>

<div class='talk op-msg' data-timestamp='1599691620' id='403161'>
<a class='timestamp' href='#403161'><time timestamp='2020-09-09T22:47:00Z'>22:47</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, can confirm i am dumb
<br>
</div>

<div class='talk op-msg' data-timestamp='1599691620' id='403162'>
<a class='timestamp' href='#403162'><time timestamp='2020-09-09T22:47:00Z'>22:47</time></a>
&lt;<span class='nick nick-6'> jb55</span>&gt;
hmm yeah I figured, maybe weird io issue
<br>
</div>

</div>
</section>

</body>
</html>
