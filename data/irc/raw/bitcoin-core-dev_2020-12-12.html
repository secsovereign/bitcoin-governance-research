<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2020-12-12
 — 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2020-12-12' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:17 UTC</pre>
<pre><a href="/bitcoin-core-dev/2020-11-12">&lt;</a><span class='header'>  December 2020   </span><a href="/bitcoin-core-dev/2021-01-12">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;       <a class="" href="/bitcoin-core-dev/2020-12-01">1</a>  <a class="" href="/bitcoin-core-dev/2020-12-02">2</a>  <a class="" href="/bitcoin-core-dev/2020-12-03">3</a>  <a class="" href="/bitcoin-core-dev/2020-12-04">4</a>  <a class="" href="/bitcoin-core-dev/2020-12-05">5</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2020-12-06">6</a>  <a class="" href="/bitcoin-core-dev/2020-12-07">7</a>  <a class="" href="/bitcoin-core-dev/2020-12-08">8</a>  <a class="" href="/bitcoin-core-dev/2020-12-09">9</a> <a class="" href="/bitcoin-core-dev/2020-12-10">10</a> <a class="" href="/bitcoin-core-dev/2020-12-11">11</a> <a class="current" href="/bitcoin-core-dev/2020-12-12">12</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2020-12-13">13</a> <a class="" href="/bitcoin-core-dev/2020-12-14">14</a> <a class="" href="/bitcoin-core-dev/2020-12-15">15</a> <a class="" href="/bitcoin-core-dev/2020-12-16">16</a> <a class="" href="/bitcoin-core-dev/2020-12-17">17</a> <a class="" href="/bitcoin-core-dev/2020-12-18">18</a> <a class="" href="/bitcoin-core-dev/2020-12-19">19</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2020-12-20">20</a> <a class="" href="/bitcoin-core-dev/2020-12-21">21</a> <a class="" href="/bitcoin-core-dev/2020-12-22">22</a> <a class="" href="/bitcoin-core-dev/2020-12-23">23</a> <a class="" href="/bitcoin-core-dev/2020-12-24">24</a> <a class="" href="/bitcoin-core-dev/2020-12-25">25</a> <a class="" href="/bitcoin-core-dev/2020-12-26">26</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2020-12-27">27</a> <a class="" href="/bitcoin-core-dev/2020-12-28">28</a> <a class="" href="/bitcoin-core-dev/2020-12-29">29</a> <a class="" href="/bitcoin-core-dev/2020-12-30">30</a> <a class="" href="/bitcoin-core-dev/2020-12-31">31</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1607731320' id='418940'>
<a class='timestamp' href='#418940'><time timestamp='2020-12-12T00:02:00Z'>00:02</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I&#x27;ll try an updated native_cctools first
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731320' id='418941'>
<a class='timestamp' href='#418941'><time timestamp='2020-12-12T00:02:00Z'>00:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
cool
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731380' id='418942'>
<a class='timestamp' href='#418942'><time timestamp='2020-12-12T00:03:00Z'>00:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s also possible that jonasschnelli&#x27;s codesign tool is too old!
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731380' id='418943'>
<a class='timestamp' href='#418943'><time timestamp='2020-12-12T00:03:00Z'>00:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
(as native_cctools was updated for 0.21)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731380' id='418944'>
<a class='timestamp' href='#418944'><time timestamp='2020-12-12T00:03:00Z'>00:03</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
Well it&#x27;s worked for the previous rc
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731440' id='418945'>
<a class='timestamp' href='#418945'><time timestamp='2020-12-12T00:04:00Z'>00:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it may be that some alignment thing changed that doesn&#x27;t matter in every situation
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731620' id='418946'>
<a class='timestamp' href='#418946'><time timestamp='2020-12-12T00:07:00Z'>00:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
maybe we should just make some arbitrary binary-changing commits for rc4, and hope that that fixes it
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731620' id='418947'>
<a class='timestamp' href='#418947'><time timestamp='2020-12-12T00:07:00Z'>00:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
<b>*hides*</b>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731920' id='418948'>
<a class='timestamp' href='#418948'><time timestamp='2020-12-12T00:12:00Z'>00:12</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: what version is your cctools? if you have the ability to change it, use 949.0.1 
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731980' id='418949'>
<a class='timestamp' href='#418949'><time timestamp='2020-12-12T00:13:00Z'>00:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: what version is your codesigning tool on macos?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731980' id='418950'>
<a class='timestamp' href='#418950'><time timestamp='2020-12-12T00:13:00Z'>00:13</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
no idea
<br>
</div>

<div class='talk op-msg' data-timestamp='1607731980' id='418951'>
<a class='timestamp' href='#418951'><time timestamp='2020-12-12T00:13:00Z'>00:13</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
there&#x27;s no version command for codesign or codesign_allocate
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732040' id='418952'>
<a class='timestamp' href='#418952'><time timestamp='2020-12-12T00:14:00Z'>00:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
this line in codesign_allocate changed in the latest cctools:
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732100' id='418953'>
<a class='timestamp' href='#418953'><time timestamp='2020-12-12T00:15:00Z'>00:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
object-&gt;seg_linkedit-&gt;vmsize = rnd32(object-&gt;seg_linkedit-&gt;filesize, get_segalign_from_flag(&amp;arch_signs[i].arch_flag));
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732100' id='418954'>
<a class='timestamp' href='#418954'><time timestamp='2020-12-12T00:15:00Z'>00:15</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
where do you see this?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732220' id='418955'>
<a class='timestamp' href='#418955'><time timestamp='2020-12-12T00:17:00Z'>00:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
<a href="https://github.com/tpoechtrager/cctools-port/commit/466063c7f7486762a5a8f0d98c48dc5ffbe42f74#diff-c0274ccf413d9c63c15dc20f765faa1dd750ae7a74b65dfda9afbe1e91ea137cR711" class="link" target="_blank">https://github.com/tpoechtrager/cctools-port/commit/466063c7f7486762a5a8f0d98c48dc5ffbe42f74#diff-c0274ccf413d9c63c15dc20f765faa1dd750ae7a74b65dfda9afbe1e91ea137cR711</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732220' id='418956'>
<a class='timestamp' href='#418956'><time timestamp='2020-12-12T00:17:00Z'>00:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
this is in the version we&#x27;re using in the gitian build
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732220' id='418957'>
<a class='timestamp' href='#418957'><time timestamp='2020-12-12T00:17:00Z'>00:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but given that it recently changed (may 2020), perhaps somehow jonasschnelli is using an apple equivalent that is older
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732220' id='418958'>
<a class='timestamp' href='#418958'><time timestamp='2020-12-12T00:17:00Z'>00:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
*march 2020
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732340' id='418959'>
<a class='timestamp' href='#418959'><time timestamp='2020-12-12T00:19:00Z'>00:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
actually, no
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732340' id='418960'>
<a class='timestamp' href='#418960'><time timestamp='2020-12-12T00:19:00Z'>00:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
rnd -&gt; rnd32 doesn&#x27;t change anything
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732460' id='418961'>
<a class='timestamp' href='#418961'><time timestamp='2020-12-12T00:21:00Z'>00:21</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
eh.. they don&#x27;t make tags for new versions.. great
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732640' id='418962'>
<a class='timestamp' href='#418962'><time timestamp='2020-12-12T00:24:00Z'>00:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
got it!
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732640' id='418963'>
<a class='timestamp' href='#418963'><time timestamp='2020-12-12T00:24:00Z'>00:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
cctools v921 uses 4k as default alignment for x86_64
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732640' id='418964'>
<a class='timestamp' href='#418964'><time timestamp='2020-12-12T00:24:00Z'>00:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
oh, no, i misread :(
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732880' id='418965'>
<a class='timestamp' href='#418965'><time timestamp='2020-12-12T00:28:00Z'>00:28</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
what is the full output from that x86_64-apple-darwin-otool -l Bitcoin-Qt command?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607732940' id='418966'>
<a class='timestamp' href='#418966'><time timestamp='2020-12-12T00:29:00Z'>00:29</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
of which version of Bitcoin-Qt
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733000' id='418967'>
<a class='timestamp' href='#418967'><time timestamp='2020-12-12T00:30:00Z'>00:30</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
no matter
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733060' id='418968'>
<a class='timestamp' href='#418968'><time timestamp='2020-12-12T00:31:00Z'>00:31</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
<a href="https://0bin.net/paste/ArdAXxJ3#67qz6LxpqPGqIXWODToWwyFxorHcouHH1CzJGxdBB2I" class="link" target="_blank">https://0bin.net/paste/ArdAXxJ3#67qz6LxpqPGqIXWODToWwyFxorHcouHH1CzJGxdBB2I</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733060' id='418969'>
<a class='timestamp' href='#418969'><time timestamp='2020-12-12T00:31:00Z'>00:31</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/67" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/67</a> | does not compile with boost_1_45_0 on OS X 10.6 · Issue #67 · bitcoin/bitcoin · GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733060' id='418970'>
<a class='timestamp' href='#418970'><time timestamp='2020-12-12T00:31:00Z'>00:31</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
bad bot
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733300' id='418971'>
<a class='timestamp' href='#418971'><time timestamp='2020-12-12T00:35:00Z'>00:35</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the __LINKEDIT &quot;filesize&quot; entry is the same for the codesign-output-binary and the gitian-reconstructed one, right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733300' id='418972'>
<a class='timestamp' href='#418972'><time timestamp='2020-12-12T00:35:00Z'>00:35</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
just vmsize is different
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733300' id='418973'>
<a class='timestamp' href='#418973'><time timestamp='2020-12-12T00:35:00Z'>00:35</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733360' id='418974'>
<a class='timestamp' href='#418974'><time timestamp='2020-12-12T00:36:00Z'>00:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yeah, if it wasnt&#x27;t, more than 1 byte would differ
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733480' id='418975'>
<a class='timestamp' href='#418975'><time timestamp='2020-12-12T00:38:00Z'>00:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
literally every version of cctools i can find uses 0x1000 as segment alignment for X86_64
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733480' id='418976'>
<a class='timestamp' href='#418976'><time timestamp='2020-12-12T00:38:00Z'>00:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so the correct rounding of filesize 500144 to vmsize is 0x7b000
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733540' id='418977'>
<a class='timestamp' href='#418977'><time timestamp='2020-12-12T00:39:00Z'>00:39</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
why is jonas&#x27; tool rounding it to 0x7c000 (like he&#x27;s using a segment alignment of 0x2000 or 0x4000)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733540' id='418978'>
<a class='timestamp' href='#418978'><time timestamp='2020-12-12T00:39:00Z'>00:39</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
now, libstuff uses 0x2000 for unknown CPU architectures
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733600' id='418979'>
<a class='timestamp' href='#418979'><time timestamp='2020-12-12T00:40:00Z'>00:40</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so maybe somehow the wrong architecture is passed down?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733660' id='418980'>
<a class='timestamp' href='#418980'><time timestamp='2020-12-12T00:41:00Z'>00:41</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
see <a href="https://opensource.apple.com/source/cctools/cctools-949.0.1/libstuff/arch.c.auto.html" class="link" target="_blank">https://opensource.apple.com/source/cctools/cctools-949.0.1/libstuff/arch.c.auto.html</a> look for &quot;{ CPU_TYPE_X86_64,    LITTLE_ENDIAN_BYTE_SEX, 0x7fff5fc00000LL,  0x1000 },&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733660' id='418981'>
<a class='timestamp' href='#418981'><time timestamp='2020-12-12T00:41:00Z'>00:41</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
updating cctools (specifically codesign_allocate) did not make a difference
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733720' id='418982'>
<a class='timestamp' href='#418982'><time timestamp='2020-12-12T00:42:00Z'>00:42</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
jonasschnelli: are you using the same signing machine as before?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733780' id='418983'>
<a class='timestamp' href='#418983'><time timestamp='2020-12-12T00:43:00Z'>00:43</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and in <a href="https://opensource.apple.com/source/cctools/cctools-949.0.1/misc/codesign_allocate.c.auto.html" class="link" target="_blank">https://opensource.apple.com/source/cctools/cctools-949.0.1/misc/codesign_allocate.c.auto.html</a> look for &quot;object-&gt;seg_linkedit-&gt;vmsize =&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607733780' id='418984'>
<a class='timestamp' href='#418984'><time timestamp='2020-12-12T00:43:00Z'>00:43</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
IIRC he has one of the M1 macs for testing stuff, maybe he used that for signing?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734200' id='418985'>
<a class='timestamp' href='#418985'><time timestamp='2020-12-12T00:50:00Z'>00:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i suspect that if we add 1024 bytes to the sig size in codesign_allocate it may work
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734200' id='418986'>
<a class='timestamp' href='#418986'><time timestamp='2020-12-12T00:50:00Z'>00:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if you do:
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734260' id='418987'>
<a class='timestamp' href='#418987'><time timestamp='2020-12-12T00:51:00Z'>00:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
codesign_allocate -i &lt;unsigned Bitcoin-Qt filename&gt; -a x86_64 $((225312+1024)) -o &lt;some temp file&gt;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734260' id='418988'>
<a class='timestamp' href='#418988'><time timestamp='2020-12-12T00:51:00Z'>00:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
on linux
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734260' id='418989'>
<a class='timestamp' href='#418989'><time timestamp='2020-12-12T00:51:00Z'>00:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it may just work, with the existing signature
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734260' id='418990'>
<a class='timestamp' href='#418990'><time timestamp='2020-12-12T00:51:00Z'>00:51</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I&#x27;m wondering why this size makes a difference to how the signature validates
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734260' id='418991'>
<a class='timestamp' href='#418991'><time timestamp='2020-12-12T00:51:00Z'>00:51</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
istm it shouldn&#x27;t be covered by the signature itself
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734320' id='418992'>
<a class='timestamp' href='#418992'><time timestamp='2020-12-12T00:52:00Z'>00:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i believe the code signature covers the entire binary, with the signature itself wiped out (this is a guess...)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734320' id='418993'>
<a class='timestamp' href='#418993'><time timestamp='2020-12-12T00:52:00Z'>00:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so its size matters
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734320' id='418994'>
<a class='timestamp' href='#418994'><time timestamp='2020-12-12T00:52:00Z'>00:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that would explain why a tool like codesign_allocate exists in the first place
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734320' id='418995'>
<a class='timestamp' href='#418995'><time timestamp='2020-12-12T00:52:00Z'>00:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
as its behavior is nominal for the signing process
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734320' id='418996'>
<a class='timestamp' href='#418996'><time timestamp='2020-12-12T00:52:00Z'>00:52</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
but the size of the signature isn&#x27;t known until the signature is made
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734380' id='418997'>
<a class='timestamp' href='#418997'><time timestamp='2020-12-12T00:53:00Z'>00:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i assume that the codesign tool does now the signature size beforehand
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734380' id='418998'>
<a class='timestamp' href='#418998'><time timestamp='2020-12-12T00:53:00Z'>00:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
*know
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734380' id='418999'>
<a class='timestamp' href='#418999'><time timestamp='2020-12-12T00:53:00Z'>00:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
or it pads it to make sure it does
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734380' id='419000'>
<a class='timestamp' href='#419000'><time timestamp='2020-12-12T00:53:00Z'>00:53</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
i suppose it just needs to fall within the page size
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734380' id='419001'>
<a class='timestamp' href='#419001'><time timestamp='2020-12-12T00:53:00Z'>00:53</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
and that&#x27;s probably a big enough range
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734380' id='419002'>
<a class='timestamp' href='#419002'><time timestamp='2020-12-12T00:53:00Z'>00:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
right
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734440' id='419003'>
<a class='timestamp' href='#419003'><time timestamp='2020-12-12T00:54:00Z'>00:54</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
so apple makes codesign_allocate open source, but not codesign itself?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734440' id='419004'>
<a class='timestamp' href='#419004'><time timestamp='2020-12-12T00:54:00Z'>00:54</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
apparently
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734440' id='419005'>
<a class='timestamp' href='#419005'><time timestamp='2020-12-12T00:54:00Z'>00:54</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but codesign invokes codesign_allocate
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734500' id='419006'>
<a class='timestamp' href='#419006'><time timestamp='2020-12-12T00:55:00Z'>00:55</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
supposedly
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734500' id='419007'>
<a class='timestamp' href='#419007'><time timestamp='2020-12-12T00:55:00Z'>00:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and you can override which codesign_allocate to use... as long as it&#x27;s signed by apple
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734560' id='419008'>
<a class='timestamp' href='#419008'><time timestamp='2020-12-12T00:56:00Z'>00:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if you run &quot;codesign_allocate -i &lt;gitian Bitcoin-Qt filename&gt; -a x86_64 $((225312+1024)) -o &lt;newname&gt;&quot; in linux, does the resulting binary work in macos?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734620' id='419009'>
<a class='timestamp' href='#419009'><time timestamp='2020-12-12T00:57:00Z'>00:57</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
oh, nvm
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734620' id='419010'>
<a class='timestamp' href='#419010'><time timestamp='2020-12-12T00:57:00Z'>00:57</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
nope, won&#x27;t work
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734620' id='419011'>
<a class='timestamp' href='#419011'><time timestamp='2020-12-12T00:57:00Z'>00:57</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that&#x27;ll actually make space in the binary
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734800' id='419012'>
<a class='timestamp' href='#419012'><time timestamp='2020-12-12T01:00:00Z'>01:00</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
what if I set arch to ARM64 so it uses 0x4000 as the page size?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607734980' id='419013'>
<a class='timestamp' href='#419013'><time timestamp='2020-12-12T01:03:00Z'>01:03</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
and codesign_allocate doesn&#x27;t like it
<br>
</div>

<div class='talk op-msg' data-timestamp='1607735280' id='419014'>
<a class='timestamp' href='#419014'><time timestamp='2020-12-12T01:08:00Z'>01:08</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yeah i don&#x27;t expect that&#x27;d work
<br>
</div>

<div class='talk op-msg' data-timestamp='1607735280' id='419015'>
<a class='timestamp' href='#419015'><time timestamp='2020-12-12T01:08:00Z'>01:08</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: but if you run codesign_allocate with 225312, on macos, you also get the 0x7c000 vmsize?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607735460' id='419016'>
<a class='timestamp' href='#419016'><time timestamp='2020-12-12T01:11:00Z'>01:11</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
Ah, yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607735520' id='419017'>
<a class='timestamp' href='#419017'><time timestamp='2020-12-12T01:12:00Z'>01:12</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so perhaps... the codesign tool isn&#x27;t invoking it with size 225312
<br>
</div>

<div class='talk op-msg' data-timestamp='1607735520' id='419018'>
<a class='timestamp' href='#419018'><time timestamp='2020-12-12T01:12:00Z'>01:12</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
mayne it invokes it twice
<br>
</div>

<div class='talk op-msg' data-timestamp='1607735580' id='419019'>
<a class='timestamp' href='#419019'><time timestamp='2020-12-12T01:13:00Z'>01:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
once with a prospective size, to get the to-be-signed binary, and then again with the real size
<br>
</div>

<div class='talk op-msg' data-timestamp='1607735580' id='419020'>
<a class='timestamp' href='#419020'><time timestamp='2020-12-12T01:13:00Z'>01:13</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
Now, I think the installation of codesign_allocate is different from the open source one
<br>
</div>

<div class='talk op-msg' data-timestamp='1607735580' id='419021'>
<a class='timestamp' href='#419021'><time timestamp='2020-12-12T01:13:00Z'>01:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that&#x27;d explain the filesize of LINKEDIT being correct, but vmsize isn&#x27;t
<br>
</div>

<div class='talk op-msg' data-timestamp='1607735640' id='419022'>
<a class='timestamp' href='#419022'><time timestamp='2020-12-12T01:14:00Z'>01:14</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
Because it matches jonas&#x27;s, not gitian
<br>
</div>

<div class='talk op-msg' data-timestamp='1607735940' id='419023'>
<a class='timestamp' href='#419023'><time timestamp='2020-12-12T01:19:00Z'>01:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
right
<br>
</div>

<div class='talk op-msg' data-timestamp='1607736180' id='419024'>
<a class='timestamp' href='#419024'><time timestamp='2020-12-12T01:23:00Z'>01:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if you on linux run codesign_allocate with a larger size first, and then again withnthe correct size, does the __linkedit stuff end up being correct?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607736780' id='419025'>
<a class='timestamp' href='#419025'><time timestamp='2020-12-12T01:33:00Z'>01:33</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
what&#x27;s a big enough size?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607736900' id='419026'>
<a class='timestamp' href='#419026'><time timestamp='2020-12-12T01:35:00Z'>01:35</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
$((225312+1024))
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737140' id='419027'>
<a class='timestamp' href='#419027'><time timestamp='2020-12-12T01:39:00Z'>01:39</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
nope. also still 7b
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737200' id='419028'>
<a class='timestamp' href='#419028'><time timestamp='2020-12-12T01:40:00Z'>01:40</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
after both commands, or even after the first one?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737200' id='419029'>
<a class='timestamp' href='#419029'><time timestamp='2020-12-12T01:40:00Z'>01:40</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
both
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737200' id='419030'>
<a class='timestamp' href='#419030'><time timestamp='2020-12-12T01:40:00Z'>01:40</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
oh, i&#x27;m wrong
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737200' id='419031'>
<a class='timestamp' href='#419031'><time timestamp='2020-12-12T01:40:00Z'>01:40</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
well both as in both both commands and first one
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737200' id='419032'>
<a class='timestamp' href='#419032'><time timestamp='2020-12-12T01:40:00Z'>01:40</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
0x1000 is not 1024, but 4096
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737260' id='419033'>
<a class='timestamp' href='#419033'><time timestamp='2020-12-12T01:41:00Z'>01:41</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so $((225312+4024))
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737260' id='419034'>
<a class='timestamp' href='#419034'><time timestamp='2020-12-12T01:41:00Z'>01:41</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so $((225312+4096))
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737260' id='419035'>
<a class='timestamp' href='#419035'><time timestamp='2020-12-12T01:41:00Z'>01:41</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
oh right
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737380' id='419036'>
<a class='timestamp' href='#419036'><time timestamp='2020-12-12T01:43:00Z'>01:43</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
that works
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737380' id='419037'>
<a class='timestamp' href='#419037'><time timestamp='2020-12-12T01:43:00Z'>01:43</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
although I will say that this is not a suitable workaround
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737440' id='419038'>
<a class='timestamp' href='#419038'><time timestamp='2020-12-12T01:44:00Z'>01:44</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
we could produce in the gitian output the information on what size to resize to
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737500' id='419039'>
<a class='timestamp' href='#419039'><time timestamp='2020-12-12T01:45:00Z'>01:45</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it can be deterministically inferred from the macos-signed binary
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737560' id='419040'>
<a class='timestamp' href='#419040'><time timestamp='2020-12-12T01:46:00Z'>01:46</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
i suppose
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737560' id='419041'>
<a class='timestamp' href='#419041'><time timestamp='2020-12-12T01:46:00Z'>01:46</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it feels like there should be a better way
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737620' id='419042'>
<a class='timestamp' href='#419042'><time timestamp='2020-12-12T01:47:00Z'>01:47</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737620' id='419043'>
<a class='timestamp' href='#419043'><time timestamp='2020-12-12T01:47:00Z'>01:47</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
there is clearly a discrepancy between the macos codesign_allocate tool and the opensource one
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737620' id='419044'>
<a class='timestamp' href='#419044'><time timestamp='2020-12-12T01:47:00Z'>01:47</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and i&#x27;m confused why that isn&#x27;t a problem for other projects
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737680' id='419045'>
<a class='timestamp' href='#419045'><time timestamp='2020-12-12T01:48:00Z'>01:48</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
maybe no one has tried to make a new release recently?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737740' id='419046'>
<a class='timestamp' href='#419046'><time timestamp='2020-12-12T01:49:00Z'>01:49</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
we didn&#x27;t see this a few weeks ago for rc2
<br>
</div>

<div class='talk op-msg' data-timestamp='1607737920' id='419047'>
<a class='timestamp' href='#419047'><time timestamp='2020-12-12T01:52:00Z'>01:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yeah, baffling
<br>
</div>

<div class='talk op-msg' data-timestamp='1607738040' id='419048'>
<a class='timestamp' href='#419048'><time timestamp='2020-12-12T01:54:00Z'>01:54</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
lol @ actively {-beating our heads against Apple&#x27;s walled garden wall-} debugging this issue
<br>
</div>

<div class='talk op-msg' data-timestamp='1607738160' id='419049'>
<a class='timestamp' href='#419049'><time timestamp='2020-12-12T01:56:00Z'>01:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
there is a macports version of cctools, presumably using the open source code
<br>
</div>

<div class='talk op-msg' data-timestamp='1607738160' id='419050'>
<a class='timestamp' href='#419050'><time timestamp='2020-12-12T01:56:00Z'>01:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if you run that on macos, what behavior does it have?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607738220' id='419051'>
<a class='timestamp' href='#419051'><time timestamp='2020-12-12T01:57:00Z'>01:57</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I don&#x27;t have macports installed
<br>
</div>

<div class='talk op-msg' data-timestamp='1607738460' id='419052'>
<a class='timestamp' href='#419052'><time timestamp='2020-12-12T02:01:00Z'>02:01</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I found an old version of codesign source on apple&#x27;s opensource site: <a href="https://opensource.apple.com/source/security_systemkeychain/security_systemkeychain-55191.1/src/codesign.cpp.auto.html" class="link" target="_blank">https://opensource.apple.com/source/security_systemkeychain/security_systemkeychain-55191.1/src/codesign.cpp.auto.html</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607738460' id='419053'>
<a class='timestamp' href='#419053'><time timestamp='2020-12-12T02:01:00Z'>02:01</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it disappears eventually, but that might just mean it got moved to somewhere else
<br>
</div>

<div class='talk op-msg' data-timestamp='1607738520' id='419054'>
<a class='timestamp' href='#419054'><time timestamp='2020-12-12T02:02:00Z'>02:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that one doesn&#x27;t invoke codesign_allocate
<br>
</div>

<div class='talk op-msg' data-timestamp='1607738520' id='419055'>
<a class='timestamp' href='#419055'><time timestamp='2020-12-12T02:02:00Z'>02:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
as far i can see, but it may be in another source file
<br>
</div>

<div class='talk op-msg' data-timestamp='1607740020' id='419056'>
<a class='timestamp' href='#419056'><time timestamp='2020-12-12T02:27:00Z'>02:27</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: macports cctools uses 0x7b000
<br>
</div>

<div class='talk op-msg' data-timestamp='1607740320' id='419057'>
<a class='timestamp' href='#419057'><time timestamp='2020-12-12T02:32:00Z'>02:32</time></a>
&lt;<span class='nick nick-3'> ConsciousFlesh</span>&gt;
Are there any devs here who were involved with, or around when the `RPCHelpMan()` function replaced throwing a runtime error to display JSON-RPC help text?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607740380' id='419058'>
<a class='timestamp' href='#419058'><time timestamp='2020-12-12T02:33:00Z'>02:33</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: great, so the apple codesign_allocate just behaves differently from their published source code
<br>
</div>

<div class='talk op-msg' data-timestamp='1607741940' id='419059'>
<a class='timestamp' href='#419059'><time timestamp='2020-12-12T02:59:00Z'>02:59</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
i guess we shouldn&#x27;t be that surprised that they do different things
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745120' id='419060'>
<a class='timestamp' href='#419060'><time timestamp='2020-12-12T03:52:00Z'>03:52</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: adding the run codesign_allocate twice trick to detached-sig-apply.sh does make rc3 pass signature validation
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745120' id='419061'>
<a class='timestamp' href='#419061'><time timestamp='2020-12-12T03:52:00Z'>03:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
great
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745180' id='419062'>
<a class='timestamp' href='#419062'><time timestamp='2020-12-12T03:53:00Z'>03:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so we just need something to take a size from the code-signatures.tgz
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745180' id='419063'>
<a class='timestamp' href='#419063'><time timestamp='2020-12-12T03:53:00Z'>03:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and modify jonas&#x27; script to compute what the right pre-allocate size is
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745180' id='419064'>
<a class='timestamp' href='#419064'><time timestamp='2020-12-12T03:53:00Z'>03:53</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I wonder if maybe it would be easier to codesign_allocate the unsigned dmg with a larger than necessary but fixed sized chunk
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745240' id='419065'>
<a class='timestamp' href='#419065'><time timestamp='2020-12-12T03:54:00Z'>03:54</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
the gitian signer&#x27;s codesign allocate shrinks it, but I don&#x27;t think effects the vmsize
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745240' id='419066'>
<a class='timestamp' href='#419066'><time timestamp='2020-12-12T03:54:00Z'>03:54</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
looking at the codesign_allocate tool, it just only ever increments the vmsize
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745300' id='419067'>
<a class='timestamp' href='#419067'><time timestamp='2020-12-12T03:55:00Z'>03:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which is going to be the rounded-up version of the largest value the filesize ever had
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745300' id='419068'>
<a class='timestamp' href='#419068'><time timestamp='2020-12-12T03:55:00Z'>03:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and whatever we do, we need to replicate the apple tool&#x27;s behavior
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745300' id='419069'>
<a class='timestamp' href='#419069'><time timestamp='2020-12-12T03:55:00Z'>03:55</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
right, so we could always overshoot by a lot when we make the unsigned dmg
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745300' id='419070'>
<a class='timestamp' href='#419070'><time timestamp='2020-12-12T03:55:00Z'>03:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yup
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745300' id='419071'>
<a class='timestamp' href='#419071'><time timestamp='2020-12-12T03:55:00Z'>03:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that&#x27;s a possibility
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745360' id='419072'>
<a class='timestamp' href='#419072'><time timestamp='2020-12-12T03:56:00Z'>03:56</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
[20:46:44] &lt;jonasschnelli&gt; is there a way to speeup gitians &quot;Upgrading system, may take a while (log in var/install.log)&quot;? &lt;-- I just run the base VM and update it
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745360' id='419073'>
<a class='timestamp' href='#419073'><time timestamp='2020-12-12T03:56:00Z'>03:56</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I&#x27;m going to go through history and see what the largest sigs we&#x27;ve had before is
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745420' id='419074'>
<a class='timestamp' href='#419074'><time timestamp='2020-12-12T03:57:00Z'>03:57</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
any idea if an overly large vmsize has any negative effects?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745540' id='419075'>
<a class='timestamp' href='#419075'><time timestamp='2020-12-12T03:59:00Z'>03:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i suspect if we crank up the codesign --pagesize value the sig will be much smaller
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745600' id='419076'>
<a class='timestamp' href='#419076'><time timestamp='2020-12-12T04:00:00Z'>04:00</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it signs every page separately
<br>
</div>

<div class='talk op-msg' data-timestamp='1607745660' id='419077'>
<a class='timestamp' href='#419077'><time timestamp='2020-12-12T04:01:00Z'>04:01</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
oh, is that why the sig is so big and varies a lot
<br>
</div>

<div class='talk op-msg' data-timestamp='1607749500' id='419078'>
<a class='timestamp' href='#419078'><time timestamp='2020-12-12T05:05:00Z'>05:05</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] pox opened pull request #20635: fix misleading comment about call to non-existing function (master...master) <a href="https://github.com/bitcoin/bitcoin/pull/20635" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/20635</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756400' id='419079'>
<a class='timestamp' href='#419079'><time timestamp='2020-12-12T07:00:00Z'>07:00</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa, achow101: I&#x27;m reading the backlog... for your info,... I haven&#x27;t changed anything on my signing computer since signing rc2 (which was successful).
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756460' id='419080'>
<a class='timestamp' href='#419080'><time timestamp='2020-12-12T07:01:00Z'>07:01</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
jonasschnelli: good to know. the backlog is quite a journey..
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756460' id='419081'>
<a class='timestamp' href='#419081'><time timestamp='2020-12-12T07:01:00Z'>07:01</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
AFAIK detached-sig-create.sh under the hood, it uses the macOS codesign tool (which I haven&#x27;t changed)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756460' id='419082'>
<a class='timestamp' href='#419082'><time timestamp='2020-12-12T07:01:00Z'>07:01</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
achow101: yeah.. halfway through.
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756460' id='419083'>
<a class='timestamp' href='#419083'><time timestamp='2020-12-12T07:01:00Z'>07:01</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Very interesting.
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756580' id='419084'>
<a class='timestamp' href='#419084'><time timestamp='2020-12-12T07:03:00Z'>07:03</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
2020-12-11T23:57:47  &lt;sipa&gt; an alternative is making jonasschnelli downgrade his codesign_allocate tool to one that&#x27;s compatible with the native_ccttols we use, and then tell his codesign tool to use that
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756580' id='419085'>
<a class='timestamp' href='#419085'><time timestamp='2020-12-12T07:03:00Z'>07:03</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
^ as said,... I haven&#x27;t upgraded anything since rc2
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756640' id='419086'>
<a class='timestamp' href='#419086'><time timestamp='2020-12-12T07:04:00Z'>07:04</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
2020-12-12T00:12:49  &lt;sipa&gt; jonasschnelli: what version is your cctools? if you have the ability to change it, use 949.0.1
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756700' id='419087'>
<a class='timestamp' href='#419087'><time timestamp='2020-12-12T07:05:00Z'>07:05</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I guess sipa wants to know what clang version I have on my signing mac. Why would this be relevant? IMO codesign is not part of the llvm suite
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756700' id='419088'>
<a class='timestamp' href='#419088'><time timestamp='2020-12-12T07:05:00Z'>07:05</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
And cctools on the gitian host should be irrelevant
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756700' id='419089'>
<a class='timestamp' href='#419089'><time timestamp='2020-12-12T07:05:00Z'>07:05</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
cctools is separate from clang
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756700' id='419090'>
<a class='timestamp' href='#419090'><time timestamp='2020-12-12T07:05:00Z'>07:05</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it&#x27;s part of xcode&#x27;s developer tools
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756760' id='419091'>
<a class='timestamp' href='#419091'><time timestamp='2020-12-12T07:06:00Z'>07:06</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
jonasschnelli: the tl;dr is that codesign_allocate as distributed by apple is different from codesign_allocate compiled from source
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756760' id='419092'>
<a class='timestamp' href='#419092'><time timestamp='2020-12-12T07:06:00Z'>07:06</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
codesign uses codesign_allocate under the hood somewhere and that&#x27;s causing us problems
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756760' id='419093'>
<a class='timestamp' href='#419093'><time timestamp='2020-12-12T07:06:00Z'>07:06</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
achow101: thats very interesting... 
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756820' id='419094'>
<a class='timestamp' href='#419094'><time timestamp='2020-12-12T07:07:00Z'>07:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: can you try whag happens if you pass --pagesize 0 to the codesign tool?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756880' id='419095'>
<a class='timestamp' href='#419095'><time timestamp='2020-12-12T07:08:00Z'>07:08</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that&#x27;s unrelated, but it may result in smaller ans more predictable signature sizes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756880' id='419096'>
<a class='timestamp' href='#419096'><time timestamp='2020-12-12T07:08:00Z'>07:08</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa: okay... I executed &quot;./detached-sig-create.sh -s &quot;Bitcoin&quot; --pagesize 0&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756940' id='419097'>
<a class='timestamp' href='#419097'><time timestamp='2020-12-12T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
no no, to the codesign tool
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756940' id='419098'>
<a class='timestamp' href='#419098'><time timestamp='2020-12-12T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so inside detached-sig-create.sh
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756940' id='419099'>
<a class='timestamp' href='#419099'><time timestamp='2020-12-12T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: I&#x27;ve figured out what that codesign source I found doesn&#x27;t have a call to codesign_allocate - the actual signing is way deeper in the stack and isn&#x27;t open source. the code I found is just the wrapper to expose things as a command line tool
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756940' id='419100'>
<a class='timestamp' href='#419100'><time timestamp='2020-12-12T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa: okay
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756940' id='419101'>
<a class='timestamp' href='#419101'><time timestamp='2020-12-12T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
or does it pass everything through?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756940' id='419102'>
<a class='timestamp' href='#419102'><time timestamp='2020-12-12T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
passing extra args to detached-sig-create should pass through to codesign
<br>
</div>

<div class='talk op-msg' data-timestamp='1607756940' id='419103'>
<a class='timestamp' href='#419103'><time timestamp='2020-12-12T07:09:00Z'>07:09</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ok
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757000' id='419104'>
<a class='timestamp' href='#419104'><time timestamp='2020-12-12T07:10:00Z'>07:10</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: yeah, i tried browsing but i couldn&#x27;t even find any place where the pagesize argument was used
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757060' id='419105'>
<a class='timestamp' href='#419105'><time timestamp='2020-12-12T07:11:00Z'>07:11</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
<a href="https://bitcoin.jonasschnelli.ch/signature-osx_pagesize_0.tar.gz" class="link" target="_blank">https://bitcoin.jonasschnelli.ch/signature-osx_pagesize_0.tar.gz</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757060' id='419106'>
<a class='timestamp' href='#419106'><time timestamp='2020-12-12T07:11:00Z'>07:11</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I changed L26 to ${CODESIGN} --pagesize 0 -f --file-list ${TEMPLIST} &quot;$@&quot; &quot;${BUNDLE}&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757120' id='419107'>
<a class='timestamp' href='#419107'><time timestamp='2020-12-12T07:12:00Z'>07:12</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
but why was rc2 fine and rc3 isn&#x27;t?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757120' id='419108'>
<a class='timestamp' href='#419108'><time timestamp='2020-12-12T07:12:00Z'>07:12</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
beats me
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757120' id='419109'>
<a class='timestamp' href='#419109'><time timestamp='2020-12-12T07:12:00Z'>07:12</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I think we&#x27;ve found an edge case
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757120' id='419110'>
<a class='timestamp' href='#419110'><time timestamp='2020-12-12T07:12:00Z'>07:12</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
as I suspected
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757180' id='419111'>
<a class='timestamp' href='#419111'><time timestamp='2020-12-12T07:13:00Z'>07:13</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it&#x27;s weird that this is not present in the open soure build though
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757180' id='419112'>
<a class='timestamp' href='#419112'><time timestamp='2020-12-12T07:13:00Z'>07:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: it appears that the macos tool uses a different segment alignment
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757180' id='419113'>
<a class='timestamp' href='#419113'><time timestamp='2020-12-12T07:13:00Z'>07:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
as your signed result has an alignment of 8192 or 16384 bytes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757180' id='419114'>
<a class='timestamp' href='#419114'><time timestamp='2020-12-12T07:13:00Z'>07:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
while the gitian result is 4096 byte aligned
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757240' id='419115'>
<a class='timestamp' href='#419115'><time timestamp='2020-12-12T07:14:00Z'>07:14</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
okay
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757240' id='419116'>
<a class='timestamp' href='#419116'><time timestamp='2020-12-12T07:14:00Z'>07:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but the apple (open source) definitely uses 4096
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757240' id='419117'>
<a class='timestamp' href='#419117'><time timestamp='2020-12-12T07:14:00Z'>07:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it may be that rc2 just accidentally was already 8192 aligned
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757240' id='419118'>
<a class='timestamp' href='#419118'><time timestamp='2020-12-12T07:14:00Z'>07:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
we could check
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757240' id='419119'>
<a class='timestamp' href='#419119'><time timestamp='2020-12-12T07:14:00Z'>07:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: how big is the .sign file now?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757300' id='419120'>
<a class='timestamp' href='#419120'><time timestamp='2020-12-12T07:15:00Z'>07:15</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: I checked earlier, it&#x27;s 7b0000
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757300' id='419121'>
<a class='timestamp' href='#419121'><time timestamp='2020-12-12T07:15:00Z'>07:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ok, i have no explanation then :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757360' id='419122'>
<a class='timestamp' href='#419122'><time timestamp='2020-12-12T07:16:00Z'>07:16</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa: jonasschnelli  staff  18496 12 Dez 08:10 Bitcoin-Qt.sign
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757420' id='419123'>
<a class='timestamp' href='#419123'><time timestamp='2020-12-12T07:17:00Z'>07:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
much better!
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757480' id='419124'>
<a class='timestamp' href='#419124'><time timestamp='2020-12-12T07:18:00Z'>07:18</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the previous ones were 200 kB or so
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757480' id='419125'>
<a class='timestamp' href='#419125'><time timestamp='2020-12-12T07:18:00Z'>07:18</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I can try to gbuild the macOS signer with that
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757480' id='419126'>
<a class='timestamp' href='#419126'><time timestamp='2020-12-12T07:18:00Z'>07:18</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s worth a try
<br>
</div>

<div class='talk op-msg' data-timestamp='1607757540' id='419127'>
<a class='timestamp' href='#419127'><time timestamp='2020-12-12T07:19:00Z'>07:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if it was a weird edge case due to alignments, maybe this is enough to fix it
<br>
</div>

<div class='talk op-msg' data-timestamp='1607758680' id='419128'>
<a class='timestamp' href='#419128'><time timestamp='2020-12-12T07:38:00Z'>07:38</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
--pagesize 0 might actually make it possible for us to hack together a tool for codesigning
<br>
</div>

<div class='talk op-msg' data-timestamp='1607758740' id='419129'>
<a class='timestamp' href='#419129'><time timestamp='2020-12-12T07:39:00Z'>07:39</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
that doesn&#x27;t require macOS
<br>
</div>

<div class='talk op-msg' data-timestamp='1607758740' id='419130'>
<a class='timestamp' href='#419130'><time timestamp='2020-12-12T07:39:00Z'>07:39</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
pagesize 0 seems also not to work
<br>
</div>

<div class='talk op-msg' data-timestamp='1607758740' id='419131'>
<a class='timestamp' href='#419131'><time timestamp='2020-12-12T07:39:00Z'>07:39</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
<a href="https://bitcoin.jonasschnelli.ch/bitcoin-osx-signed_pagesize0.dmg" class="link" target="_blank">https://bitcoin.jonasschnelli.ch/bitcoin-osx-signed_pagesize0.dmg</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607758860' id='419132'>
<a class='timestamp' href='#419132'><time timestamp='2020-12-12T07:41:00Z'>07:41</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I was going to suggest that we try using the macports codesign_allocate, but the manpage for codesign says &quot;The system will not accept such substitutes unless they are specially signed (by Apple).&quot; on that topic, so I don&#x27;t think it will work
<br>
</div>

<div class='talk op-msg' data-timestamp='1607758920' id='419133'>
<a class='timestamp' href='#419133'><time timestamp='2020-12-12T07:42:00Z'>07:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
indeed
<br>
</div>

<div class='talk op-msg' data-timestamp='1607758920' id='419134'>
<a class='timestamp' href='#419134'><time timestamp='2020-12-12T07:42:00Z'>07:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: same problem?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607758920' id='419135'>
<a class='timestamp' href='#419135'><time timestamp='2020-12-12T07:42:00Z'>07:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: is it again the vmsize being off?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607758920' id='419136'>
<a class='timestamp' href='#419136'><time timestamp='2020-12-12T07:42:00Z'>07:42</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
checking
<br>
</div>

<div class='talk op-msg' data-timestamp='1607758980' id='419137'>
<a class='timestamp' href='#419137'><time timestamp='2020-12-12T07:43:00Z'>07:43</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: is that file the signed binary that comes out of the codesign tool?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759040' id='419138'>
<a class='timestamp' href='#419138'><time timestamp='2020-12-12T07:44:00Z'>07:44</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa: no... that file above is the gitian signer result with using the signature.tar.gz that was built with pagesize 0
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759040' id='419139'>
<a class='timestamp' href='#419139'><time timestamp='2020-12-12T07:44:00Z'>07:44</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
i need to compare against the result of the codesign tool
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759040' id='419140'>
<a class='timestamp' href='#419140'><time timestamp='2020-12-12T07:44:00Z'>07:44</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: we&#x27;ll also need the codesign output
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759040' id='419141'>
<a class='timestamp' href='#419141'><time timestamp='2020-12-12T07:44:00Z'>07:44</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
okay.. one sec
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759160' id='419142'>
<a class='timestamp' href='#419142'><time timestamp='2020-12-12T07:46:00Z'>07:46</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
<a href="https://bitcoin.jonasschnelli.ch/bitcoin-0.21.0rc3-osx-unsigned-pagesize-0.zip" class="link" target="_blank">https://bitcoin.jonasschnelli.ch/bitcoin-0.21.0rc3-osx-unsigned-pagesize-0.zip</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759220' id='419143'>
<a class='timestamp' href='#419143'><time timestamp='2020-12-12T07:47:00Z'>07:47</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
yes same problem
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759280' id='419144'>
<a class='timestamp' href='#419144'><time timestamp='2020-12-12T07:48:00Z'>07:48</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
codesign_allocate really likes 7c000 for some reason
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759280' id='419145'>
<a class='timestamp' href='#419145'><time timestamp='2020-12-12T07:48:00Z'>07:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: what are the vmsize values now?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759280' id='419146'>
<a class='timestamp' href='#419146'><time timestamp='2020-12-12T07:48:00Z'>07:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
wait what
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759280' id='419147'>
<a class='timestamp' href='#419147'><time timestamp='2020-12-12T07:48:00Z'>07:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
what is the filesize field and the vmsize field in both?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759280' id='419148'>
<a class='timestamp' href='#419148'><time timestamp='2020-12-12T07:48:00Z'>07:48</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
gitian is 0x4800 and codesign is 7c000
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759340' id='419149'>
<a class='timestamp' href='#419149'><time timestamp='2020-12-12T07:49:00Z'>07:49</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
dafuq
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759340' id='419150'>
<a class='timestamp' href='#419150'><time timestamp='2020-12-12T07:49:00Z'>07:49</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
fileoff and filesize are the same
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759340' id='419151'>
<a class='timestamp' href='#419151'><time timestamp='2020-12-12T07:49:00Z'>07:49</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
both are otherwise identical except for vmsize
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759340' id='419152'>
<a class='timestamp' href='#419152'><time timestamp='2020-12-12T07:49:00Z'>07:49</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and what is that filesize?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759340' id='419153'>
<a class='timestamp' href='#419153'><time timestamp='2020-12-12T07:49:00Z'>07:49</time></a>
&lt;<span class='nick nick-12'> * jonasschnelli</span>&gt;
throws away his mac
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759340' id='419154'>
<a class='timestamp' href='#419154'><time timestamp='2020-12-12T07:49:00Z'>07:49</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
filesize 293328
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759340' id='419155'>
<a class='timestamp' href='#419155'><time timestamp='2020-12-12T07:49:00Z'>07:49</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: a just decision
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759400' id='419156'>
<a class='timestamp' href='#419156'><time timestamp='2020-12-12T07:50:00Z'>07:50</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
signature is 18496
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759400' id='419157'>
<a class='timestamp' href='#419157'><time timestamp='2020-12-12T07:50:00Z'>07:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
0x48000 is the correct vmsize
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759460' id='419158'>
<a class='timestamp' href='#419158'><time timestamp='2020-12-12T07:51:00Z'>07:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
well, &quot;correct&quot;, from my understanding of what the opensource allocate tool does
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759460' id='419159'>
<a class='timestamp' href='#419159'><time timestamp='2020-12-12T07:51:00Z'>07:51</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759460' id='419160'>
<a class='timestamp' href='#419160'><time timestamp='2020-12-12T07:51:00Z'>07:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and that&#x27;s no surprise, because that&#x27;s also what it did
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759460' id='419161'>
<a class='timestamp' href='#419161'><time timestamp='2020-12-12T07:51:00Z'>07:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but so this means it is not a rounding issue at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759520' id='419162'>
<a class='timestamp' href='#419162'><time timestamp='2020-12-12T07:52:00Z'>07:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
unless it&#x27;s rounding up to a multiple of 0x7c000 !
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759580' id='419163'>
<a class='timestamp' href='#419163'><time timestamp='2020-12-12T07:53:00Z'>07:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if you on macos run codesign_allocate infile -a x86_64 18496 -o outfile on the unsigned binary, does it also produce 0x7c000 as vmsize?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759640' id='419164'>
<a class='timestamp' href='#419164'><time timestamp='2020-12-12T07:54:00Z'>07:54</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
let me try
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759700' id='419165'>
<a class='timestamp' href='#419165'><time timestamp='2020-12-12T07:55:00Z'>07:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: did you accidentally codesign an already-signed binary?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759700' id='419166'>
<a class='timestamp' href='#419166'><time timestamp='2020-12-12T07:55:00Z'>07:55</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa:.... hmm.. that could be for the latest just done build
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759700' id='419167'>
<a class='timestamp' href='#419167'><time timestamp='2020-12-12T07:55:00Z'>07:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
vmsize is not expected to go down in that case
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759760' id='419168'>
<a class='timestamp' href='#419168'><time timestamp='2020-12-12T07:56:00Z'>07:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so you have to start with the unsigned binary
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759760' id='419169'>
<a class='timestamp' href='#419169'><time timestamp='2020-12-12T07:56:00Z'>07:56</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
vmsize 0x0000000000043188
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759760' id='419170'>
<a class='timestamp' href='#419170'><time timestamp='2020-12-12T07:56:00Z'>07:56</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I try it again with pagesize 0 and make sure it&#x27;s not signed already
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759760' id='419171'>
<a class='timestamp' href='#419171'><time timestamp='2020-12-12T07:56:00Z'>07:56</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
that&#x27;s not a multple of 0x1000, 0x2000, or 0x4000
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759760' id='419172'>
<a class='timestamp' href='#419172'><time timestamp='2020-12-12T07:56:00Z'>07:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: wut
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759820' id='419173'>
<a class='timestamp' href='#419173'><time timestamp='2020-12-12T07:57:00Z'>07:57</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
ah wrong file
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759820' id='419174'>
<a class='timestamp' href='#419174'><time timestamp='2020-12-12T07:57:00Z'>07:57</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
vmsize 0x0000000000048000
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759820' id='419175'>
<a class='timestamp' href='#419175'><time timestamp='2020-12-12T07:57:00Z'>07:57</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
that&#x27;s correct and what we expect
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759880' id='419176'>
<a class='timestamp' href='#419176'><time timestamp='2020-12-12T07:58:00Z'>07:58</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: with the macos tool?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759880' id='419177'>
<a class='timestamp' href='#419177'><time timestamp='2020-12-12T07:58:00Z'>07:58</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607759940' id='419178'>
<a class='timestamp' href='#419178'><time timestamp='2020-12-12T07:59:00Z'>07:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and just to be sure... if you pass 225312 as size?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760000' id='419179'>
<a class='timestamp' href='#419179'><time timestamp='2020-12-12T08:00:00Z'>08:00</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
(i know we did that before, but perhaps that before we knew that history of sig sizes the binary has been through mattered)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760000' id='419180'>
<a class='timestamp' href='#419180'><time timestamp='2020-12-12T08:00:00Z'>08:00</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
as before vmsize 0x000000000007c000
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760000' id='419181'>
<a class='timestamp' href='#419181'><time timestamp='2020-12-12T08:00:00Z'>08:00</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ok
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760000' id='419182'>
<a class='timestamp' href='#419182'><time timestamp='2020-12-12T08:00:00Z'>08:00</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
well, if it&#x27;s an alignment issue, 0x48000 is 0x4000 aligned, so unlikely to cause problem
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760060' id='419183'>
<a class='timestamp' href='#419183'><time timestamp='2020-12-12T08:01:00Z'>08:01</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
<a href="https://bitcoin.jonasschnelli.ch/bitcoin-0.21.0rc3-osx-unsigned-again-pagesize0.zip" class="link" target="_blank">https://bitcoin.jonasschnelli.ch/bitcoin-0.21.0rc3-osx-unsigned-again-pagesize0.zip</a>   &lt;--- signed with pagesize 0, check that is was not already codesigned
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760060' id='419184'>
<a class='timestamp' href='#419184'><time timestamp='2020-12-12T08:01:00Z'>08:01</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so i expect this will be a solution
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760060' id='419185'>
<a class='timestamp' href='#419185'><time timestamp='2020-12-12T08:01:00Z'>08:01</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
(gitian output follows)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760120' id='419186'>
<a class='timestamp' href='#419186'><time timestamp='2020-12-12T08:02:00Z'>08:02</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: it&#x27;s aligning against 0x2000
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760180' id='419187'>
<a class='timestamp' href='#419187'><time timestamp='2020-12-12T08:03:00Z'>08:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: you found that by trying more sizes?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760180' id='419188'>
<a class='timestamp' href='#419188'><time timestamp='2020-12-12T08:03:00Z'>08:03</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
if I use 4096 as the size, I get 46000. same with 8192
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760240' id='419189'>
<a class='timestamp' href='#419189'><time timestamp='2020-12-12T08:04:00Z'>08:04</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
and if anyone wants to test 0.20.2rc1, I just created the detached signature (no gitian build yet):  <a href="https://bitcoin.jonasschnelli.ch/signature-osx_0.20.2rc1.tar.gz" class="link" target="_blank">https://bitcoin.jonasschnelli.ch/signature-osx_0.20.2rc1.tar.gz</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760240' id='419190'>
<a class='timestamp' href='#419190'><time timestamp='2020-12-12T08:04:00Z'>08:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ok
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760240' id='419191'>
<a class='timestamp' href='#419191'><time timestamp='2020-12-12T08:04:00Z'>08:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: we could patch out cctools to do the same
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760240' id='419192'>
<a class='timestamp' href='#419192'><time timestamp='2020-12-12T08:04:00Z'>08:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
*our
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760240' id='419193'>
<a class='timestamp' href='#419193'><time timestamp='2020-12-12T08:04:00Z'>08:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s a tiny change
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760240' id='419194'>
<a class='timestamp' href='#419194'><time timestamp='2020-12-12T08:04:00Z'>08:04</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I&#x27;m not optimistic that that&#x27;s a lasting solution
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760300' id='419195'>
<a class='timestamp' href='#419195'><time timestamp='2020-12-12T08:05:00Z'>08:05</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yeah, agree
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760360' id='419196'>
<a class='timestamp' href='#419196'><time timestamp='2020-12-12T08:06:00Z'>08:06</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but it&#x27;s simpler than trying to hack around the issue with multiple preallocate calls and passing the size through
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760420' id='419197'>
<a class='timestamp' href='#419197'><time timestamp='2020-12-12T08:07:00Z'>08:07</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
<a href="https://github.com/achow101/bitcoin/commit/26f8ebcca26eb74b6546b5d551f3ec468e2878be" class="link" target="_blank">https://github.com/achow101/bitcoin/commit/26f8ebcca26eb74b6546b5d551f3ec468e2878be</a> is my current proposal
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760420' id='419198'>
<a class='timestamp' href='#419198'><time timestamp='2020-12-12T08:07:00Z'>08:07</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
if we combine with pagesize 0, then it&#x27;ll probably always work
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760480' id='419199'>
<a class='timestamp' href='#419199'><time timestamp='2020-12-12T08:08:00Z'>08:08</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
the largest signature since 0.12.1 is 407424
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760600' id='419200'>
<a class='timestamp' href='#419200'><time timestamp='2020-12-12T08:10:00Z'>08:10</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: if the gitian preallocate takes it to a large <b>*odd*</b> multiple of 0x1000, will the macos sign tool not increase it further to a multiple of 0x2000 ?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760660' id='419201'>
<a class='timestamp' href='#419201'><time timestamp='2020-12-12T08:11:00Z'>08:11</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if it&#x27;s anything like the opensource version, it won&#x27;t
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760660' id='419202'>
<a class='timestamp' href='#419202'><time timestamp='2020-12-12T08:11:00Z'>08:11</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but who knows what it does
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760720' id='419203'>
<a class='timestamp' href='#419203'><time timestamp='2020-12-12T08:12:00Z'>08:12</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
oh!
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760720' id='419204'>
<a class='timestamp' href='#419204'><time timestamp='2020-12-12T08:12:00Z'>08:12</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
pagesize 0 result in a valid signatue (through gitian)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760720' id='419205'>
<a class='timestamp' href='#419205'><time timestamp='2020-12-12T08:12:00Z'>08:12</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I didn&#x27;t before because I signed an already signed binary
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760780' id='419206'>
<a class='timestamp' href='#419206'><time timestamp='2020-12-12T08:13:00Z'>08:13</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
<a href="https://bitcoin.jonasschnelli.ch/bitcoin-osx-signed_pagesize0_clean.dmg" class="link" target="_blank">https://bitcoin.jonasschnelli.ch/bitcoin-osx-signed_pagesize0_clean.dmg</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760780' id='419207'>
<a class='timestamp' href='#419207'><time timestamp='2020-12-12T08:13:00Z'>08:13</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
(used detach signature from <a href="https://bitcoin.jonasschnelli.ch/bitcoin-0.21.0rc3-osx-unsigned-again-pagesize0.zip" class="link" target="_blank">https://bitcoin.jonasschnelli.ch/bitcoin-0.21.0rc3-osx-unsigned-again-pagesize0.zip</a> )
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760780' id='419208'>
<a class='timestamp' href='#419208'><time timestamp='2020-12-12T08:13:00Z'>08:13</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I think that is currently the expected result
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760840' id='419209'>
<a class='timestamp' href='#419209'><time timestamp='2020-12-12T08:14:00Z'>08:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: yeah, matches our understanding
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760840' id='419210'>
<a class='timestamp' href='#419210'><time timestamp='2020-12-12T08:14:00Z'>08:14</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: it does not appear to shrink the vmsize at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760900' id='419211'>
<a class='timestamp' href='#419211'><time timestamp='2020-12-12T08:15:00Z'>08:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: yes, but it may increase it further
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760900' id='419212'>
<a class='timestamp' href='#419212'><time timestamp='2020-12-12T08:15:00Z'>08:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
(i don&#x27;t expect it to, but we should check i think)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607760900' id='419213'>
<a class='timestamp' href='#419213'><time timestamp='2020-12-12T08:15:00Z'>08:15</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
i&#x27;ll try against the macports cctools
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761140' id='419214'>
<a class='timestamp' href='#419214'><time timestamp='2020-12-12T08:19:00Z'>08:19</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it preserves it
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761200' id='419215'>
<a class='timestamp' href='#419215'><time timestamp='2020-12-12T08:20:00Z'>08:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
great
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761200' id='419216'>
<a class='timestamp' href='#419216'><time timestamp='2020-12-12T08:20:00Z'>08:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
500000 is probably overkill if we&#x27;re going to use pagesize 0
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761260' id='419217'>
<a class='timestamp' href='#419217'><time timestamp='2020-12-12T08:21:00Z'>08:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but that does like a pretty simple fix
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761260' id='419218'>
<a class='timestamp' href='#419218'><time timestamp='2020-12-12T08:21:00Z'>08:21</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
probably, but I also have no idea what goes into the signature size
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761320' id='419219'>
<a class='timestamp' href='#419219'><time timestamp='2020-12-12T08:22:00Z'>08:22</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
i&#x27;ll open a pr when i wake up
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761320' id='419220'>
<a class='timestamp' href='#419220'><time timestamp='2020-12-12T08:22:00Z'>08:22</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
thanks achow101!
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761320' id='419221'>
<a class='timestamp' href='#419221'><time timestamp='2020-12-12T08:22:00Z'>08:22</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
and sipa 
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761320' id='419222'>
<a class='timestamp' href='#419222'><time timestamp='2020-12-12T08:22:00Z'>08:22</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] MarcoFalke pushed 6 commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/6a4806367177...ffc4d0499020" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/6a4806367177...ffc4d0499020</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761320' id='419223'>
<a class='timestamp' href='#419223'><time timestamp='2020-12-12T08:22:00Z'>08:22</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 5aaeb6c Russell Yanofsky: MOVEONLY: Move IsBDBFile, IsSQLiteFile, and ListWalletDir
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761320' id='419224'>
<a class='timestamp' href='#419224'><time timestamp='2020-12-12T08:22:00Z'>08:22</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 6ee9cbd Russell Yanofsky: refactor: Replace ListWalletDir() function with ListDatabases()
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761320' id='419225'>
<a class='timestamp' href='#419225'><time timestamp='2020-12-12T08:22:00Z'>08:22</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 6a7a636 Russell Yanofsky: refactor: Drop call to GetWalletEnv in wallet salvage code
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761380' id='419226'>
<a class='timestamp' href='#419226'><time timestamp='2020-12-12T08:23:00Z'>08:23</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I knew that when I&#x27;m going to wake up that you guys will have a solution
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761380' id='419227'>
<a class='timestamp' href='#419227'><time timestamp='2020-12-12T08:23:00Z'>08:23</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
lol
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761380' id='419228'>
<a class='timestamp' href='#419228'><time timestamp='2020-12-12T08:23:00Z'>08:23</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] MarcoFalke merged pull request #20275: wallet: List all wallets in non-SQLite and non-BDB builds (master...pr/exist) <a href="https://github.com/bitcoin/bitcoin/pull/20275" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/20275</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761440' id='419229'>
<a class='timestamp' href='#419229'><time timestamp='2020-12-12T08:24:00Z'>08:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: number of pages, and &quot;resources&quot; are counted separately
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761440' id='419230'>
<a class='timestamp' href='#419230'><time timestamp='2020-12-12T08:24:00Z'>08:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
with pagesize=0 the executable code is always 1 page
<br>
</div>

<div class='talk op-msg' data-timestamp='1607761620' id='419231'>
<a class='timestamp' href='#419231'><time timestamp='2020-12-12T08:27:00Z'>08:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so i expect it to be mostly constant with pagesize=0
<br>
</div>

<div class='talk op-msg' data-timestamp='1607762040' id='419232'>
<a class='timestamp' href='#419232'><time timestamp='2020-12-12T08:34:00Z'>08:34</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I&#x27;m also getting an invalid signature for 0.20.2rc1
<br>
</div>

<div class='talk op-msg' data-timestamp='1607762040' id='419233'>
<a class='timestamp' href='#419233'><time timestamp='2020-12-12T08:34:00Z'>08:34</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
shall I codesign with --pagesize 0?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607762100' id='419234'>
<a class='timestamp' href='#419234'><time timestamp='2020-12-12T08:35:00Z'>08:35</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: that may work (50% chance)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607762160' id='419235'>
<a class='timestamp' href='#419235'><time timestamp='2020-12-12T08:36:00Z'>08:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: basically any pagesize you try (has to be zero or a power of 2) has an independent 50% chance of being succesful with the current tooling
<br>
</div>

<div class='talk op-msg' data-timestamp='1607762160' id='419236'>
<a class='timestamp' href='#419236'><time timestamp='2020-12-12T08:36:00Z'>08:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
with achow&#x27;s fix it should always work
<br>
</div>

<div class='talk op-msg' data-timestamp='1607762160' id='419237'>
<a class='timestamp' href='#419237'><time timestamp='2020-12-12T08:36:00Z'>08:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
better just wait; it can be backported too
<br>
</div>

<div class='talk op-msg' data-timestamp='1607762280' id='419238'>
<a class='timestamp' href='#419238'><time timestamp='2020-12-12T08:38:00Z'>08:38</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
ok
<br>
</div>

<div class='talk op-msg' data-timestamp='1607772900' id='419239'>
<a class='timestamp' href='#419239'><time timestamp='2020-12-12T11:35:00Z'>11:35</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] MarcoFalke pushed 3 commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/ffc4d0499020...b18978066d87" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/ffc4d0499020...b18978066d87</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607772900' id='419240'>
<a class='timestamp' href='#419240'><time timestamp='2020-12-12T11:35:00Z'>11:35</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master fad68af MarcoFalke: p2p: Ignore non-version msgs before version msg
<br>
</div>

<div class='talk op-msg' data-timestamp='1607772900' id='419241'>
<a class='timestamp' href='#419241'><time timestamp='2020-12-12T11:35:00Z'>11:35</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master faaad1b MarcoFalke: p2p: Ignore version msgs after initial version msg
<br>
</div>

<div class='talk op-msg' data-timestamp='1607772900' id='419242'>
<a class='timestamp' href='#419242'><time timestamp='2020-12-12T11:35:00Z'>11:35</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master b189780 MarcoFalke: Merge #20079: p2p: Treat handshake misbehavior like unknown message
<br>
</div>

<div class='talk op-msg' data-timestamp='1607772960' id='419243'>
<a class='timestamp' href='#419243'><time timestamp='2020-12-12T11:36:00Z'>11:36</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] MarcoFalke merged pull request #20079: p2p: Treat handshake misbehavior like unknown message (master...2010-p2pNoVersion) <a href="https://github.com/bitcoin/bitcoin/pull/20079" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/20079</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607789160' id='419244'>
<a class='timestamp' href='#419244'><time timestamp='2020-12-12T16:06:00Z'>16:06</time></a>
&lt;<span class='nick nick-16'> prusnak</span>&gt;
do you know if <a href="https://github.com/shesek" class="link" target="_blank">https://github.com/shesek</a> is on IRC?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607789160' id='419245'>
<a class='timestamp' href='#419245'><time timestamp='2020-12-12T16:06:00Z'>16:06</time></a>
&lt;<span class='nick nick-2'> belcher</span>&gt;
prusnak yes hes called shesek 
<br>
</div>

<div class='talk op-msg' data-timestamp='1607789160' id='419246'>
<a class='timestamp' href='#419246'><time timestamp='2020-12-12T16:06:00Z'>16:06</time></a>
&lt;<span class='nick nick-16'> prusnak</span>&gt;
shesek: no such nick
<br>
</div>

<div class='talk op-msg' data-timestamp='1607789220' id='419247'>
<a class='timestamp' href='#419247'><time timestamp='2020-12-12T16:07:00Z'>16:07</time></a>
&lt;<span class='nick nick-16'> prusnak</span>&gt;
thanks, i was asking because he&#x27;s offline most probably
<br>
</div>

<div class='talk op-msg' data-timestamp='1607790300' id='419248'>
<a class='timestamp' href='#419248'><time timestamp='2020-12-12T16:25:00Z'>16:25</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: I found the codesign source. It&#x27;s in a library called &quot;Security&quot;: <a href="https://opensource.apple.com/source/Security/Security-59306.140.5/OSX/libsecurity_codesigning/lib/" class="link" target="_blank">https://opensource.apple.com/source/Security/Security-59306.140.5/OSX/libsecurity_codesigning/lib/</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607790540' id='419249'>
<a class='timestamp' href='#419249'><time timestamp='2020-12-12T16:29:00Z'>16:29</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
Would it be worthwhile to write a tool that lets us code sign macOS from linux? Given that we can read the original code signing source, I don&#x27;t think it would be too difficult to write one.
<br>
</div>

<div class='talk op-msg' data-timestamp='1607792280' id='419250'>
<a class='timestamp' href='#419250'><time timestamp='2020-12-12T16:58:00Z'>16:58</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] achow101 opened pull request #20638: Mac codesign fixed alloc (master...mac-codesign-fixed-alloc) <a href="https://github.com/bitcoin/bitcoin/pull/20638" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/20638</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607794680' id='419251'>
<a class='timestamp' href='#419251'><time timestamp='2020-12-12T17:38:00Z'>17:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: maybe, depending on how hard it is to compile that for linux
<br>
</div>

<div class='talk op-msg' data-timestamp='1607795880' id='419252'>
<a class='timestamp' href='#419252'><time timestamp='2020-12-12T17:58:00Z'>17:58</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
achow101: nice!
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796060' id='419253'>
<a class='timestamp' href='#419253'><time timestamp='2020-12-12T18:01:00Z'>18:01</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: I don&#x27;t think we can compile it ourselves. It would have to be a completely separate implementation.
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796120' id='419254'>
<a class='timestamp' href='#419254'><time timestamp='2020-12-12T18:02:00Z'>18:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: that sounds nontrivial
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796120' id='419255'>
<a class='timestamp' href='#419255'><time timestamp='2020-12-12T18:02:00Z'>18:02</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
assuming, of course, it&#x27;s the same as the binary they ship
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796180' id='419256'>
<a class='timestamp' href='#419256'><time timestamp='2020-12-12T18:03:00Z'>18:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the benefit is that if someone actually makes that work, we may be able to replace it with multiparty RSA or s
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796180' id='419257'>
<a class='timestamp' href='#419257'><time timestamp='2020-12-12T18:03:00Z'>18:03</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it appears to be nontrivial. the code is a bit hard to understand
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796180' id='419258'>
<a class='timestamp' href='#419258'><time timestamp='2020-12-12T18:03:00Z'>18:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
o
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796240' id='419259'>
<a class='timestamp' href='#419259'><time timestamp='2020-12-12T18:04:00Z'>18:04</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I just wanted to make it use rfc6979
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796240' id='419260'>
<a class='timestamp' href='#419260'><time timestamp='2020-12-12T18:04:00Z'>18:04</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
if it&#x27;s RSA in the first place
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796240' id='419261'>
<a class='timestamp' href='#419261'><time timestamp='2020-12-12T18:04:00Z'>18:04</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
the cert is rsa
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796300' id='419262'>
<a class='timestamp' href='#419262'><time timestamp='2020-12-12T18:05:00Z'>18:05</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it&#x27;s amazing how hard it is to actually find the function that does the cryptographic signature
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796420' id='419263'>
<a class='timestamp' href='#419263'><time timestamp='2020-12-12T18:07:00Z'>18:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i assume the signature contais a certnl chain too
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796420' id='419264'>
<a class='timestamp' href='#419264'><time timestamp='2020-12-12T18:07:00Z'>18:07</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
you&#x27;d say if you&#x27;re going to do something like per-page signing you&#x27;d use an algorithm with short signatures :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796420' id='419265'>
<a class='timestamp' href='#419265'><time timestamp='2020-12-12T18:07:00Z'>18:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which may complicate thihgs
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796420' id='419266'>
<a class='timestamp' href='#419266'><time timestamp='2020-12-12T18:07:00Z'>18:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and the code for deciding exactly is being signed may be nontrivial too
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796420' id='419267'>
<a class='timestamp' href='#419267'><time timestamp='2020-12-12T18:07:00Z'>18:07</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
that explains why no one else made a portable signer i guess
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796480' id='419268'>
<a class='timestamp' href='#419268'><time timestamp='2020-12-12T18:08:00Z'>18:08</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I&#x27;m surprised no one has put in the effort to make one given that it&#x27;s actually open source
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796480' id='419269'>
<a class='timestamp' href='#419269'><time timestamp='2020-12-12T18:08:00Z'>18:08</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i wonder how many people even care about doing codesigning macos binaries on a non-macos platform
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796540' id='419270'>
<a class='timestamp' href='#419270'><time timestamp='2020-12-12T18:09:00Z'>18:09</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
true, not that many projects are doing deterministic builds
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796600' id='419271'>
<a class='timestamp' href='#419271'><time timestamp='2020-12-12T18:10:00Z'>18:10</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
though even for non-deterministic builds it can often be useful to do all builds on a single build host platform
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796720' id='419272'>
<a class='timestamp' href='#419272'><time timestamp='2020-12-12T18:12:00Z'>18:12</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
even with per-page signing, shouldn&#x27;t the signature be way larger than 200k?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796720' id='419273'>
<a class='timestamp' href='#419273'><time timestamp='2020-12-12T18:12:00Z'>18:12</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
given our binary size
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796780' id='419274'>
<a class='timestamp' href='#419274'><time timestamp='2020-12-12T18:13:00Z'>18:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
what is the actual binary size without resources?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796840' id='419275'>
<a class='timestamp' href='#419275'><time timestamp='2020-12-12T18:14:00Z'>18:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i think jonasschnelli&#x27;s tgz has a file that lists all the resources
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796900' id='419276'>
<a class='timestamp' href='#419276'><time timestamp='2020-12-12T18:15:00Z'>18:15</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
26891600 Dec 12 11:40 Bitcoin-Qt
<br>
</div>

<div class='talk op-msg' data-timestamp='1607796960' id='419277'>
<a class='timestamp' href='#419277'><time timestamp='2020-12-12T18:16:00Z'>18:16</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
do you know how many bits the RSA key is?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797020' id='419278'>
<a class='timestamp' href='#419278'><time timestamp='2020-12-12T18:17:00Z'>18:17</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
hmm. the cert is not in contrib/macdeploy.. I thought it was
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797020' id='419279'>
<a class='timestamp' href='#419279'><time timestamp='2020-12-12T18:17:00Z'>18:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: perhaps you can find in that apple source code what the default page size is
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797140' id='419280'>
<a class='timestamp' href='#419280'><time timestamp='2020-12-12T18:19:00Z'>18:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
perhaps the default page size is 32k or 64k
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797140' id='419281'>
<a class='timestamp' href='#419281'><time timestamp='2020-12-12T18:19:00Z'>18:19</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
turns out codesign has a lot of --verbose options
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797140' id='419282'>
<a class='timestamp' href='#419282'><time timestamp='2020-12-12T18:19:00Z'>18:19</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
the page size is 4096 in the rc3 sig
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797140' id='419283'>
<a class='timestamp' href='#419283'><time timestamp='2020-12-12T18:19:00Z'>18:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
hmm
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797200' id='419284'>
<a class='timestamp' href='#419284'><time timestamp='2020-12-12T18:20:00Z'>18:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that makes little sense
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797260' id='419285'>
<a class='timestamp' href='#419285'><time timestamp='2020-12-12T18:21:00Z'>18:21</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
here is the full verbose output of codesign -d: <a href="https://0bin.net/paste/2gi9BEF9#YOEGkrrhbpToojZbGKJhHvcYp5H1zV3MfO" class="link" target="_blank">https://0bin.net/paste/2gi9BEF9#YOEGkrrhbpToojZbGKJhHvcYp5H1zV3MfO</a>+skMBRotg
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797260' id='419286'>
<a class='timestamp' href='#419286'><time timestamp='2020-12-12T18:21:00Z'>18:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
well that&quot;s 35 bytes per sig
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797260' id='419287'>
<a class='timestamp' href='#419287'><time timestamp='2020-12-12T18:21:00Z'>18:21</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it looks like it&#x27;s actually just a ton of hashes and the signature is over all of them?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797260' id='419288'>
<a class='timestamp' href='#419288'><time timestamp='2020-12-12T18:21:00Z'>18:21</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it says Signature size=8973
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797260' id='419289'>
<a class='timestamp' href='#419289'><time timestamp='2020-12-12T18:21:00Z'>18:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ah!
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797260' id='419290'>
<a class='timestamp' href='#419290'><time timestamp='2020-12-12T18:21:00Z'>18:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s a merkle tree over the binary?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797260' id='419291'>
<a class='timestamp' href='#419291'><time timestamp='2020-12-12T18:21:00Z'>18:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that makes sens
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797320' id='419292'>
<a class='timestamp' href='#419292'><time timestamp='2020-12-12T18:22:00Z'>18:22</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
couldn&#x27;t say. but 6463 * 32 is in the ballpark of the signature size
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797380' id='419293'>
<a class='timestamp' href='#419293'><time timestamp='2020-12-12T18:23:00Z'>18:23</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
and there&#x27;s 6432 hashes. that also fits with the page size and binary size, 6432 * 4096 is near the binary size
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797380' id='419294'>
<a class='timestamp' href='#419294'><time timestamp='2020-12-12T18:23:00Z'>18:23</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
*6463 hashes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797440' id='419295'>
<a class='timestamp' href='#419295'><time timestamp='2020-12-12T18:24:00Z'>18:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yup
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797440' id='419296'>
<a class='timestamp' href='#419296'><time timestamp='2020-12-12T18:24:00Z'>18:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i suspect that&#x27;s it exactly
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797440' id='419297'>
<a class='timestamp' href='#419297'><time timestamp='2020-12-12T18:24:00Z'>18:24</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
making hashes of each page seems excessive though
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797500' id='419298'>
<a class='timestamp' href='#419298'><time timestamp='2020-12-12T18:25:00Z'>18:25</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it allows for fast per-page validation
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797500' id='419299'>
<a class='timestamp' href='#419299'><time timestamp='2020-12-12T18:25:00Z'>18:25</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
without needing to hash all the leaves every time
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797680' id='419300'>
<a class='timestamp' href='#419300'><time timestamp='2020-12-12T18:28:00Z'>18:28</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] jbampton opened pull request #20639: doc: fix case of GitHub (master...fix-case-of-github) <a href="https://github.com/bitcoin/bitcoin/pull/20639" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/20639</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797920' id='419301'>
<a class='timestamp' href='#419301'><time timestamp='2020-12-12T18:32:00Z'>18:32</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I don&#x27;t think it&#x27;s a merkle tree. I&#x27;m pretty sure it&#x27;s just a flat list of hashes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607797980' id='419302'>
<a class='timestamp' href='#419302'><time timestamp='2020-12-12T18:33:00Z'>18:33</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
that&#x27;s what gets hashes again and signed
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798100' id='419303'>
<a class='timestamp' href='#419303'><time timestamp='2020-12-12T18:35:00Z'>18:35</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
that makes sense
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798160' id='419304'>
<a class='timestamp' href='#419304'><time timestamp='2020-12-12T18:36:00Z'>18:36</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
a hash would be much more efficient to verify per page, after all, and the signature check can be done once at load time for the hashes section
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798220' id='419305'>
<a class='timestamp' href='#419305'><time timestamp='2020-12-12T18:37:00Z'>18:37</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
per page (or bunch-of-pages) makes sense as it decreases the granularity of loading, a hash over the entire binary means the entire binary has to be read 
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798280' id='419306'>
<a class='timestamp' href='#419306'><time timestamp='2020-12-12T18:38:00Z'>18:38</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
so our trick to do a single page may not be ideal
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798280' id='419307'>
<a class='timestamp' href='#419307'><time timestamp='2020-12-12T18:38:00Z'>18:38</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
well if it works as a workaround
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798280' id='419308'>
<a class='timestamp' href='#419308'><time timestamp='2020-12-12T18:38:00Z'>18:38</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
but not in the long term no i guess
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798340' id='419309'>
<a class='timestamp' href='#419309'><time timestamp='2020-12-12T18:39:00Z'>18:39</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
well we now know mostly how big the signature will be, so we could compute an overestimate instead
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798400' id='419310'>
<a class='timestamp' href='#419310'><time timestamp='2020-12-12T18:40:00Z'>18:40</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: why not? do we care about not loading all pages all at once?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798400' id='419311'>
<a class='timestamp' href='#419311'><time timestamp='2020-12-12T18:40:00Z'>18:40</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
if someone wants to reverse engineer this i&#x27;d prefer having a signature <b>*verifier*</b> first, so the gitian process can detect if it went wrong
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798400' id='419312'>
<a class='timestamp' href='#419312'><time timestamp='2020-12-12T18:40:00Z'>18:40</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
sipa: i guess so? there&#x27;s always a lot of data in a binary that&#x27;s not &#x27;hot&#x27;, might never be accessed at all, especially as we static link qt
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798460' id='419313'>
<a class='timestamp' href='#419313'><time timestamp='2020-12-12T18:41:00Z'>18:41</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
i dunno
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798460' id='419314'>
<a class='timestamp' href='#419314'><time timestamp='2020-12-12T18:41:00Z'>18:41</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it seems like there&#x27;s a default for a reason
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798460' id='419315'>
<a class='timestamp' href='#419315'><time timestamp='2020-12-12T18:41:00Z'>18:41</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
and it&#x27;s clearly architecture optimized
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798460' id='419316'>
<a class='timestamp' href='#419316'><time timestamp='2020-12-12T18:41:00Z'>18:41</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
that said, given the memory requiremetns i&#x27;m not sure we care about paging much
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798520' id='419317'>
<a class='timestamp' href='#419317'><time timestamp='2020-12-12T18:42:00Z'>18:42</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
verification of the signature itself should only happen once
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798520' id='419318'>
<a class='timestamp' href='#419318'><time timestamp='2020-12-12T18:42:00Z'>18:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
oh you think it&#x27;s re-verifying the pages every time they get loaded again from disk
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798520' id='419319'>
<a class='timestamp' href='#419319'><time timestamp='2020-12-12T18:42:00Z'>18:42</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes, but the hash might be done more often, say if a page is paged out and in again?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798520' id='419320'>
<a class='timestamp' href='#419320'><time timestamp='2020-12-12T18:42:00Z'>18:42</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I would guess this is some kind of runtime integrity check
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798520' id='419321'>
<a class='timestamp' href='#419321'><time timestamp='2020-12-12T18:42:00Z'>18:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that does make sense
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798520' id='419322'>
<a class='timestamp' href='#419322'><time timestamp='2020-12-12T18:42:00Z'>18:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but just the hash, not the full sig
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798580' id='419323'>
<a class='timestamp' href='#419323'><time timestamp='2020-12-12T18:43:00Z'>18:43</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
yeah
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798580' id='419324'>
<a class='timestamp' href='#419324'><time timestamp='2020-12-12T18:43:00Z'>18:43</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes, the sig verification for the hashes section is likely done only once
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798580' id='419325'>
<a class='timestamp' href='#419325'><time timestamp='2020-12-12T18:43:00Z'>18:43</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but that means that the list of hashes must be loaded at all times
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798580' id='419326'>
<a class='timestamp' href='#419326'><time timestamp='2020-12-12T18:43:00Z'>18:43</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798640' id='419327'>
<a class='timestamp' href='#419327'><time timestamp='2020-12-12T18:44:00Z'>18:44</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
so it&#x27;d be a compromise--too small page size and the list of hashes is huge, too big page size and it has very large paging granularity
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798760' id='419328'>
<a class='timestamp' href='#419328'><time timestamp='2020-12-12T18:46:00Z'>18:46</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
and i&#x27;m not sure--if it wouldn&#x27;t check every time a page is re-loaded from disk it might open up some kinds of exploits, espeically for network file systems if manipulation of the data can happen without the OS knowing
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798820' id='419329'>
<a class='timestamp' href='#419329'><time timestamp='2020-12-12T18:47:00Z'>18:47</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
but that&#x27;s not certain
<br>
</div>

<div class='talk op-msg' data-timestamp='1607798880' id='419330'>
<a class='timestamp' href='#419330'><time timestamp='2020-12-12T18:48:00Z'>18:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if it was a Merkle tree instead they wouldn&#x27;t need to keep the hash lish loaded, but it&#x27;d be twice the size
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799120' id='419331'>
<a class='timestamp' href='#419331'><time timestamp='2020-12-12T18:52:00Z'>18:52</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I think we can produce a good enough overestimate to allow for the default page size
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799180' id='419332'>
<a class='timestamp' href='#419332'><time timestamp='2020-12-12T18:53:00Z'>18:53</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
(((unsigned_size / 4096) + 1) * 32) + 50000
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799180' id='419333'>
<a class='timestamp' href='#419333'><time timestamp='2020-12-12T18:53:00Z'>18:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yup
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799180' id='419334'>
<a class='timestamp' href='#419334'><time timestamp='2020-12-12T18:53:00Z'>18:53</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
good!
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799180' id='419335'>
<a class='timestamp' href='#419335'><time timestamp='2020-12-12T18:53:00Z'>18:53</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
the sig is 9k, and there&#x27;s an additional 10k of overhead. with + 50k, we get 30k of extra
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799240' id='419336'>
<a class='timestamp' href='#419336'><time timestamp='2020-12-12T18:54:00Z'>18:54</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
i&#x27;ll update the pr
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799300' id='419337'>
<a class='timestamp' href='#419337'><time timestamp='2020-12-12T18:55:00Z'>18:55</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
it seems to be using <a href="https://en.wikipedia.org/wiki/Cryptographic_Message_Syntax" class="link" target="_blank">https://en.wikipedia.org/wiki/Cryptographic_Message_Syntax</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799360' id='419338'>
<a class='timestamp' href='#419338'><time timestamp='2020-12-12T18:56:00Z'>18:56</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
oh!
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799360' id='419339'>
<a class='timestamp' href='#419339'><time timestamp='2020-12-12T18:56:00Z'>18:56</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
so openssl can be used?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799540' id='419340'>
<a class='timestamp' href='#419340'><time timestamp='2020-12-12T18:59:00Z'>18:59</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
achow101, well to quote a comment &#x27;Sign a Mach-O binary, using liberal dollops of that special Mach-O magic sauce.&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799540' id='419341'>
<a class='timestamp' href='#419341'><time timestamp='2020-12-12T18:59:00Z'>18:59</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
so
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799540' id='419342'>
<a class='timestamp' href='#419342'><time timestamp='2020-12-12T18:59:00Z'>18:59</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
when I read that, I was not encouraged
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799540' id='419343'>
<a class='timestamp' href='#419343'><time timestamp='2020-12-12T18:59:00Z'>18:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
how to construct the Xcode extract for the 0.20 and 0.19 builds?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799600' id='419344'>
<a class='timestamp' href='#419344'><time timestamp='2020-12-12T19:00:00Z'>19:00</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: see contrib/macdeploy/README in the 0.20 branch
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799600' id='419345'>
<a class='timestamp' href='#419345'><time timestamp='2020-12-12T19:00:00Z'>19:00</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it explains how for both
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799600' id='419346'>
<a class='timestamp' href='#419346'><time timestamp='2020-12-12T19:00:00Z'>19:00</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
if the download is still available on the apple site, hopefully
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799660' id='419347'>
<a class='timestamp' href='#419347'><time timestamp='2020-12-12T19:01:00Z'>19:01</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
<a href="https://github.com/bitcoin-core/docs/blob/master/gitian-building/gitian-building-mac-os-sdk.md" class="link" target="_blank">https://github.com/bitcoin-core/docs/blob/master/gitian-building/gitian-building-mac-os-sdk.md</a> seems to refer to very old stuff
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799660' id='419348'>
<a class='timestamp' href='#419348'><time timestamp='2020-12-12T19:01:00Z'>19:01</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i guess it should be updated or deleted?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799660' id='419349'>
<a class='timestamp' href='#419349'><time timestamp='2020-12-12T19:01:00Z'>19:01</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
or changed into a link to the macdeploy stuff?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799660' id='419350'>
<a class='timestamp' href='#419350'><time timestamp='2020-12-12T19:01:00Z'>19:01</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I think it should link to macdeploy
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799720' id='419351'>
<a class='timestamp' href='#419351'><time timestamp='2020-12-12T19:02:00Z'>19:02</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yea the information on a branch should probably only describe for that branch
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799720' id='419352'>
<a class='timestamp' href='#419352'><time timestamp='2020-12-12T19:02:00Z'>19:02</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
for some reason the 0.19 branch doesn&#x27;t describe the extract process, but 0.20 does as &quot;the old way&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799780' id='419353'>
<a class='timestamp' href='#419353'><time timestamp='2020-12-12T19:03:00Z'>19:03</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
achow101, yeha i cant figure out where it&#x27;s actually signing either
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799780' id='419354'>
<a class='timestamp' href='#419354'><time timestamp='2020-12-12T19:03:00Z'>19:03</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
im sure if i could download that entire directory from git or as a tar ball i could
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799840' id='419355'>
<a class='timestamp' href='#419355'><time timestamp='2020-12-12T19:04:00Z'>19:04</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
but no
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799840' id='419356'>
<a class='timestamp' href='#419356'><time timestamp='2020-12-12T19:04:00Z'>19:04</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
classic apple
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799840' id='419357'>
<a class='timestamp' href='#419357'><time timestamp='2020-12-12T19:04:00Z'>19:04</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
phantomcircuit: mirror of it here <a href="https://github.com/apple-opensource/Security/" class="link" target="_blank">https://github.com/apple-opensource/Security/</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799900' id='419358'>
<a class='timestamp' href='#419358'><time timestamp='2020-12-12T19:05:00Z'>19:05</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
slightly older version, but close enough
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799960' id='419359'>
<a class='timestamp' href='#419359'><time timestamp='2020-12-12T19:06:00Z'>19:06</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I got to SecCodeSigner::Signer::signCodeDirectory in signer.cpp before I got super lost
<br>
</div>

<div class='talk op-msg' data-timestamp='1607799960' id='419360'>
<a class='timestamp' href='#419360'><time timestamp='2020-12-12T19:06:00Z'>19:06</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
achow101, yeah that&#x27;s definitely the right function
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800020' id='419361'>
<a class='timestamp' href='#419361'><time timestamp='2020-12-12T19:07:00Z'>19:07</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
i got to CMSEncoderAddSigners but can&#x27;t tell what it&#x27;s actually doing
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800020' id='419362'>
<a class='timestamp' href='#419362'><time timestamp='2020-12-12T19:07:00Z'>19:07</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
at least i think that&#x27;s a decent place to look
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800080' id='419363'>
<a class='timestamp' href='#419363'><time timestamp='2020-12-12T19:08:00Z'>19:08</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
also, if(hashDict != NULL) {assert(hashDict != NULL); they must not trust their compiler very much
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800080' id='419364'>
<a class='timestamp' href='#419364'><time timestamp='2020-12-12T19:08:00Z'>19:08</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
CMSEncoderCopyEncodedContent claims to do the actual signing, but I find no evidence that supports that. it just kinda goes into a while function stack that I can&#x27;t understand
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800080' id='419365'>
<a class='timestamp' href='#419365'><time timestamp='2020-12-12T19:08:00Z'>19:08</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
*wild
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800140' id='419366'>
<a class='timestamp' href='#419366'><time timestamp='2020-12-12T19:09:00Z'>19:09</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
CMSEncoderAddSigners just adds some kind of signer object to a list
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800260' id='419367'>
<a class='timestamp' href='#419367'><time timestamp='2020-12-12T19:11:00Z'>19:11</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
achow101, CMSEncoderUpdateContent
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800380' id='419368'>
<a class='timestamp' href='#419368'><time timestamp='2020-12-12T19:13:00Z'>19:13</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
wait this looks like it&#x27;s generating hashes and then encrypting them???
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800380' id='419369'>
<a class='timestamp' href='#419369'><time timestamp='2020-12-12T19:13:00Z'>19:13</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I think they use encrypt and sign interchangeably
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800440' id='419370'>
<a class='timestamp' href='#419370'><time timestamp='2020-12-12T19:14:00Z'>19:14</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
achow101, <a href="https://github.com/apple-opensource/Security/blob/3aaa9af09496be26b5c15ff011e3d65ca75821ac/libsecurity_smime/lib/cmsencode.c#L389" class="link" target="_blank">https://github.com/apple-opensource/Security/blob/3aaa9af09496be26b5c15ff011e3d65ca75821ac/libsecurity_smime/lib/cmsencode.c#L389</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800440' id='419371'>
<a class='timestamp' href='#419371'><time timestamp='2020-12-12T19:14:00Z'>19:14</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
iono kinda looks like it&#x27;s actually encrypting things
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800500' id='419372'>
<a class='timestamp' href='#419372'><time timestamp='2020-12-12T19:15:00Z'>19:15</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
of course there&#x27;s about 10 levels of indirection though so who can even tell
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800500' id='419373'>
<a class='timestamp' href='#419373'><time timestamp='2020-12-12T19:15:00Z'>19:15</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I think it&#x27;s just some more generic code that can also handle encryption?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800500' id='419374'>
<a class='timestamp' href='#419374'><time timestamp='2020-12-12T19:15:00Z'>19:15</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
honstly it&#x27;s hard to know
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800560' id='419375'>
<a class='timestamp' href='#419375'><time timestamp='2020-12-12T19:16:00Z'>19:16</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
for RSA encrypting and signing are kind-of interchangeable (but the devil is in the details)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607800800' id='419376'>
<a class='timestamp' href='#419376'><time timestamp='2020-12-12T19:20:00Z'>19:20</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, just gotta figure out where the ciphcx object is set.. which is uhhh
<br>
</div>

<div class='talk op-msg' data-timestamp='1607801340' id='419377'>
<a class='timestamp' href='#419377'><time timestamp='2020-12-12T19:29:00Z'>19:29</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ok, downloading xocde 10.2.1
<br>
</div>

<div class='talk op-msg' data-timestamp='1607801340' id='419378'>
<a class='timestamp' href='#419378'><time timestamp='2020-12-12T19:29:00Z'>19:29</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
*xcode
<br>
</div>

<div class='talk op-msg' data-timestamp='1607803440' id='419379'>
<a class='timestamp' href='#419379'><time timestamp='2020-12-12T20:04:00Z'>20:04</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
can you see what hash algorithm they use? if so it might be most straightforward to check if the hashes are encrypted or otherwise obfuscating by hashing pages and looking if they appear in the signature section of the file
<br>
</div>

<div class='talk op-msg' data-timestamp='1607803560' id='419380'>
<a class='timestamp' href='#419380'><time timestamp='2020-12-12T20:06:00Z'>20:06</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
pages are bound to have an address aligned to the start of the file, otherwise it&#x27;d be wildly inefficient
<br>
</div>

<div class='talk op-msg' data-timestamp='1607804100' id='419381'>
<a class='timestamp' href='#419381'><time timestamp='2020-12-12T20:15:00Z'>20:15</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
they use sha256, so it shouldn&#x27;t be hard to check
<br>
</div>

<div class='talk op-msg' data-timestamp='1607805720' id='419382'>
<a class='timestamp' href='#419382'><time timestamp='2020-12-12T20:42:00Z'>20:42</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
The hashes are definitely embedded
<br>
</div>

<div class='talk op-msg' data-timestamp='1607805780' id='419383'>
<a class='timestamp' href='#419383'><time timestamp='2020-12-12T20:43:00Z'>20:43</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
From the 2nd page to the end of the file, the hashes in the signed binary match the unsigned one
<br>
</div>

<div class='talk op-msg' data-timestamp='1607805780' id='419384'>
<a class='timestamp' href='#419384'><time timestamp='2020-12-12T20:43:00Z'>20:43</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
the 2nd page contains the alloc thing, so it&#x27;s different, but if the alloc is done, it matches
<br>
</div>

<div class='talk op-msg' data-timestamp='1607805780' id='419385'>
<a class='timestamp' href='#419385'><time timestamp='2020-12-12T20:43:00Z'>20:43</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
only the first page doesn&#x27;t match. and then there are 3 &quot;special&quot; hashes that are of... something else
<br>
</div>

<div class='talk op-msg' data-timestamp='1607805900' id='419386'>
<a class='timestamp' href='#419386'><time timestamp='2020-12-12T20:45:00Z'>20:45</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
achow101: oh that&#x27;s great!
<br>
</div>

<div class='talk op-msg' data-timestamp='1607805960' id='419387'>
<a class='timestamp' href='#419387'><time timestamp='2020-12-12T20:46:00Z'>20:46</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
actually the first page matches, it just doesn&#x27;t match the unsigned one
<br>
</div>

<div class='talk op-msg' data-timestamp='1607806020' id='419388'>
<a class='timestamp' href='#419388'><time timestamp='2020-12-12T20:47:00Z'>20:47</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
maybe it updates something in the header first
<br>
</div>

<div class='talk op-msg' data-timestamp='1607806200' id='419389'>
<a class='timestamp' href='#419389'><time timestamp='2020-12-12T20:50:00Z'>20:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
well, we know it does :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607806200' id='419390'>
<a class='timestamp' href='#419390'><time timestamp='2020-12-12T20:50:00Z'>20:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if it didn&#x27;t, this whole problem wouldn&#x27;t exist
<br>
</div>

<div class='talk op-msg' data-timestamp='1607806200' id='419391'>
<a class='timestamp' href='#419391'><time timestamp='2020-12-12T20:50:00Z'>20:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the vmsize/filesize entries on the __LINKEDIT section are changed
<br>
</div>

<div class='talk op-msg' data-timestamp='1607806200' id='419392'>
<a class='timestamp' href='#419392'><time timestamp='2020-12-12T20:50:00Z'>20:50</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yeah then it makes sense for the hash to match the new state, not the original one
<br>
</div>

<div class='talk op-msg' data-timestamp='1607806260' id='419393'>
<a class='timestamp' href='#419393'><time timestamp='2020-12-12T20:51:00Z'>20:51</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
right, true :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607806680' id='419394'>
<a class='timestamp' href='#419394'><time timestamp='2020-12-12T20:58:00Z'>20:58</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
yep, first 2 pages differ from unsigned because of the addition of the code signing section
<br>
</div>

<div class='talk op-msg' data-timestamp='1607806740' id='419395'>
<a class='timestamp' href='#419395'><time timestamp='2020-12-12T20:59:00Z'>20:59</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
so the hashes in the sig are 4096 byte pages from beginning of the signed binary to the beginning of the code signature
<br>
</div>

<div class='talk op-msg' data-timestamp='1607806740' id='419396'>
<a class='timestamp' href='#419396'><time timestamp='2020-12-12T20:59:00Z'>20:59</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
this is something we can verify ourselves
<br>
</div>

<div class='talk op-msg' data-timestamp='1607807280' id='419397'>
<a class='timestamp' href='#419397'><time timestamp='2020-12-12T21:08:00Z'>21:08</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ah, neat
<br>
</div>

<div class='talk op-msg' data-timestamp='1607807340' id='419398'>
<a class='timestamp' href='#419398'><time timestamp='2020-12-12T21:09:00Z'>21:09</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
i figured out 2 of the 3 special hashes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607807820' id='419399'>
<a class='timestamp' href='#419399'><time timestamp='2020-12-12T21:17:00Z'>21:17</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
that&#x27;s fast :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607807880' id='419400'>
<a class='timestamp' href='#419400'><time timestamp='2020-12-12T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
last one may be some metadata with the signature/hashing parameters?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607807880' id='419401'>
<a class='timestamp' href='#419401'><time timestamp='2020-12-12T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
looking at the source, I think it&#x27;s &quot;entitlements&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607807880' id='419402'>
<a class='timestamp' href='#419402'><time timestamp='2020-12-12T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
but I don&#x27;t know what that means
<br>
</div>

<div class='talk op-msg' data-timestamp='1607807940' id='419403'>
<a class='timestamp' href='#419403'><time timestamp='2020-12-12T21:19:00Z'>21:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the codesign tool has a way to provide something called entitlements to it
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808060' id='419404'>
<a class='timestamp' href='#419404'><time timestamp='2020-12-12T21:21:00Z'>21:21</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
one of the hashes is of the file Bitcoin-Qt.app/Contents/_CodeSignature/CodeResources, and the other is Bitcoin-Qt.app/Contents/Info.plist
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808120' id='419405'>
<a class='timestamp' href='#419405'><time timestamp='2020-12-12T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
but this last hash is not any of the files in the bundle
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808180' id='419406'>
<a class='timestamp' href='#419406'><time timestamp='2020-12-12T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
if we don&#x27;t pass &quot;entitlements&quot;, maybe it&#x27;s a hash of empty data?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808180' id='419407'>
<a class='timestamp' href='#419407'><time timestamp='2020-12-12T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I don&#x27;t think so
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808240' id='419408'>
<a class='timestamp' href='#419408'><time timestamp='2020-12-12T21:24:00Z'>21:24</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
The hash is Bitcoin-Qt.app/Contents
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808240' id='419409'>
<a class='timestamp' href='#419409'><time timestamp='2020-12-12T21:24:00Z'>21:24</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
1761bc7a0f37e9809acd22c53f42ff21622ea02093c14058e7daa3a466c95d97
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808540' id='419410'>
<a class='timestamp' href='#419410'><time timestamp='2020-12-12T21:29:00Z'>21:29</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
is this hash the same for other releases?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808540' id='419411'>
<a class='timestamp' href='#419411'><time timestamp='2020-12-12T21:29:00Z'>21:29</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if it&#x27;s just some constant we don&#x27;t actually care what it&#x27;s a hash of
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808840' id='419412'>
<a class='timestamp' href='#419412'><time timestamp='2020-12-12T21:34:00Z'>21:34</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
right a proto-verifyer could just compare it against the fixed hash and raise alarm if it doesn&#x27;t match
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808840' id='419413'>
<a class='timestamp' href='#419413'><time timestamp='2020-12-12T21:34:00Z'>21:34</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it&#x27;s the same in 0.20.1, 0.21.0rc2, and 0.21.0rc3
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808900' id='419414'>
<a class='timestamp' href='#419414'><time timestamp='2020-12-12T21:35:00Z'>21:35</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
afaik we don&#x27;t have any entitlements so it should just be the hash of an empty something
<br>
</div>

<div class='talk op-msg' data-timestamp='1607808900' id='419415'>
<a class='timestamp' href='#419415'><time timestamp='2020-12-12T21:35:00Z'>21:35</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
google is of no help
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809200' id='419416'>
<a class='timestamp' href='#419416'><time timestamp='2020-12-12T21:40:00Z'>21:40</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809200' id='419417'>
<a class='timestamp' href='#419417'><time timestamp='2020-12-12T21:40:00Z'>21:40</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
The specific entitlements will be embedded in the signature of an application. If you are having trouble, it can help to look at what the signature actually says about the entitlements: $ codesign -d --entitlements - Example.app will show an XML property list similar to the one above.
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809260' id='419418'>
<a class='timestamp' href='#419418'><time timestamp='2020-12-12T21:41:00Z'>21:41</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it gives nothing so there are no entitlements
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809260' id='419419'>
<a class='timestamp' href='#419419'><time timestamp='2020-12-12T21:41:00Z'>21:41</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
so it&#x27;s a hash of something that is in the signature itself, that sounds strange but...
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809260' id='419420'>
<a class='timestamp' href='#419420'><time timestamp='2020-12-12T21:41:00Z'>21:41</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
maybe it&#x27;s just &lt;xml&gt;&lt;/xml&gt; or something
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809260' id='419421'>
<a class='timestamp' href='#419421'><time timestamp='2020-12-12T21:41:00Z'>21:41</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
I&#x27;d expect so
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809320' id='419422'>
<a class='timestamp' href='#419422'><time timestamp='2020-12-12T21:42:00Z'>21:42</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
the source code has it as a datatype of CFDataRef which I think just means it&#x27;s a void *
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809320' id='419423'>
<a class='timestamp' href='#419423'><time timestamp='2020-12-12T21:42:00Z'>21:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
wumpus: sounds similar to bitcoin&#x27;s use of a sighash byte
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809320' id='419424'>
<a class='timestamp' href='#419424'><time timestamp='2020-12-12T21:42:00Z'>21:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
part of the signature itself, and also signed
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809380' id='419425'>
<a class='timestamp' href='#419425'><time timestamp='2020-12-12T21:43:00Z'>21:43</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
sipa: ah yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809980' id='419426'>
<a class='timestamp' href='#419426'><time timestamp='2020-12-12T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
is there such a thing as a generic DER decoder?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607809980' id='419427'>
<a class='timestamp' href='#419427'><time timestamp='2020-12-12T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810100' id='419428'>
<a class='timestamp' href='#419428'><time timestamp='2020-12-12T21:55:00Z'>21:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
<a href="https://github.com/pornin/DDer" class="link" target="_blank">https://github.com/pornin/DDer</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810100' id='419429'>
<a class='timestamp' href='#419429'><time timestamp='2020-12-12T21:55:00Z'>21:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ha, thomas pornin
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810100' id='419430'>
<a class='timestamp' href='#419430'><time timestamp='2020-12-12T21:55:00Z'>21:55</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i&#x27;ve met him
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810220' id='419431'>
<a class='timestamp' href='#419431'><time timestamp='2020-12-12T21:57:00Z'>21:57</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
hmm, openssl should be able to decode this if it was properly CMS DER, but it doesn&#x27;t like it
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810280' id='419432'>
<a class='timestamp' href='#419432'><time timestamp='2020-12-12T21:58:00Z'>21:58</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
it apparently DiskRep::component(cdEntitlementSlot) gets the data that is hashed to verify the entitlement slot, there are different implementations of DispRep though, but in diskrep this is the file &quot;CodeEntitlements&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810280' id='419433'>
<a class='timestamp' href='#419433'><time timestamp='2020-12-12T21:58:00Z'>21:58</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
filediskrep*
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810400' id='419434'>
<a class='timestamp' href='#419434'><time timestamp='2020-12-12T22:00:00Z'>22:00</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
in CodeDirectory::slotIsPresent a non-zero digest in the slot means that is is present
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810520' id='419435'>
<a class='timestamp' href='#419435'><time timestamp='2020-12-12T22:02:00Z'>22:02</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
i guess i should be looking at BundleDiskRep::component(cdEntitlementSlot) as it can fetch components from the executable itself
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810520' id='419436'>
<a class='timestamp' href='#419436'><time timestamp='2020-12-12T22:02:00Z'>22:02</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I found a bunch of ASN.1 templates, this means it should be possible to figure the serialization, right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810580' id='419437'>
<a class='timestamp' href='#419437'><time timestamp='2020-12-12T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
achow101: can you show me the DER data?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810580' id='419438'>
<a class='timestamp' href='#419438'><time timestamp='2020-12-12T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: in the bitcoin-detached-sigs repo osx/dist/Bitcoin-Qt.app/Contents/MacOS/Bitcoin-Qt.sign
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810580' id='419439'>
<a class='timestamp' href='#419439'><time timestamp='2020-12-12T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
that&#x27;s the code signature. in theory it&#x27;s DER
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810580' id='419440'>
<a class='timestamp' href='#419440'><time timestamp='2020-12-12T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
(checkout 0.21 branch)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810580' id='419441'>
<a class='timestamp' href='#419441'><time timestamp='2020-12-12T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you don&#x27;t actually need the schema to decode DER, it&#x27;s self-descriptive
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810640' id='419442'>
<a class='timestamp' href='#419442'><time timestamp='2020-12-12T22:04:00Z'>22:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the scheme just helps with naming stuff
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810640' id='419443'>
<a class='timestamp' href='#419443'><time timestamp='2020-12-12T22:04:00Z'>22:04</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I&#x27;m not convinced it&#x27;s actually DER
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810640' id='419444'>
<a class='timestamp' href='#419444'><time timestamp='2020-12-12T22:04:00Z'>22:04</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
<b>*i have no clue what i&#x27;m doing dog image*</b>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810700' id='419445'>
<a class='timestamp' href='#419445'><time timestamp='2020-12-12T22:05:00Z'>22:05</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
this looks interesting: <a href="https://chromium.googlesource.com/experimental/chromium/src/+/refs/wip/bajones/webvr/chrome/browser/safe_browsing/signature_evaluator_mac.mm" class="link" target="_blank">https://chromium.googlesource.com/experimental/chromium/src/+/refs/wip/bajones/webvr/chrome/browser/safe_browsing/signature_evaluator_mac.mm</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810760' id='419446'>
<a class='timestamp' href='#419446'><time timestamp='2020-12-12T22:06:00Z'>22:06</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s not
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810760' id='419447'>
<a class='timestamp' href='#419447'><time timestamp='2020-12-12T22:06:00Z'>22:06</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
ok
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810820' id='419448'>
<a class='timestamp' href='#419448'><time timestamp='2020-12-12T22:07:00Z'>22:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
$ file Bitcoin-Qt.sign
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810820' id='419449'>
<a class='timestamp' href='#419449'><time timestamp='2020-12-12T22:07:00Z'>22:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
Bitcoin-Qt.sign: Mac OS X Detached Code Signature (non-executable) - 216249 bytes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810820' id='419450'>
<a class='timestamp' href='#419450'><time timestamp='2020-12-12T22:07:00Z'>22:07</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
wait file recognizes this???
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810940' id='419451'>
<a class='timestamp' href='#419451'><time timestamp='2020-12-12T22:09:00Z'>22:09</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
hmm where does file keeps its magic definitions these days?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810940' id='419452'>
<a class='timestamp' href='#419452'><time timestamp='2020-12-12T22:09:00Z'>22:09</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i only find a precompiled magic.mgc file
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810940' id='419453'>
<a class='timestamp' href='#419453'><time timestamp='2020-12-12T22:09:00Z'>22:09</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I think that&#x27;s it
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810940' id='419454'>
<a class='timestamp' href='#419454'><time timestamp='2020-12-12T22:09:00Z'>22:09</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
gotta find the source for file
<br>
</div>

<div class='talk op-msg' data-timestamp='1607810940' id='419455'>
<a class='timestamp' href='#419455'><time timestamp='2020-12-12T22:09:00Z'>22:09</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
from MachORep::compoenent to EmbeddedSignatureBlob::component now
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811000' id='419456'>
<a class='timestamp' href='#419456'><time timestamp='2020-12-12T22:10:00Z'>22:10</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
<a href="https://github.com/file/file/blob/master/magic/Magdir/apple" class="link" target="_blank">https://github.com/file/file/blob/master/magic/Magdir/apple</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811060' id='419457'>
<a class='timestamp' href='#419457'><time timestamp='2020-12-12T22:11:00Z'>22:11</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
&quot;An EmbeddedSignatureBlob is a SuperBlob indexed by component slot number.&quot; of coursee
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811060' id='419458'>
<a class='timestamp' href='#419458'><time timestamp='2020-12-12T22:11:00Z'>22:11</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
class EmbeddedSignatureBlob : public SuperBlobCore&lt;EmbeddedSignatureBlob, 0xfade0cc0, uint32_t&gt;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811180' id='419459'>
<a class='timestamp' href='#419459'><time timestamp='2020-12-12T22:13:00Z'>22:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
_0x0ff: belong0xfade0cc1Mac OS X Detached Code Signature
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811180' id='419460'>
<a class='timestamp' href='#419460'><time timestamp='2020-12-12T22:13:00Z'>22:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
0 belong 0xfade0cc1 Mac OS X Detached Code Signature
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811240' id='419461'>
<a class='timestamp' href='#419461'><time timestamp='2020-12-12T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
typedef SuperBlob&lt;0xfade0cc1&gt; DetachedSignatureBlob;  // indexed by main architecture
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811240' id='419462'>
<a class='timestamp' href='#419462'><time timestamp='2020-12-12T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
superblobs, all of them
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811300' id='419463'>
<a class='timestamp' href='#419463'><time timestamp='2020-12-12T22:15:00Z'>22:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
turtles all the way down
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811300' id='419464'>
<a class='timestamp' href='#419464'><time timestamp='2020-12-12T22:15:00Z'>22:15</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
hehe
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811300' id='419465'>
<a class='timestamp' href='#419465'><time timestamp='2020-12-12T22:15:00Z'>22:15</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
blobloblob
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811420' id='419466'>
<a class='timestamp' href='#419466'><time timestamp='2020-12-12T22:17:00Z'>22:17</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
/ as a genuine Blob (e.g. for insertion into a SuperBlob).
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811480' id='419467'>
<a class='timestamp' href='#419467'><time timestamp='2020-12-12T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
a superblob is a map of integers to blobs
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811480' id='419468'>
<a class='timestamp' href='#419468'><time timestamp='2020-12-12T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
getting deeper
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811540' id='419469'>
<a class='timestamp' href='#419469'><time timestamp='2020-12-12T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
&quot;// echoes from parent BlobCore (the C++ type system is too restrictive here)&quot; uh
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811660' id='419470'>
<a class='timestamp' href='#419470'><time timestamp='2020-12-12T22:21:00Z'>22:21</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
tbh seems like it&#x27;s actually all fairly straightforward C++ code
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811720' id='419471'>
<a class='timestamp' href='#419471'><time timestamp='2020-12-12T22:22:00Z'>22:22</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
the comments are way scarier than the code itself
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811840' id='419472'>
<a class='timestamp' href='#419472'><time timestamp='2020-12-12T22:24:00Z'>22:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
wumpus: you&#x27;re biased
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811840' id='419473'>
<a class='timestamp' href='#419473'><time timestamp='2020-12-12T22:24:00Z'>22:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
:)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811900' id='419474'>
<a class='timestamp' href='#419474'><time timestamp='2020-12-12T22:25:00Z'>22:25</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
i... suppose hehe
<br>
</div>

<div class='talk op-msg' data-timestamp='1607811960' id='419475'>
<a class='timestamp' href='#419475'><time timestamp='2020-12-12T22:26:00Z'>22:26</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
i&#x27;ve somehow wandered into some code in this libsecurity that&#x27;s Copyright Mozilla
<br>
</div>

<div class='talk op-msg' data-timestamp='1607813640' id='419476'>
<a class='timestamp' href='#419476'><time timestamp='2020-12-12T22:54:00Z'>22:54</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so do we know how to extract the blobs from the EmbeddedSignatureBlob ?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814000' id='419477'>
<a class='timestamp' href='#419477'><time timestamp='2020-12-12T23:00:00Z'>23:00</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
nope?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814240' id='419478'>
<a class='timestamp' href='#419478'><time timestamp='2020-12-12T23:04:00Z'>23:04</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
That unknown hash earlier is apparently &quot;internal requirements&quot;, not entitlements
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814660' id='419479'>
<a class='timestamp' href='#419479'><time timestamp='2020-12-12T23:11:00Z'>23:11</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
kind of, it&#x27;s u32 magic (BE), u32 (BE) size, then u32 (LE) number of blobs, then per blob u32 (LE) blob type, u32 LE offset
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814660' id='419480'>
<a class='timestamp' href='#419480'><time timestamp='2020-12-12T23:11:00Z'>23:11</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
then the data
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814720' id='419481'>
<a class='timestamp' href='#419481'><time timestamp='2020-12-12T23:12:00Z'>23:12</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
blob type is the slot id, so 5 for the cdEntitlementSlot, but apprantly we&#x27;re no longer looking for that
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814780' id='419482'>
<a class='timestamp' href='#419482'><time timestamp='2020-12-12T23:13:00Z'>23:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ok so 3 blobs 
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814840' id='419483'>
<a class='timestamp' href='#419483'><time timestamp='2020-12-12T23:14:00Z'>23:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
first blob is type 0, length 0x24
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814840' id='419484'>
<a class='timestamp' href='#419484'><time timestamp='2020-12-12T23:14:00Z'>23:14</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
which is good as it doesn&#x27;t have that one
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814840' id='419485'>
<a class='timestamp' href='#419485'><time timestamp='2020-12-12T23:14:00Z'>23:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ah no, not length; offset
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814900' id='419486'>
<a class='timestamp' href='#419486'><time timestamp='2020-12-12T23:15:00Z'>23:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the individual blobs don&#x27;t have a length?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814900' id='419487'>
<a class='timestamp' href='#419487'><time timestamp='2020-12-12T23:15:00Z'>23:15</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
sipa: that seems correct?
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814900' id='419488'>
<a class='timestamp' href='#419488'><time timestamp='2020-12-12T23:15:00Z'>23:15</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes, offset
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814900' id='419489'>
<a class='timestamp' href='#419489'><time timestamp='2020-12-12T23:15:00Z'>23:15</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
the length is in the blob itself
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814900' id='419490'>
<a class='timestamp' href='#419490'><time timestamp='2020-12-12T23:15:00Z'>23:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the first blob has magic fa de 0c 02
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814900' id='419491'>
<a class='timestamp' href='#419491'><time timestamp='2020-12-12T23:15:00Z'>23:15</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
blobs are all &lt;magic&gt; &lt;length&gt;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814900' id='419492'>
<a class='timestamp' href='#419492'><time timestamp='2020-12-12T23:15:00Z'>23:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
got it
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814960' id='419493'>
<a class='timestamp' href='#419493'><time timestamp='2020-12-12T23:16:00Z'>23:16</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
list of magics in OSX/libsecurity_codesigning/lib/CSCommonPriv.h
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814960' id='419494'>
<a class='timestamp' href='#419494'><time timestamp='2020-12-12T23:16:00Z'>23:16</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
Mac OS X Code Directory is the first one
<br>
</div>

<div class='talk op-msg' data-timestamp='1607814960' id='419495'>
<a class='timestamp' href='#419495'><time timestamp='2020-12-12T23:16:00Z'>23:16</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
so yes we have 0 at offset 0x24, 2 at offset 0x2f7a4 and 0x100 at offset 0x2f864
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815020' id='419496'>
<a class='timestamp' href='#419496'><time timestamp='2020-12-12T23:17:00Z'>23:17</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
sipa: yes. this contains our list of hashes
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815020' id='419497'>
<a class='timestamp' href='#419497'><time timestamp='2020-12-12T23:17:00Z'>23:17</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
(all integers are BE, it seemed from the code that they&#x27;d be LE but apparently they&#x27;re swapped somewhere)
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815080' id='419498'>
<a class='timestamp' href='#419498'><time timestamp='2020-12-12T23:18:00Z'>23:18</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it looks like the structure is the class members
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815080' id='419499'>
<a class='timestamp' href='#419499'><time timestamp='2020-12-12T23:18:00Z'>23:18</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
in order as listed
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815080' id='419500'>
<a class='timestamp' href='#419500'><time timestamp='2020-12-12T23:18:00Z'>23:18</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
second one has magic fa de 0c 01, Mac OS X Code Requirement Set
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815080' id='419501'>
<a class='timestamp' href='#419501'><time timestamp='2020-12-12T23:18:00Z'>23:18</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
there&#x27;s your requirement set to hash i guess
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815080' id='419502'>
<a class='timestamp' href='#419502'><time timestamp='2020-12-12T23:18:00Z'>23:18</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
last blob has magic fa de 0b 01
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815140' id='419503'>
<a class='timestamp' href='#419503'><time timestamp='2020-12-12T23:19:00Z'>23:19</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
class BlobWrapper : public Blob&lt;BlobWrapper, 0xfade0b01&gt; 
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815200' id='419504'>
<a class='timestamp' href='#419504'><time timestamp='2020-12-12T23:20:00Z'>23:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the first blob has magic fa de 0c 02
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815200' id='419505'>
<a class='timestamp' href='#419505'><time timestamp='2020-12-12T23:20:00Z'>23:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
<a href="https://gist.github.com/nmoinvaz/cd8651ffb3659161423534b29824510a" class="link" target="_blank">https://gist.github.com/nmoinvaz/cd8651ffb3659161423534b29824510a</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815200' id='419506'>
<a class='timestamp' href='#419506'><time timestamp='2020-12-12T23:20:00Z'>23:20</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
oh nice
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815260' id='419507'>
<a class='timestamp' href='#419507'><time timestamp='2020-12-12T23:21:00Z'>23:21</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
hmm, it can&#x27;t be the structure as listed because I run into some strings before I&#x27;m supposed to
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815260' id='419508'>
<a class='timestamp' href='#419508'><time timestamp='2020-12-12T23:21:00Z'>23:21</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
but it&#x27;s pretty close
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815260' id='419509'>
<a class='timestamp' href='#419509'><time timestamp='2020-12-12T23:21:00Z'>23:21</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
euhh the third&#x27;s slot id is 0x10000 which is cdSignatureSlot = 0x10000,|     |       |       // CMS signature
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815320' id='419510'>
<a class='timestamp' href='#419510'><time timestamp='2020-12-12T23:22:00Z'>23:22</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
that might be DER encoded
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815320' id='419511'>
<a class='timestamp' href='#419511'><time timestamp='2020-12-12T23:22:00Z'>23:22</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
which is wrapped in a BlobWrapper which is simply a blob header with arbitrary binary dat
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815320' id='419512'>
<a class='timestamp' href='#419512'><time timestamp='2020-12-12T23:22:00Z'>23:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
this has so many layers, i&#x27;d be surprised if it isn&#x27;t somehow exploitable...
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815440' id='419513'>
<a class='timestamp' href='#419513'><time timestamp='2020-12-12T23:24:00Z'>23:24</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
In class CodeDirectory, everything in the class decodes in order up to spare3
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815500' id='419514'>
<a class='timestamp' href='#419514'><time timestamp='2020-12-12T23:25:00Z'>23:25</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
then we get to the offset for identifier string and the identifer string begins there, as expected
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815500' id='419515'>
<a class='timestamp' href='#419515'><time timestamp='2020-12-12T23:25:00Z'>23:25</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
otoh the blob format is super simple, there could be a mistake of course, but yes e.g. DER parsers are notoriously exploitable
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815800' id='419516'>
<a class='timestamp' href='#419516'><time timestamp='2020-12-12T23:30:00Z'>23:30</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
the CMS signature is produced in SecCodeSigner::Signer::signCodeDirectory in signer.cpp
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815800' id='419517'>
<a class='timestamp' href='#419517'><time timestamp='2020-12-12T23:30:00Z'>23:30</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
it seems like the message that is signed is the CodeDirectory blob
<br>
</div>

<div class='talk op-msg' data-timestamp='1607815860' id='419518'>
<a class='timestamp' href='#419518'><time timestamp='2020-12-12T23:31:00Z'>23:31</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
that&#x27;s what the comment says too &quot;Generate the CMS signature for a (finished) CodeDirectory.&quot;, in addition it takes a hashDict and hashList
<br>
</div>

<div class='talk op-msg' data-timestamp='1607816280' id='419519'>
<a class='timestamp' href='#419519'><time timestamp='2020-12-12T23:38:00Z'>23:38</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
where hashDict is apparently &quot;v2&quot; and hashList for &quot;v1&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1607816400' id='419520'>
<a class='timestamp' href='#419520'><time timestamp='2020-12-12T23:40:00Z'>23:40</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
the encoding is indeed the Cryptographic Message Syntax what phantomcircuit linked to with apple specific tags
<br>
</div>

<div class='talk op-msg' data-timestamp='1607816940' id='419521'>
<a class='timestamp' href='#419521'><time timestamp='2020-12-12T23:49:00Z'>23:49</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
&lt;sipa&gt; this has so many layers, i&#x27;d be surprised if it isn&#x27;t somehow exploitable...
<br>
</div>

<div class='talk op-msg' data-timestamp='1607816940' id='419522'>
<a class='timestamp' href='#419522'><time timestamp='2020-12-12T23:49:00Z'>23:49</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
indeed
<br>
</div>

<div class='talk op-msg' data-timestamp='1607817180' id='419523'>
<a class='timestamp' href='#419523'><time timestamp='2020-12-12T23:53:00Z'>23:53</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
wumpus: that Requirement Set blob is indeed the unknown hash.
<br>
</div>

</div>
</section>

</body>
</html>
