<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2018-03-10
 — 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2018-03-10' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:22 UTC</pre>
<pre><a href="/bitcoin-core-dev/2018-02-10">&lt;</a><span class='header'>    March 2018    </span><a href="/bitcoin-core-dev/2018-04-10">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;             <a class="" href="/bitcoin-core-dev/2018-03-01">1</a>  <a class="" href="/bitcoin-core-dev/2018-03-02">2</a>  <a class="" href="/bitcoin-core-dev/2018-03-03">3</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2018-03-04">4</a>  <a class="" href="/bitcoin-core-dev/2018-03-05">5</a>  <a class="" href="/bitcoin-core-dev/2018-03-06">6</a>  <a class="" href="/bitcoin-core-dev/2018-03-07">7</a>  <a class="" href="/bitcoin-core-dev/2018-03-08">8</a>  <a class="" href="/bitcoin-core-dev/2018-03-09">9</a> <a class="current" href="/bitcoin-core-dev/2018-03-10">10</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-03-11">11</a> <a class="" href="/bitcoin-core-dev/2018-03-12">12</a> <a class="" href="/bitcoin-core-dev/2018-03-13">13</a> <a class="" href="/bitcoin-core-dev/2018-03-14">14</a> <a class="" href="/bitcoin-core-dev/2018-03-15">15</a> <a class="" href="/bitcoin-core-dev/2018-03-16">16</a> <a class="" href="/bitcoin-core-dev/2018-03-17">17</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-03-18">18</a> <a class="" href="/bitcoin-core-dev/2018-03-19">19</a> <a class="" href="/bitcoin-core-dev/2018-03-20">20</a> <a class="" href="/bitcoin-core-dev/2018-03-21">21</a> <a class="" href="/bitcoin-core-dev/2018-03-22">22</a> <a class="" href="/bitcoin-core-dev/2018-03-23">23</a> <a class="" href="/bitcoin-core-dev/2018-03-24">24</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-03-25">25</a> <a class="" href="/bitcoin-core-dev/2018-03-26">26</a> <a class="" href="/bitcoin-core-dev/2018-03-27">27</a> <a class="" href="/bitcoin-core-dev/2018-03-28">28</a> <a class="" href="/bitcoin-core-dev/2018-03-29">29</a> <a class="" href="/bitcoin-core-dev/2018-03-30">30</a> <a class="" href="/bitcoin-core-dev/2018-03-31">31</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1520644020' id='603069'>
<a class='timestamp' href='#603069'><time timestamp='2018-03-10T01:07:00Z'>01:07</time></a>
&lt;<span class='nick nick-6'> karelb</span>&gt;
I am porting the autogenerated doc into bitcoincore.org website so I can make a PR and it looks fine :) 
<br>
</div>

<div class='talk op-msg' data-timestamp='1520644020' id='603070'>
<a class='timestamp' href='#603070'><time timestamp='2018-03-10T01:07:00Z'>01:07</time></a>
&lt;<span class='nick nick-6'> karelb</span>&gt;
<a href="https://i.imgur.com/Qu42lTZ.png" class="link" target="_blank">https://i.imgur.com/Qu42lTZ.png</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520644080' id='603071'>
<a class='timestamp' href='#603071'><time timestamp='2018-03-10T01:08:00Z'>01:08</time></a>
&lt;<span class='nick nick-6'> karelb</span>&gt;
well at least on my notebook
<br>
</div>

<div class='talk op-msg' data-timestamp='1520644080' id='603072'>
<a class='timestamp' href='#603072'><time timestamp='2018-03-10T01:08:00Z'>01:08</time></a>
&lt;<span class='nick nick-6'> karelb</span>&gt;
I hijacked the GUI you have for article TOC for also adding a menu
<br>
</div>

<div class='talk op-msg' data-timestamp='1520644140' id='603073'>
<a class='timestamp' href='#603073'><time timestamp='2018-03-10T01:09:00Z'>01:09</time></a>
&lt;<span class='nick nick-6'> karelb</span>&gt;
(that is where I found <a href="https://github.com/bitcoin-core/bitcoincore.org/issues/525" class="link" target="_blank">https://github.com/bitcoin-core/bitcoincore.org/issues/525</a> )
<br>
</div>

<div class='talk op-msg' data-timestamp='1520644380' id='603074'>
<a class='timestamp' href='#603074'><time timestamp='2018-03-10T01:13:00Z'>01:13</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
I wonder if the Doxygen stuff would be useful to publish
<br>
</div>

<div class='talk op-msg' data-timestamp='1520644860' id='603075'>
<a class='timestamp' href='#603075'><time timestamp='2018-03-10T01:21:00Z'>01:21</time></a>
&lt;<span class='nick nick-6'> karelb</span>&gt;
There is something here
<br>
</div>

<div class='talk op-msg' data-timestamp='1520644860' id='603076'>
<a class='timestamp' href='#603076'><time timestamp='2018-03-10T01:21:00Z'>01:21</time></a>
&lt;<span class='nick nick-6'> karelb</span>&gt;
<a href="https://dev.visucore.com/bitcoin/doxygen/struct_c_coin.html" class="link" target="_blank">https://dev.visucore.com/bitcoin/doxygen/struct_c_coin.html</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520644920' id='603077'>
<a class='timestamp' href='#603077'><time timestamp='2018-03-10T01:22:00Z'>01:22</time></a>
&lt;<span class='nick nick-6'> karelb</span>&gt;
and I don&#x27;t think it&#x27;s more useful than just looking at the source, to be frank
<br>
</div>

<div class='talk op-msg' data-timestamp='1520645520' id='603078'>
<a class='timestamp' href='#603078'><time timestamp='2018-03-10T01:32:00Z'>01:32</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] sipa opened pull request #12658: Sanitize some wallet serialize (master...201803_crazywalletser) <a href="https://github.com/bitcoin/bitcoin/pull/12658" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/12658</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520649600' id='603079'>
<a class='timestamp' href='#603079'><time timestamp='2018-03-10T02:40:00Z'>02:40</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] eklitzke closed pull request #12491: Try to use posix_fadvise with CBufferedFile (master...fadvise) <a href="https://github.com/bitcoin/bitcoin/pull/12491" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/12491</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520654040' id='603080'>
<a class='timestamp' href='#603080'><time timestamp='2018-03-10T03:54:00Z'>03:54</time></a>
&lt;<span class='nick nick-11'> pierre_rochard</span>&gt;
karelb: I’ve found the doxygen call/caller graphs to be useful, but otherwise agree that source is more useful
<br>
</div>

<div class='talk op-msg' data-timestamp='1520664840' id='603081'>
<a class='timestamp' href='#603081'><time timestamp='2018-03-10T06:54:00Z'>06:54</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] eklitzke opened pull request #12659: Improve Fatal LevelDB Log Messages (master...leveldb_errmsg) <a href="https://github.com/bitcoin/bitcoin/pull/12659" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/12659</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520664900' id='603082'>
<a class='timestamp' href='#603082'><time timestamp='2018-03-10T06:55:00Z'>06:55</time></a>
&lt;<span class='nick nick-4'> armid</span>&gt;
what plugin in the code make spacing in variable declaration ?
<br>
</div>

<div class='talk op-msg' data-timestamp='1520664900' id='603083'>
<a class='timestamp' href='#603083'><time timestamp='2018-03-10T06:55:00Z'>06:55</time></a>
&lt;<span class='nick nick-4'> armid</span>&gt;
such that
<br>
</div>

<div class='talk op-msg' data-timestamp='1520664900' id='603084'>
<a class='timestamp' href='#603084'><time timestamp='2018-03-10T06:55:00Z'>06:55</time></a>
&lt;<span class='nick nick-4'> armid</span>&gt;
 SELECTCOINS = (1 &lt;&lt; 10),
<br>
</div>

<div class='talk op-msg' data-timestamp='1520664900' id='603085'>
<a class='timestamp' href='#603085'><time timestamp='2018-03-10T06:55:00Z'>06:55</time></a>
&lt;<span class='nick nick-4'> armid</span>&gt;
QT          = (1 &lt;&lt; 19),
<br>
</div>

<div class='talk op-msg' data-timestamp='1520665020' id='603086'>
<a class='timestamp' href='#603086'><time timestamp='2018-03-10T06:57:00Z'>06:57</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
what?
<br>
</div>

<div class='talk op-msg' data-timestamp='1520665020' id='603087'>
<a class='timestamp' href='#603087'><time timestamp='2018-03-10T06:57:00Z'>06:57</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
bitcoin core doesn&#x27;t have plugins
<br>
</div>

<div class='talk op-msg' data-timestamp='1520665080' id='603088'>
<a class='timestamp' href='#603088'><time timestamp='2018-03-10T06:58:00Z'>06:58</time></a>
&lt;<span class='nick nick-4'> armid</span>&gt;
i mean IDE plugin
<br>
</div>

<div class='talk op-msg' data-timestamp='1520665080' id='603089'>
<a class='timestamp' href='#603089'><time timestamp='2018-03-10T06:58:00Z'>06:58</time></a>
&lt;<span class='nick nick-4'> armid</span>&gt;
or something
<br>
</div>

<div class='talk op-msg' data-timestamp='1520665140' id='603090'>
<a class='timestamp' href='#603090'><time timestamp='2018-03-10T06:59:00Z'>06:59</time></a>
&lt;<span class='nick nick-4'> armid</span>&gt;
vscode-plugin ? 
<br>
</div>

<div class='talk op-msg' data-timestamp='1520665140' id='603091'>
<a class='timestamp' href='#603091'><time timestamp='2018-03-10T06:59:00Z'>06:59</time></a>
&lt;<span class='nick nick-4'> armid</span>&gt;
that can format code
<br>
</div>

<div class='talk op-msg' data-timestamp='1520665140' id='603092'>
<a class='timestamp' href='#603092'><time timestamp='2018-03-10T06:59:00Z'>06:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you can use whatever you want
<br>
</div>

<div class='talk op-msg' data-timestamp='1520665140' id='603093'>
<a class='timestamp' href='#603093'><time timestamp='2018-03-10T06:59:00Z'>06:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i think most develooers just use text editors
<br>
</div>

<div class='talk op-msg' data-timestamp='1520665200' id='603094'>
<a class='timestamp' href='#603094'><time timestamp='2018-03-10T07:00:00Z'>07:00</time></a>
&lt;<span class='nick nick-4'> armid</span>&gt;
^^     
<br>
</div>

<div class='talk op-msg' data-timestamp='1520666160' id='603095'>
<a class='timestamp' href='#603095'><time timestamp='2018-03-10T07:16:00Z'>07:16</time></a>
&lt;<span class='nick nick-14'> mrannanay</span>&gt;
ryanofsky: Thanks! 
<br>
</div>

<div class='talk op-msg' data-timestamp='1520698500' id='603096'>
<a class='timestamp' href='#603096'><time timestamp='2018-03-10T16:15:00Z'>16:15</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/29fad97c320c...bb98aec6743e" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/29fad97c320c...bb98aec6743e</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520698500' id='603097'>
<a class='timestamp' href='#603097'><time timestamp='2018-03-10T16:15:00Z'>16:15</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master a7324bd practicalswift: Format timestamps using ISO 8601 formatting (e.g. &quot;2018-02-28T12:34:56Z&quot;)...
<br>
</div>

<div class='talk op-msg' data-timestamp='1520698500' id='603098'>
<a class='timestamp' href='#603098'><time timestamp='2018-03-10T16:15:00Z'>16:15</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master bb98aec Wladimir J. van der Laan: Merge #12567: util: Print timestamp strings in logs using ISO 8601 formatting...
<br>
</div>

<div class='talk op-msg' data-timestamp='1520698560' id='603099'>
<a class='timestamp' href='#603099'><time timestamp='2018-03-10T16:16:00Z'>16:16</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj closed pull request #12567: util: Print timestamp strings in logs using ISO 8601 formatting (master...iso-8601) <a href="https://github.com/bitcoin/bitcoin/pull/12567" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/12567</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520701560' id='603100'>
<a class='timestamp' href='#603100'><time timestamp='2018-03-10T17:06:00Z'>17:06</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] eklitzke opened pull request #12664: Rename LevelDB background compaction thread (master...bgcompact) <a href="https://github.com/bitcoin/bitcoin/pull/12664" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/12664</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520702220' id='603101'>
<a class='timestamp' href='#603101'><time timestamp='2018-03-10T17:17:00Z'>17:17</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] practicalswift opened pull request #12665: Add compile time checking for all run time locking assertions (master...compile-time-checking-of-runtime-assertions) <a href="https://github.com/bitcoin/bitcoin/pull/12665" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/12665</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520703300' id='603102'>
<a class='timestamp' href='#603102'><time timestamp='2018-03-10T17:35:00Z'>17:35</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
i was looking at malloc stats before/after flushing the dbcache, it looks like glibc malloc doesn&#x27;t do so hot: <a href="https://gist.github.com/eklitzke/9cdcedaf5d15157f79e59128edd83234" class="link" target="_blank">https://gist.github.com/eklitzke/9cdcedaf5d15157f79e59128edd83234</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520703300' id='603103'>
<a class='timestamp' href='#603103'><time timestamp='2018-03-10T17:35:00Z'>17:35</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
the memory use for heap 7 (where the loadblk thread is running) is basically the same before and after the 2GB flush
<br>
</div>

<div class='talk op-msg' data-timestamp='1520703480' id='603104'>
<a class='timestamp' href='#603104'><time timestamp='2018-03-10T17:38:00Z'>17:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
eklitzke: how do i view that?
<br>
</div>

<div class='talk op-msg' data-timestamp='1520703540' id='603105'>
<a class='timestamp' href='#603105'><time timestamp='2018-03-10T17:39:00Z'>17:39</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
bitcoin-cli getmemory mallocinfo
<br>
</div>

<div class='talk op-msg' data-timestamp='1520703720' id='603106'>
<a class='timestamp' href='#603106'><time timestamp='2018-03-10T17:42:00Z'>17:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
o     
<br>
</div>

<div class='talk op-msg' data-timestamp='1520703840' id='603107'>
<a class='timestamp' href='#603107'><time timestamp='2018-03-10T17:44:00Z'>17:44</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
you can get global stats with mallinfo(3) but the xml thing seems to be the only way to get the stats broken down by arena (for bitcoin each thread effectively gets its own arena)
<br>
</div>

<div class='talk op-msg' data-timestamp='1520703960' id='603108'>
<a class='timestamp' href='#603108'><time timestamp='2018-03-10T17:46:00Z'>17:46</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
eklitzke: by do so hot, you&#x27;re expecting usage to go down... I wouldn&#x27;t expect it to due to fragmentation. the cache is kazillions of tiny sparse allocations that all happened at different times.
<br>
</div>

<div class='talk op-msg' data-timestamp='1520703960' id='603109'>
<a class='timestamp' href='#603109'><time timestamp='2018-03-10T17:46:00Z'>17:46</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
it may not be fragmentation per se but it&#x27;s not releasing the memory back to the os
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704020' id='603110'>
<a class='timestamp' href='#603110'><time timestamp='2018-03-10T17:47:00Z'>17:47</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
i was experimenting with trying to dynamically change the dbcache size and it was ineffecitve for this reason, even when using rehash etc.
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704080' id='603111'>
<a class='timestamp' href='#603111'><time timestamp='2018-03-10T17:48:00Z'>17:48</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
it would be nice if the dbcache could be given its own arena since it uses so much memory (on many configurations) and has a somewhat unique allocation pattern
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704140' id='603112'>
<a class='timestamp' href='#603112'><time timestamp='2018-03-10T17:49:00Z'>17:49</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Instead, I&#x27;d rather it didn&#x27;t allocate at all.
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704140' id='603113'>
<a class='timestamp' href='#603113'><time timestamp='2018-03-10T17:49:00Z'>17:49</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
you mean like with a slab allocator?
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704140' id='603114'>
<a class='timestamp' href='#603114'><time timestamp='2018-03-10T17:49:00Z'>17:49</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
what I&#x27;d previously propsosed is that we make it into an open hash table, with all data internal. (and an exception map for rare unusually large entries)
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704200' id='603115'>
<a class='timestamp' href='#603115'><time timestamp='2018-03-10T17:50:00Z'>17:50</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
i was thinking about that too
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704200' id='603116'>
<a class='timestamp' href='#603116'><time timestamp='2018-03-10T17:50:00Z'>17:50</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
everything inline, so no pointer chasing in lookups.
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704200' id='603117'>
<a class='timestamp' href='#603117'><time timestamp='2018-03-10T17:50:00Z'>17:50</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
(except for the exception entries)
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704200' id='603118'>
<a class='timestamp' href='#603118'><time timestamp='2018-03-10T17:50:00Z'>17:50</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
nearly everything in the cache is the same size, the data could fit very compactly
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704200' id='603119'>
<a class='timestamp' href='#603119'><time timestamp='2018-03-10T17:50:00Z'>17:50</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
right.
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704260' id='603120'>
<a class='timestamp' href='#603120'><time timestamp='2018-03-10T17:51:00Z'>17:51</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
just make every entry the same size, and the rare ones that don&#x27;t fit, the storage is a union with a pointer, and a flag tells you to look in an map for the payload.
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704260' id='603121'>
<a class='timestamp' href='#603121'><time timestamp='2018-03-10T17:51:00Z'>17:51</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
or something along those lines.
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704260' id='603122'>
<a class='timestamp' href='#603122'><time timestamp='2018-03-10T17:51:00Z'>17:51</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
makes sense
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704320' id='603123'>
<a class='timestamp' href='#603123'><time timestamp='2018-03-10T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but avoiding allocating inside the LevelDB batch creation would need serious refactoring
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704320' id='603124'>
<a class='timestamp' href='#603124'><time timestamp='2018-03-10T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
leveldb isn&#x27;t really optimized for the way bitcoin writes to it
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704380' id='603125'>
<a class='timestamp' href='#603125'><time timestamp='2018-03-10T17:53:00Z'>17:53</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
you could make it a lot more efficient
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704380' id='603126'>
<a class='timestamp' href='#603126'><time timestamp='2018-03-10T17:53:00Z'>17:53</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
and entries could be never deleted from the open hash table, just flagged.. and make the insert routine understand that it can just write over the first non-dirty entry it encounters.
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704440' id='603127'>
<a class='timestamp' href='#603127'><time timestamp='2018-03-10T17:54:00Z'>17:54</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
it would require kind of serious surgery to the leveldb guts, but leveldb already represents the data in ordered ranges for the sstables, and the data to be flushed can be sorted, so i think you could redo the merge algorithm to zip through the on-disk data and the data being flushed and do the merge without doing a lot of allocatoins
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704440' id='603128'>
<a class='timestamp' href='#603128'><time timestamp='2018-03-10T17:54:00Z'>17:54</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
IIRC, at least at one point, Linux didn&#x27;t <b>*support*</b> processes releasing memory back to the OS. But that may have changed (it&#x27;s been years)
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704500' id='603129'>
<a class='timestamp' href='#603129'><time timestamp='2018-03-10T17:55:00Z'>17:55</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
linux has supported releasing memory back to the operating system for 20+ years if you munmap the data
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704500' id='603130'>
<a class='timestamp' href='#603130'><time timestamp='2018-03-10T17:55:00Z'>17:55</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
you can&#x27;t do it with brk/sbrk though
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704560' id='603131'>
<a class='timestamp' href='#603131'><time timestamp='2018-03-10T17:56:00Z'>17:56</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
glibc mixes both which is kind of weird
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704560' id='603132'>
<a class='timestamp' href='#603132'><time timestamp='2018-03-10T17:56:00Z'>17:56</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
from what i can tell the main arena is allocated with sbrk and the other arenas are allocated with mmap
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704620' id='603133'>
<a class='timestamp' href='#603133'><time timestamp='2018-03-10T17:57:00Z'>17:57</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
iirc it&#x27;s just a threshold
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704620' id='603134'>
<a class='timestamp' href='#603134'><time timestamp='2018-03-10T17:57:00Z'>17:57</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
memory ranges above a certain size are anonymous mmaps
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704680' id='603135'>
<a class='timestamp' href='#603135'><time timestamp='2018-03-10T17:58:00Z'>17:58</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
i think step 1 though would be to implement greg
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704680' id='603136'>
<a class='timestamp' href='#603136'><time timestamp='2018-03-10T17:58:00Z'>17:58</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
s idea, since that doesn&#x27;t require messing with the allocator used by the rest of the code
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704680' id='603137'>
<a class='timestamp' href='#603137'><time timestamp='2018-03-10T17:58:00Z'>17:58</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i believe greg is notoriously hard to implement
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704680' id='603138'>
<a class='timestamp' href='#603138'><time timestamp='2018-03-10T17:58:00Z'>17:58</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ah.     
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704740' id='603139'>
<a class='timestamp' href='#603139'><time timestamp='2018-03-10T17:59:00Z'>17:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
eklitzke: i have a flame graph!
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704800' id='603140'>
<a class='timestamp' href='#603140'><time timestamp='2018-03-10T18:00:00Z'>18:00</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
did you get it color coded?
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704800' id='603141'>
<a class='timestamp' href='#603141'><time timestamp='2018-03-10T18:00:00Z'>18:00</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes; it&#x27;s inside libsecp256k1 though, in a microbenchmark
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704800' id='603142'>
<a class='timestamp' href='#603142'><time timestamp='2018-03-10T18:00:00Z'>18:00</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
awesome!
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704860' id='603143'>
<a class='timestamp' href='#603143'><time timestamp='2018-03-10T18:01:00Z'>18:01</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
<a href="http://bitcoin.sipa.be/flame.svg" class="link" target="_blank">http://bitcoin.sipa.be/flame.svg</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704920' id='603144'>
<a class='timestamp' href='#603144'><time timestamp='2018-03-10T18:02:00Z'>18:02</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
for micro benchmarks you should look at &quot;perf stat&quot; (man perf-stat)
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704920' id='603145'>
<a class='timestamp' href='#603145'><time timestamp='2018-03-10T18:02:00Z'>18:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ah     
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704920' id='603146'>
<a class='timestamp' href='#603146'><time timestamp='2018-03-10T18:02:00Z'>18:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the same scripts apply?
<br>
</div>

<div class='talk op-msg' data-timestamp='1520704980' id='603147'>
<a class='timestamp' href='#603147'><time timestamp='2018-03-10T18:03:00Z'>18:03</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
no it just gives you detailed information about things like cache hits/misses, cpu cycles, page faults, etc.
<br>
</div>

<div class='talk op-msg' data-timestamp='1520705040' id='603148'>
<a class='timestamp' href='#603148'><time timestamp='2018-03-10T18:04:00Z'>18:04</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
so much gmpz realloc
<br>
</div>

<div class='talk op-msg' data-timestamp='1520705100' id='603149'>
<a class='timestamp' href='#603149'><time timestamp='2018-03-10T18:05:00Z'>18:05</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the problem i&#x27;m trying to investigate is why this call to GMP takes 600 cpu cycles when run inside the microbenchmark, but 6000 cpu cycles when called from a higher-level benchmark in core
<br>
</div>

<div class='talk op-msg' data-timestamp='1520705100' id='603150'>
<a class='timestamp' href='#603150'><time timestamp='2018-03-10T18:05:00Z'>18:05</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and at this point i have no better guess than cache effects... but i&#x27;m very surprised it would be that much difference
<br>
</div>

<div class='talk op-msg' data-timestamp='1520705280' id='603151'>
<a class='timestamp' href='#603151'><time timestamp='2018-03-10T18:08:00Z'>18:08</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
one guess: in the benchmark there&#x27;s one thread so everything is in the same core and numa memory zone, but in core the code has to access memory in another numa zone
<br>
</div>

<div class='talk op-msg' data-timestamp='1520705280' id='603152'>
<a class='timestamp' href='#603152'><time timestamp='2018-03-10T18:08:00Z'>18:08</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
there&#x27;s some stuff in numactl you could do try to force core to run all on one core to test that hypothesis
<br>
</div>

<div class='talk op-msg' data-timestamp='1520705280' id='603153'>
<a class='timestamp' href='#603153'><time timestamp='2018-03-10T18:08:00Z'>18:08</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the whole thing should be one thread even when called from bench_bitcoin
<br>
</div>

<div class='talk op-msg' data-timestamp='1520705340' id='603154'>
<a class='timestamp' href='#603154'><time timestamp='2018-03-10T18:09:00Z'>18:09</time></a>
&lt;<span class='nick nick-7'> eklitzke</span>&gt;
try perf-stat -a --per-core
<br>
</div>

<div class='talk op-msg' data-timestamp='1520718480' id='603155'>
<a class='timestamp' href='#603155'><time timestamp='2018-03-10T21:48:00Z'>21:48</time></a>
&lt;<span class='nick nick-16'> jbnj</span>&gt;
hi     
<br>
</div>

<div class='talk op-msg' data-timestamp='1520718540' id='603156'>
<a class='timestamp' href='#603156'><time timestamp='2018-03-10T21:49:00Z'>21:49</time></a>
&lt;<span class='nick nick-16'> jbnj</span>&gt;
hi everybody
<br>
</div>

<div class='talk op-msg' data-timestamp='1520720160' id='603157'>
<a class='timestamp' href='#603157'><time timestamp='2018-03-10T22:16:00Z'>22:16</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] luke-jr opened pull request #12666: configure: UniValue 1.0.4 is required for pushKV(, bool) (master...univalue-1.0.4-required) <a href="https://github.com/bitcoin/bitcoin/pull/12666" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/12666</a>
<br>
</div>

</div>
</section>

</body>
</html>
