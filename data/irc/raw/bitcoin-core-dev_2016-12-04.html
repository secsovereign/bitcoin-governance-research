<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2016-12-04
 â€” 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2016-12-04' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:25 UTC</pre>
<pre><a href="/bitcoin-core-dev/2016-11-04">&lt;</a><span class='header'>  December 2016   </span><a href="/bitcoin-core-dev/2017-01-04">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;             <a class="" href="/bitcoin-core-dev/2016-12-01">1</a>  <a class="" href="/bitcoin-core-dev/2016-12-02">2</a>  <a class="" href="/bitcoin-core-dev/2016-12-03">3</a>  &#x000A; <a class="current" href="/bitcoin-core-dev/2016-12-04">4</a>  <a class="" href="/bitcoin-core-dev/2016-12-05">5</a>  <a class="" href="/bitcoin-core-dev/2016-12-06">6</a>  <a class="" href="/bitcoin-core-dev/2016-12-07">7</a>  <a class="" href="/bitcoin-core-dev/2016-12-08">8</a>  <a class="" href="/bitcoin-core-dev/2016-12-09">9</a> <a class="" href="/bitcoin-core-dev/2016-12-10">10</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2016-12-11">11</a> <a class="" href="/bitcoin-core-dev/2016-12-12">12</a> <a class="" href="/bitcoin-core-dev/2016-12-13">13</a> <a class="" href="/bitcoin-core-dev/2016-12-14">14</a> <a class="" href="/bitcoin-core-dev/2016-12-15">15</a> <a class="" href="/bitcoin-core-dev/2016-12-16">16</a> <a class="" href="/bitcoin-core-dev/2016-12-17">17</a>  &#x000A;18 <a class="" href="/bitcoin-core-dev/2016-12-19">19</a> <a class="" href="/bitcoin-core-dev/2016-12-20">20</a> <a class="" href="/bitcoin-core-dev/2016-12-21">21</a> <a class="" href="/bitcoin-core-dev/2016-12-22">22</a> <a class="" href="/bitcoin-core-dev/2016-12-23">23</a> <a class="" href="/bitcoin-core-dev/2016-12-24">24</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2016-12-25">25</a> <a class="" href="/bitcoin-core-dev/2016-12-26">26</a> <a class="" href="/bitcoin-core-dev/2016-12-27">27</a> <a class="" href="/bitcoin-core-dev/2016-12-28">28</a> <a class="" href="/bitcoin-core-dev/2016-12-29">29</a> <a class="" href="/bitcoin-core-dev/2016-12-30">30</a> <a class="" href="/bitcoin-core-dev/2016-12-31">31</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1480839900' id='515556'>
<a class='timestamp' href='#515556'><time timestamp='2016-12-04T08:25:00Z'>08:25</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] TheBlueMatt opened pull request #9273: Remove unused CDiskBlockPos* argument from ProcessNewBlock (master...2016-12-remove-unused-pnb-param) <a href="https://github.com/bitcoin/bitcoin/pull/9273" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9273</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480875840' id='515557'>
<a class='timestamp' href='#515557'><time timestamp='2016-12-04T18:24:00Z'>18:24</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] MarcoFalke opened pull request #9274: [qa] pruning: Use cached utxo set to run faster (master...Mf1612-qaPruningCacheUtxos) <a href="https://github.com/bitcoin/bitcoin/pull/9274" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9274</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480881480' id='515558'>
<a class='timestamp' href='#515558'><time timestamp='2016-12-04T19:58:00Z'>19:58</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] jonasschnelli pushed 3 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/2efcfa5acfac...4d955fc5824b" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/2efcfa5acfac...4d955fc5824b</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480881480' id='515559'>
<a class='timestamp' href='#515559'><time timestamp='2016-12-04T19:58:00Z'>19:58</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 827d9a3 Wladimir J. van der Laan: qt: Replace NetworkToggleStatusBarControl with generic ClickableLabel...
<br>
</div>

<div class='talk op-msg' data-timestamp='1480881480' id='515560'>
<a class='timestamp' href='#515560'><time timestamp='2016-12-04T19:58:00Z'>19:58</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 042f9fa Wladimir J. van der Laan: qt: Show progress overlay when clicking spinner icon...
<br>
</div>

<div class='talk op-msg' data-timestamp='1480881480' id='515561'>
<a class='timestamp' href='#515561'><time timestamp='2016-12-04T19:58:00Z'>19:58</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 4d955fc Jonas Schnelli: Merge #9218: qt: Show progress overlay when clicking spinner icon...
<br>
</div>

<div class='talk op-msg' data-timestamp='1480881480' id='515562'>
<a class='timestamp' href='#515562'><time timestamp='2016-12-04T19:58:00Z'>19:58</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] jonasschnelli closed pull request #9218: qt: Show progress overlay when clicking spinner icon (master...2016_11_overlay_when_clicking_sync_icon) <a href="https://github.com/bitcoin/bitcoin/pull/9218" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9218</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882680' id='515563'>
<a class='timestamp' href='#515563'><time timestamp='2016-12-04T20:18:00Z'>20:18</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jtimon: re: libconsensus: have you thought more about it after the discussions in milan? I&#x27;m still not a huge fan of exposing a ton of functions and prefer a simple refactor that a) makes it so that everything ProcessNewBlock calls isnt aware of disk positioning/etc and b) move all that stuff into a class which owns mapBlockIndex, chainActive, etc
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882680' id='515564'>
<a class='timestamp' href='#515564'><time timestamp='2016-12-04T20:18:00Z'>20:18</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jtimon: see <a href="https://github.com/TheBlueMatt/bitcoin/commits/2016-12-cconsensus" class="link" target="_blank">https://github.com/TheBlueMatt/bitcoin/commits/2016-12-cconsensus</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882800' id='515565'>
<a class='timestamp' href='#515565'><time timestamp='2016-12-04T20:20:00Z'>20:20</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
I keep thinking the same thing more or less
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882860' id='515566'>
<a class='timestamp' href='#515566'><time timestamp='2016-12-04T20:21:00Z'>20:21</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
if you don&#x27;t want to expose verifyHeader or verifyTx...I know some people want verifyHeader for SPV wallets, but not so sure about verifyTx
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882860' id='515567'>
<a class='timestamp' href='#515567'><time timestamp='2016-12-04T20:21:00Z'>20:21</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
regarding process block, as discussed, I think we should expose verifyBlock instead
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882920' id='515568'>
<a class='timestamp' href='#515568'><time timestamp='2016-12-04T20:22:00Z'>20:22</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jtimon: why, though? if you expose ProcessNewBlock{,Headers} someone can implement a full spv client and full client all in the same codepaths, without exposing low-level partial-verification functions
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882980' id='515569'>
<a class='timestamp' href='#515569'><time timestamp='2016-12-04T20:23:00Z'>20:23</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
(or, excuse me, without requiring users do their own utxo-management shit, while still giving them access to query the utxo state)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882980' id='515570'>
<a class='timestamp' href='#515570'><time timestamp='2016-12-04T20:23:00Z'>20:23</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
how can an SPV node calle ProcessNewBlock? 
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882980' id='515571'>
<a class='timestamp' href='#515571'><time timestamp='2016-12-04T20:23:00Z'>20:23</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
ProcessNewBlockHeaders
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882980' id='515572'>
<a class='timestamp' href='#515572'><time timestamp='2016-12-04T20:23:00Z'>20:23</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
why would they want to depend on levelDB ?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480882980' id='515573'>
<a class='timestamp' href='#515573'><time timestamp='2016-12-04T20:23:00Z'>20:23</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
nono, that part should be abstracted out
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883040' id='515574'>
<a class='timestamp' href='#515574'><time timestamp='2016-12-04T20:24:00Z'>20:24</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
as discussed
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883040' id='515575'>
<a class='timestamp' href='#515575'><time timestamp='2016-12-04T20:24:00Z'>20:24</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
eg see the blockstores in bitcoinj: <a href="https://github.com/bitcoinj/bitcoinj/tree/master/core/src/main/java/org/bitcoinj/store" class="link" target="_blank">https://github.com/bitcoinj/bitcoinj/tree/master/core/src/main/java/org/bitcoinj/store</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883100' id='515576'>
<a class='timestamp' href='#515576'><time timestamp='2016-12-04T20:25:00Z'>20:25</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
oh, right, you were ok with abstracting storage, just wanted libconsensus to manage reorgs and all the rest in an abstracted way
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883100' id='515577'>
<a class='timestamp' href='#515577'><time timestamp='2016-12-04T20:25:00Z'>20:25</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
yea, best to handle /all/ the complexity imo
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883100' id='515578'>
<a class='timestamp' href='#515578'><time timestamp='2016-12-04T20:25:00Z'>20:25</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
isn&#x27;t ProcessNewBlockHeaders an intermediate function?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883100' id='515579'>
<a class='timestamp' href='#515579'><time timestamp='2016-12-04T20:25:00Z'>20:25</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
no? it takes headers and adds them and selects the best headers chain it has seen
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883220' id='515580'>
<a class='timestamp' href='#515580'><time timestamp='2016-12-04T20:27:00Z'>20:27</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
then I&#x27;m not sure what you mean by &quot;intermediate&quot; in this context
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883220' id='515581'>
<a class='timestamp' href='#515581'><time timestamp='2016-12-04T20:27:00Z'>20:27</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
ehh, I apologize, I forgot that your definition of verifyBlock also means checking all the txes connect, ie essentially TestBlockValidity
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883280' id='515582'>
<a class='timestamp' href='#515582'><time timestamp='2016-12-04T20:28:00Z'>20:28</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
instead of existing CheckBlock-type functions
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883280' id='515583'>
<a class='timestamp' href='#515583'><time timestamp='2016-12-04T20:28:00Z'>20:28</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
well, no really testblockvelidity since that call connectBlock too
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883280' id='515584'>
<a class='timestamp' href='#515584'><time timestamp='2016-12-04T20:28:00Z'>20:28</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
hmm?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883280' id='515585'>
<a class='timestamp' href='#515585'><time timestamp='2016-12-04T20:28:00Z'>20:28</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
not really
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883280' id='515586'>
<a class='timestamp' href='#515586'><time timestamp='2016-12-04T20:28:00Z'>20:28</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
huh     
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883340' id='515587'>
<a class='timestamp' href='#515587'><time timestamp='2016-12-04T20:29:00Z'>20:29</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
my proposed verifyBlock just tells you whether a block is valid or not, but it doesn&#x27;t do anything with it
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883340' id='515588'>
<a class='timestamp' href='#515588'><time timestamp='2016-12-04T20:29:00Z'>20:29</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
indeed, like TestBlockValidity?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883460' id='515589'>
<a class='timestamp' href='#515589'><time timestamp='2016-12-04T20:31:00Z'>20:31</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
mhmm, connect block updates transactions, updates undo info and updates the view of the best block, no?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883520' id='515590'>
<a class='timestamp' href='#515590'><time timestamp='2016-12-04T20:32:00Z'>20:32</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
but TestBlockValidity throws away all that info afterwards
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883520' id='515591'>
<a class='timestamp' href='#515591'><time timestamp='2016-12-04T20:32:00Z'>20:32</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
oh, I see
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883520' id='515592'>
<a class='timestamp' href='#515592'><time timestamp='2016-12-04T20:32:00Z'>20:32</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
and you have to keep an updated-utxo-state as you connect the block to test validity
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883520' id='515593'>
<a class='timestamp' href='#515593'><time timestamp='2016-12-04T20:32:00Z'>20:32</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
well, then yes, but without generating info than then throws away
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883580' id='515594'>
<a class='timestamp' href='#515594'><time timestamp='2016-12-04T20:33:00Z'>20:33</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
you cand check a block without doing that
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883580' id='515595'>
<a class='timestamp' href='#515595'><time timestamp='2016-12-04T20:33:00Z'>20:33</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
yeah, you need to update at least a view of the utxo
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883580' id='515596'>
<a class='timestamp' href='#515596'><time timestamp='2016-12-04T20:33:00Z'>20:33</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
right, that was my idea for verifyBlock
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883940' id='515597'>
<a class='timestamp' href='#515597'><time timestamp='2016-12-04T20:39:00Z'>20:39</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jtimon: ok, so back to my original question...what do you think of not exposing that and actually having a utxo/disk-storage-abstraced full consensus layer
<br>
</div>

<div class='talk op-msg' data-timestamp='1480883940' id='515598'>
<a class='timestamp' href='#515598'><time timestamp='2016-12-04T20:39:00Z'>20:39</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
?     
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884000' id='515599'>
<a class='timestamp' href='#515599'><time timestamp='2016-12-04T20:40:00Z'>20:40</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
well, where I have te strongest opinion is in abstracting from storage
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884060' id='515600'>
<a class='timestamp' href='#515600'><time timestamp='2016-12-04T20:41:00Z'>20:41</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
and agree on that
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884060' id='515601'>
<a class='timestamp' href='#515601'><time timestamp='2016-12-04T20:41:00Z'>20:41</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
ok...?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884060' id='515602'>
<a class='timestamp' href='#515602'><time timestamp='2016-12-04T20:41:00Z'>20:41</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
oh, well sure, I dont think anyone wants libconsensus to require a certain storage layer
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884060' id='515603'>
<a class='timestamp' href='#515603'><time timestamp='2016-12-04T20:41:00Z'>20:41</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
what would be the API? precessnewblock and processnewheaders?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884180' id='515604'>
<a class='timestamp' href='#515604'><time timestamp='2016-12-04T20:43:00Z'>20:43</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jtimon: essentially, yes, PNB, PNBH, some initialization api (see <a href="https://github.com/TheBlueMatt/bitcoin/blob/2016-12-cconsensus/src/validation.cpp#L80" class="link" target="_blank">https://github.com/TheBlueMatt/bitcoin/blob/2016-12-cconsensus/src/validation.cpp#L80</a>) and a utxo-state-accessor/loadblock-accessor api
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884180' id='515605'>
<a class='timestamp' href='#515605'><time timestamp='2016-12-04T20:43:00Z'>20:43</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
well, I do think some people want to depend on a concrete storage , but since it&#x27;s neither of us, let&#x27;s leave that aside
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884240' id='515606'>
<a class='timestamp' href='#515606'><time timestamp='2016-12-04T20:44:00Z'>20:44</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
what about caches? any API for those?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884240' id='515607'>
<a class='timestamp' href='#515607'><time timestamp='2016-12-04T20:44:00Z'>20:44</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
well once the bitcoin core codebase &quot;eats its own dogfood&quot;, as it were, we can take the storage layer we have and expose that optionally
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884240' id='515608'>
<a class='timestamp' href='#515608'><time timestamp='2016-12-04T20:44:00Z'>20:44</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
right
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884240' id='515609'>
<a class='timestamp' href='#515609'><time timestamp='2016-12-04T20:44:00Z'>20:44</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
no, caches are up to the client application, ie the client application gives libbitcoinconsensus pcoinsTip
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884240' id='515610'>
<a class='timestamp' href='#515610'><time timestamp='2016-12-04T20:44:00Z'>20:44</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
similarly, in the future, maybe we can expose CCoinsViewCache or whatever
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884240' id='515611'>
<a class='timestamp' href='#515611'><time timestamp='2016-12-04T20:44:00Z'>20:44</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
but for v1, its uneccessary
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884300' id='515612'>
<a class='timestamp' href='#515612'><time timestamp='2016-12-04T20:45:00Z'>20:45</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
mhmm, I mean for example the versionbits cache
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884300' id='515613'>
<a class='timestamp' href='#515613'><time timestamp='2016-12-04T20:45:00Z'>20:45</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
is that hidden to the caller or exposed somehow?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884360' id='515614'>
<a class='timestamp' href='#515614'><time timestamp='2016-12-04T20:46:00Z'>20:46</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
since its currently not exposed, hidden and present
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884360' id='515615'>
<a class='timestamp' href='#515615'><time timestamp='2016-12-04T20:46:00Z'>20:46</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
dont expose anything unless its required, and for v1, dont worry too much about performance or memory usage
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884420' id='515616'>
<a class='timestamp' href='#515616'><time timestamp='2016-12-04T20:47:00Z'>20:47</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the reason for not exposing would exactly be performance and memory usage, i think
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884420' id='515617'>
<a class='timestamp' href='#515617'><time timestamp='2016-12-04T20:47:00Z'>20:47</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s pretty hard to design a stable api that can be used efficiently for those things
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884420' id='515618'>
<a class='timestamp' href='#515618'><time timestamp='2016-12-04T20:47:00Z'>20:47</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so i&#x27;d say make all state (caches, indexes, ...) by default part of the abstracted state
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884480' id='515619'>
<a class='timestamp' href='#515619'><time timestamp='2016-12-04T20:48:00Z'>20:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and perhaps later introduce a way for the caller to install callbacks to override it, and provide their own
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884480' id='515620'>
<a class='timestamp' href='#515620'><time timestamp='2016-12-04T20:48:00Z'>20:48</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
well, the api may change if consensus rules change
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884720' id='515621'>
<a class='timestamp' href='#515621'><time timestamp='2016-12-04T20:52:00Z'>20:52</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
BlueMatt: I highly doubt some implementors (say libbitcoin) will use processNewBlock, then again I also doubted they were going to use verifyBlock directly either, I was hoping maybe verifyHeader, verifyTx + GetConsensusFlags
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884780' id='515622'>
<a class='timestamp' href='#515622'><time timestamp='2016-12-04T20:53:00Z'>20:53</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
sipa: yea, except for v1 it doesnt matter, really - just dont expose anything and later, if we remove caches to make the library lighter, expose hooks to replace the caches
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884780' id='515623'>
<a class='timestamp' href='#515623'><time timestamp='2016-12-04T20:53:00Z'>20:53</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] morcos opened pull request #9276: Some minor testing cleanups (master...rpccleanup) <a href="https://github.com/bitcoin/bitcoin/pull/9276" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9276</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884780' id='515624'>
<a class='timestamp' href='#515624'><time timestamp='2016-12-04T20:53:00Z'>20:53</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
leaving that aside, I would like libconsensus to be the specification of the consensus rules for a given block to be valid, it seems that with your approach it would be more than that
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884840' id='515625'>
<a class='timestamp' href='#515625'><time timestamp='2016-12-04T20:54:00Z'>20:54</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
but bitcoin core is currently way more than that, so...
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884840' id='515626'>
<a class='timestamp' href='#515626'><time timestamp='2016-12-04T20:54:00Z'>20:54</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jtimon: I mean the way any sane full node is structured there is an abstracted utxo/blocks-on-disk storage and something which checks everything and itnerfaces with that state
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884900' id='515627'>
<a class='timestamp' href='#515627'><time timestamp='2016-12-04T20:55:00Z'>20:55</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
I also hope you don&#x27;t intend to put half of the server package in the consensus package
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884900' id='515628'>
<a class='timestamp' href='#515628'><time timestamp='2016-12-04T20:55:00Z'>20:55</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jtimon: I see no reason why libbitcoinconsensus shouldnt repalce everything in between because if the goal is to reduce the risk of consensus incompatibility, we should replace everything we can
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884900' id='515629'>
<a class='timestamp' href='#515629'><time timestamp='2016-12-04T20:55:00Z'>20:55</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jtimon: I dont care what it weighs, only what it does....cutting down the weight is for later versions
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884900' id='515630'>
<a class='timestamp' href='#515630'><time timestamp='2016-12-04T20:55:00Z'>20:55</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
:p     
<br>
</div>

<div class='talk op-msg' data-timestamp='1480884960' id='515631'>
<a class='timestamp' href='#515631'><time timestamp='2016-12-04T20:56:00Z'>20:56</time></a>
&lt;<span class='nick nick-16'> * BlueMatt</span>&gt;
-&gt; brunch
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885020' id='515632'>
<a class='timestamp' href='#515632'><time timestamp='2016-12-04T20:57:00Z'>20:57</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
because some implementors (like libbitcoin) value more the ability to have their own concurrency model (ie without locks) than reducing risks of consensus incompatibility beyond verifyScript (which they also use only optionally)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885080' id='515633'>
<a class='timestamp' href='#515633'><time timestamp='2016-12-04T20:58:00Z'>20:58</time></a>
&lt;<span class='nick nick-2'> * jtimon</span>&gt;
should have brinner soon too
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885200' id='515634'>
<a class='timestamp' href='#515634'><time timestamp='2016-12-04T21:00:00Z'>21:00</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
I agree, that we can leave &quot;cutting weight&quot; for later (like we&#x27;re leaving moving CFeeRate for later for very long), my point is that with your approach, even after you&#x27;re done, it will be much bigger than &quot;the specification for whether a block is valid or not&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885260' id='515635'>
<a class='timestamp' href='#515635'><time timestamp='2016-12-04T21:01:00Z'>21:01</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
it would be more like the specification of &quot;how to follow and store the longest valid chain&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885260' id='515636'>
<a class='timestamp' href='#515636'><time timestamp='2016-12-04T21:01:00Z'>21:01</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
then someone will want prunning too...
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885440' id='515637'>
<a class='timestamp' href='#515637'><time timestamp='2016-12-04T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jtimon: yes, it&#x27;s the specification for whether a blockchain is valid or not
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885440' id='515638'>
<a class='timestamp' href='#515638'><time timestamp='2016-12-04T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
sipa: processNewBlock does much more than that
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885440' id='515639'>
<a class='timestamp' href='#515639'><time timestamp='2016-12-04T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
well, yes, due to necessity
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885440' id='515640'>
<a class='timestamp' href='#515640'><time timestamp='2016-12-04T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
we can&#x27;t track the validity of every single chain
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885440' id='515641'>
<a class='timestamp' href='#515641'><time timestamp='2016-12-04T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so we only have a utxo set at a tip
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885500' id='515642'>
<a class='timestamp' href='#515642'><time timestamp='2016-12-04T21:05:00Z'>21:05</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
that&#x27;s we, maybe other callers want to do things differently
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885620' id='515643'>
<a class='timestamp' href='#515643'><time timestamp='2016-12-04T21:07:00Z'>21:07</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
then maybe someone else asks for &quot;sharded prunning&quot; or something else, and soon you end up again with a lot of things that don&#x27;t have anything to do with consensus rules
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885620' id='515644'>
<a class='timestamp' href='#515644'><time timestamp='2016-12-04T21:07:00Z'>21:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes, so we can later provide ways to plug in your own state storage (utxo/caches/indexes/...)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885680' id='515645'>
<a class='timestamp' href='#515645'><time timestamp='2016-12-04T21:08:00Z'>21:08</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
sipa: oh, BlueMatt&#x27;s approach already gives you an abstraction for the utxo and chain index storage
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885680' id='515646'>
<a class='timestamp' href='#515646'><time timestamp='2016-12-04T21:08:00Z'>21:08</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
oj     
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885680' id='515647'>
<a class='timestamp' href='#515647'><time timestamp='2016-12-04T21:08:00Z'>21:08</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
ok     
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885740' id='515648'>
<a class='timestamp' href='#515648'><time timestamp='2016-12-04T21:09:00Z'>21:09</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
but my example is that if it supports prunning, that needs to be exposed somehow
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885800' id='515649'>
<a class='timestamp' href='#515649'><time timestamp='2016-12-04T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
heh?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885800' id='515650'>
<a class='timestamp' href='#515650'><time timestamp='2016-12-04T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
how does block storage have anything to do with this
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885800' id='515651'>
<a class='timestamp' href='#515651'><time timestamp='2016-12-04T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
isn&#x27;t prunning deleting blocks you are storing?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885800' id='515652'>
<a class='timestamp' href='#515652'><time timestamp='2016-12-04T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes, but blocks wouldn&#x27;t be stored by libconsensus
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885860' id='515653'>
<a class='timestamp' href='#515653'><time timestamp='2016-12-04T21:11:00Z'>21:11</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
they would with BlueMatt&#x27;s approach
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885860' id='515654'>
<a class='timestamp' href='#515654'><time timestamp='2016-12-04T21:11:00Z'>21:11</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
hmm, that seems strange
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885860' id='515655'>
<a class='timestamp' href='#515655'><time timestamp='2016-12-04T21:11:00Z'>21:11</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
if I undesrtood him correctly
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885860' id='515656'>
<a class='timestamp' href='#515656'><time timestamp='2016-12-04T21:11:00Z'>21:11</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i would have an api where you plug in a way libconsensus to ask you for a block
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885920' id='515657'>
<a class='timestamp' href='#515657'><time timestamp='2016-12-04T21:12:00Z'>21:12</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if yiu&#x27;re abstracting utxo storage, i don&#x27;t see why you wouldn&#x27;t abstract nlock storage
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885920' id='515658'>
<a class='timestamp' href='#515658'><time timestamp='2016-12-04T21:12:00Z'>21:12</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
that&#x27;s why he needs something like <a href="https://github.com/bitcoinj/bitcoinj/blob/master/core/src/main/java/org/bitcoinj/store/BlockStore.java#L39" class="link" target="_blank">https://github.com/bitcoinj/bitcoinj/blob/master/core/src/main/java/org/bitcoinj/store/BlockStore.java#L39</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885920' id='515659'>
<a class='timestamp' href='#515659'><time timestamp='2016-12-04T21:12:00Z'>21:12</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which is even less consensus critical
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885920' id='515660'>
<a class='timestamp' href='#515660'><time timestamp='2016-12-04T21:12:00Z'>21:12</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but that&#x27;s the user that provides the blockstore
<br>
</div>

<div class='talk op-msg' data-timestamp='1480885920' id='515661'>
<a class='timestamp' href='#515661'><time timestamp='2016-12-04T21:12:00Z'>21:12</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
not the library
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886040' id='515662'>
<a class='timestamp' href='#515662'><time timestamp='2016-12-04T21:14:00Z'>21:14</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
right, the library provides an API and callbacks the implementor for stored data in both cases, but in bluematt&#x27;s case, it also updates the storage, it doesn&#x27;t use it in a read only way
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886040' id='515663'>
<a class='timestamp' href='#515663'><time timestamp='2016-12-04T21:14:00Z'>21:14</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
maybe prunning was a bad example, I agree you don&#x27;t need to put it in libconsensus even in that case
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886100' id='515664'>
<a class='timestamp' href='#515664'><time timestamp='2016-12-04T21:15:00Z'>21:15</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I think abstracting things like all this storage maybe getting into the realm of imaginary users... is there really many users that want to make no change (not even instrumentation) to consensus but is very interested at implementing their own UTXO database?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886160' id='515665'>
<a class='timestamp' href='#515665'><time timestamp='2016-12-04T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
in my case, it takes a block and says valid or validation error x and does nothing more than that
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886160' id='515666'>
<a class='timestamp' href='#515666'><time timestamp='2016-12-04T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jtimon: but you need to reimplement a lot of complicated logic in your application for it
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886160' id='515667'>
<a class='timestamp' href='#515667'><time timestamp='2016-12-04T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
utxo caching is hard
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886160' id='515668'>
<a class='timestamp' href='#515668'><time timestamp='2016-12-04T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
block index tracking with skiplists is not trivial
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886160' id='515669'>
<a class='timestamp' href='#515669'><time timestamp='2016-12-04T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
gmaxwell: I agree that part of the problem here is not having a clear idea of the users or their preferences
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886160' id='515670'>
<a class='timestamp' href='#515670'><time timestamp='2016-12-04T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I thought the goal for libconsensus is that so that when someone wants to make their own custom wallet thing they wouldn&#x27;t need to reimplment any of the consensus logic, just to create their own application logic.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886220' id='515671'>
<a class='timestamp' href='#515671'><time timestamp='2016-12-04T21:17:00Z'>21:17</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
gmaxwell: but it seems that your objection would apply to both my approach and matt&#x27;s
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886220' id='515672'>
<a class='timestamp' href='#515672'><time timestamp='2016-12-04T21:17:00Z'>21:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i really don&#x27;t care about users at this point - we don&#x27;t have any, and have no easy way to build somwthing others could use
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886220' id='515673'>
<a class='timestamp' href='#515673'><time timestamp='2016-12-04T21:17:00Z'>21:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i care about separating consensus from nonconsensus logic
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886280' id='515674'>
<a class='timestamp' href='#515674'><time timestamp='2016-12-04T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
if so that would really mean all the chain management would really be inside the library. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886280' id='515675'>
<a class='timestamp' href='#515675'><time timestamp='2016-12-04T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: okay so for the purpose of consensus safty of changes, the caches and utxo database are all consensus critical--
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886280' id='515676'>
<a class='timestamp' href='#515676'><time timestamp='2016-12-04T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: fair enough, but so is the c++ standard library
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886280' id='515677'>
<a class='timestamp' href='#515677'><time timestamp='2016-12-04T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
gmaxwell: right, matt puts the chain management inside, but also provides an abstraction for storage
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886340' id='515678'>
<a class='timestamp' href='#515678'><time timestamp='2016-12-04T21:19:00Z'>21:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i think having block storage outside the library is perfectly fine, as consensus logic really does not need blocks except for reorgs
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886340' id='515679'>
<a class='timestamp' href='#515679'><time timestamp='2016-12-04T21:19:00Z'>21:19</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jtimon: Providing an abstraction for IO though is different than something that expects the user to implement a complex database.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886400' id='515680'>
<a class='timestamp' href='#515680'><time timestamp='2016-12-04T21:20:00Z'>21:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
even utxo storage i can be convinced of, i think
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886400' id='515681'>
<a class='timestamp' href='#515681'><time timestamp='2016-12-04T21:20:00Z'>21:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but block chain tracking (cblockindex/mapblockindex/...) should really be inside
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886400' id='515682'>
<a class='timestamp' href='#515682'><time timestamp='2016-12-04T21:20:00Z'>21:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s highly dependent on how we manage chains
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886400' id='515683'>
<a class='timestamp' href='#515683'><time timestamp='2016-12-04T21:20:00Z'>21:20</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
providing a wrapper that includes the same storage as bitcoin core, as an extended library should be easy
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886460' id='515684'>
<a class='timestamp' href='#515684'><time timestamp='2016-12-04T21:21:00Z'>21:21</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
so long as the requirements are very clear and simple... where no bitcoin specific understanding is required... sure.  though doing that without breaking efficiency might be hard. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886460' id='515685'>
<a class='timestamp' href='#515685'><time timestamp='2016-12-04T21:21:00Z'>21:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i don&#x27;t want every cblockindex access to go through wrapper calls
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886520' id='515686'>
<a class='timestamp' href='#515686'><time timestamp='2016-12-04T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
e.g. there are ordering requirements for fixation of block data vs utxo data to disk.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886520' id='515687'>
<a class='timestamp' href='#515687'><time timestamp='2016-12-04T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
yep, efficiency is the main concern with my approach I think
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886580' id='515688'>
<a class='timestamp' href='#515688'><time timestamp='2016-12-04T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
btw, as always comments on <a href="https://github.com/bitcoin/bitcoin/pull/8493" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/8493</a> welcomed
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886700' id='515689'>
<a class='timestamp' href='#515689'><time timestamp='2016-12-04T21:25:00Z'>21:25</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
this kind of thing (for the abstracted storage) is disruptive though <a href="https://github.com/bitcoin/bitcoin/pull/8493/commits/0a1ff996c5db5265742e3e90f3690a0b8d9cf045" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/8493/commits/0a1ff996c5db5265742e3e90f3690a0b8d9cf045</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480886760' id='515690'>
<a class='timestamp' href='#515690'><time timestamp='2016-12-04T21:26:00Z'>21:26</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
and the way I implemented it there, is also inneficient for bitcoin core 
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887360' id='515691'>
<a class='timestamp' href='#515691'><time timestamp='2016-12-04T21:36:00Z'>21:36</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
anyway, there&#x27;s 2 separated topics here
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887360' id='515692'>
<a class='timestamp' href='#515692'><time timestamp='2016-12-04T21:36:00Z'>21:36</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
whether to abstract and expose storage
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887420' id='515693'>
<a class='timestamp' href='#515693'><time timestamp='2016-12-04T21:37:00Z'>21:37</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
and whether or not to manage reorgs and other things beyond &quot;check whether a given block is valid or not&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887540' id='515694'>
<a class='timestamp' href='#515694'><time timestamp='2016-12-04T21:39:00Z'>21:39</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
my answers are yes and no, matt&#x27;s is yes and yes. If gmaxwell&#x27;s is no and yes, and sipa&#x27;s are yes and yes, we have all the options represented :p
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887780' id='515695'>
<a class='timestamp' href='#515695'><time timestamp='2016-12-04T21:43:00Z'>21:43</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
s/sipa&#x27;s are no and no/
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887900' id='515696'>
<a class='timestamp' href='#515696'><time timestamp='2016-12-04T21:45:00Z'>21:45</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the first thing we should probably do is separate CBlockIndex into block storage data (file, offset, undo, ...), and chain data (block index, work, validation)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887960' id='515697'>
<a class='timestamp' href='#515697'><time timestamp='2016-12-04T21:46:00Z'>21:46</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that would be required if we&#x27;d want to abstract block storage out from a library
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887960' id='515698'>
<a class='timestamp' href='#515698'><time timestamp='2016-12-04T21:46:00Z'>21:46</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but i thibk it shoukd hapoen regardless
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887960' id='515699'>
<a class='timestamp' href='#515699'><time timestamp='2016-12-04T21:46:00Z'>21:46</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
I don&#x27;t need to do that in my approach
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887960' id='515700'>
<a class='timestamp' href='#515700'><time timestamp='2016-12-04T21:46:00Z'>21:46</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the block storage data doesn&#x27;t even need to be in memory permnantly
<br>
</div>

<div class='talk op-msg' data-timestamp='1480887960' id='515701'>
<a class='timestamp' href='#515701'><time timestamp='2016-12-04T21:46:00Z'>21:46</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i understand
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888020' id='515702'>
<a class='timestamp' href='#515702'><time timestamp='2016-12-04T21:47:00Z'>21:47</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but my point is that we should do that, even if there never is a library at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888080' id='515703'>
<a class='timestamp' href='#515703'><time timestamp='2016-12-04T21:48:00Z'>21:48</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
chain.o and coins.o are already separated, I&#x27;m not entirely sure I understand what you mean
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888200' id='515704'>
<a class='timestamp' href='#515704'><time timestamp='2016-12-04T21:50:00Z'>21:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
CBlockIndex stores things about where blocks are on disk
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888200' id='515705'>
<a class='timestamp' href='#515705'><time timestamp='2016-12-04T21:50:00Z'>21:50</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
oh, I see
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888200' id='515706'>
<a class='timestamp' href='#515706'><time timestamp='2016-12-04T21:50:00Z'>21:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
(which has nothing to do with consensus)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888200' id='515707'>
<a class='timestamp' href='#515707'><time timestamp='2016-12-04T21:50:00Z'>21:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and things like validation flags and chainwork
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888260' id='515708'>
<a class='timestamp' href='#515708'><time timestamp='2016-12-04T21:51:00Z'>21:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and the block header
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888260' id='515709'>
<a class='timestamp' href='#515709'><time timestamp='2016-12-04T21:51:00Z'>21:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
which do
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888380' id='515710'>
<a class='timestamp' href='#515710'><time timestamp='2016-12-04T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
regarding the validation flags, I replaced #7779 with <a href="https://github.com/bitcoin/bitcoin/pull/9271" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9271</a> (although got errors in unittests because we&#x27;re already relying on the consensus flags being coupled for testing it seems)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888380' id='515711'>
<a class='timestamp' href='#515711'><time timestamp='2016-12-04T21:53:00Z'>21:53</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/7779" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/7779</a> | An error has occurred and has been logged. Please contact this bot&#x27;s administrator for more information.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480888560' id='515712'>
<a class='timestamp' href='#515712'><time timestamp='2016-12-04T21:56:00Z'>21:56</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
see <a href="https://github.com/bitcoin/bitcoin/pull/9271/commits/7a90173b839e682932426f7d6ac91d2df88e2cfb" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9271/commits/7a90173b839e682932426f7d6ac91d2df88e2cfb</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480889040' id='515713'>
<a class='timestamp' href='#515713'><time timestamp='2016-12-04T22:04:00Z'>22:04</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] s-matthew-english opened pull request #9277: clear typo &quot;skipepd&quot; changed to &quot;skipped&quot; (master...patch-12) <a href="https://github.com/bitcoin/bitcoin/pull/9277" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9277</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480889460' id='515714'>
<a class='timestamp' href='#515714'><time timestamp='2016-12-04T22:11:00Z'>22:11</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] MarcoFalke closed pull request #9277: clear typo &quot;skipepd&quot; changed to &quot;skipped&quot; (master...patch-12) <a href="https://github.com/bitcoin/bitcoin/pull/9277" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9277</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1480892160' id='515715'>
<a class='timestamp' href='#515715'><time timestamp='2016-12-04T22:56:00Z'>22:56</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
gmaxwell: regarding bumpfee...  i&#x27;d been advising mrbandrews to try to simplify what the rpc command is doing as much as possible, with the hope of getting a helpful utility in place tht we could layer more advanced behavior on top of
<br>
</div>

<div class='talk op-msg' data-timestamp='1480892220' id='515716'>
<a class='timestamp' href='#515716'><time timestamp='2016-12-04T22:57:00Z'>22:57</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
gmaxwell: so in particular, i wasn&#x27;t aware of a robust way to identify the change output, so i suggested for this rpc to have the user supply it
<br>
</div>

<div class='talk op-msg' data-timestamp='1480892220' id='515717'>
<a class='timestamp' href='#515717'><time timestamp='2016-12-04T22:57:00Z'>22:57</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
is there a robust way to identify the change output?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480892280' id='515718'>
<a class='timestamp' href='#515718'><time timestamp='2016-12-04T22:58:00Z'>22:58</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes, IsMine() and not in address book
<br>
</div>

<div class='talk op-msg' data-timestamp='1480892580' id='515719'>
<a class='timestamp' href='#515719'><time timestamp='2016-12-04T23:03:00Z'>23:03</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
sorry i&#x27;m so unfamiliar with this...  i guess there&#x27;s an IsChange() function, with a TODO saying that this might not work with multisig behavior in the future.  is that not a concern now?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480892940' id='515720'>
<a class='timestamp' href='#515720'><time timestamp='2016-12-04T23:09:00Z'>23:09</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sdaftuar: We really should be storing the data in the wallet, but just using IsMine would be better than asking for it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480892940' id='515721'>
<a class='timestamp' href='#515721'><time timestamp='2016-12-04T23:09:00Z'>23:09</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
(I think specifying it is basically something that would only be useful to the same people who could use createrawtransaction)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893000' id='515722'>
<a class='timestamp' href='#515722'><time timestamp='2016-12-04T23:10:00Z'>23:10</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Simplifying it is good, but we can&#x27;t make it a hazard to users-- which is why I was saying it needed to somehow assure that the outputs will not get spent while unconfirmed.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893060' id='515723'>
<a class='timestamp' href='#515723'><time timestamp='2016-12-04T23:11:00Z'>23:11</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Simiarly, just diminishing the change and never adding inputs will produce transactions which won&#x27;t relay (dust). though I suppose instead of being able to add inputs it could just limit itself to places where that wouldn&#x27;t be the case.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893060' id='515724'>
<a class='timestamp' href='#515724'><time timestamp='2016-12-04T23:11:00Z'>23:11</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
gmaxwell: i haven&#x27;t looked at the PR lately but i thought it was going to do the right thing with dust.  
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893060' id='515725'>
<a class='timestamp' href='#515725'><time timestamp='2016-12-04T23:11:00Z'>23:11</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Because of the need to restrict dependant transaction chains I thought a &#x27;bump everything&#x27; might be simpler.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893120' id='515726'>
<a class='timestamp' href='#515726'><time timestamp='2016-12-04T23:12:00Z'>23:12</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sdaftuar: it didn&#x27;t look like it could add inputs to me but equally possible that I was confused.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893180' id='515727'>
<a class='timestamp' href='#515727'><time timestamp='2016-12-04T23:13:00Z'>23:13</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
gmaxwell: oh it won&#x27;t currently add inputs, as i recall, but i think if it would reduce the change output to less than dust, then it would get dropped altogether
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893180' id='515728'>
<a class='timestamp' href='#515728'><time timestamp='2016-12-04T23:13:00Z'>23:13</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
(that&#x27;s what i recall some discussion of, anyway)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893180' id='515729'>
<a class='timestamp' href='#515729'><time timestamp='2016-12-04T23:13:00Z'>23:13</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
are you saying though that you don&#x27;t think it should allow feebumping a tx that has descendants?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893180' id='515730'>
<a class='timestamp' href='#515730'><time timestamp='2016-12-04T23:13:00Z'>23:13</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
i thought that was part of the point of this RPC, to get that right.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893480' id='515731'>
<a class='timestamp' href='#515731'><time timestamp='2016-12-04T23:18:00Z'>23:18</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
imagine you have txn  A, and B that spends A.  Then you bump A creating a replaceme A&#x27; that replaces A/B.  Now you make nother spend that spends the output of A&#x27;  ...  you really need to draft two versions of it one that spends B and one that spends A&#x27;... and switch to relaying the other depending on what confirms. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893480' id='515732'>
<a class='timestamp' href='#515732'><time timestamp='2016-12-04T23:18:00Z'>23:18</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I thought that was too advanced, which is why I was suggesting prohibiting descendants.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893480' id='515733'>
<a class='timestamp' href='#515733'><time timestamp='2016-12-04T23:18:00Z'>23:18</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
ahh right
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893480' id='515734'>
<a class='timestamp' href='#515734'><time timestamp='2016-12-04T23:18:00Z'>23:18</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
wow, i totally missed that
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893540' id='515735'>
<a class='timestamp' href='#515735'><time timestamp='2016-12-04T23:19:00Z'>23:19</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
GAit has implemented bumping in the green address wallet and I think it deals with all this stuff.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893600' id='515736'>
<a class='timestamp' href='#515736'><time timestamp='2016-12-04T23:20:00Z'>23:20</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
PRs welcome? :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893600' id='515737'>
<a class='timestamp' href='#515737'><time timestamp='2016-12-04T23:20:00Z'>23:20</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
even my suggestion of making unspendable for one confirm is a bit risky, since it couple be reorged out. :(
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893600' id='515738'>
<a class='timestamp' href='#515738'><time timestamp='2016-12-04T23:20:00Z'>23:20</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
so i think bumpunconfirmed is a good idea, but i worry about old transactions that have long since been double spent
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893600' id='515739'>
<a class='timestamp' href='#515739'><time timestamp='2016-12-04T23:20:00Z'>23:20</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
esp since there is non-trivial amounts of hashpower that won&#x27;t take replacements.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893600' id='515740'>
<a class='timestamp' href='#515740'><time timestamp='2016-12-04T23:20:00Z'>23:20</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
or rather, distinguishing those from other unconfirmed transactions
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893660' id='515741'>
<a class='timestamp' href='#515741'><time timestamp='2016-12-04T23:21:00Z'>23:21</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
well we track conflicted transactions.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893660' id='515742'>
<a class='timestamp' href='#515742'><time timestamp='2016-12-04T23:21:00Z'>23:21</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
but not perfectly
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893660' id='515743'>
<a class='timestamp' href='#515743'><time timestamp='2016-12-04T23:21:00Z'>23:21</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
we can&#x27;t track conflicted transactions where the conflict chain is broken with tx&#x27;s not in our wallet
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893720' id='515744'>
<a class='timestamp' href='#515744'><time timestamp='2016-12-04T23:22:00Z'>23:22</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Point. Though it would be sufficient for this functionality to only work on transactions where the closure of unconfirmed parents are all in the wallet, I guess.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893900' id='515745'>
<a class='timestamp' href='#515745'><time timestamp='2016-12-04T23:25:00Z'>23:25</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I wonder how often someone has multiple unconfirmeds pending and doesn&#x27;t want to just bump them all. Usually it will save them total fees if they do so.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893900' id='515746'>
<a class='timestamp' href='#515746'><time timestamp='2016-12-04T23:25:00Z'>23:25</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
ignoring crazy corner cases like some being doublespent.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480893960' id='515747'>
<a class='timestamp' href='#515747'><time timestamp='2016-12-04T23:26:00Z'>23:26</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
yeah i think it does seem like a useful feature
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894020' id='515748'>
<a class='timestamp' href='#515748'><time timestamp='2016-12-04T23:27:00Z'>23:27</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
it just seemed simpler to me than getting all the corner cases right.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894080' id='515749'>
<a class='timestamp' href='#515749'><time timestamp='2016-12-04T23:28:00Z'>23:28</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
well i think that has a bunch of corner cases too.  you probably want to make sure you conflict with anything that might possibly confirm, so you have to include even abandoned transactions right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894080' id='515750'>
<a class='timestamp' href='#515750'><time timestamp='2016-12-04T23:28:00Z'>23:28</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
(maybe even 1-confirm tx&#x27;s!)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894080' id='515751'>
<a class='timestamp' href='#515751'><time timestamp='2016-12-04T23:28:00Z'>23:28</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
er 1-conflicted
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894140' id='515752'>
<a class='timestamp' href='#515752'><time timestamp='2016-12-04T23:29:00Z'>23:29</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
You need to conflict with anything whos outputs you include, so that you don&#x27;t potentially double-pay. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894200' id='515753'>
<a class='timestamp' href='#515753'><time timestamp='2016-12-04T23:30:00Z'>23:30</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
i guess that raises a good UI point
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894200' id='515754'>
<a class='timestamp' href='#515754'><time timestamp='2016-12-04T23:30:00Z'>23:30</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
probably the user would want to see all the outputs and transactions being bumped, and ack that?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894200' id='515755'>
<a class='timestamp' href='#515755'><time timestamp='2016-12-04T23:30:00Z'>23:30</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
in case of the really old wallet tx that the user forgot about problem
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894260' id='515756'>
<a class='timestamp' href='#515756'><time timestamp='2016-12-04T23:31:00Z'>23:31</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
i dunno, i guess i just assume that heavy wallet users that have been running for a while must have lots of those, maybe that&#x27;s not a good assumption
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894320' id='515757'>
<a class='timestamp' href='#515757'><time timestamp='2016-12-04T23:32:00Z'>23:32</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
?     
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894320' id='515758'>
<a class='timestamp' href='#515758'><time timestamp='2016-12-04T23:32:00Z'>23:32</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I think it would work like this: take the set of unconfirmed transactions which are AllFromMe (whatever the test that excludes coinjoins is called). Then eliminate all transactions whos parents aren&#x27;t either all AllFromMe or 6 confirmed.  Then gather up all their outputs, eliminate all the IsMine outputs,  and generate a new transaction which conflicts each transaction in the set, and pays suffi
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894380' id='515759'>
<a class='timestamp' href='#515759'><time timestamp='2016-12-04T23:33:00Z'>23:33</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
ciently more fees. Then its change output (if any) should be marked so that it will not be treated as IsFromMe for spending purposes. (UI wise we should encourage somewhat overpaying due to this last point)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894440' id='515760'>
<a class='timestamp' href='#515760'><time timestamp='2016-12-04T23:34:00Z'>23:34</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I don&#x27;t think most users have a lot of long lost transactions.  I hope not. :) since they&#x27;ll pretty likely to lose coins if they ditch the wallet thinking the balance was zero.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894440' id='515761'>
<a class='timestamp' href='#515761'><time timestamp='2016-12-04T23:34:00Z'>23:34</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
that seems like it ought to work.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894440' id='515762'>
<a class='timestamp' href='#515762'><time timestamp='2016-12-04T23:34:00Z'>23:34</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
do we have a way right now to do the mark-change-as-unspendable thing?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894440' id='515763'>
<a class='timestamp' href='#515763'><time timestamp='2016-12-04T23:34:00Z'>23:34</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
We have something that doesn&#x27;t do what we want here.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894440' id='515764'>
<a class='timestamp' href='#515764'><time timestamp='2016-12-04T23:34:00Z'>23:34</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
(lockunspent)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894500' id='515765'>
<a class='timestamp' href='#515765'><time timestamp='2016-12-04T23:35:00Z'>23:35</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
For this, I think we need to add a boolen to the wallet txn and have isfromme check that. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894560' id='515766'>
<a class='timestamp' href='#515766'><time timestamp='2016-12-04T23:36:00Z'>23:36</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Later we could have more advanced bumping logic that does the make-multiple-transaction-versions.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894620' id='515767'>
<a class='timestamp' href='#515767'><time timestamp='2016-12-04T23:37:00Z'>23:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sdaftuar: if you really think that there are many users with txn stuck never confirmed... then we really need to add a &#x27;Pending Payments&#x27; -- sum of confirmed outputs which are spent by unconfirmed transactions -- in the UI/rpc. So that people don&#x27;t discard wallets as empty when they&#x27;re really not.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894680' id='515768'>
<a class='timestamp' href='#515768'><time timestamp='2016-12-04T23:38:00Z'>23:38</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
gmaxwell: actually, maybe i am missing something.  with your proposed algorithm, what would happen if you bumpunconfirmed twice?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894740' id='515769'>
<a class='timestamp' href='#515769'><time timestamp='2016-12-04T23:39:00Z'>23:39</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
You would ignore the existing bump (it would fail the AllFrom me in step 1) and make a new bump of all the other unconfirmed transactions in your wallet.  
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894800' id='515770'>
<a class='timestamp' href='#515770'><time timestamp='2016-12-04T23:40:00Z'>23:40</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
i didn&#x27;t follow why it would fail the AllFromMe step, but if you managed to construct a new tx that didn&#x27;t conflict with the older bumped fee one, you&#x27;re screwed right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894860' id='515771'>
<a class='timestamp' href='#515771'><time timestamp='2016-12-04T23:41:00Z'>23:41</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
It would fail the all from me, because I propose the change output of the bumb be flagged specifically so that it does. ... so that under no condition wall the wallet spend it until it is 6 confirmed. Specfically to avoid having to deal with things spending it then having the originals confirm.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894920' id='515772'>
<a class='timestamp' href='#515772'><time timestamp='2016-12-04T23:42:00Z'>23:42</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
isn&#x27;t IsAllFromMe purely a function of the tx inputs?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894920' id='515773'>
<a class='timestamp' href='#515773'><time timestamp='2016-12-04T23:42:00Z'>23:42</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
The new tx doesn&#x27;t need to conflict with it, so long as it doesn&#x27;t pay to any of its outputs, which it won&#x27;t because it wasn&#x27;t included in the set of available txn. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894980' id='515774'>
<a class='timestamp' href='#515774'><time timestamp='2016-12-04T23:43:00Z'>23:43</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
i think i am pretty confused right now, why don&#x27;t i spend another day thinking about the wallet and then rejoin this conversation
<br>
</div>

<div class='talk op-msg' data-timestamp='1480894980' id='515775'>
<a class='timestamp' href='#515775'><time timestamp='2016-12-04T23:43:00Z'>23:43</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
It&#x27;s a function of the input&#x27;s outputs. Is every input an output of mine. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1480895040' id='515776'>
<a class='timestamp' href='#515776'><time timestamp='2016-12-04T23:44:00Z'>23:44</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sdaftuar: this stuff makes my head hurt too.  I really want to get some kind of bumping in ASAP, it&#x27;s hard to come up with a minimal feature...
<br>
</div>

<div class='talk op-msg' data-timestamp='1480895100' id='515777'>
<a class='timestamp' href='#515777'><time timestamp='2016-12-04T23:45:00Z'>23:45</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
one last try before i call it a night -- let&#x27;s say i have tx1, tx2, tx3 -- each one is IsAllFromMe.  i bump and create tx4, which conflicts with each, and pays all their outputs, and the change output of tx4 is specially flagged or whatever to be unspendable until it confirms.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480895100' id='515778'>
<a class='timestamp' href='#515778'><time timestamp='2016-12-04T23:45:00Z'>23:45</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
wont&#x27;t tx4 still be IsAllFromMe?
<br>
</div>

<div class='talk op-msg' data-timestamp='1480895160' id='515779'>
<a class='timestamp' href='#515779'><time timestamp='2016-12-04T23:46:00Z'>23:46</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
(actually i have to run, back later)
<br>
</div>

<div class='talk op-msg' data-timestamp='1480895220' id='515780'>
<a class='timestamp' href='#515780'><time timestamp='2016-12-04T23:47:00Z'>23:47</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Right, okay -- I should have said IsMine and IsAllFromMe  -- the flagging should make it not IsMine.
<br>
</div>

<div class='talk op-msg' data-timestamp='1480895220' id='515781'>
<a class='timestamp' href='#515781'><time timestamp='2016-12-04T23:47:00Z'>23:47</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sdaftuar: ttyl
<br>
</div>

<div class='talk op-msg' data-timestamp='1480895880' id='515782'>
<a class='timestamp' href='#515782'><time timestamp='2016-12-04T23:58:00Z'>23:58</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
gmaxwell: ok, I missed a bunch of scrollback, but hell yes...everyone wants the utxo db in their own format so that they can do other queries against it
<br>
</div>

<div class='talk op-msg' data-timestamp='1480895880' id='515783'>
<a class='timestamp' href='#515783'><time timestamp='2016-12-04T23:58:00Z'>23:58</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jtimon: no, I absolutely think we should abstract out block storage
<br>
</div>

<div class='talk op-msg' data-timestamp='1480895940' id='515784'>
<a class='timestamp' href='#515784'><time timestamp='2016-12-04T23:59:00Z'>23:59</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
jtimon: hell, the branch I sent you did that for ConnectBlock/DisconnectBlock in the first commit
<br>
</div>

<div class='talk op-msg' data-timestamp='1480895940' id='515785'>
<a class='timestamp' href='#515785'><time timestamp='2016-12-04T23:59:00Z'>23:59</time></a>
&lt;<span class='nick nick-13'> jtimon</span>&gt;
right, I said &quot;yes and yes&quot; for you
<br>
</div>

</div>
</section>

</body>
</html>
