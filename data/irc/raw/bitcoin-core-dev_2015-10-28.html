<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2015-10-28
 — 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2015-10-28' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:27 UTC</pre>
<pre><a href="/bitcoin-core-dev/2015-09-28">&lt;</a><span class='header'>   October 2015   </span><a href="/bitcoin-core-dev/2015-11-28">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;             <a class="" href="/bitcoin-core-dev/2015-10-01">1</a>  <a class="" href="/bitcoin-core-dev/2015-10-02">2</a>  <a class="" href="/bitcoin-core-dev/2015-10-03">3</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2015-10-04">4</a>  <a class="" href="/bitcoin-core-dev/2015-10-05">5</a>  <a class="" href="/bitcoin-core-dev/2015-10-06">6</a>  <a class="" href="/bitcoin-core-dev/2015-10-07">7</a>  <a class="" href="/bitcoin-core-dev/2015-10-08">8</a>  <a class="" href="/bitcoin-core-dev/2015-10-09">9</a> <a class="" href="/bitcoin-core-dev/2015-10-10">10</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2015-10-11">11</a> <a class="" href="/bitcoin-core-dev/2015-10-12">12</a> <a class="" href="/bitcoin-core-dev/2015-10-13">13</a> <a class="" href="/bitcoin-core-dev/2015-10-14">14</a> <a class="" href="/bitcoin-core-dev/2015-10-15">15</a> <a class="" href="/bitcoin-core-dev/2015-10-16">16</a> <a class="" href="/bitcoin-core-dev/2015-10-17">17</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2015-10-18">18</a> <a class="" href="/bitcoin-core-dev/2015-10-19">19</a> <a class="" href="/bitcoin-core-dev/2015-10-20">20</a> <a class="" href="/bitcoin-core-dev/2015-10-21">21</a> <a class="" href="/bitcoin-core-dev/2015-10-22">22</a> <a class="" href="/bitcoin-core-dev/2015-10-23">23</a> <a class="" href="/bitcoin-core-dev/2015-10-24">24</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2015-10-25">25</a> <a class="" href="/bitcoin-core-dev/2015-10-26">26</a> <a class="" href="/bitcoin-core-dev/2015-10-27">27</a> <a class="current" href="/bitcoin-core-dev/2015-10-28">28</a> <a class="" href="/bitcoin-core-dev/2015-10-29">29</a> <a class="" href="/bitcoin-core-dev/2015-10-30">30</a> <a class="" href="/bitcoin-core-dev/2015-10-31">31</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1445991660' id='432895'>
<a class='timestamp' href='#432895'><time timestamp='2015-10-28T00:21:00Z'>00:21</time></a>
&lt;<span class='nick nick-13'> GitHub30</span>&gt;
[bitcoin] sipa opened pull request #6895: Update to my new key (master...newkey) <a href="https://github.com/bitcoin/bitcoin/pull/6895" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6895</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445994420' id='432896'>
<a class='timestamp' href='#432896'><time timestamp='2015-10-28T01:07:00Z'>01:07</time></a>
&lt;<span class='nick nick-11'> GitHub19</span>&gt;
[bitcoin] gmaxwell pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/8f3b3cdee497...d0badb916e51" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/8f3b3cdee497...d0badb916e51</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445994420' id='432897'>
<a class='timestamp' href='#432897'><time timestamp='2015-10-28T01:07:00Z'>01:07</time></a>
&lt;<span class='nick nick-11'> GitHub19</span>&gt;
bitcoin/master 298e040 Pieter Wuille: Fix chainstate serialized_size computation
<br>
</div>

<div class='talk op-msg' data-timestamp='1445994420' id='432898'>
<a class='timestamp' href='#432898'><time timestamp='2015-10-28T01:07:00Z'>01:07</time></a>
&lt;<span class='nick nick-11'> GitHub19</span>&gt;
bitcoin/master d0badb9 Gregory Maxwell: Merge pull request #6865...
<br>
</div>

<div class='talk op-msg' data-timestamp='1445994420' id='432899'>
<a class='timestamp' href='#432899'><time timestamp='2015-10-28T01:07:00Z'>01:07</time></a>
&lt;<span class='nick nick-2'> GitHub22</span>&gt;
[bitcoin] gmaxwell closed pull request #6865: Fix chainstate serialized_size computation (master...fixchainsize) <a href="https://github.com/bitcoin/bitcoin/pull/6865" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6865</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995320' id='432900'>
<a class='timestamp' href='#432900'><time timestamp='2015-10-28T01:22:00Z'>01:22</time></a>
&lt;<span class='nick nick-2'> GitHub43</span>&gt;
[bitcoin] sipa pushed 4 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/d0badb916e51...93521a4f56ce" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/d0badb916e51...93521a4f56ce</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995320' id='432901'>
<a class='timestamp' href='#432901'><time timestamp='2015-10-28T01:22:00Z'>01:22</time></a>
&lt;<span class='nick nick-2'> GitHub43</span>&gt;
bitcoin/master 27252b7 Matt Corallo: Fix pre-push-hook regexes
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995320' id='432902'>
<a class='timestamp' href='#432902'><time timestamp='2015-10-28T01:22:00Z'>01:22</time></a>
&lt;<span class='nick nick-2'> GitHub43</span>&gt;
bitcoin/master 1d94b72 Matt Corallo: Whitelist commits signed with Pieter&#x27;s now-revoked key
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995320' id='432903'>
<a class='timestamp' href='#432903'><time timestamp='2015-10-28T01:22:00Z'>01:22</time></a>
&lt;<span class='nick nick-2'> GitHub43</span>&gt;
bitcoin/master 6e800c2 Matt Corallo: Add Pieter&#x27;s new PGP key to verify-commits/trusted-keys
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995320' id='432904'>
<a class='timestamp' href='#432904'><time timestamp='2015-10-28T01:22:00Z'>01:22</time></a>
&lt;<span class='nick nick-6'> GitHub113</span>&gt;
[bitcoin] sipa closed pull request #6875: Fix pre-push-hook regexes (master...verify-commits-fixes) <a href="https://github.com/bitcoin/bitcoin/pull/6875" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6875</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995440' id='432905'>
<a class='timestamp' href='#432905'><time timestamp='2015-10-28T01:24:00Z'>01:24</time></a>
&lt;<span class='nick nick-9'> GitHub157</span>&gt;
[bitcoin] sipa pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/93521a4f56ce...8756c986420c" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/93521a4f56ce...8756c986420c</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995440' id='432906'>
<a class='timestamp' href='#432906'><time timestamp='2015-10-28T01:24:00Z'>01:24</time></a>
&lt;<span class='nick nick-9'> GitHub157</span>&gt;
bitcoin/master 4252cd0 Pieter Wuille: Update to my new key
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995440' id='432907'>
<a class='timestamp' href='#432907'><time timestamp='2015-10-28T01:24:00Z'>01:24</time></a>
&lt;<span class='nick nick-9'> GitHub157</span>&gt;
bitcoin/master 8756c98 Pieter Wuille: Merge pull request #6895...
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995440' id='432908'>
<a class='timestamp' href='#432908'><time timestamp='2015-10-28T01:24:00Z'>01:24</time></a>
&lt;<span class='nick nick-14'> GitHub179</span>&gt;
[bitcoin] sipa closed pull request #6895: Update to my new key (master...newkey) <a href="https://github.com/bitcoin/bitcoin/pull/6895" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6895</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995500' id='432909'>
<a class='timestamp' href='#432909'><time timestamp='2015-10-28T01:25:00Z'>01:25</time></a>
&lt;<span class='nick nick-13'> GitHub93</span>&gt;
[bitcoin] sipa pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/8756c986420c...e06c14fb59ee" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/8756c986420c...e06c14fb59ee</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995500' id='432910'>
<a class='timestamp' href='#432910'><time timestamp='2015-10-28T01:25:00Z'>01:25</time></a>
&lt;<span class='nick nick-13'> GitHub93</span>&gt;
bitcoin/master ab1f560 Pieter Wuille: Support -checkmempool=N, which runs checks on average once every N transactions
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995500' id='432911'>
<a class='timestamp' href='#432911'><time timestamp='2015-10-28T01:25:00Z'>01:25</time></a>
&lt;<span class='nick nick-13'> GitHub93</span>&gt;
bitcoin/master e06c14f Pieter Wuille: Merge pull request #6776...
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995500' id='432912'>
<a class='timestamp' href='#432912'><time timestamp='2015-10-28T01:25:00Z'>01:25</time></a>
&lt;<span class='nick nick-3'> GitHub73</span>&gt;
[bitcoin] sipa closed pull request #6776: Support -checkmempool=N, which runs checks once every N transactions (master...fraccheck) <a href="https://github.com/bitcoin/bitcoin/pull/6776" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6776</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995860' id='432913'>
<a class='timestamp' href='#432913'><time timestamp='2015-10-28T01:31:00Z'>01:31</time></a>
&lt;<span class='nick nick-11'> GitHub67</span>&gt;
[bitcoin] sipa pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/e06c14fb59ee...4764f5db9d2c" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/e06c14fb59ee...4764f5db9d2c</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995860' id='432914'>
<a class='timestamp' href='#432914'><time timestamp='2015-10-28T01:31:00Z'>01:31</time></a>
&lt;<span class='nick nick-11'> GitHub67</span>&gt;
bitcoin/master 214de7e Philip Kaufmann: [Trivial] ensure minimal header conventions...
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995860' id='432915'>
<a class='timestamp' href='#432915'><time timestamp='2015-10-28T01:31:00Z'>01:31</time></a>
&lt;<span class='nick nick-11'> GitHub67</span>&gt;
bitcoin/master 4764f5d Pieter Wuille: Merge pull request #6892...
<br>
</div>

<div class='talk op-msg' data-timestamp='1445995860' id='432916'>
<a class='timestamp' href='#432916'><time timestamp='2015-10-28T01:31:00Z'>01:31</time></a>
&lt;<span class='nick nick-16'> GitHub110</span>&gt;
[bitcoin] sipa closed pull request #6892: [Trivial] ensure minimal header conventions (master...headers-new) <a href="https://github.com/bitcoin/bitcoin/pull/6892" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6892</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445996040' id='432917'>
<a class='timestamp' href='#432917'><time timestamp='2015-10-28T01:34:00Z'>01:34</time></a>
&lt;<span class='nick nick-4'> GitHub1</span>&gt;
[bitcoin] sipa pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/4764f5db9d2c...8daffe227bc6" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/4764f5db9d2c...8daffe227bc6</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445996040' id='432918'>
<a class='timestamp' href='#432918'><time timestamp='2015-10-28T01:34:00Z'>01:34</time></a>
&lt;<span class='nick nick-4'> GitHub1</span>&gt;
bitcoin/master ad5aae1 Philip Kaufmann: constify missing catch cases...
<br>
</div>

<div class='talk op-msg' data-timestamp='1445996040' id='432919'>
<a class='timestamp' href='#432919'><time timestamp='2015-10-28T01:34:00Z'>01:34</time></a>
&lt;<span class='nick nick-4'> GitHub1</span>&gt;
bitcoin/master 8daffe2 Pieter Wuille: Merge pull request #6891...
<br>
</div>

<div class='talk op-msg' data-timestamp='1445996040' id='432920'>
<a class='timestamp' href='#432920'><time timestamp='2015-10-28T01:34:00Z'>01:34</time></a>
&lt;<span class='nick nick-14'> GitHub130</span>&gt;
[bitcoin] sipa closed pull request #6891: constify missing catch cases (master...const-ex) <a href="https://github.com/bitcoin/bitcoin/pull/6891" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6891</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445997660' id='432921'>
<a class='timestamp' href='#432921'><time timestamp='2015-10-28T02:01:00Z'>02:01</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Oh I think I know one reason we see corruption reports on windows.
<br>
</div>

<div class='talk op-msg' data-timestamp='1445997720' id='432922'>
<a class='timestamp' href='#432922'><time timestamp='2015-10-28T02:02:00Z'>02:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Stopnode often takes an awful long time, for example on my laptop running defaults it just took 12 seconds.  In windows, on shutdown, tasks that don&#x27;t stop pretty much immediately get killed.
<br>
</div>

<div class='talk op-msg' data-timestamp='1445997720' id='432923'>
<a class='timestamp' href='#432923'><time timestamp='2015-10-28T02:02:00Z'>02:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
thats probably a maximally bad case for leveldb as it&#x27;ll be in the middle of flushing out a bunch of cached updates.
<br>
</div>

<div class='talk op-msg' data-timestamp='1445998200' id='432924'>
<a class='timestamp' href='#432924'><time timestamp='2015-10-28T02:10:00Z'>02:10</time></a>
&lt;<span class='nick nick-13'> GitHub4</span>&gt;
[bitcoin] sipa opened pull request #6896: Make -checkmempool=1 not fail through int32 overflow (master...fixchainsize) <a href="https://github.com/bitcoin/bitcoin/pull/6896" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6896</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1445999700' id='432925'>
<a class='timestamp' href='#432925'><time timestamp='2015-10-28T02:35:00Z'>02:35</time></a>
&lt;<span class='nick nick-9'> tripleslash</span>&gt;
gmaxwell: its specifically HungAppTimeout and is defaulted to 5 seconds.
<br>
</div>

<div class='talk op-msg' data-timestamp='1445999880' id='432926'>
<a class='timestamp' href='#432926'><time timestamp='2015-10-28T02:38:00Z'>02:38</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
test_bitcoin hangs for me a decent fraction of the time.  It looks like it gets stuck at line 109 in scheduler_tests.cpp
<br>
</div>

<div class='talk op-msg' data-timestamp='1446000960' id='432927'>
<a class='timestamp' href='#432927'><time timestamp='2015-10-28T02:56:00Z'>02:56</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
ah, i see it is an issue, #6540
<br>
</div>

<div class='talk op-msg' data-timestamp='1446019980' id='432928'>
<a class='timestamp' href='#432928'><time timestamp='2015-10-28T08:13:00Z'>08:13</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
gmaxwell: that will likely contribute to it, although most of the time corruption seems to happen on crashes / power failures, when there is no time to flush at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1446020820' id='432929'>
<a class='timestamp' href='#432929'><time timestamp='2015-10-28T08:27:00Z'>08:27</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
but if that is the case too then the flush+sync on windows is not essentially not working at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1446020820' id='432930'>
<a class='timestamp' href='#432930'><time timestamp='2015-10-28T08:27:00Z'>08:27</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
-first not
<br>
</div>

<div class='talk op-msg' data-timestamp='1446021600' id='432931'>
<a class='timestamp' href='#432931'><time timestamp='2015-10-28T08:40:00Z'>08:40</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
someone was commenting that we were writing via mmap on windows and that the sync we were using there didn&#x27;t work on maps; which sounds like the mac problem. I didn&#x27;t verify these claims at all.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446023460' id='432932'>
<a class='timestamp' href='#432932'><time timestamp='2015-10-28T09:11:00Z'>09:11</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
didn&#x27;t check that either
<br>
</div>

<div class='talk op-msg' data-timestamp='1446026580' id='432933'>
<a class='timestamp' href='#432933'><time timestamp='2015-10-28T10:03:00Z'>10:03</time></a>
&lt;<span class='nick nick-3'> dcousens</span>&gt;
wumpus: aye, 1 OOM and my chain was broke
<br>
</div>

<div class='talk op-msg' data-timestamp='1446044100' id='432934'>
<a class='timestamp' href='#432934'><time timestamp='2015-10-28T14:55:00Z'>14:55</time></a>
&lt;<span class='nick nick-8'> jcorgan</span>&gt;
cfields: did you ever make progress on #6681?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446044280' id='432935'>
<a class='timestamp' href='#432935'><time timestamp='2015-10-28T14:58:00Z'>14:58</time></a>
&lt;<span class='nick nick-8'> jcorgan</span>&gt;
i guess that would be #6819 now
<br>
</div>

<div class='talk op-msg' data-timestamp='1446045360' id='432936'>
<a class='timestamp' href='#432936'><time timestamp='2015-10-28T15:16:00Z'>15:16</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
jcorgan: no, i stopped there. I just wanted to get it building so that someone who knows zmq could make it actually work
<br>
</div>

<div class='talk op-msg' data-timestamp='1446045720' id='432937'>
<a class='timestamp' href='#432937'><time timestamp='2015-10-28T15:22:00Z'>15:22</time></a>
&lt;<span class='nick nick-8'> jcorgan</span>&gt;
got it
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054420' id='432938'>
<a class='timestamp' href='#432938'><time timestamp='2015-10-28T17:47:00Z'>17:47</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: For this fast template generation on new block code.  Are you envisioning you switch to a new empty template after a new most work header?  Even if you haven&#x27;t validated the block you&#x27;re connecting yet?  And then set some sort of timeout with which you&#x27;ll switch back to not being willing to build off a headers only chain?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054480' id='432939'>
<a class='timestamp' href='#432939'><time timestamp='2015-10-28T17:48:00Z'>17:48</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Once you&#x27;ve connected a new block, I&#x27;d say there is no reason not to wait the extra few ms to generate a block template with txs in it.  Which can then be validated after its already been served to you.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054540' id='432940'>
<a class='timestamp' href='#432940'><time timestamp='2015-10-28T17:49:00Z'>17:49</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
No I was not. This is less safe than many people think it is, and I think not needed if the other details are handled correctly.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054540' id='432941'>
<a class='timestamp' href='#432941'><time timestamp='2015-10-28T17:49:00Z'>17:49</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Well thats where all the delay is right?  Receiving and connecting the new best block.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054540' id='432942'>
<a class='timestamp' href='#432942'><time timestamp='2015-10-28T17:49:00Z'>17:49</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
how about building a new template, switching to working on it immediately, and then starting a validation for it
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054600' id='432943'>
<a class='timestamp' href='#432943'><time timestamp='2015-10-28T17:50:00Z'>17:50</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
sipa: yes thats what i&#x27;m suggesting.  but thats after you&#x27;ve connected the best block.  if we&#x27;re still requiring to wait for that, don&#x27;t we think people will choose to short circuit it less safely on their own
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054600' id='432944'>
<a class='timestamp' href='#432944'><time timestamp='2015-10-28T17:50:00Z'>17:50</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: No, CNB latency is tens of times slower than validating normally.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054660' id='432945'>
<a class='timestamp' href='#432945'><time timestamp='2015-10-28T17:51:00Z'>17:51</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: ok, i&#x27;ll give you multiples, but probably less than 10x unless your mempool is really really big.  and thats just compared to validating, what about waiting to receive?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054720' id='432946'>
<a class='timestamp' href='#432946'><time timestamp='2015-10-28T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
i haven&#x27;t looked at the time delay from receiving most work header to finishing connecting the block, any idea what that is typically?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054720' id='432947'>
<a class='timestamp' href='#432947'><time timestamp='2015-10-28T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
i bet its long
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054720' id='432948'>
<a class='timestamp' href='#432948'><time timestamp='2015-10-28T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
When the relay network is working normally about 80% of blocks are transmitted in a single packet.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054720' id='432949'>
<a class='timestamp' href='#432949'><time timestamp='2015-10-28T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
ah yes, forgot about relay network
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054720' id='432950'>
<a class='timestamp' href='#432950'><time timestamp='2015-10-28T17:52:00Z'>17:52</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
thats why i ask questions
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054780' id='432951'>
<a class='timestamp' href='#432951'><time timestamp='2015-10-28T17:53:00Z'>17:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it still makes sense to have numbers for the time between receive inv and CNB building a template on top
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054780' id='432952'>
<a class='timestamp' href='#432952'><time timestamp='2015-10-28T17:53:00Z'>17:53</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Most of the delays in mining right now appear to be from outside of bitcoin core, actually.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054840' id='432953'>
<a class='timestamp' href='#432953'><time timestamp='2015-10-28T17:54:00Z'>17:54</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
sipa in a relay node connected case or regular node or both
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054840' id='432954'>
<a class='timestamp' href='#432954'><time timestamp='2015-10-28T17:54:00Z'>17:54</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
morcos: in &quot;reality&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054840' id='432955'>
<a class='timestamp' href='#432955'><time timestamp='2015-10-28T17:54:00Z'>17:54</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
:)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054900' id='432956'>
<a class='timestamp' href='#432956'><time timestamp='2015-10-28T17:55:00Z'>17:55</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
ok, well i&#x27;m almost ready to push a WIP branch.  it still doesn&#x27;t do it in a thread, but the gain is really rather limited at this point, and i&#x27;ll save that i think for a second pull
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054900' id='432957'>
<a class='timestamp' href='#432957'><time timestamp='2015-10-28T17:55:00Z'>17:55</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
but the question i want to resolve is what to do when TestBlockValidity fails
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054900' id='432958'>
<a class='timestamp' href='#432958'><time timestamp='2015-10-28T17:55:00Z'>17:55</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
right now it throws an error
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054900' id='432959'>
<a class='timestamp' href='#432959'><time timestamp='2015-10-28T17:55:00Z'>17:55</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
hm. we&#x27;ve done something recently that slowed down connectblock (or the network behavior changes have)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054900' id='432960'>
<a class='timestamp' href='#432960'><time timestamp='2015-10-28T17:55:00Z'>17:55</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
oh dear
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054900' id='432961'>
<a class='timestamp' href='#432961'><time timestamp='2015-10-28T17:55:00Z'>17:55</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
connectblock has always been slow since i&#x27;ve measured it
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054960' id='432962'>
<a class='timestamp' href='#432962'><time timestamp='2015-10-28T17:56:00Z'>17:56</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
debug.log:2015-10-28 16:11:38 - Connect block: 7256.55ms [7475.14s]
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054960' id='432963'>
<a class='timestamp' href='#432963'><time timestamp='2015-10-28T17:56:00Z'>17:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
how much is fetching inputs vs verifying inputs?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446054960' id='432964'>
<a class='timestamp' href='#432964'><time timestamp='2015-10-28T17:56:00Z'>17:56</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
wtf.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055020' id='432965'>
<a class='timestamp' href='#432965'><time timestamp='2015-10-28T17:57:00Z'>17:57</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
since my node here&#x27;s last update to master connect block&#x27;s time has increased monotonically for every block.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055080' id='432966'>
<a class='timestamp' href='#432966'><time timestamp='2015-10-28T17:58:00Z'>17:58</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: coincache being thrown out my mempool bloat?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055140' id='432967'>
<a class='timestamp' href='#432967'><time timestamp='2015-10-28T17:59:00Z'>17:59</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell, what block hash was that?  
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055260' id='432968'>
<a class='timestamp' href='#432968'><time timestamp='2015-10-28T18:01:00Z'>18:01</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: are you still running mempool.check?  it runs inside that timer
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055260' id='432969'>
<a class='timestamp' href='#432969'><time timestamp='2015-10-28T18:01:00Z'>18:01</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: before this latest rounds of attack this node was taking &lt;100ms to connect block.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055260' id='432970'>
<a class='timestamp' href='#432970'><time timestamp='2015-10-28T18:01:00Z'>18:01</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: must be the mempool checks then.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055320' id='432971'>
<a class='timestamp' href='#432971'><time timestamp='2015-10-28T18:02:00Z'>18:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: it&#x27;s all of them.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055320' id='432972'>
<a class='timestamp' href='#432972'><time timestamp='2015-10-28T18:02:00Z'>18:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: turning on mempool checks are a certain way to blow away your cache every block
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055320' id='432973'>
<a class='timestamp' href='#432973'><time timestamp='2015-10-28T18:02:00Z'>18:02</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
the blocks around that time for me took 500ms and then 1ms (only coinbase)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055440' id='432974'>
<a class='timestamp' href='#432974'><time timestamp='2015-10-28T18:04:00Z'>18:04</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
in any case, debug logs ran this thing out of space a couple hours ago, so I&#x27;ve restarted it. I&#x27;ll run without mempool checks to get some good timings.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055500' id='432975'>
<a class='timestamp' href='#432975'><time timestamp='2015-10-28T18:05:00Z'>18:05</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Numers I posted from shortly before the MTL event were about 80ms.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055560' id='432976'>
<a class='timestamp' href='#432976'><time timestamp='2015-10-28T18:06:00Z'>18:06</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
80ms?? hmm...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055620' id='432977'>
<a class='timestamp' href='#432977'><time timestamp='2015-10-28T18:07:00Z'>18:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so with a 200 MB mempool i seem to need a 700-1200 MB coincache
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055620' id='432978'>
<a class='timestamp' href='#432978'><time timestamp='2015-10-28T18:07:00Z'>18:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
with matt&#x27;s latest patch
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055740' id='432979'>
<a class='timestamp' href='#432979'><time timestamp='2015-10-28T18:09:00Z'>18:09</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i wonder if we should (as a short term hack) treat some factor of the size-of-pulled-in-memory of a tx as its txsize
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055860' id='432980'>
<a class='timestamp' href='#432980'><time timestamp='2015-10-28T18:11:00Z'>18:11</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell:  i looked at some old numbers of mine (couple of months ago) and they were like 500ms on average (during fairly busy time, mid July)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055860' id='432981'>
<a class='timestamp' href='#432981'><time timestamp='2015-10-28T18:11:00Z'>18:11</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: Interesting!
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055920' id='432982'>
<a class='timestamp' href='#432982'><time timestamp='2015-10-28T18:12:00Z'>18:12</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
sipa: so what do you mean &quot;need&quot;?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055980' id='432983'>
<a class='timestamp' href='#432983'><time timestamp='2015-10-28T18:13:00Z'>18:13</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
a 200MB mempool isn&#x27;t really the right measure right
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055980' id='432984'>
<a class='timestamp' href='#432984'><time timestamp='2015-10-28T18:13:00Z'>18:13</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
morcos: how do you mean?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446055980' id='432985'>
<a class='timestamp' href='#432985'><time timestamp='2015-10-28T18:13:00Z'>18:13</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
because as you go from 0 - 200MB you&#x27;ll pull in a certain amount of txin&#x27;s.  but as you keep running, youre mempool stays at 200MB, but you&#x27;ll i think tend to pull in more txin&#x27;s?   or does matt&#x27;s patch actually remove txin&#x27;s no longer requested when a tx gets mined?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056040' id='432986'>
<a class='timestamp' href='#432986'><time timestamp='2015-10-28T18:14:00Z'>18:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
when a tx gets mined it goes into the cache with dirty bit on
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056100' id='432987'>
<a class='timestamp' href='#432987'><time timestamp='2015-10-28T18:15:00Z'>18:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so it can&#x27;t be removed from the cache anymore
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056100' id='432988'>
<a class='timestamp' href='#432988'><time timestamp='2015-10-28T18:15:00Z'>18:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
until a flush
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056100' id='432989'>
<a class='timestamp' href='#432989'><time timestamp='2015-10-28T18:15:00Z'>18:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but just a 700 MB coincache sounds pretty painful already
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056160' id='432990'>
<a class='timestamp' href='#432990'><time timestamp='2015-10-28T18:16:00Z'>18:16</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
yes i think 700MB is pretty painful, but we need to think a bit about how to be smarter about it
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056220' id='432991'>
<a class='timestamp' href='#432991'><time timestamp='2015-10-28T18:17:00Z'>18:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
per-txout cache...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056280' id='432992'>
<a class='timestamp' href='#432992'><time timestamp='2015-10-28T18:18:00Z'>18:18</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
yeah if it was pertxout, then you&#x27;d solve that problem
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056280' id='432993'>
<a class='timestamp' href='#432993'><time timestamp='2015-10-28T18:18:00Z'>18:18</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
every so often you don&#x27;t flush your cache, you just write out the dirty entries
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056340' id='432994'>
<a class='timestamp' href='#432994'><time timestamp='2015-10-28T18:19:00Z'>18:19</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
we could still do that now, except we don&#x27;t know if that tx should still be in cache b/c of other mempool txs
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056340' id='432995'>
<a class='timestamp' href='#432995'><time timestamp='2015-10-28T18:19:00Z'>18:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
well an lru or random eviction of the utxo set could work too
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056340' id='432996'>
<a class='timestamp' href='#432996'><time timestamp='2015-10-28T18:19:00Z'>18:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the cache would just become less effective
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056700' id='432997'>
<a class='timestamp' href='#432997'><time timestamp='2015-10-28T18:25:00Z'>18:25</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
so when we flush the cache, we have to write everything correct?  so its consistent.  i think if we could jsut get smarter about what we wiped from the cache at that point, then maybe we could jsut flush a lot more often, or do you think that would be bad.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056760' id='432998'>
<a class='timestamp' href='#432998'><time timestamp='2015-10-28T18:26:00Z'>18:26</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes, a flush shouldn&#x27;t wipe everything
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056760' id='432999'>
<a class='timestamp' href='#432999'><time timestamp='2015-10-28T18:26:00Z'>18:26</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
tell me if this would be too cumbersome.  i think it might be pretty fast, how long does a flush take?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446056820' id='433000'>
<a class='timestamp' href='#433000'><time timestamp='2015-10-28T18:27:00Z'>18:27</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
after you write everything, you quickly scan the top 10MB of txs in the mempool, and insert all of their txin.prevout.hash&#x27;s into a set, and then you iterate throught the cachemap erasing anything thats not one of those
<br>
</div>

<div class='talk op-msg' data-timestamp='1446057180' id='433001'>
<a class='timestamp' href='#433001'><time timestamp='2015-10-28T18:33:00Z'>18:33</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
so actually flushing takes over a second right?  i think you might be able to do something like i suggested on the order of 10&#x27;s of ms, but not sure
<br>
</div>

<div class='talk op-msg' data-timestamp='1446057360' id='433002'>
<a class='timestamp' href='#433002'><time timestamp='2015-10-28T18:36:00Z'>18:36</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
i don&#x27;t know if it&#x27;s bad (or maybe its even good) to flush more regularly.  but if we did something like that, we wouldn&#x27;t even need to worry about matt&#x27;s patch.  we could just &quot;flush&quot; every time the cache was getting too big.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446058260' id='433003'>
<a class='timestamp' href='#433003'><time timestamp='2015-10-28T18:51:00Z'>18:51</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
re: TestBlockValidity failing.  I think I&#x27;m going to log an error and return NULL.  Seems better than throwing an error.  I&#x27;d like to reuse FormatStateMessage (in main.cpp), should I move it to a different file, or just declare it in main.h?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065640' id='433004'>
<a class='timestamp' href='#433004'><time timestamp='2015-10-28T20:54:00Z'>20:54</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
morcos: ⁇? if the block is invalid you do NOT want to use the template ever
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065700' id='433005'>
<a class='timestamp' href='#433005'><time timestamp='2015-10-28T20:55:00Z'>20:55</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
morcos: pretty sure you would entirely break proposals too
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065700' id='433006'>
<a class='timestamp' href='#433006'><time timestamp='2015-10-28T20:55:00Z'>20:55</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Luke-Jr: I know you don&#x27;t want to use it, the question is how to handle that case.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065760' id='433007'>
<a class='timestamp' href='#433007'><time timestamp='2015-10-28T20:56:00Z'>20:56</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
It means code is broken somewhere, so human intervention is going to be required at some point
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065760' id='433008'>
<a class='timestamp' href='#433008'><time timestamp='2015-10-28T20:56:00Z'>20:56</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
The existing code would have thrown an error.  I chose to return NULL and log the error (which will cause getblocktemplate to throw a now misnamed JSONRPC error)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065820' id='433009'>
<a class='timestamp' href='#433009'><time timestamp='2015-10-28T20:57:00Z'>20:57</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Another option would be to try to return a template with no tx&#x27;s instead (since the likely bug is mempool consistency was broken)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065820' id='433010'>
<a class='timestamp' href='#433010'><time timestamp='2015-10-28T20:57:00Z'>20:57</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
I&#x27;m about to PR as a WIP... , would be great if you want to take a look
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065880' id='433011'>
<a class='timestamp' href='#433011'><time timestamp='2015-10-28T20:58:00Z'>20:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: I vaguly recall something that if createnewblock can fail there is a crash elsewher.e
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065880' id='433012'>
<a class='timestamp' href='#433012'><time timestamp='2015-10-28T20:58:00Z'>20:58</time></a>
&lt;<span class='nick nick-1'> GitHub181</span>&gt;
[bitcoin] morcos opened pull request #6898: [WIP] Rewrite CreateNewBlock (master...fasterCNB) <a href="https://github.com/bitcoin/bitcoin/pull/6898" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6898</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065880' id='433013'>
<a class='timestamp' href='#433013'><time timestamp='2015-10-28T20:58:00Z'>20:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
or maybe I also fixed that in anticipation of people making it possible to fail again.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065940' id='433014'>
<a class='timestamp' href='#433014'><time timestamp='2015-10-28T20:59:00Z'>20:59</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
It took a long time to make it produce the exact same blocks as the old code, but helped work out a couple of bugs.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446065940' id='433015'>
<a class='timestamp' href='#433015'><time timestamp='2015-10-28T20:59:00Z'>20:59</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
IMO human intervention is preferable to silently mining empty blocks
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066000' id='433016'>
<a class='timestamp' href='#433016'><time timestamp='2015-10-28T21:00:00Z'>21:00</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
and debug.log is not non-silent
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066000' id='433017'>
<a class='timestamp' href='#433017'><time timestamp='2015-10-28T21:00:00Z'>21:00</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Most miners will never see anything in debug.log.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066000' id='433018'>
<a class='timestamp' href='#433018'><time timestamp='2015-10-28T21:00:00Z'>21:00</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
I really hate the ugliness around hacking in the ability to still do priority space in the blocks.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066000' id='433019'>
<a class='timestamp' href='#433019'><time timestamp='2015-10-28T21:00:00Z'>21:00</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
morcos: if that requires ugliness, the old code was better ?/
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066000' id='433020'>
<a class='timestamp' href='#433020'><time timestamp='2015-10-28T21:00:00Z'>21:00</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
:\
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066060' id='433021'>
<a class='timestamp' href='#433021'><time timestamp='2015-10-28T21:01:00Z'>21:01</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
well, I&#x27;d call the old code ugly as well.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066060' id='433022'>
<a class='timestamp' href='#433022'><time timestamp='2015-10-28T21:01:00Z'>21:01</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Luke-Jr: the old code is very ugly.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066060' id='433023'>
<a class='timestamp' href='#433023'><time timestamp='2015-10-28T21:01:00Z'>21:01</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
slow != ugly
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066060' id='433024'>
<a class='timestamp' href='#433024'><time timestamp='2015-10-28T21:01:00Z'>21:01</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Also I didn&#x27;t clean up the whole thing, I just am putting this out there for proof of concept.  
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066120' id='433025'>
<a class='timestamp' href='#433025'><time timestamp='2015-10-28T21:02:00Z'>21:02</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
but I cant see the new code to compare yet..
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066180' id='433026'>
<a class='timestamp' href='#433026'><time timestamp='2015-10-28T21:03:00Z'>21:03</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Luke-Jr: the big problem is priority is very difficult to calculate
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066240' id='433027'>
<a class='timestamp' href='#433027'><time timestamp='2015-10-28T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
? no
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066240' id='433028'>
<a class='timestamp' href='#433028'><time timestamp='2015-10-28T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
If there is a consensus that its an important metric to keep, then I think we should #6357 which would make it much faster to calculate the correct priority in the mining code
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066240' id='433029'>
<a class='timestamp' href='#433029'><time timestamp='2015-10-28T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
however it&#x27;ll still be impossible to keep a sort based on it (i think)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066300' id='433030'>
<a class='timestamp' href='#433030'><time timestamp='2015-10-28T21:05:00Z'>21:05</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
it changes!
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066300' id='433031'>
<a class='timestamp' href='#433031'><time timestamp='2015-10-28T21:05:00Z'>21:05</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
you need to lookup the inputs anyway
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066300' id='433032'>
<a class='timestamp' href='#433032'><time timestamp='2015-10-28T21:05:00Z'>21:05</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
not anymore
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066360' id='433033'>
<a class='timestamp' href='#433033'><time timestamp='2015-10-28T21:06:00Z'>21:06</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
but even if you do, the biggest problem i see with the old code, is that you have to look up the inputs for ALL the txs in your mempool
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066360' id='433034'>
<a class='timestamp' href='#433034'><time timestamp='2015-10-28T21:06:00Z'>21:06</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
not just the ones you&#x27;re putting in a block
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066360' id='433035'>
<a class='timestamp' href='#433035'><time timestamp='2015-10-28T21:06:00Z'>21:06</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
hmm
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066360' id='433036'>
<a class='timestamp' href='#433036'><time timestamp='2015-10-28T21:06:00Z'>21:06</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
and if you&#x27;re going to do a priority portion of the block, you have to keep doing that
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066420' id='433037'>
<a class='timestamp' href='#433037'><time timestamp='2015-10-28T21:07:00Z'>21:07</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
resorting once per block seems reasonable imo?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066420' id='433038'>
<a class='timestamp' href='#433038'><time timestamp='2015-10-28T21:07:00Z'>21:07</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
although maybe the dynamic priority calculation would fix that, i haven&#x27;t looked at it in a while..   and maybe it could be made even easier now with the concept of mempool children
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066480' id='433039'>
<a class='timestamp' href='#433039'><time timestamp='2015-10-28T21:08:00Z'>21:08</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Luke-Jr: you&#x27;re right, that would be the way to improve this code if priority isn&#x27;t going away
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066540' id='433040'>
<a class='timestamp' href='#433040'><time timestamp='2015-10-28T21:09:00Z'>21:09</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
morcos: I still plan to redo all this btw :p
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066540' id='433041'>
<a class='timestamp' href='#433041'><time timestamp='2015-10-28T21:09:00Z'>21:09</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
keep an index (either part of the multi-index or separate) of all the priorities sorted, and only update it once per block
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066540' id='433042'>
<a class='timestamp' href='#433042'><time timestamp='2015-10-28T21:09:00Z'>21:09</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
yeah me too! :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066540' id='433043'>
<a class='timestamp' href='#433043'><time timestamp='2015-10-28T21:09:00Z'>21:09</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
so the mempool is a list of block templates
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066600' id='433044'>
<a class='timestamp' href='#433044'><time timestamp='2015-10-28T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
but i was hoping we might be able to get something simple&#x27;ish done for 0.12, which would make GBT run a lot faster.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066600' id='433045'>
<a class='timestamp' href='#433045'><time timestamp='2015-10-28T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: the input look up problem exists for fees too. :(
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066600' id='433046'>
<a class='timestamp' href='#433046'><time timestamp='2015-10-28T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: they are already stored in CTxMemPoolEntries
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066600' id='433047'>
<a class='timestamp' href='#433047'><time timestamp='2015-10-28T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
and now i addded sigops to that too
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066600' id='433048'>
<a class='timestamp' href='#433048'><time timestamp='2015-10-28T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Oh I see right fees can be cached but priority cannot. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066600' id='433049'>
<a class='timestamp' href='#433049'><time timestamp='2015-10-28T21:10:00Z'>21:10</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
right
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066660' id='433050'>
<a class='timestamp' href='#433050'><time timestamp='2015-10-28T21:11:00Z'>21:11</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
priority is our best metric right now I think, so I wouldnt want to lose ikt even temporarily
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066720' id='433051'>
<a class='timestamp' href='#433051'><time timestamp='2015-10-28T21:12:00Z'>21:12</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
best metric for what?  why do you think its better than fees?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066720' id='433052'>
<a class='timestamp' href='#433052'><time timestamp='2015-10-28T21:12:00Z'>21:12</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Luke-Jr: I don&#x27;t really agree there. Priority works fine for you and I, I don&#x27;t think he serves most users all that well.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066780' id='433053'>
<a class='timestamp' href='#433053'><time timestamp='2015-10-28T21:13:00Z'>21:13</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
morcos: spammers are happy to pay fees
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066780' id='433054'>
<a class='timestamp' href='#433054'><time timestamp='2015-10-28T21:13:00Z'>21:13</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Luke-Jr: yeah i actually agree its a pretty good anti-spam mechanism
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066780' id='433055'>
<a class='timestamp' href='#433055'><time timestamp='2015-10-28T21:13:00Z'>21:13</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
but thats not how we use it now!
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066840' id='433056'>
<a class='timestamp' href='#433056'><time timestamp='2015-10-28T21:14:00Z'>21:14</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
we do both now
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066840' id='433057'>
<a class='timestamp' href='#433057'><time timestamp='2015-10-28T21:14:00Z'>21:14</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
gmaxwell: imo thats why it isnt <b>*exclusively*</b> priority
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066840' id='433058'>
<a class='timestamp' href='#433058'><time timestamp='2015-10-28T21:14:00Z'>21:14</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Luke-Jr: point was spam goes through currently. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066840' id='433059'>
<a class='timestamp' href='#433059'><time timestamp='2015-10-28T21:14:00Z'>21:14</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Luke-Jr: there is also the problem of incentives
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066900' id='433060'>
<a class='timestamp' href='#433060'><time timestamp='2015-10-28T21:15:00Z'>21:15</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
gmaxwell: not via priority…?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066900' id='433061'>
<a class='timestamp' href='#433061'><time timestamp='2015-10-28T21:15:00Z'>21:15</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
how do you make miners prefer priority vs fee
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066900' id='433062'>
<a class='timestamp' href='#433062'><time timestamp='2015-10-28T21:15:00Z'>21:15</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
morcos: you dont
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066960' id='433063'>
<a class='timestamp' href='#433063'><time timestamp='2015-10-28T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
wumpus, i haven&#x27;t forgotten about getting you a copy of a corrupted datadir btw
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066960' id='433064'>
<a class='timestamp' href='#433064'><time timestamp='2015-10-28T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
longterm fees are the only realistic metric
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066960' id='433065'>
<a class='timestamp' href='#433065'><time timestamp='2015-10-28T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
Luke-Jr: so you view priority as like an HOV lane.  at least some txs will sneak past even if the spam is causing congestion on most of the block
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066960' id='433066'>
<a class='timestamp' href='#433066'><time timestamp='2015-10-28T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
but for now we want to try to keep fees low
<br>
</div>

<div class='talk op-msg' data-timestamp='1446066960' id='433067'>
<a class='timestamp' href='#433067'><time timestamp='2015-10-28T21:16:00Z'>21:16</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: and it does have that effect.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067020' id='433068'>
<a class='timestamp' href='#433068'><time timestamp='2015-10-28T21:17:00Z'>21:17</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
morcos: basically
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067020' id='433069'>
<a class='timestamp' href='#433069'><time timestamp='2015-10-28T21:17:00Z'>21:17</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
also a nice fallback
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067020' id='433070'>
<a class='timestamp' href='#433070'><time timestamp='2015-10-28T21:17:00Z'>21:17</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: if we care about preserving that, why don&#x27;t we just redefine priority, to be your priority at the time the tx was accepted
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067020' id='433071'>
<a class='timestamp' href='#433071'><time timestamp='2015-10-28T21:17:00Z'>21:17</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
then it can be cached and its easy to reason about and who cares if different nodes/miners calculate it differently
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067020' id='433072'>
<a class='timestamp' href='#433072'><time timestamp='2015-10-28T21:17:00Z'>21:17</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
as long as we have priority, every tx can get confirmed <b>*eventually*</b>
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067020' id='433073'>
<a class='timestamp' href='#433073'><time timestamp='2015-10-28T21:17:00Z'>21:17</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: we could expect then it&#x27;ll turn into dead weight in the mempool.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067080' id='433074'>
<a class='timestamp' href='#433074'><time timestamp='2015-10-28T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
oh sorry, thats not what i mean
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067080' id='433075'>
<a class='timestamp' href='#433075'><time timestamp='2015-10-28T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
t
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067080' id='433076'>
<a class='timestamp' href='#433076'><time timestamp='2015-10-28T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
i meant the priority only depends on your inputs that were confirmed at the time you were accpeted
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067080' id='433077'>
<a class='timestamp' href='#433077'><time timestamp='2015-10-28T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
so its still a bit complicated, but way less than currently
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067140' id='433078'>
<a class='timestamp' href='#433078'><time timestamp='2015-10-28T21:19:00Z'>21:19</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
a better question is, why would miners use priority?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067140' id='433079'>
<a class='timestamp' href='#433079'><time timestamp='2015-10-28T21:19:00Z'>21:19</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I think that would be fine.  Then it only needs to update by some ratio of the size, I guess.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067140' id='433080'>
<a class='timestamp' href='#433080'><time timestamp='2015-10-28T21:19:00Z'>21:19</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
that may work good enough as a temporary thing
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067140' id='433081'>
<a class='timestamp' href='#433081'><time timestamp='2015-10-28T21:19:00Z'>21:19</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
phantomcircuit: already had that minidiscussion scroll up
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067260' id='433082'>
<a class='timestamp' href='#433082'><time timestamp='2015-10-28T21:21:00Z'>21:21</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: but yeah, i mean even easier, lets just make it not age once its in your mempool.  if you guessed wrong and it doesn&#x27;t get confirmed soonish, then you resubmit after it expires (currently 72 hours)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067320' id='433083'>
<a class='timestamp' href='#433083'><time timestamp='2015-10-28T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
morcos: maybe have a post-block resort for new confirmed inputs optionally enabled in conf file
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067320' id='433084'>
<a class='timestamp' href='#433084'><time timestamp='2015-10-28T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
just in case it turns out bad
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067320' id='433085'>
<a class='timestamp' href='#433085'><time timestamp='2015-10-28T21:22:00Z'>21:22</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
re solrt I mean
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067380' id='433086'>
<a class='timestamp' href='#433086'><time timestamp='2015-10-28T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
re sort sorry
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067380' id='433087'>
<a class='timestamp' href='#433087'><time timestamp='2015-10-28T21:23:00Z'>21:23</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: thats a little obnoxious, in that if it doesn&#x27;t make it in the first block then immediately anything new added has an advantage. Maybe it okay?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067500' id='433088'>
<a class='timestamp' href='#433088'><time timestamp='2015-10-28T21:25:00Z'>21:25</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: yeah i think its a tradeoff.  the annoying thing however is i&#x27;m not sure you can combine it into one score very easily and still have it serve the purpose you want it to serve
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067500' id='433089'>
<a class='timestamp' href='#433089'><time timestamp='2015-10-28T21:25:00Z'>21:25</time></a>
&lt;<span class='nick nick-2'> Luke-Jr</span>&gt;
afk
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067560' id='433090'>
<a class='timestamp' href='#433090'><time timestamp='2015-10-28T21:26:00Z'>21:26</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I supposed if we cared more we could have a background task that just goes and recosts them from time to time.,
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067560' id='433091'>
<a class='timestamp' href='#433091'><time timestamp='2015-10-28T21:26:00Z'>21:26</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
presumably we&#x27;re doing some kind of linear scan for the expiration? (I haven&#x27;t kept up with the latest changes)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446067980' id='433092'>
<a class='timestamp' href='#433092'><time timestamp='2015-10-28T21:33:00Z'>21:33</time></a>
&lt;<span class='nick nick-11'> morcos</span>&gt;
gmaxwell: expiration?  oh no, there is an entry time index as well.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446069300' id='433093'>
<a class='timestamp' href='#433093'><time timestamp='2015-10-28T21:55:00Z'>21:55</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
gmaxwell, im seeing ~200ms on average for Connect total on my server for the last two months
<br>
</div>

<div class='talk op-msg' data-timestamp='1446069600' id='433094'>
<a class='timestamp' href='#433094'><time timestamp='2015-10-28T22:00:00Z'>22:00</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
morcos: so... perhaps another way to handle priority is to maintain a seperate very small mempool for it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446069600' id='433095'>
<a class='timestamp' href='#433095'><time timestamp='2015-10-28T22:00:00Z'>22:00</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
so then the cost of having to update and resort the &#x27;whole mempool&#x27; is not very lage.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446069600' id='433096'>
<a class='timestamp' href='#433096'><time timestamp='2015-10-28T22:00:00Z'>22:00</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
er large*
<br>
</div>

<div class='talk op-msg' data-timestamp='1446070560' id='433097'>
<a class='timestamp' href='#433097'><time timestamp='2015-10-28T22:16:00Z'>22:16</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
gmaxwell, why not just mark transaction sin the mempool as dirty when there&#x27;s a new block and update the priority in a background thread?
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072000' id='433098'>
<a class='timestamp' href='#433098'><time timestamp='2015-10-28T22:40:00Z'>22:40</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
I&#x27;m probably wasting my time, but I&#x27;m writing a more (space) efficient std::vector drop-in replacement
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072060' id='433099'>
<a class='timestamp' href='#433099'><time timestamp='2015-10-28T22:41:00Z'>22:41</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
a vector has an average overhead of 40 bytes currently...
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072120' id='433100'>
<a class='timestamp' href='#433100'><time timestamp='2015-10-28T22:42:00Z'>22:42</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: probably; ... maybe a more useful thing to do is to find things using vectors for small amounts of data and make them not use vectors. :P
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072120' id='433101'>
<a class='timestamp' href='#433101'><time timestamp='2015-10-28T22:42:00Z'>22:42</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: question;  I can&#x27;t figure out why we would need to cache failing signatures at all:  rationale: constructing a new novel failing signature is free.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072120' id='433102'>
<a class='timestamp' href='#433102'><time timestamp='2015-10-28T22:42:00Z'>22:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: the idea is to use a union to either store elements directly, or store the size + pointer of a dynamic array
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072180' id='433103'>
<a class='timestamp' href='#433103'><time timestamp='2015-10-28T22:43:00Z'>22:43</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: we cache failing transactions, not signatures
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072180' id='433104'>
<a class='timestamp' href='#433104'><time timestamp='2015-10-28T22:43:00Z'>22:43</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
to prevent downloading and verifying them over and over again
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072240' id='433105'>
<a class='timestamp' href='#433105'><time timestamp='2015-10-28T22:44:00Z'>22:44</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
that was just a brainfart, for some reason I thought the sigcache type included a validity flag.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072240' id='433106'>
<a class='timestamp' href='#433106'><time timestamp='2015-10-28T22:44:00Z'>22:44</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
of course it doesn&#x27;t.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072300' id='433107'>
<a class='timestamp' href='#433107'><time timestamp='2015-10-28T22:45:00Z'>22:45</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: I&#x27;ve wondered before why the normal std::vector didn&#x27;t special case small numbers of objects by making one of the pointers null and storing the objects internally.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072420' id='433108'>
<a class='timestamp' href='#433108'><time timestamp='2015-10-28T22:47:00Z'>22:47</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: even if you superoptimize the vector, there is still malloc overhead and fragmentation and the pointer to the vector object in its parent object which can all be eliminated in cases where the vector can be avoided.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072480' id='433109'>
<a class='timestamp' href='#433109'><time timestamp='2015-10-28T22:48:00Z'>22:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: well for example almost every CScript (which is a std::vector&lt;unsigned char&gt;) in the utxo cache and mempool stores at least 25 bytes
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072540' id='433110'>
<a class='timestamp' href='#433110'><time timestamp='2015-10-28T22:49:00Z'>22:49</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Every vector&lt;char&gt; is probably suspect to begin with. :P 
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072540' id='433111'>
<a class='timestamp' href='#433111'><time timestamp='2015-10-28T22:49:00Z'>22:49</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i can make a vector that is exactly 32 bytes (4 bytes size + 28 bytes data, or 4 bytes size + 4 bytes alloced size + pointer to actual data)
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072600' id='433112'>
<a class='timestamp' href='#433112'><time timestamp='2015-10-28T22:50:00Z'>22:50</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
It might be interesting to instrument std::vector so we can get a report of vectors in the codebase that have a constant number of objects in them.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072600' id='433113'>
<a class='timestamp' href='#433113'><time timestamp='2015-10-28T22:50:00Z'>22:50</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so it&#x27;s 32B for up to 28 bytes of data, or 32B + N for N &gt; 28 bytes of data
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072660' id='433114'>
<a class='timestamp' href='#433114'><time timestamp='2015-10-28T22:51:00Z'>22:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
instead of vector&#x27;s 40B + N for everything
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072720' id='433115'>
<a class='timestamp' href='#433115'><time timestamp='2015-10-28T22:52:00Z'>22:52</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: or you could make the parent object able to store up to 32 bytes internally, and only create a vector if there is more than that. (I suppose it could use a union with the char[32] to store the pointer to the vector when there is one).
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072780' id='433116'>
<a class='timestamp' href='#433116'><time timestamp='2015-10-28T22:53:00Z'>22:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: that&#x27;s what i&#x27;m doing
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072780' id='433117'>
<a class='timestamp' href='#433117'><time timestamp='2015-10-28T22:53:00Z'>22:53</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
when i say &quot;vector&quot; i mean parent type; i think you&#x27;re interpreting that word as &quot;malloced data&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072840' id='433118'>
<a class='timestamp' href='#433118'><time timestamp='2015-10-28T22:54:00Z'>22:54</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Got it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072900' id='433119'>
<a class='timestamp' href='#433119'><time timestamp='2015-10-28T22:55:00Z'>22:55</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
why 28? why not 31?  you don&#x27;t need a 4 byte length for only 31 bytes of range.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072960' id='433120'>
<a class='timestamp' href='#433120'><time timestamp='2015-10-28T22:56:00Z'>22:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it complicates things a bit if you can&#x27;t share the size for one with the other
<br>
</div>

<div class='talk op-msg' data-timestamp='1446072960' id='433121'>
<a class='timestamp' href='#433121'><time timestamp='2015-10-28T22:56:00Z'>22:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but yes, indeed
<br>
</div>

<div class='talk op-msg' data-timestamp='1446073080' id='433122'>
<a class='timestamp' href='#433122'><time timestamp='2015-10-28T22:58:00Z'>22:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
ah I see, actually that also lets you avoid a flag.. since you can switch the behavior on size.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446073140' id='433123'>
<a class='timestamp' href='#433123'><time timestamp='2015-10-28T22:59:00Z'>22:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i thought about that first, but that&#x27;s unfortunately not the case
<br>
</div>

<div class='talk op-msg' data-timestamp='1446073140' id='433124'>
<a class='timestamp' href='#433124'><time timestamp='2015-10-28T22:59:00Z'>22:59</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
as vector guarantees that a resize that shrinks doesn&#x27;t invalidate pointers
<br>
</div>

<div class='talk op-msg' data-timestamp='1446073200' id='433125'>
<a class='timestamp' href='#433125'><time timestamp='2015-10-28T23:00:00Z'>23:00</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so dropping from over the threshold to below the threshold cannot switch to in-object storage
<br>
</div>

<div class='talk op-msg' data-timestamp='1446073260' id='433126'>
<a class='timestamp' href='#433126'><time timestamp='2015-10-28T23:01:00Z'>23:01</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
so i use 1 bit of the 4-byte size to determine what type of storage to use
<br>
</div>

<div class='talk op-msg' data-timestamp='1446073320' id='433127'>
<a class='timestamp' href='#433127'><time timestamp='2015-10-28T23:02:00Z'>23:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
what I was thinking about when I said changing the datastructure was just flattening. e.g. one dynamically sized txout object that contains everything in it directly, and no pointers at all. It&#x27;s not like we ever modify any of this except setting flags.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446073320' id='433128'>
<a class='timestamp' href='#433128'><time timestamp='2015-10-28T23:02:00Z'>23:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
so having any pointers in it under any condition, is just waste and overhead.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446073320' id='433129'>
<a class='timestamp' href='#433129'><time timestamp='2015-10-28T23:02:00Z'>23:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
but it means that there needs to be smart accessors for it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1446076140' id='433130'>
<a class='timestamp' href='#433130'><time timestamp='2015-10-28T23:49:00Z'>23:49</time></a>
&lt;<span class='nick nick-14'> GitHub107</span>&gt;
[bitcoin] mcelrath opened pull request #6899: Warnings clean with C++11 (master...cpp11) <a href="https://github.com/bitcoin/bitcoin/pull/6899" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/6899</a>
<br>
</div>

</div>
</section>

</body>
</html>
