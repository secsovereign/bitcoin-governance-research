<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2018-08-28
 — 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2018-08-28' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:21 UTC</pre>
<pre><a href="/bitcoin-core-dev/2018-07-28">&lt;</a><span class='header'>   August 2018    </span><a href="/bitcoin-core-dev/2018-09-28">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;          <a class="" href="/bitcoin-core-dev/2018-08-01">1</a>  <a class="" href="/bitcoin-core-dev/2018-08-02">2</a>  <a class="" href="/bitcoin-core-dev/2018-08-03">3</a>  <a class="" href="/bitcoin-core-dev/2018-08-04">4</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2018-08-05">5</a>  <a class="" href="/bitcoin-core-dev/2018-08-06">6</a>  <a class="" href="/bitcoin-core-dev/2018-08-07">7</a>  <a class="" href="/bitcoin-core-dev/2018-08-08">8</a>  <a class="" href="/bitcoin-core-dev/2018-08-09">9</a> <a class="" href="/bitcoin-core-dev/2018-08-10">10</a> <a class="" href="/bitcoin-core-dev/2018-08-11">11</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-08-12">12</a> <a class="" href="/bitcoin-core-dev/2018-08-13">13</a> <a class="" href="/bitcoin-core-dev/2018-08-14">14</a> <a class="" href="/bitcoin-core-dev/2018-08-15">15</a> <a class="" href="/bitcoin-core-dev/2018-08-16">16</a> <a class="" href="/bitcoin-core-dev/2018-08-17">17</a> <a class="" href="/bitcoin-core-dev/2018-08-18">18</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-08-19">19</a> <a class="" href="/bitcoin-core-dev/2018-08-20">20</a> <a class="" href="/bitcoin-core-dev/2018-08-21">21</a> <a class="" href="/bitcoin-core-dev/2018-08-22">22</a> <a class="" href="/bitcoin-core-dev/2018-08-23">23</a> <a class="" href="/bitcoin-core-dev/2018-08-24">24</a> <a class="" href="/bitcoin-core-dev/2018-08-25">25</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-08-26">26</a> <a class="" href="/bitcoin-core-dev/2018-08-27">27</a> <a class="current" href="/bitcoin-core-dev/2018-08-28">28</a> <a class="" href="/bitcoin-core-dev/2018-08-29">29</a> <a class="" href="/bitcoin-core-dev/2018-08-30">30</a> <a class="" href="/bitcoin-core-dev/2018-08-31">31</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1535415720' id='627979'>
<a class='timestamp' href='#627979'><time timestamp='2018-08-28T00:22:00Z'>00:22</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
github ded :(
<br>
</div>

<div class='talk op-msg' data-timestamp='1535415720' id='627980'>
<a class='timestamp' href='#627980'><time timestamp='2018-08-28T00:22:00Z'>00:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
aww
<br>
</div>

<div class='talk op-msg' data-timestamp='1535416320' id='627981'>
<a class='timestamp' href='#627981'><time timestamp='2018-08-28T00:32:00Z'>00:32</time></a>
&lt;<span class='nick nick-5'> midnightmagic</span>&gt;
achow101: huh?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535421180' id='627982'>
<a class='timestamp' href='#627982'><time timestamp='2018-08-28T01:53:00Z'>01:53</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
I was getting a bunch of errors earlier
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447220' id='627983'>
<a class='timestamp' href='#627983'><time timestamp='2018-08-28T09:07:00Z'>09:07</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa, gmaxwell: I think we should keep 2^31 for the maximal message size, reducing to 3bytes (23bits + rekey bit) seems too small and not worth saving a byte
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447280' id='627984'>
<a class='timestamp' href='#627984'><time timestamp='2018-08-28T09:08:00Z'>09:08</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
BTW: -maxreceivebuffer is also respected with the new message types... (this is a level deeper more on the socket)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447340' id='627985'>
<a class='timestamp' href='#627985'><time timestamp='2018-08-28T09:09:00Z'>09:09</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Ah... nm. I was wrong. The buffer check only happens when a complete message has been loaded
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447340' id='627986'>
<a class='timestamp' href='#627986'><time timestamp='2018-08-28T09:09:00Z'>09:09</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
why would you ever need such a big message? in my experience it&#x27;s usually better to split something up into smaller messages in that case
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447400' id='627987'>
<a class='timestamp' href='#627987'><time timestamp='2018-08-28T09:10:00Z'>09:10</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
(for one, example to be able to continue an interrupted transfer, if it&#x27;s all-or-nothing that won&#x27;t work)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447460' id='627988'>
<a class='timestamp' href='#627988'><time timestamp='2018-08-28T09:11:00Z'>09:11</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
3 bytes - one rekey bit results in max size of 8’388’608 bytes (hardcoded in the protocol). I agree that we want smaller junks enforced on the application layer... but unsure about the protocol layer
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447520' id='627989'>
<a class='timestamp' href='#627989'><time timestamp='2018-08-28T09:12:00Z'>09:12</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
so if you really need &gt;24MB network messages, that is to me a suggestion something is wrong with the design at a higher level
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447520' id='627990'>
<a class='timestamp' href='#627990'><time timestamp='2018-08-28T09:12:00Z'>09:12</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
right
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447580' id='627991'>
<a class='timestamp' href='#627991'><time timestamp='2018-08-28T09:13:00Z'>09:13</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
if you also want to cram other data into the length word, it changes, though you could reserve the bits instead
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447640' id='627992'>
<a class='timestamp' href='#627992'><time timestamp='2018-08-28T09:14:00Z'>09:14</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. Thats also an idea.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447640' id='627993'>
<a class='timestamp' href='#627993'><time timestamp='2018-08-28T09:14:00Z'>09:14</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I also fail to see why someone should not be able to mem DOS a current peer with a incomplete message up to MAX_SIZE (33&#x27;554&#x27;432)...
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447640' id='627994'>
<a class='timestamp' href='#627994'><time timestamp='2018-08-28T09:14:00Z'>09:14</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
The -maxreceivebuffer hits only when the message is complete
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447700' id='627995'>
<a class='timestamp' href='#627995'><time timestamp='2018-08-28T09:15:00Z'>09:15</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
so still leave 24 bits for the message length, a bit for rekey, and leave the rest for future use--it seems a bit wasteful but if your protocol is byte-based you don&#x27;t get around such things
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447700' id='627996'>
<a class='timestamp' href='#627996'><time timestamp='2018-08-28T09:15:00Z'>09:15</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
right
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447760' id='627997'>
<a class='timestamp' href='#627997'><time timestamp='2018-08-28T09:16:00Z'>09:16</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
though as attacker you have to actually send the data, so if so it&#x27;s a very slow DoS, but yes DoS potential is another good reason to not allow very large messages
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447820' id='627998'>
<a class='timestamp' href='#627998'><time timestamp='2018-08-28T09:17:00Z'>09:17</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
[22:56:32]  &lt;gmaxwell&gt;I think as you have it now thats probably a trivial DOS attack, e.g. I can make your node use 32mb * npeers ram... so 4GB additional usage in the default configuration
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447820' id='627999'>
<a class='timestamp' href='#627999'><time timestamp='2018-08-28T09:17:00Z'>09:17</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
wumpus: I think that attack is possible today
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447820' id='628000'>
<a class='timestamp' href='#628000'><time timestamp='2018-08-28T09:17:00Z'>09:17</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
npeers * MAX_SIZE
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447820' id='628001'>
<a class='timestamp' href='#628001'><time timestamp='2018-08-28T09:17:00Z'>09:17</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447880' id='628002'>
<a class='timestamp' href='#628002'><time timestamp='2018-08-28T09:18:00Z'>09:18</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
The question is, why is MAX_SIZE 0x2000000
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447880' id='628003'>
<a class='timestamp' href='#628003'><time timestamp='2018-08-28T09:18:00Z'>09:18</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Ah. That constant is also used at http level
<br>
</div>

<div class='talk op-msg' data-timestamp='1535447940' id='628004'>
<a class='timestamp' href='#628004'><time timestamp='2018-08-28T09:19:00Z'>09:19</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
and other places
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448000' id='628005'>
<a class='timestamp' href='#628005'><time timestamp='2018-08-28T09:20:00Z'>09:20</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
for http is pretty arbitrary
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448000' id='628006'>
<a class='timestamp' href='#628006'><time timestamp='2018-08-28T09:20:00Z'>09:20</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
but less important, as the http interface is meant for internal use, there are probably tons of ways to DoS it
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448000' id='628007'>
<a class='timestamp' href='#628007'><time timestamp='2018-08-28T09:20:00Z'>09:20</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I mean as an attacker, you can create a IPv6 peer and create 128 connections to a peer (assume remote peer has no used ports) and send the same incomplete 32MB message to the peer and consume 4GB
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448120' id='628008'>
<a class='timestamp' href='#628008'><time timestamp='2018-08-28T09:22:00Z'>09:22</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
as buffers are per connection, the only way around that would be to account, on a process level, of the total size of those buffers and go into some kind of DoS mode if too much is consumed in total
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448180' id='628009'>
<a class='timestamp' href='#628009'><time timestamp='2018-08-28T09:23:00Z'>09:23</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
you <b>*need*</b> a fairly large receive buffer (though maybe not that large) to handle all the current messages, multiplied with 120+ that&#x27;s always going to be a lot !
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448360' id='628010'>
<a class='timestamp' href='#628010'><time timestamp='2018-08-28T09:26:00Z'>09:26</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I think there should be a combined view on those buffers and as you said some sort of DoS prevention mode or a max total buffer size that makes per-connection-queues pause
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448360' id='628011'>
<a class='timestamp' href='#628011'><time timestamp='2018-08-28T09:26:00Z'>09:26</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
indeed
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448420' id='628012'>
<a class='timestamp' href='#628012'><time timestamp='2018-08-28T09:27:00Z'>09:27</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
one way to handle going over the total buffer cap would be to simply stop reading until it&#x27;s processed, another way would be to drop connections with low priority and large buffers
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448480' id='628013'>
<a class='timestamp' href='#628013'><time timestamp='2018-08-28T09:28:00Z'>09:28</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448540' id='628014'>
<a class='timestamp' href='#628014'><time timestamp='2018-08-28T09:29:00Z'>09:29</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
might be out of scope for what you&#x27;re doing, <b>*not making it worse*</b> would be nice 
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448600' id='628015'>
<a class='timestamp' href='#628015'><time timestamp='2018-08-28T09:30:00Z'>09:30</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
(re: bitcoin P2P specifically: do we ever get <b>*unexpected*</b> big messages?)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448600' id='628016'>
<a class='timestamp' href='#628016'><time timestamp='2018-08-28T09:30:00Z'>09:30</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
my intuition would be that the larger messages are always replies to requests such as getblock, getaddr, etc
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448660' id='628017'>
<a class='timestamp' href='#628017'><time timestamp='2018-08-28T09:31:00Z'>09:31</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
The buffer attack problem is orthogonal to the v2 protocol I&#x27;m implementing
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448660' id='628018'>
<a class='timestamp' href='#628018'><time timestamp='2018-08-28T09:31:00Z'>09:31</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
if so, someone connecting to you and instantly offering a large message should probably be blasted
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448660' id='628019'>
<a class='timestamp' href='#628019'><time timestamp='2018-08-28T09:31:00Z'>09:31</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes, agree
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448720' id='628020'>
<a class='timestamp' href='#628020'><time timestamp='2018-08-28T09:32:00Z'>09:32</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I guess the attack would be, a) connect with a bunch of fake peers, do proper version handshake, send incomplete 32MB message (only header will be parsed) via all connections.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448720' id='628021'>
<a class='timestamp' href='#628021'><time timestamp='2018-08-28T09:32:00Z'>09:32</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
The attacked peer could reject messages based on per command max sizes
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448780' id='628022'>
<a class='timestamp' href='#628022'><time timestamp='2018-08-28T09:33:00Z'>09:33</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
But then, unknown messages.. (unknown commands)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448780' id='628023'>
<a class='timestamp' href='#628023'><time timestamp='2018-08-28T09:33:00Z'>09:33</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
well if someone wants to send you an unknown message, out of the blue, larger than N -&gt; bye
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448780' id='628024'>
<a class='timestamp' href='#628024'><time timestamp='2018-08-28T09:33:00Z'>09:33</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
there&#x27;s some scope for behavior modeling here, though I think keeping track of total buffer sizes is more predictable and easier to implement
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448780' id='628025'>
<a class='timestamp' href='#628025'><time timestamp='2018-08-28T09:33:00Z'>09:33</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. That is implemented, though N is 0x2000000
<br>
</div>

<div class='talk op-msg' data-timestamp='1535448840' id='628026'>
<a class='timestamp' href='#628026'><time timestamp='2018-08-28T09:34:00Z'>09:34</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
wumpus: yes. agree
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449020' id='628027'>
<a class='timestamp' href='#628027'><time timestamp='2018-08-28T09:37:00Z'>09:37</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
it&#x27;s even possible that libevent already has this funcionality, as it&#x27;s not protocol specific
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449140' id='628028'>
<a class='timestamp' href='#628028'><time timestamp='2018-08-28T09:39:00Z'>09:39</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
good point... 
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449500' id='628029'>
<a class='timestamp' href='#628029'><time timestamp='2018-08-28T09:45:00Z'>09:45</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Anyone know how I can solve this gcc -fPIC error while compiling test_bitcoin or bench_bitcoin:
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449500' id='628030'>
<a class='timestamp' href='#628030'><time timestamp='2018-08-28T09:45:00Z'>09:45</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
  CXXLD    test/test_bitcoin
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449500' id='628031'>
<a class='timestamp' href='#628031'><time timestamp='2018-08-28T09:45:00Z'>09:45</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
 /usr/bin/ld: crypto/libbitcoin_crypto_base.a(crypto_libbitcoin_crypto_base_a-chacha.o): relocation R_X86_64_32 against `.rodata.cst16&#x27; can not be used when making a PIE object; recompile with -fPIC
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449500' id='628032'>
<a class='timestamp' href='#628032'><time timestamp='2018-08-28T09:45:00Z'>09:45</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
<a href="https://api.travis-ci.org/v3/job/421481343/log.txt" class="link" target="_blank">https://api.travis-ci.org/v3/job/421481343/log.txt</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449500' id='628033'>
<a class='timestamp' href='#628033'><time timestamp='2018-08-28T09:45:00Z'>09:45</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Is it because I added extern C code?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449560' id='628034'>
<a class='timestamp' href='#628034'><time timestamp='2018-08-28T09:46:00Z'>09:46</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I think its clang not gcc, sry
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449800' id='628035'>
<a class='timestamp' href='#628035'><time timestamp='2018-08-28T09:50:00Z'>09:50</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
&quot;You can assign bufferevents to a rate limiting group if you want to limit their total bandwidth usage.&quot; seems like a different thing though
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449800' id='628036'>
<a class='timestamp' href='#628036'><time timestamp='2018-08-28T09:50:00Z'>09:50</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
rate limiting versus total buffer limiting
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449800' id='628037'>
<a class='timestamp' href='#628037'><time timestamp='2018-08-28T09:50:00Z'>09:50</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
jonasschnelli: you&#x27;re probably linking to a static library that wasn&#x27;t compiled with -fPIC
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449860' id='628038'>
<a class='timestamp' href='#628038'><time timestamp='2018-08-28T09:51:00Z'>09:51</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
either link to a dynamic library instead or re-compile it with -fPIC
<br>
</div>

<div class='talk op-msg' data-timestamp='1535449920' id='628039'>
<a class='timestamp' href='#628039'><time timestamp='2018-08-28T09:52:00Z'>09:52</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
wumpus: could it be because test_bitcoin has LDFLAGS -static? It works on master, but when I add my chacha20/poly1305 code to LIBBITCOIN_CRYPTO, it failes
<br>
</div>

<div class='talk op-msg' data-timestamp='1535450040' id='628040'>
<a class='timestamp' href='#628040'><time timestamp='2018-08-28T09:54:00Z'>09:54</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
on a general level it happens when some objects are built without -fPIC while requesting a position independent library/executable at link time-- &#x27;-static&#x27; will, on most platforms, generate a position dependent executable so no I don&#x27;t think that&#x27;s the reason
<br>
</div>

<div class='talk op-msg' data-timestamp='1535450280' id='628041'>
<a class='timestamp' href='#628041'><time timestamp='2018-08-28T09:58:00Z'>09:58</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
in this specific case, it looks like crypto_libbitcoin_crypto_base_a-chacha.o is built without -fPIC so the linker cannot include it
<br>
</div>

<div class='talk op-msg' data-timestamp='1535450460' id='628042'>
<a class='timestamp' href='#628042'><time timestamp='2018-08-28T10:01:00Z'>10:01</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
wumpus: thanks... I&#x27;ll take a closer look
<br>
</div>

<div class='talk op-msg' data-timestamp='1535450880' id='628043'>
<a class='timestamp' href='#628043'><time timestamp='2018-08-28T10:08:00Z'>10:08</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
wumpus: I guess i found it, the added code (chacha/poly1305) are .c files and compiled with CC (CFLAGS) and not with CXX
<br>
</div>

<div class='talk op-msg' data-timestamp='1535451360' id='628044'>
<a class='timestamp' href='#628044'><time timestamp='2018-08-28T10:16:00Z'>10:16</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
ahh the ancient problem
<br>
</div>

<div class='talk op-msg' data-timestamp='1535451600' id='628045'>
<a class='timestamp' href='#628045'><time timestamp='2018-08-28T10:20:00Z'>10:20</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
can probably just rename to .cpp?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535451840' id='628046'>
<a class='timestamp' href='#628046'><time timestamp='2018-08-28T10:24:00Z'>10:24</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
luke-jr: trying right now...
<br>
</div>

<div class='talk op-msg' data-timestamp='1535451900' id='628047'>
<a class='timestamp' href='#628047'><time timestamp='2018-08-28T10:25:00Z'>10:25</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes, &#x27;porting&#x27; it to C++ might be the most straightforward solution, unless you need to do it repeatedly (such as when there&#x27;s an upstream)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535452020' id='628048'>
<a class='timestamp' href='#628048'><time timestamp='2018-08-28T10:27:00Z'>10:27</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I guess porting is fine... but the compile cache is killing me
<br>
</div>

<div class='talk op-msg' data-timestamp='1535452080' id='628049'>
<a class='timestamp' href='#628049'><time timestamp='2018-08-28T10:28:00Z'>10:28</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
both the name of the file and the compile flags will have changed, why would the cache pick that up?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535453160' id='628050'>
<a class='timestamp' href='#628050'><time timestamp='2018-08-28T10:46:00Z'>10:46</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
please, don&#x27;t do this: #14087  we have PRs enough to cope with
<br>
</div>

<div class='talk op-msg' data-timestamp='1535453160' id='628051'>
<a class='timestamp' href='#628051'><time timestamp='2018-08-28T10:46:00Z'>10:46</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/14087" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/14087</a> | Remove unnecessary G_TRANSLATION_FUN nullptr assignment by promag · Pull Request #14087 · bitcoin/bitcoin · GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1535453220' id='628052'>
<a class='timestamp' href='#628052'><time timestamp='2018-08-28T10:47:00Z'>10:47</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
the code is correct and clear, no need to fiddle with it
<br>
</div>

<div class='talk op-msg' data-timestamp='1535464680' id='628053'>
<a class='timestamp' href='#628053'><time timestamp='2018-08-28T13:58:00Z'>13:58</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
ok, apparently the code was not correct and clear, it was assigning nullptr to a std::function, sorry
<br>
</div>

<div class='talk op-msg' data-timestamp='1535466360' id='628054'>
<a class='timestamp' href='#628054'><time timestamp='2018-08-28T14:26:00Z'>14:26</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
btw: I intend to change my git mail to laanwj@protonmail.com (from laanwj@gmail.com), is this going to give any problems or set off alarms? (I&#x27;ll keep using the same gpg key FWIW)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467080' id='628055'>
<a class='timestamp' href='#628055'><time timestamp='2018-08-28T14:38:00Z'>14:38</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
02:07:36 &lt; jonasschnelli&gt; sipa, gmaxwell: I think we should keep 2^31 for the  maximal message size, reducing to 3bytes (23bits +  rekey bit) seems too small and not worth saving a byte
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467080' id='628056'>
<a class='timestamp' href='#628056'><time timestamp='2018-08-28T14:38:00Z'>14:38</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: I agree that the byte is unimportant, but we will never have such big messages.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467140' id='628057'>
<a class='timestamp' href='#628057'><time timestamp='2018-08-28T14:39:00Z'>14:39</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
indeed
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467140' id='628058'>
<a class='timestamp' href='#628058'><time timestamp='2018-08-28T14:39:00Z'>14:39</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Even sending around 2MB messages is pretty terrible. Anything where a message would be that big should be split into smaller messages.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467200' id='628059'>
<a class='timestamp' href='#628059'><time timestamp='2018-08-28T14:40:00Z'>14:40</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I would say that we should introduce new messages to do this for blocks already, except that other than in IBD/catchup blocks are almost never sent whole anymore.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467200' id='628060'>
<a class='timestamp' href='#628060'><time timestamp='2018-08-28T14:40:00Z'>14:40</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yep, said the same thing
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467440' id='628061'>
<a class='timestamp' href='#628061'><time timestamp='2018-08-28T14:44:00Z'>14:44</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
E.g. a N-way split block message could send the merkle branches for the remaining parts, so you can verify the merkle root for each chunk as you get it, and not bother buffering something that is never going to be useful.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467500' id='628062'>
<a class='timestamp' href='#628062'><time timestamp='2018-08-28T14:45:00Z'>14:45</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
similar to how bittorrent uses merkle trees IIRC
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467560' id='628063'>
<a class='timestamp' href='#628063'><time timestamp='2018-08-28T14:46:00Z'>14:46</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
but yes, good idea
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467800' id='628064'>
<a class='timestamp' href='#628064'><time timestamp='2018-08-28T14:50:00Z'>14:50</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
yes. agree.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535467980' id='628065'>
<a class='timestamp' href='#628065'><time timestamp='2018-08-28T14:53:00Z'>14:53</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Really the message sizes should be driven by being large enough to make overheads low, and large enough to usefully process something incrementally (it&#x27;s not so useful to send a message where we can do nothing at all with it except wait for more), and otherwise as small as possible to avoid creating large buffering and head of line blocking problems.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535468760' id='628066'>
<a class='timestamp' href='#628066'><time timestamp='2018-08-28T15:06:00Z'>15:06</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
wumpus: add a new uid to your gpg key and upload it somewhere
<br>
</div>

<div class='talk op-msg' data-timestamp='1535468940' id='628067'>
<a class='timestamp' href='#628067'><time timestamp='2018-08-28T15:09:00Z'>15:09</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
sipa: I already did that part :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469180' id='628068'>
<a class='timestamp' href='#628068'><time timestamp='2018-08-28T15:13:00Z'>15:13</time></a>
&lt;<span class='nick nick-4'> waxwing</span>&gt;
sipa, what&#x27;s going on here? why would someone be adding both witness and non-witness utxo fields in the same input (bip174)? <a href="https://github.com/bitcoin/bitcoin/blob/master/src/script/sign.cpp#L256-L259" class="link" target="_blank">https://github.com/bitcoin/bitcoin/blob/master/src/script/sign.cpp#L256-L259</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469480' id='628069'>
<a class='timestamp' href='#628069'><time timestamp='2018-08-28T15:18:00Z'>15:18</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
waxwing: it&#x27;s just a safety check
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469540' id='628070'>
<a class='timestamp' href='#628070'><time timestamp='2018-08-28T15:19:00Z'>15:19</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
waxwing: that could happen in the case that someone adds a non-witness utxo to a witness one because it is p2sh wrapped. Then someone else could, seeing that there was no witness utxo, add a witness one without removing the non-witness one
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469540' id='628071'>
<a class='timestamp' href='#628071'><time timestamp='2018-08-28T15:19:00Z'>15:19</time></a>
&lt;<span class='nick nick-1'> achow101</span>&gt;
that would of course be an implementation error, but it should still be a case that needs to be handled
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469660' id='628072'>
<a class='timestamp' href='#628072'><time timestamp='2018-08-28T15:21:00Z'>15:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
waxwing: both are added, and the irrelevant one is later deleted (because it&#x27;s the signing code that determines which one was needed)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469720' id='628073'>
<a class='timestamp' href='#628073'><time timestamp='2018-08-28T15:22:00Z'>15:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it will never make it out to the serialization
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469720' id='628074'>
<a class='timestamp' href='#628074'><time timestamp='2018-08-28T15:22:00Z'>15:22</time></a>
&lt;<span class='nick nick-4'> waxwing</span>&gt;
it&#x27;s technically more lax than what was specc&#x27;ed right, which was to reject anything with both. but the example you give is a plausible case for allowing it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469720' id='628075'>
<a class='timestamp' href='#628075'><time timestamp='2018-08-28T15:22:00Z'>15:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
waxwing: this is just internals
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469720' id='628076'>
<a class='timestamp' href='#628076'><time timestamp='2018-08-28T15:22:00Z'>15:22</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it&#x27;s not observable behavior
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469780' id='628077'>
<a class='timestamp' href='#628077'><time timestamp='2018-08-28T15:23:00Z'>15:23</time></a>
&lt;<span class='nick nick-4'> waxwing</span>&gt;
ah ok, thanks
<br>
</div>

<div class='talk op-msg' data-timestamp='1535469780' id='628078'>
<a class='timestamp' href='#628078'><time timestamp='2018-08-28T15:23:00Z'>15:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
(scroll down a bit, see line 280-287
<br>
</div>

<div class='talk op-msg' data-timestamp='1535471520' id='628079'>
<a class='timestamp' href='#628079'><time timestamp='2018-08-28T15:52:00Z'>15:52</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: re memory usage, see MAX_PROTOCOL_MESSAGE_LENGTH. -- you can&#x27;t cause 32MB usage today.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535471580' id='628080'>
<a class='timestamp' href='#628080'><time timestamp='2018-08-28T15:53:00Z'>15:53</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I think if we were to redo things from scratch, we&#x27;d end up with a 256KB maximum message size or something like that.  The only reason I don&#x27;t suggest making the encrypted transport limited to that sort of size is because we&#x27;d have to introduced split block messages first.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535471640' id='628081'>
<a class='timestamp' href='#628081'><time timestamp='2018-08-28T15:54:00Z'>15:54</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
and as I mentioned before, due to compact blocks I think it isn&#x27;t particularly important to add split blocks.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535475840' id='628082'>
<a class='timestamp' href='#628082'><time timestamp='2018-08-28T17:04:00Z'>17:04</time></a>
&lt;<span class='nick nick-12'> ryanofsky</span>&gt;
MarcoFalke, any suggestion on how handle &quot;AppVeyor was unable to build non-mergeable pull request&quot; in 9381? there are no conflicts. maybe close and reopen?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535475960' id='628083'>
<a class='timestamp' href='#628083'><time timestamp='2018-08-28T17:06:00Z'>17:06</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I recommend a goat sacrifice.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535476680' id='628084'>
<a class='timestamp' href='#628084'><time timestamp='2018-08-28T17:18:00Z'>17:18</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes, a goat should do in this case
<br>
</div>

<div class='talk op-msg' data-timestamp='1535476920' id='628085'>
<a class='timestamp' href='#628085'><time timestamp='2018-08-28T17:22:00Z'>17:22</time></a>
&lt;<span class='nick nick-16'> luke-jr</span>&gt;
who has one? someone is more rural than me?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535477400' id='628086'>
<a class='timestamp' href='#628086'><time timestamp='2018-08-28T17:30:00Z'>17:30</time></a>
&lt;<span class='nick nick-15'> Chris_Stewart_5</span>&gt;
any idea what is going on testnet ? 
<br>
</div>

<div class='talk op-msg' data-timestamp='1535477460' id='628087'>
<a class='timestamp' href='#628087'><time timestamp='2018-08-28T17:31:00Z'>17:31</time></a>
&lt;<span class='nick nick-15'> Chris_Stewart_5</span>&gt;
or ¯\_(ツ)_/¯
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481480' id='628088'>
<a class='timestamp' href='#628088'><time timestamp='2018-08-28T18:38:00Z'>18:38</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: oh. Right. I missed MAX_PROTOCOL_MESSAGE_LENGTH.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481480' id='628089'>
<a class='timestamp' href='#628089'><time timestamp='2018-08-28T18:38:00Z'>18:38</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
That check is also there for the v2 protocol (in my PR)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481540' id='628090'>
<a class='timestamp' href='#628090'><time timestamp='2018-08-28T18:39:00Z'>18:39</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
But its in-precise in v2 because one package can contain multiple messages (and this checks a &quot;package&quot;)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481540' id='628091'>
<a class='timestamp' href='#628091'><time timestamp='2018-08-28T18:39:00Z'>18:39</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
We might want to log the command, length, number for each message we send, and see if the ability to batch multiple messages even potentially pays for the extra 3/4 bytes of length.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481720' id='628092'>
<a class='timestamp' href='#628092'><time timestamp='2018-08-28T18:42:00Z'>18:42</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: what do you mean that its imprecise?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481720' id='628093'>
<a class='timestamp' href='#628093'><time timestamp='2018-08-28T18:42:00Z'>18:42</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
The package payload should be limited to MAX_PROTOCOL_MESSAGE_LENGTH.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481720' id='628094'>
<a class='timestamp' href='#628094'><time timestamp='2018-08-28T18:42:00Z'>18:42</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: if you combine 10 blocks into a single encryption package it gets rejected
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481720' id='628095'>
<a class='timestamp' href='#628095'><time timestamp='2018-08-28T18:42:00Z'>18:42</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: Yes. I agree.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481780' id='628096'>
<a class='timestamp' href='#628096'><time timestamp='2018-08-28T18:43:00Z'>18:43</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I guess its a wording thing,... 
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481780' id='628097'>
<a class='timestamp' href='#628097'><time timestamp='2018-08-28T18:43:00Z'>18:43</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
message is IMO the v2 inner message (the actual command&amp;size&amp;payload)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481780' id='628098'>
<a class='timestamp' href='#628098'><time timestamp='2018-08-28T18:43:00Z'>18:43</time></a>
&lt;<span class='nick nick-6'> willyko_</span>&gt;
hi all, i&#x27;m wondering what&#x27;s the current gitian build tech stack people are using right now? i haven&#x27;t been able to gitian build since the bionic upgrade
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481780' id='628099'>
<a class='timestamp' href='#628099'><time timestamp='2018-08-28T18:43:00Z'>18:43</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Right good.  I understand, you&#x27;re just saying that by applying it as max package length you can&#x27;t always use a message of that size.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481780' id='628100'>
<a class='timestamp' href='#628100'><time timestamp='2018-08-28T18:43:00Z'>18:43</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Where the outer message is the &quot;package&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481780' id='628101'>
<a class='timestamp' href='#628101'><time timestamp='2018-08-28T18:43:00Z'>18:43</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
If combining messages gets a thing, people would expect that MAX_PROTOCOL_MESSAGE_LENGTH is per inner message
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481840' id='628102'>
<a class='timestamp' href='#628102'><time timestamp='2018-08-28T18:44:00Z'>18:44</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: if you would otherwise buffer more than MAX_PROTOCOL_MESSAGE_LENGTH then that just goes into another package.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481900' id='628103'>
<a class='timestamp' href='#628103'><time timestamp='2018-08-28T18:45:00Z'>18:45</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: but you need to read-process the whole package to check the MAC before you can look at the inner messages
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481900' id='628104'>
<a class='timestamp' href='#628104'><time timestamp='2018-08-28T18:45:00Z'>18:45</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Yes. I am referring to the sender.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481960' id='628105'>
<a class='timestamp' href='#628105'><time timestamp='2018-08-28T18:46:00Z'>18:46</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
oh. yes.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481960' id='628106'>
<a class='timestamp' href='#628106'><time timestamp='2018-08-28T18:46:00Z'>18:46</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yeah. The question is if we want to drop the multi-message thing and save 4 bytes (and some complication is size checkes)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535481960' id='628107'>
<a class='timestamp' href='#628107'><time timestamp='2018-08-28T18:46:00Z'>18:46</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I guess originally cfields came up with that idea
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482020' id='628108'>
<a class='timestamp' href='#628108'><time timestamp='2018-08-28T18:47:00Z'>18:47</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
(the idea to use multi-message envelopes
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482020' id='628109'>
<a class='timestamp' href='#628109'><time timestamp='2018-08-28T18:47:00Z'>18:47</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
+)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482020' id='628110'>
<a class='timestamp' href='#628110'><time timestamp='2018-08-28T18:47:00Z'>18:47</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
But I&#x27;m wondering if the ability to put multiple messages in a package even makes sense. It adds 4 bytes (maybe we change to 3) overhead to every message, ... but only saves 16 bytes when we bundle.  And except for ping  no common message is especially small.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482020' id='628111'>
<a class='timestamp' href='#628111'><time timestamp='2018-08-28T18:47:00Z'>18:47</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
A headers message, we want to minimize latency, so it will almost never be bundled.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482020' id='628112'>
<a class='timestamp' href='#628112'><time timestamp='2018-08-28T18:47:00Z'>18:47</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
INVs get batched internally.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482080' id='628113'>
<a class='timestamp' href='#628113'><time timestamp='2018-08-28T18:48:00Z'>18:48</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
jonasschnelli: I believe I argued against :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482080' id='628114'>
<a class='timestamp' href='#628114'><time timestamp='2018-08-28T18:48:00Z'>18:48</time></a>
&lt;<span class='nick nick-13'> cfields</span>&gt;
jonasschnelli: iirc my request was that IF we bundle, to throw an index up-front so that we could do optimistic preallocation
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482080' id='628115'>
<a class='timestamp' href='#628115'><time timestamp='2018-08-28T18:48:00Z'>18:48</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
It seemed like sipa was for some reason thinking that we could incrementally process inner messages before buffering the whole thing. But we can&#x27;t or otherwise that moots the MAC.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482140' id='628116'>
<a class='timestamp' href='#628116'><time timestamp='2018-08-28T18:49:00Z'>18:49</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yeah... 
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482140' id='628117'>
<a class='timestamp' href='#628117'><time timestamp='2018-08-28T18:49:00Z'>18:49</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I say drop it (the envelope/inner-message wrapping)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482140' id='628118'>
<a class='timestamp' href='#628118'><time timestamp='2018-08-28T18:49:00Z'>18:49</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
And reduce the length to 3 bytes (- rekey bit) resulting in 2^23 (8’388’608) max message size
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482260' id='628119'>
<a class='timestamp' href='#628119'><time timestamp='2018-08-28T18:51:00Z'>18:51</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Does the inner length as done now include the variable length command?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482260' id='628120'>
<a class='timestamp' href='#628120'><time timestamp='2018-08-28T18:51:00Z'>18:51</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
no
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482260' id='628121'>
<a class='timestamp' href='#628121'><time timestamp='2018-08-28T18:51:00Z'>18:51</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
It should. So you don&#x27;t have to read the command in order to process the mac.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482320' id='628122'>
<a class='timestamp' href='#628122'><time timestamp='2018-08-28T18:52:00Z'>18:52</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
by read I mean decode.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482320' id='628123'>
<a class='timestamp' href='#628123'><time timestamp='2018-08-28T18:52:00Z'>18:52</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
[3 byte - 1 bit lenth][varlen command][16 byte mac]. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482320' id='628124'>
<a class='timestamp' href='#628124'><time timestamp='2018-08-28T18:52:00Z'>18:52</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
wouldn&#x27;t it be -&gt; ( 3bytes_cipher_length_plus_flag || cipher_command || payload || 128bit-MAC )
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482380' id='628125'>
<a class='timestamp' href='#628125'><time timestamp='2018-08-28T18:53:00Z'>18:53</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
yes, well I mean, if you want to actually send payloads... :P
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482380' id='628126'>
<a class='timestamp' href='#628126'><time timestamp='2018-08-28T18:53:00Z'>18:53</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
You decrypt the length, then read and MAC-check the rest, then decrypt
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482380' id='628127'>
<a class='timestamp' href='#628127'><time timestamp='2018-08-28T18:53:00Z'>18:53</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
if there is no payload you would figure out during command varint processing and after the MAC
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482500' id='628128'>
<a class='timestamp' href='#628128'><time timestamp='2018-08-28T18:55:00Z'>18:55</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
AEAD( AAD( K1_ENC( 3bytes_cipher_length_plus_flag ) ) || K2_ENC( cipher_command || payload ) )
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482560' id='628129'>
<a class='timestamp' href='#628129'><time timestamp='2018-08-28T18:56:00Z'>18:56</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
in the above the crypto layer just becomes completely oblivious to commands.  it&#x27;s all just payload to it.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482620' id='628130'>
<a class='timestamp' href='#628130'><time timestamp='2018-08-28T18:57:00Z'>18:57</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
how is the variable length command implemented?  the bip just says varlen which is not very clear.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482680' id='628131'>
<a class='timestamp' href='#628131'><time timestamp='2018-08-28T18:58:00Z'>18:58</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
varstr (a varint plus a string),... I think probably always one byte &amp; the string
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482680' id='628132'>
<a class='timestamp' href='#628132'><time timestamp='2018-08-28T18:58:00Z'>18:58</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
0x03 &#x27;i&#x27; &#x27;n&#x27; &#x27;v&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482680' id='628133'>
<a class='timestamp' href='#628133'><time timestamp='2018-08-28T18:58:00Z'>18:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
yes, it should be at most one byte. Allowing more to be encoded is just begging for bugs.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482740' id='628134'>
<a class='timestamp' href='#628134'><time timestamp='2018-08-28T18:59:00Z'>18:59</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. We could enforce one bytes length by the specs
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482860' id='628135'>
<a class='timestamp' href='#628135'><time timestamp='2018-08-28T19:01:00Z'>19:01</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
We could also change to command byte where 0-12 mean 0-12 byte explicit comands, and other values are mapped to some existing commands (like ping/inv/header) and the rest are undefined.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482860' id='628136'>
<a class='timestamp' href='#628136'><time timestamp='2018-08-28T19:01:00Z'>19:01</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
but at least the size should just be made a byte.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482920' id='628137'>
<a class='timestamp' href='#628137'><time timestamp='2018-08-28T19:02:00Z'>19:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
in general we should watch for cases where a parser would need to impose limits to protect itself from bad values, and just make those bad values impossible to encode.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535482920' id='628138'>
<a class='timestamp' href='#628138'><time timestamp='2018-08-28T19:02:00Z'>19:02</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yeah.. would save another byte. :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483040' id='628139'>
<a class='timestamp' href='#628139'><time timestamp='2018-08-28T19:04:00Z'>19:04</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
well for ping the packed commands would save 4 bytes. For inv 3 bytes. for headers it would save 7 bytes... 
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483100' id='628140'>
<a class='timestamp' href='#628140'><time timestamp='2018-08-28T19:05:00Z'>19:05</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: Aha. I see now. Dropping the str-based command for a number-to-command mapping...
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483160' id='628141'>
<a class='timestamp' href='#628141'><time timestamp='2018-08-28T19:06:00Z'>19:06</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
But smells a bit after central planing (I guess developers will tend then to address new values to new commands)
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483160' id='628142'>
<a class='timestamp' href='#628142'><time timestamp='2018-08-28T19:06:00Z'>19:06</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: str based exists for some messages, its needed for extensibility.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483160' id='628143'>
<a class='timestamp' href='#628143'><time timestamp='2018-08-28T19:06:00Z'>19:06</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. Sure. We can set 0xFF for str or something
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483160' id='628144'>
<a class='timestamp' href='#628144'><time timestamp='2018-08-28T19:06:00Z'>19:06</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
or as you said, just use 0-12 for the very known ones
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483160' id='628145'>
<a class='timestamp' href='#628145'><time timestamp='2018-08-28T19:06:00Z'>19:06</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Well I was suggesting that we have values 1-12 be for strings of length 1-12.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483160' id='628146'>
<a class='timestamp' href='#628146'><time timestamp='2018-08-28T19:06:00Z'>19:06</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
right.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483220' id='628147'>
<a class='timestamp' href='#628147'><time timestamp='2018-08-28T19:07:00Z'>19:07</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Or that. Yes.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483220' id='628148'>
<a class='timestamp' href='#628148'><time timestamp='2018-08-28T19:07:00Z'>19:07</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
then use values for the few very common small protocol messages (ping, inv, header probably) and the rest just stay strings.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483220' id='628149'>
<a class='timestamp' href='#628149'><time timestamp='2018-08-28T19:07:00Z'>19:07</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Jup. I like that.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483280' id='628150'>
<a class='timestamp' href='#628150'><time timestamp='2018-08-28T19:08:00Z'>19:08</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
as far as centeral planning goes there isn&#x27;t a reason that nodes couldn&#x27;t use different numbers on dinfferent links.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483280' id='628151'>
<a class='timestamp' href='#628151'><time timestamp='2018-08-28T19:08:00Z'>19:08</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
we wouldn&#x27;t implement support for that unless needed, but it wouldn&#x27;t be a problem.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483340' id='628152'>
<a class='timestamp' href='#628152'><time timestamp='2018-08-28T19:09:00Z'>19:09</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
they 1-byte commands would really only be needed for commands which are frequent and small...  So, for example if we introduced a new kind of headers message, we might want to use one for that.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483340' id='628153'>
<a class='timestamp' href='#628153'><time timestamp='2018-08-28T19:09:00Z'>19:09</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
But I don&#x27;t see any reason to use a 1-byte command for a block. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483460' id='628154'>
<a class='timestamp' href='#628154'><time timestamp='2018-08-28T19:11:00Z'>19:11</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Your argument is then more for latency then for bandwidth, right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483580' id='628155'>
<a class='timestamp' href='#628155'><time timestamp='2018-08-28T19:13:00Z'>19:13</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I guess if your peer gets heavy used for IBDing, saving a couple of bytes on the block command has the same effect then on the inv command (in terms of total bandwidth
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483640' id='628156'>
<a class='timestamp' href='#628156'><time timestamp='2018-08-28T19:14:00Z'>19:14</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
But say, for example, we decide we want to have a HEADERS2 message coded as value 27 in bitcoin core.  We&#x27;re going to negoiate its activation with something like SENDHEADERS.   Say another implementation BitcoinConnectUnlimitedClassic (BCUX) wants to use 27 for XHEADERS. An implementation could support talking to both kinds of peers just by assigning the meaning of 27 based on the negoation.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483640' id='628157'>
<a class='timestamp' href='#628157'><time timestamp='2018-08-28T19:14:00Z'>19:14</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: not in terms of percentage, however.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483820' id='628158'>
<a class='timestamp' href='#628158'><time timestamp='2018-08-28T19:17:00Z'>19:17</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Over the life of a node, even one that serves IBDing peers, it should service a lot more INV messages than block messages.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535483940' id='628159'>
<a class='timestamp' href='#628159'><time timestamp='2018-08-28T19:19:00Z'>19:19</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
agree
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484000' id='628160'>
<a class='timestamp' href='#628160'><time timestamp='2018-08-28T19:20:00Z'>19:20</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
we can even specify that any usage of short types other than the ones initially set should be negoigated. So then there is basically no collision problem.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484120' id='628161'>
<a class='timestamp' href='#628161'><time timestamp='2018-08-28T19:22:00Z'>19:22</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
With negotiating you mean some &quot;proprietary&quot; message?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484180' id='628162'>
<a class='timestamp' href='#628162'><time timestamp='2018-08-28T19:23:00Z'>19:23</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I mean just that you don&#x27;t use them unless you know the other side can handle them, based on something else they&#x27;ve sent.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484240' id='628163'>
<a class='timestamp' href='#628163'><time timestamp='2018-08-28T19:24:00Z'>19:24</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. We should mention that...
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484240' id='628164'>
<a class='timestamp' href='#628164'><time timestamp='2018-08-28T19:24:00Z'>19:24</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
So for example, we&#x27;ll likely introduce a new ADDR message in the future.  So your peer can send you a SENDADDR2 command, and then after they get that they know they can send you value=22 messages, per the ADDR2 BIP.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484300' id='628165'>
<a class='timestamp' href='#628165'><time timestamp='2018-08-28T19:25:00Z'>19:25</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Got it. Yes.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484300' id='628166'>
<a class='timestamp' href='#628166'><time timestamp='2018-08-28T19:25:00Z'>19:25</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: since the length is now caped at 2^23, how would decomposing a message distributed over two packages look like?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484360' id='628167'>
<a class='timestamp' href='#628167'><time timestamp='2018-08-28T19:26:00Z'>19:26</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Thats specific to the message.  It should be decomposed in a way that allows incremental processing.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484360' id='628168'>
<a class='timestamp' href='#628168'><time timestamp='2018-08-28T19:26:00Z'>19:26</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Aha.. PARTIALBLOCK or something
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484420' id='628169'>
<a class='timestamp' href='#628169'><time timestamp='2018-08-28T19:27:00Z'>19:27</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Good. Then there is no extra handling on the transport layer.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484420' id='628170'>
<a class='timestamp' href='#628170'><time timestamp='2018-08-28T19:27:00Z'>19:27</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
So for example, say we wanted to support breaking blocks up,  you&#x27;d split a block into N messages, the first message might be the header, tx count, and N hashes, where the N hashes are the merkelroots for the N chunks of the block.  Then additional messages for each chunk.  But the transport layer doesn&#x27;t care.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484420' id='628171'>
<a class='timestamp' href='#628171'><time timestamp='2018-08-28T19:27:00Z'>19:27</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
The rationale is that the right splitting is message type dependant.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484480' id='628172'>
<a class='timestamp' href='#628172'><time timestamp='2018-08-28T19:28:00Z'>19:28</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
For an INV, for example, there is <u>_just no reason_</u> to ever make a single INV that big, just make another INV.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535484480' id='628173'>
<a class='timestamp' href='#628173'><time timestamp='2018-08-28T19:28:00Z'>19:28</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
so the splitting for INVs is more invs.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535489640' id='628174'>
<a class='timestamp' href='#628174'><time timestamp='2018-08-28T20:54:00Z'>20:54</time></a>
&lt;<span class='nick nick-8'> promag</span>&gt;
#13825 in HP?
<br>
</div>

<div class='talk op-msg' data-timestamp='1535489640' id='628175'>
<a class='timestamp' href='#628175'><time timestamp='2018-08-28T20:54:00Z'>20:54</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/13825" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/13825</a> | [wallet] Kill accounts by jnewbery · Pull Request #13825 · bitcoin/bitcoin · GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1535491080' id='628176'>
<a class='timestamp' href='#628176'><time timestamp='2018-08-28T21:18:00Z'>21:18</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: interesting to note: 4(magic) + 12(command) + 4(length) + 4(sha2) = 24  which is more than 3 (length) + 1(type) + 16(mac) = 20  for messages that can use the 1-byte type.
<br>
</div>

<div class='talk op-msg' data-timestamp='1535494740' id='628177'>
<a class='timestamp' href='#628177'><time timestamp='2018-08-28T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-15'> Chris_Stewart_5</span>&gt;
luke-jr: I could get my hands on a goat -- don&#x27;t think i could sacrifice it though. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1535494740' id='628178'>
<a class='timestamp' href='#628178'><time timestamp='2018-08-28T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-15'> Chris_Stewart_5</span>&gt;
;)
<br>
</div>

</div>
</section>

</body>
</html>
