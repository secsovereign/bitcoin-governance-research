<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2018-08-11
 â€” 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2018-08-11' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:21 UTC</pre>
<pre><a href="/bitcoin-core-dev/2018-07-11">&lt;</a><span class='header'>   August 2018    </span><a href="/bitcoin-core-dev/2018-09-11">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;          <a class="" href="/bitcoin-core-dev/2018-08-01">1</a>  <a class="" href="/bitcoin-core-dev/2018-08-02">2</a>  <a class="" href="/bitcoin-core-dev/2018-08-03">3</a>  <a class="" href="/bitcoin-core-dev/2018-08-04">4</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2018-08-05">5</a>  <a class="" href="/bitcoin-core-dev/2018-08-06">6</a>  <a class="" href="/bitcoin-core-dev/2018-08-07">7</a>  <a class="" href="/bitcoin-core-dev/2018-08-08">8</a>  <a class="" href="/bitcoin-core-dev/2018-08-09">9</a> <a class="" href="/bitcoin-core-dev/2018-08-10">10</a> <a class="current" href="/bitcoin-core-dev/2018-08-11">11</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-08-12">12</a> <a class="" href="/bitcoin-core-dev/2018-08-13">13</a> <a class="" href="/bitcoin-core-dev/2018-08-14">14</a> <a class="" href="/bitcoin-core-dev/2018-08-15">15</a> <a class="" href="/bitcoin-core-dev/2018-08-16">16</a> <a class="" href="/bitcoin-core-dev/2018-08-17">17</a> <a class="" href="/bitcoin-core-dev/2018-08-18">18</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-08-19">19</a> <a class="" href="/bitcoin-core-dev/2018-08-20">20</a> <a class="" href="/bitcoin-core-dev/2018-08-21">21</a> <a class="" href="/bitcoin-core-dev/2018-08-22">22</a> <a class="" href="/bitcoin-core-dev/2018-08-23">23</a> <a class="" href="/bitcoin-core-dev/2018-08-24">24</a> <a class="" href="/bitcoin-core-dev/2018-08-25">25</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-08-26">26</a> <a class="" href="/bitcoin-core-dev/2018-08-27">27</a> <a class="" href="/bitcoin-core-dev/2018-08-28">28</a> <a class="" href="/bitcoin-core-dev/2018-08-29">29</a> <a class="" href="/bitcoin-core-dev/2018-08-30">30</a> <a class="" href="/bitcoin-core-dev/2018-08-31">31</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1533952020' id='624249'>
<a class='timestamp' href='#624249'><time timestamp='2018-08-11T01:47:00Z'>01:47</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
[ot followup] ossifrage: Their blinking patent filings more or less confirm it was an intentional backdoor: <a href="http://i.blackhat.com/us-18/Thu-August-9/us-18-Domas-God-Mode-Unlocked-Hardware-Backdoors-In-x86-CPUs.pdf" class="link" target="_blank">http://i.blackhat.com/us-18/Thu-August-9/us-18-Domas-God-Mode-Unlocked-Hardware-Backdoors-In-x86-CPUs.pdf</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1534014900' id='624250'>
<a class='timestamp' href='#624250'><time timestamp='2018-08-11T19:15:00Z'>19:15</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I think the BIP151 proposed handshake requires some overhaul
<br>
</div>

<div class='talk op-msg' data-timestamp='1534014960' id='624251'>
<a class='timestamp' href='#624251'><time timestamp='2018-08-11T19:16:00Z'>19:16</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Non ideal is two simultaneous message push during encack
<br>
</div>

<div class='talk op-msg' data-timestamp='1534014960' id='624252'>
<a class='timestamp' href='#624252'><time timestamp='2018-08-11T19:16:00Z'>19:16</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
The current flow is...
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015020' id='624253'>
<a class='timestamp' href='#624253'><time timestamp='2018-08-11T19:17:00Z'>19:17</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
1. requesting peer asks for encryption sends &quot;encint&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015020' id='624254'>
<a class='timestamp' href='#624254'><time timestamp='2018-08-11T19:17:00Z'>19:17</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
before or after version/verack?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015020' id='624255'>
<a class='timestamp' href='#624255'><time timestamp='2018-08-11T19:17:00Z'>19:17</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
2. remote peer give its &quot;encack&quot;,.. but then require to ask also for an &quot;encinit&quot; for the other-way communication (sends two messages the same time)
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015020' id='624256'>
<a class='timestamp' href='#624256'><time timestamp='2018-08-11T19:17:00Z'>19:17</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa: thats another topic
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015080' id='624257'>
<a class='timestamp' href='#624257'><time timestamp='2018-08-11T19:18:00Z'>19:18</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
3. requesting peeer sends its &quot;encack&quot; and a &quot;version&quot; message (one unencrypted, one encrypted)
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015080' id='624258'>
<a class='timestamp' href='#624258'><time timestamp='2018-08-11T19:18:00Z'>19:18</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa: right now, my implementation sends it before the version... which is also not ideal.. means not really backward compatible
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015140' id='624259'>
<a class='timestamp' href='#624259'><time timestamp='2018-08-11T19:19:00Z'>19:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
my preference would to throw it all away, and just start with a completely new protocol, not embedded in the old one; if you get disconnected when trying the encrypted proto, mark the peer as not supporting encryption, and retry another peer
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015140' id='624260'>
<a class='timestamp' href='#624260'><time timestamp='2018-08-11T19:19:00Z'>19:19</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and have a service flag for encryption
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015140' id='624261'>
<a class='timestamp' href='#624261'><time timestamp='2018-08-11T19:19:00Z'>19:19</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa: I came to the same conclusion... 
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015200' id='624262'>
<a class='timestamp' href='#624262'><time timestamp='2018-08-11T19:20:00Z'>19:20</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
But in oder to &quot;see&quot; the service flag, you need to talk with the legacy protocol... or do you mean more for addman/dns seeds, etc.?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015200' id='624263'>
<a class='timestamp' href='#624263'><time timestamp='2018-08-11T19:20:00Z'>19:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
well you learn the IP of a peer whomewhere
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015200' id='624264'>
<a class='timestamp' href='#624264'><time timestamp='2018-08-11T19:20:00Z'>19:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
generally that somewhere has service flags
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015200' id='624265'>
<a class='timestamp' href='#624265'><time timestamp='2018-08-11T19:20:00Z'>19:20</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. Right...
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015260' id='624266'>
<a class='timestamp' href='#624266'><time timestamp='2018-08-11T19:21:00Z'>19:21</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if the service flag says encryption supported, you try an encrypted connection
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015260' id='624267'>
<a class='timestamp' href='#624267'><time timestamp='2018-08-11T19:21:00Z'>19:21</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
The handshake could just be a pubkey from both sides (eventually a checksum)
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015380' id='624268'>
<a class='timestamp' href='#624268'><time timestamp='2018-08-11T19:23:00Z'>19:23</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Maybe the handshake could be: (peer A) -&gt; &lt;pubkey|cipher|4byte_hash_checksum&gt;, (peer B) &lt;- &lt;pubkey|4byte_hash_checksum&gt;
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015440' id='624269'>
<a class='timestamp' href='#624269'><time timestamp='2018-08-11T19:24:00Z'>19:24</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa: for encryption both (incoming / outgoing) channel, would it make sense to do... (peer A) -&gt; &lt;pubkey|cipher|4byte_hash_checksum&gt; (peer B) &lt;- &lt;pubkey|pubkey|4byte_hash_checksum&gt; (peer A) -&gt; &lt;pubkey|cipher|4byte_hash_checksum&gt;?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015500' id='624270'>
<a class='timestamp' href='#624270'><time timestamp='2018-08-11T19:25:00Z'>19:25</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
encryption setup can by symmetric, i think
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015500' id='624271'>
<a class='timestamp' href='#624271'><time timestamp='2018-08-11T19:25:00Z'>19:25</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa: you mean only one negotiation?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015500' id='624272'>
<a class='timestamp' href='#624272'><time timestamp='2018-08-11T19:25:00Z'>19:25</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015500' id='624273'>
<a class='timestamp' href='#624273'><time timestamp='2018-08-11T19:25:00Z'>19:25</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I asked myself what the reason was for both direction encryption... 
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015500' id='624274'>
<a class='timestamp' href='#624274'><time timestamp='2018-08-11T19:25:00Z'>19:25</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
(two secrets)
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015560' id='624275'>
<a class='timestamp' href='#624275'><time timestamp='2018-08-11T19:26:00Z'>19:26</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
for authentication it makes sense to split it up
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015560' id='624276'>
<a class='timestamp' href='#624276'><time timestamp='2018-08-11T19:26:00Z'>19:26</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
yes. that is another thing..
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015560' id='624277'>
<a class='timestamp' href='#624277'><time timestamp='2018-08-11T19:26:00Z'>19:26</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
also for embedding it in the old protocol, perhaps splitting up made sense
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015620' id='624278'>
<a class='timestamp' href='#624278'><time timestamp='2018-08-11T19:27:00Z'>19:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
because you have an asynchronous thing to embed it into
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015620' id='624279'>
<a class='timestamp' href='#624279'><time timestamp='2018-08-11T19:27:00Z'>19:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but if there is an entirely new protocol, not so much
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015620' id='624280'>
<a class='timestamp' href='#624280'><time timestamp='2018-08-11T19:27:00Z'>19:27</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
What do you mean with &quot;asynchronous thing&quot;. The uncontrollable timing of messages?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015620' id='624281'>
<a class='timestamp' href='#624281'><time timestamp='2018-08-11T19:27:00Z'>19:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes, you need a well-identifiable point when encryption starts for both directions
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015680' id='624282'>
<a class='timestamp' href='#624282'><time timestamp='2018-08-11T19:28:00Z'>19:28</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: opinions?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015680' id='624283'>
<a class='timestamp' href='#624283'><time timestamp='2018-08-11T19:28:00Z'>19:28</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. That is currently a problem in the implementation
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015680' id='624284'>
<a class='timestamp' href='#624284'><time timestamp='2018-08-11T19:28:00Z'>19:28</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Currently, the second encack will enable the encryption,... since it&#x27;s before the version, no other messages should interfere
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015740' id='624285'>
<a class='timestamp' href='#624285'><time timestamp='2018-08-11T19:29:00Z'>19:29</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I like handshakes that just send pubkeys because they&#x27;re harder to DPI match.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015740' id='624286'>
<a class='timestamp' href='#624286'><time timestamp='2018-08-11T19:29:00Z'>19:29</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
but sending the encack along with the version message (two PushMessage in the same codeblock, one plan, the other encrypted) result in things not working as it should
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015800' id='624287'>
<a class='timestamp' href='#624287'><time timestamp='2018-08-11T19:30:00Z'>19:30</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: but do we need two ECDH handshakes for both com directions?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015860' id='624288'>
<a class='timestamp' href='#624288'><time timestamp='2018-08-11T19:31:00Z'>19:31</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
IMHO: (peer A) -&gt; &lt;pubkey|cipher|4byte_hash_checksum&gt;, (peer B) &lt;- &lt;pubkey|4byte_hash_checksum&gt; should be enough and no communication should happend before this handshake is complete in the new p2p protocol
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015860' id='624289'>
<a class='timestamp' href='#624289'><time timestamp='2018-08-11T19:31:00Z'>19:31</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
You need one ECDH, but that requires two messages.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015860' id='624290'>
<a class='timestamp' href='#624290'><time timestamp='2018-08-11T19:31:00Z'>19:31</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
why even send cipher and checksum?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015920' id='624291'>
<a class='timestamp' href='#624291'><time timestamp='2018-08-11T19:32:00Z'>19:32</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: BIP151 currently require that both peers initiate a ECDH handshake. There are two secrets (one for incomming one for outgoind encryption)
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015920' id='624292'>
<a class='timestamp' href='#624292'><time timestamp='2018-08-11T19:32:00Z'>19:32</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Well there is no reason to do that.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015920' id='624293'>
<a class='timestamp' href='#624293'><time timestamp='2018-08-11T19:32:00Z'>19:32</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Okay... :/
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015980' id='624294'>
<a class='timestamp' href='#624294'><time timestamp='2018-08-11T19:33:00Z'>19:33</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
in the old embedded protocol it was necessaey because it would be hard to coordinate the encryption switchover point otherwise
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015980' id='624295'>
<a class='timestamp' href='#624295'><time timestamp='2018-08-11T19:33:00Z'>19:33</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
if you start with a completely new protocol i don&#x27;t think there is any reason to not just do a single negotiation
<br>
</div>

<div class='talk op-msg' data-timestamp='1534015980' id='624296'>
<a class='timestamp' href='#624296'><time timestamp='2018-08-11T19:33:00Z'>19:33</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. But the question then would be, is the second encryption handshake partially encrypted since one channel is &quot;ready&quot;?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016040' id='624297'>
<a class='timestamp' href='#624297'><time timestamp='2018-08-11T19:34:00Z'>19:34</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
You can have simply: Client connects, sends a 32 byte pubkey. Server responds with its 32 byte pubkey, and an encrypted stream.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016040' id='624298'>
<a class='timestamp' href='#624298'><time timestamp='2018-08-11T19:34:00Z'>19:34</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: agree. What do you think by adding one byte for a possible cipherscheme upgrade (first message only)?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016100' id='624299'>
<a class='timestamp' href='#624299'><time timestamp='2018-08-11T19:35:00Z'>19:35</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
(peer A) -&gt; &lt;pubkey|cipher_1BYTE|4byte_hash_checksum&gt;, (peer B) &lt;- &lt;pubkey|4byte_hash_checksum&gt;
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016100' id='624300'>
<a class='timestamp' href='#624300'><time timestamp='2018-08-11T19:35:00Z'>19:35</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
4byte checksum required? or a crc? or nothing and detect it via wrong shared secret?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016100' id='624301'>
<a class='timestamp' href='#624301'><time timestamp='2018-08-11T19:35:00Z'>19:35</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
well that cipher can&#x27;t be encrypted or authenticated.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016100' id='624302'>
<a class='timestamp' href='#624302'><time timestamp='2018-08-11T19:35:00Z'>19:35</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
If the shared secret is wrong auth will fail on the first message. So I don&#x27;t see any reason for a checksum.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016160' id='624303'>
<a class='timestamp' href='#624303'><time timestamp='2018-08-11T19:36:00Z'>19:36</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Also just sending as little as possible makes it maximally hard to DPI match the traffic.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016160' id='624304'>
<a class='timestamp' href='#624304'><time timestamp='2018-08-11T19:36:00Z'>19:36</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. Agree, a week cipher attack would be possible,.. better drop that
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016160' id='624305'>
<a class='timestamp' href='#624305'><time timestamp='2018-08-11T19:36:00Z'>19:36</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Which shouldn&#x27;t be a primary goal, but it&#x27;s nice if we can have it for nearly free.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016220' id='624306'>
<a class='timestamp' href='#624306'><time timestamp='2018-08-11T19:37:00Z'>19:37</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I guess DPI could identify two 33byte packages (you wrote 32byte pubkey above, incorrect?) followed by a package of &quot;versionmessage&quot;-length?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016220' id='624307'>
<a class='timestamp' href='#624307'><time timestamp='2018-08-11T19:37:00Z'>19:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: we could signal ciphers, but in the server to client direction, where it could be encrypted and authenticated with the shared secret.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016220' id='624308'>
<a class='timestamp' href='#624308'><time timestamp='2018-08-11T19:37:00Z'>19:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
it would be best to use 32 byte pubkeys, which are close to uniform. The 33 byte encoding is really identifyable.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016220' id='624309'>
<a class='timestamp' href='#624309'><time timestamp='2018-08-11T19:37:00Z'>19:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: just drop the 02/03 first byte of the pubkey
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016220' id='624310'>
<a class='timestamp' href='#624310'><time timestamp='2018-08-11T19:37:00Z'>19:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and assume it&#x27;s always 02
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016280' id='624311'>
<a class='timestamp' href='#624311'><time timestamp='2018-08-11T19:38:00Z'>19:38</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
whats sipa says.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016280' id='624312'>
<a class='timestamp' href='#624312'><time timestamp='2018-08-11T19:38:00Z'>19:38</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
ack
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016280' id='624313'>
<a class='timestamp' href='#624313'><time timestamp='2018-08-11T19:38:00Z'>19:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
i have a writeup on how to do ECDH over secp256k1 in a completely unidentifiable way
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016280' id='624314'>
<a class='timestamp' href='#624314'><time timestamp='2018-08-11T19:38:00Z'>19:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but it&#x27;s pretty complicated and not worth it imho
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016280' id='624315'>
<a class='timestamp' href='#624315'><time timestamp='2018-08-11T19:38:00Z'>19:38</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
There are techniques to encode keys which are closer to uniform, but it&#x27;s unclear if its worth the complexity.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016280' id='624316'>
<a class='timestamp' href='#624316'><time timestamp='2018-08-11T19:38:00Z'>19:38</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
derive emphemeral keys until pubkey start with 02?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016280' id='624317'>
<a class='timestamp' href='#624317'><time timestamp='2018-08-11T19:38:00Z'>19:38</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Esp since the send 32 bytes each way pattern is pretty identiable.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016280' id='624318'>
<a class='timestamp' href='#624318'><time timestamp='2018-08-11T19:38:00Z'>19:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: just negate your key if it has a 03 pubkey
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016340' id='624319'>
<a class='timestamp' href='#624319'><time timestamp='2018-08-11T19:39:00Z'>19:39</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
ack
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016340' id='624320'>
<a class='timestamp' href='#624320'><time timestamp='2018-08-11T19:39:00Z'>19:39</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the negation will be a 02 pubkey
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016340' id='624321'>
<a class='timestamp' href='#624321'><time timestamp='2018-08-11T19:39:00Z'>19:39</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: if K starts with 03 then -K is the 02 version.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016340' id='624322'>
<a class='timestamp' href='#624322'><time timestamp='2018-08-11T19:39:00Z'>19:39</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I guess that code change would belong into the secp256k1 sources?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016400' id='624323'>
<a class='timestamp' href='#624323'><time timestamp='2018-08-11T19:40:00Z'>19:40</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
at least with this there are no fixed bytes to match on, which at least kills the dumbest DPI.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016460' id='624324'>
<a class='timestamp' href='#624324'><time timestamp='2018-08-11T19:41:00Z'>19:41</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
in any case, once you have a shared session key you can use hashing to get keys for encrypt and auth in each direction.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016460' id='624325'>
<a class='timestamp' href='#624325'><time timestamp='2018-08-11T19:41:00Z'>19:41</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
(and for a session identifier that can get shown in RPC and which the later auth stuff will act on)
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016520' id='624326'>
<a class='timestamp' href='#624326'><time timestamp='2018-08-11T19:42:00Z'>19:42</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. I already added the HKDF derived session ID via RPC to allow detecting an MITM
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016520' id='624327'>
<a class='timestamp' href='#624327'><time timestamp='2018-08-11T19:42:00Z'>19:42</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: but would two encryption key for each direction be required?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016580' id='624328'>
<a class='timestamp' href='#624328'><time timestamp='2018-08-11T19:43:00Z'>19:43</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Yes. there are attacks otherwise.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016580' id='624329'>
<a class='timestamp' href='#624329'><time timestamp='2018-08-11T19:43:00Z'>19:43</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Do you mind give me a hint where I can read that up?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016640' id='624330'>
<a class='timestamp' href='#624330'><time timestamp='2018-08-11T19:44:00Z'>19:44</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
just generate them like H(shared_secret||direction||enc_or_auth)  e.g. H(secret||0||0) or similar.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016640' id='624331'>
<a class='timestamp' href='#624331'><time timestamp='2018-08-11T19:44:00Z'>19:44</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yup. Will do...
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016640' id='624332'>
<a class='timestamp' href='#624332'><time timestamp='2018-08-11T19:44:00Z'>19:44</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
where 0 is the side that connected, and 1 is the side that accepted the connection, e.g.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016640' id='624333'>
<a class='timestamp' href='#624333'><time timestamp='2018-08-11T19:44:00Z'>19:44</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: we use a stream cipher <u>_ANY_</u> reuse of the secret is fatal because an attacker can xor the two ciphertexts and learn the xor of the messages.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016700' id='624334'>
<a class='timestamp' href='#624334'><time timestamp='2018-08-11T19:45:00Z'>19:45</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I guess this is the never reuse nonce&amp;key? Right? And we can&#x27;t control the sequence number (==nonce) in a bidirectional/async protocol?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016760' id='624335'>
<a class='timestamp' href='#624335'><time timestamp='2018-08-11T19:46:00Z'>19:46</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
we should get this done before I start proposing we use <a href="https://gitweb.torproject.org/user/isis/torspec.git/plain/proposals/XXX-newhope-hybrid-handshake.txt?h=draft" class="link" target="_blank">https://gitweb.torproject.org/user/isis/torspec.git/plain/proposals/XXX-newhope-hybrid-handshake.txt?h=draft</a>/newhope (but with secp256k1 instead of ed25519 for code reuse reasons)
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016820' id='624336'>
<a class='timestamp' href='#624336'><time timestamp='2018-08-11T19:47:00Z'>19:47</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: well I assume our sequence number is just starting at zero in each direction. You could hard partition the sequence space for each direction and be okay, but that seems about as complex as just derriving different values for each direction entirely, and more failure prone.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016820' id='624337'>
<a class='timestamp' href='#624337'><time timestamp='2018-08-11T19:47:00Z'>19:47</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I see. Yes. Makes sense.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016880' id='624338'>
<a class='timestamp' href='#624338'><time timestamp='2018-08-11T19:48:00Z'>19:48</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
I&#x27;m going to write an overhaul of BIP151 (I hope nobody complain since it initial draft has been published via the BIPS long long ago). I know Armory has a complete implementation and they may not like the fact that they need to rewrite some parts
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016940' id='624339'>
<a class='timestamp' href='#624339'><time timestamp='2018-08-11T19:49:00Z'>19:49</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
But I guess the changes are not too significant
<br>
</div>

<div class='talk op-msg' data-timestamp='1534016940' id='624340'>
<a class='timestamp' href='#624340'><time timestamp='2018-08-11T19:49:00Z'>19:49</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
if someone complaints, you can just make a new BIP number... and they can stay using the old one: after all, they weren&#x27;t talking to us with it anyways.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534017000' id='624341'>
<a class='timestamp' href='#624341'><time timestamp='2018-08-11T19:50:00Z'>19:50</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Right,...
<br>
</div>

<div class='talk op-msg' data-timestamp='1534017120' id='624342'>
<a class='timestamp' href='#624342'><time timestamp='2018-08-11T19:52:00Z'>19:52</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
gmaxwell: if the ciphertype (which we just dropped) in the handshake request would be part of the encryption and authentication key, wouldn&#x27;t this mean its not attackable?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534017120' id='624343'>
<a class='timestamp' href='#624343'><time timestamp='2018-08-11T19:52:00Z'>19:52</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Like H(shared_secret||direction||enc_or_auth||ciphertype)
<br>
</div>

<div class='talk op-msg' data-timestamp='1534017300' id='624344'>
<a class='timestamp' href='#624344'><time timestamp='2018-08-11T19:55:00Z'>19:55</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
depends on how you handle failure...
<br>
</div>

<div class='talk op-msg' data-timestamp='1534017300' id='624345'>
<a class='timestamp' href='#624345'><time timestamp='2018-08-11T19:55:00Z'>19:55</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I mean if we only implement 1 on day one, then anyone trying to use 2 will expect it to fail and then need to retry.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534017300' id='624346'>
<a class='timestamp' href='#624346'><time timestamp='2018-08-11T19:55:00Z'>19:55</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
so by just blocking 2 you can force the use of 1.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534017360' id='624347'>
<a class='timestamp' href='#624347'><time timestamp='2018-08-11T19:56:00Z'>19:56</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
good point
<br>
</div>

<div class='talk op-msg' data-timestamp='1534017420' id='624348'>
<a class='timestamp' href='#624348'><time timestamp='2018-08-11T19:57:00Z'>19:57</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I assume if we change ciphers it would just be to something totally different, probably also at that point adding post-quantum key argreement like the hybrid above.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534017420' id='624349'>
<a class='timestamp' href='#624349'><time timestamp='2018-08-11T19:57:00Z'>19:57</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. I see that and I agree adding the 1byte ciphertype seems a bit pointless
<br>
</div>

<div class='talk op-msg' data-timestamp='1534017480' id='624350'>
<a class='timestamp' href='#624350'><time timestamp='2018-08-11T19:58:00Z'>19:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
it&#x27;s just kind of unfortunate that AES uses less power on hardware that has it, but is otherwise really slow.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534020780' id='624351'>
<a class='timestamp' href='#624351'><time timestamp='2018-08-11T20:53:00Z'>20:53</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
sipa, gmaxwell: if we negate K in case of an ODD pubkey (0x03), don&#x27;t we reduce the possible keyspace and therefore the bits of security?
<br>
</div>

<div class='talk op-msg' data-timestamp='1534021320' id='624352'>
<a class='timestamp' href='#624352'><time timestamp='2018-08-11T21:02:00Z'>21:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: at worst, it&#x27;s a 1 bit security loss
<br>
</div>

<div class='talk op-msg' data-timestamp='1534021320' id='624353'>
<a class='timestamp' href='#624353'><time timestamp='2018-08-11T21:02:00Z'>21:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
jonasschnelli: ECDSA does the same internally, btw
<br>
</div>

<div class='talk op-msg' data-timestamp='1534021380' id='624354'>
<a class='timestamp' href='#624354'><time timestamp='2018-08-11T21:03:00Z'>21:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
the public nonce is encoded in the signature with only its x coordinate
<br>
</div>

<div class='talk op-msg' data-timestamp='1534023000' id='624355'>
<a class='timestamp' href='#624355'><time timestamp='2018-08-11T21:30:00Z'>21:30</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: there is no reduction in any case, because 0x02 vs 0x02 would be visible in public in any case.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534023060' id='624356'>
<a class='timestamp' href='#624356'><time timestamp='2018-08-11T21:31:00Z'>21:31</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: maybe we should consider merging in RLWE, there is a small, tidy, BSD licensed C implementation.  The motivation is that for encrypted communication there is an incentive for an attacker to log all the traffic and then years later, when ECDH in secp256k1 is weakened, go and crack past logged connections.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534023120' id='624357'>
<a class='timestamp' href='#624357'><time timestamp='2018-08-11T21:32:00Z'>21:32</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
the hybrid proposal I linked to just runs RLWE and ECDH in parallel and hashes them both into the shared secret.
<br>
</div>

<div class='talk op-msg' data-timestamp='1534023180' id='624358'>
<a class='timestamp' href='#624358'><time timestamp='2018-08-11T21:33:00Z'>21:33</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
jonasschnelli: I forget now, how does your proposal handle rotating the symmetric keys? are they updated with hashing after some fixed interval?
<br>
</div>

</div>
</section>

</body>
</html>
