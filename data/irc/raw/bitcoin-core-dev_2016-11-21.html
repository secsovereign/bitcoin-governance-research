<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2016-11-21
 — 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2016-11-21' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:25 UTC</pre>
<pre><a href="/bitcoin-core-dev/2016-10-21">&lt;</a><span class='header'>  November 2016   </span><a href="/bitcoin-core-dev/2016-12-21">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;       <a class="" href="/bitcoin-core-dev/2016-11-01">1</a>  <a class="" href="/bitcoin-core-dev/2016-11-02">2</a>  <a class="" href="/bitcoin-core-dev/2016-11-03">3</a>  <a class="" href="/bitcoin-core-dev/2016-11-04">4</a>  <a class="" href="/bitcoin-core-dev/2016-11-05">5</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2016-11-06">6</a>  <a class="" href="/bitcoin-core-dev/2016-11-07">7</a>  <a class="" href="/bitcoin-core-dev/2016-11-08">8</a>  <a class="" href="/bitcoin-core-dev/2016-11-09">9</a> <a class="" href="/bitcoin-core-dev/2016-11-10">10</a> <a class="" href="/bitcoin-core-dev/2016-11-11">11</a> <a class="" href="/bitcoin-core-dev/2016-11-12">12</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2016-11-13">13</a> <a class="" href="/bitcoin-core-dev/2016-11-14">14</a> <a class="" href="/bitcoin-core-dev/2016-11-15">15</a> <a class="" href="/bitcoin-core-dev/2016-11-16">16</a> <a class="" href="/bitcoin-core-dev/2016-11-17">17</a> <a class="" href="/bitcoin-core-dev/2016-11-18">18</a> <a class="" href="/bitcoin-core-dev/2016-11-19">19</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2016-11-20">20</a> <a class="current" href="/bitcoin-core-dev/2016-11-21">21</a> <a class="" href="/bitcoin-core-dev/2016-11-22">22</a> <a class="" href="/bitcoin-core-dev/2016-11-23">23</a> <a class="" href="/bitcoin-core-dev/2016-11-24">24</a> <a class="" href="/bitcoin-core-dev/2016-11-25">25</a> <a class="" href="/bitcoin-core-dev/2016-11-26">26</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2016-11-27">27</a> <a class="" href="/bitcoin-core-dev/2016-11-28">28</a> <a class="" href="/bitcoin-core-dev/2016-11-29">29</a> <a class="" href="/bitcoin-core-dev/2016-11-30">30</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1479713820' id='512130'>
<a class='timestamp' href='#512130'><time timestamp='2016-11-21T07:37:00Z'>07:37</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj closed pull request #9193: Update copyright year to 2016 (master...patch-1) <a href="https://github.com/bitcoin/bitcoin/pull/9193" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9193</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479721920' id='512131'>
<a class='timestamp' href='#512131'><time timestamp='2016-11-21T09:52:00Z'>09:52</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj pushed 5 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/44adf683ad23...7490ae8b699d" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/44adf683ad23...7490ae8b699d</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479721920' id='512132'>
<a class='timestamp' href='#512132'><time timestamp='2016-11-21T09:52:00Z'>09:52</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 0e85204 Pieter Wuille: Add serialization for unique_ptr and shared_ptr
<br>
</div>

<div class='talk op-msg' data-timestamp='1479721920' id='512133'>
<a class='timestamp' href='#512133'><time timestamp='2016-11-21T09:52:00Z'>09:52</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master da60506 Pieter Wuille: Add deserializing constructors to CTransaction and CMutableTransaction
<br>
</div>

<div class='talk op-msg' data-timestamp='1479721920' id='512134'>
<a class='timestamp' href='#512134'><time timestamp='2016-11-21T09:52:00Z'>09:52</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 1662b43 Pieter Wuille: Make CBlock::vtx a vector of shared_ptr&lt;CTransaction&gt;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479721920' id='512135'>
<a class='timestamp' href='#512135'><time timestamp='2016-11-21T09:52:00Z'>09:52</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj closed pull request #9125: Make CBlock a vector of shared_ptr of CTransactions (master...sharedblock) <a href="https://github.com/bitcoin/bitcoin/pull/9125" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9125</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479721920' id='512136'>
<a class='timestamp' href='#512136'><time timestamp='2016-11-21T09:52:00Z'>09:52</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
\O/     
<br>
</div>

<div class='talk op-msg' data-timestamp='1479723780' id='512137'>
<a class='timestamp' href='#512137'><time timestamp='2016-11-21T10:23:00Z'>10:23</time></a>
&lt;<span class='nick nick-4'> BlueMatt</span>&gt;
sipa: did you ever benchmark how much of #9125&#x27;s performance improvement was actually just the #9014 stuff? (I assume a lot, though the real benifit is compact block speedups here, which reindex cannot test)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479723780' id='512138'>
<a class='timestamp' href='#512138'><time timestamp='2016-11-21T10:23:00Z'>10:23</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/9125" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/9125</a> | Make CBlock a vector of shared_ptr of CTransactions by sipa · Pull Request #9125 · bitcoin/bitcoin · GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1479723780' id='512139'>
<a class='timestamp' href='#512139'><time timestamp='2016-11-21T10:23:00Z'>10:23</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/9014" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/9014</a> | Fix block-connection performance regression by TheBlueMatt · Pull Request #9014 · bitcoin/bitcoin · GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1479725460' id='512140'>
<a class='timestamp' href='#512140'><time timestamp='2016-11-21T10:51:00Z'>10:51</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/7490ae8b699d...c3906403c8ed" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/7490ae8b699d...c3906403c8ed</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479725460' id='512141'>
<a class='timestamp' href='#512141'><time timestamp='2016-11-21T10:51:00Z'>10:51</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 4662553 Cory Fields: net: don&#x27;t send feefilter messages before the version handshake is complete
<br>
</div>

<div class='talk op-msg' data-timestamp='1479725460' id='512142'>
<a class='timestamp' href='#512142'><time timestamp='2016-11-21T10:51:00Z'>10:51</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master c390640 Wladimir J. van der Laan: Merge #9117: net: don&#x27;t send feefilter messages before the version handshake is complete...
<br>
</div>

<div class='talk op-msg' data-timestamp='1479725460' id='512143'>
<a class='timestamp' href='#512143'><time timestamp='2016-11-21T10:51:00Z'>10:51</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj closed pull request #9117: net: don&#x27;t send feefilter messages before the version handshake is complete (master...feefilter-assert) <a href="https://github.com/bitcoin/bitcoin/pull/9117" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9117</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479732540' id='512144'>
<a class='timestamp' href='#512144'><time timestamp='2016-11-21T12:49:00Z'>12:49</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
wumpus: do you have plans to rebase #7729? Otherwise I can pick it up.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479732540' id='512145'>
<a class='timestamp' href='#512145'><time timestamp='2016-11-21T12:49:00Z'>12:49</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/7729" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/7729</a> | An error has occurred and has been logged. Please contact this bot&#x27;s administrator for more information.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479732540' id='512146'>
<a class='timestamp' href='#512146'><time timestamp='2016-11-21T12:49:00Z'>12:49</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes, I&#x27;ll get back to that at some point
<br>
</div>

<div class='talk op-msg' data-timestamp='1479732600' id='512147'>
<a class='timestamp' href='#512147'><time timestamp='2016-11-21T12:50:00Z'>12:50</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
happy some people are finally commenting on the API
<br>
</div>

<div class='talk op-msg' data-timestamp='1479732720' id='512148'>
<a class='timestamp' href='#512148'><time timestamp='2016-11-21T12:52:00Z'>12:52</time></a>
&lt;<span class='nick nick-13'> jonasschnelli</span>&gt;
Yes. Thanks to last weeks meeting.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479734400' id='512149'>
<a class='timestamp' href='#512149'><time timestamp='2016-11-21T13:20:00Z'>13:20</time></a>
&lt;<span class='nick nick-11'> instagibbs</span>&gt;
wumpus, I&#x27;m not an old timer, which is why I&#x27;m asking more basic account questions. It&#x27;s always been deprecated in my Bitcoin lifetime :P
<br>
</div>

<div class='talk op-msg' data-timestamp='1479734460' id='512150'>
<a class='timestamp' href='#512150'><time timestamp='2016-11-21T13:21:00Z'>13:21</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
right, it&#x27;s always been deprecated, it&#x27;s time to move forward there
<br>
</div>

<div class='talk op-msg' data-timestamp='1479734460' id='512151'>
<a class='timestamp' href='#512151'><time timestamp='2016-11-21T13:21:00Z'>13:21</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
&quot;always&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479734520' id='512152'>
<a class='timestamp' href='#512152'><time timestamp='2016-11-21T13:22:00Z'>13:22</time></a>
&lt;<span class='nick nick-11'> instagibbs</span>&gt;
But my assumption is correct, yes? That accounts gave balances which were often screwy/inconsistent, people should be doing this at higher layers by getting lists of outputs under labels or whatever?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479734580' id='512153'>
<a class='timestamp' href='#512153'><time timestamp='2016-11-21T13:23:00Z'>13:23</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
yes, it&#x27;s a mess, people have shot themselves in the foot using it many times, and also most expect it to be something else than it is (eg &quot;subwallets&quot; with their own utxos)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479734580' id='512154'>
<a class='timestamp' href='#512154'><time timestamp='2016-11-21T13:23:00Z'>13:23</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
it&#x27;s indeed not something that belongs at the wallet level
<br>
</div>

<div class='talk op-msg' data-timestamp='1479734580' id='512155'>
<a class='timestamp' href='#512155'><time timestamp='2016-11-21T13:23:00Z'>13:23</time></a>
&lt;<span class='nick nick-11'> instagibbs</span>&gt;
Yes I recall finding the comment in code about using * was incorrect in retrieving same balances, but I couldn&#x27;t even describe the replacement text and gave up
<br>
</div>

<div class='talk op-msg' data-timestamp='1479734940' id='512156'>
<a class='timestamp' href='#512156'><time timestamp='2016-11-21T13:29:00Z'>13:29</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
so should the argument to importaddress and sendtoaddress etc be called &quot;address&quot; or &quot;bitcoinaddress&quot;? we use a mix of both, which isn&#x27;t very consistent
<br>
</div>

<div class='talk op-msg' data-timestamp='1479735000' id='512157'>
<a class='timestamp' href='#512157'><time timestamp='2016-11-21T13:30:00Z'>13:30</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
same with importprivkey which uses &quot;bitcoinprivkey&quot; as argument name, but &quot;importpubkey&quot; which just uses &quot;pubkey&quot;. Should make these consistent for #8811
<br>
</div>

<div class='talk op-msg' data-timestamp='1479735000' id='512158'>
<a class='timestamp' href='#512158'><time timestamp='2016-11-21T13:30:00Z'>13:30</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/8811" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/8811</a> | rpc: Add support for JSON-RPC named arguments by laanwj · Pull Request #8811 · bitcoin/bitcoin · GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1479735000' id='512159'>
<a class='timestamp' href='#512159'><time timestamp='2016-11-21T13:30:00Z'>13:30</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
my preference would be the shorter name, it <b>*is*</b> bitcoin we don&#x27;t have any other context where we use address/pubkey/privkey
<br>
</div>

<div class='talk op-msg' data-timestamp='1479735300' id='512160'>
<a class='timestamp' href='#512160'><time timestamp='2016-11-21T13:35:00Z'>13:35</time></a>
&lt;<span class='nick nick-11'> instagibbs</span>&gt;
shorter is better unless it results in overload in the context
<br>
</div>

<div class='talk op-msg' data-timestamp='1479735360' id='512161'>
<a class='timestamp' href='#512161'><time timestamp='2016-11-21T13:36:00Z'>13:36</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
right
<br>
</div>

<div class='talk op-msg' data-timestamp='1479735360' id='512162'>
<a class='timestamp' href='#512162'><time timestamp='2016-11-21T13:36:00Z'>13:36</time></a>
&lt;<span class='nick nick-16'> wumpus</span>&gt;
changing to just &quot;address&quot; then
<br>
</div>

<div class='talk op-msg' data-timestamp='1479738480' id='512163'>
<a class='timestamp' href='#512163'><time timestamp='2016-11-21T14:28:00Z'>14:28</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/c3906403c8ed...b9a87b459d25" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/c3906403c8ed...b9a87b459d25</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479738480' id='512164'>
<a class='timestamp' href='#512164'><time timestamp='2016-11-21T14:28:00Z'>14:28</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master fa7cc5a MarcoFalke: Set DEFAULT_LIMITFREERELAY = 0 kB/minute
<br>
</div>

<div class='talk op-msg' data-timestamp='1479738480' id='512165'>
<a class='timestamp' href='#512165'><time timestamp='2016-11-21T14:28:00Z'>14:28</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master b9a87b4 Wladimir J. van der Laan: Merge #9179: Set DEFAULT_LIMITFREERELAY = 0 kB/minute...
<br>
</div>

<div class='talk op-msg' data-timestamp='1479738480' id='512166'>
<a class='timestamp' href='#512166'><time timestamp='2016-11-21T14:28:00Z'>14:28</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj closed pull request #9179: Set DEFAULT_LIMITFREERELAY = 0 kB/minute (master...Mf1611-blockFreeTxs) <a href="https://github.com/bitcoin/bitcoin/pull/9179" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9179</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479738780' id='512167'>
<a class='timestamp' href='#512167'><time timestamp='2016-11-21T14:33:00Z'>14:33</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj pushed 2 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/b9a87b459d25...210891143ba0" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/b9a87b459d25...210891143ba0</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479738780' id='512168'>
<a class='timestamp' href='#512168'><time timestamp='2016-11-21T14:33:00Z'>14:33</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 7451cf5 jnewbery: Allow bitcoin-tx to parse partial transactions...
<br>
</div>

<div class='talk op-msg' data-timestamp='1479738780' id='512169'>
<a class='timestamp' href='#512169'><time timestamp='2016-11-21T14:33:00Z'>14:33</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 2108911 Wladimir J. van der Laan: Merge #8837: allow bitcoin-tx to parse partial transactions...
<br>
</div>

<div class='talk op-msg' data-timestamp='1479738780' id='512170'>
<a class='timestamp' href='#512170'><time timestamp='2016-11-21T14:33:00Z'>14:33</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj closed pull request #8837: allow bitcoin-tx to parse partial transactions (master...bitcoin-tx-partial-transactions) <a href="https://github.com/bitcoin/bitcoin/pull/8837" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/8837</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479739260' id='512171'>
<a class='timestamp' href='#512171'><time timestamp='2016-11-21T14:41:00Z'>14:41</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj pushed 4 new commits to master: <a href="https://github.com/bitcoin/bitcoin/compare/210891143ba0...0c577f2638b7" class="link" target="_blank">https://github.com/bitcoin/bitcoin/compare/210891143ba0...0c577f2638b7</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479739260' id='512172'>
<a class='timestamp' href='#512172'><time timestamp='2016-11-21T14:41:00Z'>14:41</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master d768f15 mrbandrews: [qa] Make comptool push blocks instead of relying on inv-fetch
<br>
</div>

<div class='talk op-msg' data-timestamp='1479739260' id='512173'>
<a class='timestamp' href='#512173'><time timestamp='2016-11-21T14:41:00Z'>14:41</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 3451203 Matt Corallo: [qa] Respond to getheaders and do not assume a getdata on inv
<br>
</div>

<div class='talk op-msg' data-timestamp='1479739260' id='512174'>
<a class='timestamp' href='#512174'><time timestamp='2016-11-21T14:41:00Z'>14:41</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
bitcoin/master 037159c Matt Corallo: Remove block-request logic from INV message processing
<br>
</div>

<div class='talk op-msg' data-timestamp='1479739320' id='512175'>
<a class='timestamp' href='#512175'><time timestamp='2016-11-21T14:42:00Z'>14:42</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] laanwj closed pull request #8872: Remove block-request logic from INV message processing (master...fetchflags2) <a href="https://github.com/bitcoin/bitcoin/pull/8872" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/8872</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479744180' id='512176'>
<a class='timestamp' href='#512176'><time timestamp='2016-11-21T16:03:00Z'>16:03</time></a>
&lt;<span class='nick nick-11'> bitcoin-git</span>&gt;
[bitcoin] ryanofsky opened pull request #9196: Send tip change notification from invalidateblock (master...pr/notify-tip) <a href="https://github.com/bitcoin/bitcoin/pull/9196" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/9196</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479744840' id='512177'>
<a class='timestamp' href='#512177'><time timestamp='2016-11-21T16:14:00Z'>16:14</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
hi. I&#x27;ve got a transaction that&#x27;s somehow not relayed to the network. but when doing getrawtransaction and sendrawtransaction afterwards it&#x27;s relayed to the network
<br>
</div>

<div class='talk op-msg' data-timestamp='1479744840' id='512178'>
<a class='timestamp' href='#512178'><time timestamp='2016-11-21T16:14:00Z'>16:14</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
is this a known issue somehow?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479744900' id='512179'>
<a class='timestamp' href='#512179'><time timestamp='2016-11-21T16:15:00Z'>16:15</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
thermoman: is this for a brand new transaction you created, or an old wallet transaction?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479744960' id='512180'>
<a class='timestamp' href='#512180'><time timestamp='2016-11-21T16:16:00Z'>16:16</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
ok, it just was relayed to the network - but a hughe delay
<br>
</div>

<div class='talk op-msg' data-timestamp='1479744960' id='512181'>
<a class='timestamp' href='#512181'><time timestamp='2016-11-21T16:16:00Z'>16:16</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
sdaftuar: it&#x27;s a brand new tx
<br>
</div>

<div class='talk op-msg' data-timestamp='1479744960' id='512182'>
<a class='timestamp' href='#512182'><time timestamp='2016-11-21T16:16:00Z'>16:16</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
we have noticed big delays since 2 or 3 days
<br>
</div>

<div class='talk op-msg' data-timestamp='1479744960' id='512183'>
<a class='timestamp' href='#512183'><time timestamp='2016-11-21T16:16:00Z'>16:16</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
thermoman: define huge?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745020' id='512184'>
<a class='timestamp' href='#512184'><time timestamp='2016-11-21T16:17:00Z'>16:17</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
doing sendrawtransaction as a workaround after the initial TX the TX was then immediately visible
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745020' id='512185'>
<a class='timestamp' href='#512185'><time timestamp='2016-11-21T16:17:00Z'>16:17</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
thermoman: can you clarify how you&#x27;re telling that the tx is &quot;visible&quot;?  
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745020' id='512186'>
<a class='timestamp' href='#512186'><time timestamp='2016-11-21T16:17:00Z'>16:17</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
ie, visible on some 3rd party explorer?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745080' id='512187'>
<a class='timestamp' href='#512187'><time timestamp='2016-11-21T16:18:00Z'>16:18</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
or are you looking at your node&#x27;s relay behavior more directly?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745080' id='512188'>
<a class='timestamp' href='#512188'><time timestamp='2016-11-21T16:18:00Z'>16:18</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
lemme get that info from our dev
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745080' id='512189'>
<a class='timestamp' href='#512189'><time timestamp='2016-11-21T16:18:00Z'>16:18</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
I guess 3rd party
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745080' id='512190'>
<a class='timestamp' href='#512190'><time timestamp='2016-11-21T16:18:00Z'>16:18</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
like blockchain.info
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745080' id='512191'>
<a class='timestamp' href='#512191'><time timestamp='2016-11-21T16:18:00Z'>16:18</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
i query the dev right now
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745200' id='512192'>
<a class='timestamp' href='#512192'><time timestamp='2016-11-21T16:20:00Z'>16:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
also, what kind of delays are we talking about? second? minutes? hours?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745260' id='512193'>
<a class='timestamp' href='#512193'><time timestamp='2016-11-21T16:21:00Z'>16:21</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
<a href="http://pastebin.com/LXT4GmnP" class="link" target="_blank">http://pastebin.com/LXT4GmnP</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745260' id='512194'>
<a class='timestamp' href='#512194'><time timestamp='2016-11-21T16:21:00Z'>16:21</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
sipa, sdaftuar ^
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745320' id='512195'>
<a class='timestamp' href='#512195'><time timestamp='2016-11-21T16:22:00Z'>16:22</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
delay ~20 minutes
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745440' id='512196'>
<a class='timestamp' href='#512196'><time timestamp='2016-11-21T16:24:00Z'>16:24</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
thermoman: can you show a few lines that come after the first broadcast?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479745800' id='512197'>
<a class='timestamp' href='#512197'><time timestamp='2016-11-21T16:30:00Z'>16:30</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
sure, one moment
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746100' id='512198'>
<a class='timestamp' href='#512198'><time timestamp='2016-11-21T16:35:00Z'>16:35</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
sipa: <a href="http://pastebin.com/8TEFK0Ee" class="link" target="_blank">http://pastebin.com/8TEFK0Ee</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746100' id='512199'>
<a class='timestamp' href='#512199'><time timestamp='2016-11-21T16:35:00Z'>16:35</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
this comes directly below it
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746100' id='512200'>
<a class='timestamp' href='#512200'><time timestamp='2016-11-21T16:35:00Z'>16:35</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
the node in question is connected to a proxy node via connect=&lt;IP&gt;:8333
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746160' id='512201'>
<a class='timestamp' href='#512201'><time timestamp='2016-11-21T16:36:00Z'>16:36</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
it seems like the connection to the proxy node got reset
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746160' id='512202'>
<a class='timestamp' href='#512202'><time timestamp='2016-11-21T16:36:00Z'>16:36</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
all nodes run 0.13.1
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746160' id='512203'>
<a class='timestamp' href='#512203'><time timestamp='2016-11-21T16:36:00Z'>16:36</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
right, so you had no peer to broadcast to initially
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746220' id='512204'>
<a class='timestamp' href='#512204'><time timestamp='2016-11-21T16:37:00Z'>16:37</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
which would explain the delays you&#x27;re seeing, though it raises the question of why you&#x27;re getting disconnected
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746220' id='512205'>
<a class='timestamp' href='#512205'><time timestamp='2016-11-21T16:37:00Z'>16:37</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
right. the proxy node is on the LAN
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746280' id='512206'>
<a class='timestamp' href='#512206'><time timestamp='2016-11-21T16:38:00Z'>16:38</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
if you can share the debug log info around the time of a disconnect, that might help indicate if it&#x27;s a bitcoind issue
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746280' id='512207'>
<a class='timestamp' href='#512207'><time timestamp='2016-11-21T16:38:00Z'>16:38</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
you mean from the proxy node, right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746340' id='512208'>
<a class='timestamp' href='#512208'><time timestamp='2016-11-21T16:39:00Z'>16:39</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
the proxy node isn&#x27;t running with debug=1 - will have to change that
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746340' id='512209'>
<a class='timestamp' href='#512209'><time timestamp='2016-11-21T16:39:00Z'>16:39</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
well it might be helpful to see it from both sides&#x27; point of view
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746340' id='512210'>
<a class='timestamp' href='#512210'><time timestamp='2016-11-21T16:39:00Z'>16:39</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
if you just have one debug log, we can look at that
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746400' id='512211'>
<a class='timestamp' href='#512211'><time timestamp='2016-11-21T16:40:00Z'>16:40</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
lemme activate debug=1 on the proxy node. and when the error occurs again tomorrow i&#x27;ll put both debug logs on pastebin
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746400' id='512212'>
<a class='timestamp' href='#512212'><time timestamp='2016-11-21T16:40:00Z'>16:40</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
ok?     
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746460' id='512213'>
<a class='timestamp' href='#512213'><time timestamp='2016-11-21T16:41:00Z'>16:41</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
thermoman: i believe you were not even connected to your proxy node when the transaction was creates
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746520' id='512214'>
<a class='timestamp' href='#512214'><time timestamp='2016-11-21T16:42:00Z'>16:42</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
oh, sdaftuar already told you thay
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746520' id='512215'>
<a class='timestamp' href='#512215'><time timestamp='2016-11-21T16:42:00Z'>16:42</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
thermoman: does your proxy node -whitelist your internal node?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746580' id='512216'>
<a class='timestamp' href='#512216'><time timestamp='2016-11-21T16:43:00Z'>16:43</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
sdaftuar: yes
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746580' id='512217'>
<a class='timestamp' href='#512217'><time timestamp='2016-11-21T16:43:00Z'>16:43</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
# Whitelist internal networks
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746640' id='512218'>
<a class='timestamp' href='#512218'><time timestamp='2016-11-21T16:44:00Z'>16:44</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
whitelist=a.b.c.d/24
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746640' id='512219'>
<a class='timestamp' href='#512219'><time timestamp='2016-11-21T16:44:00Z'>16:44</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
from bitcoin.conf on proxy node
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746760' id='512220'>
<a class='timestamp' href='#512220'><time timestamp='2016-11-21T16:46:00Z'>16:46</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
we now have debug=1 on proxy node. we&#x27;ll monitor the debug.log from the proxy for new connections from our nodes and when this happens again I will come back here
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746760' id='512221'>
<a class='timestamp' href='#512221'><time timestamp='2016-11-21T16:46:00Z'>16:46</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
thanks so far
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746820' id='512222'>
<a class='timestamp' href='#512222'><time timestamp='2016-11-21T16:47:00Z'>16:47</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
ok, sounds good.  if you have the debug.log from your internal node available where you saw the disconnect, we should be able to tell if your internal node decided to disconnect your proxy for some reason.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479746880' id='512223'>
<a class='timestamp' href='#512223'><time timestamp='2016-11-21T16:48:00Z'>16:48</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
also, if the proxy rejected something your node sent it, causing a disconnect, we would be able to see that as well, i thnk
<br>
</div>

<div class='talk op-msg' data-timestamp='1479747420' id='512224'>
<a class='timestamp' href='#512224'><time timestamp='2016-11-21T16:57:00Z'>16:57</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
ok     
<br>
</div>

<div class='talk op-msg' data-timestamp='1479747420' id='512225'>
<a class='timestamp' href='#512225'><time timestamp='2016-11-21T16:57:00Z'>16:57</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
here is the interesting part from the node behind the proxy
<br>
</div>

<div class='talk op-msg' data-timestamp='1479747900' id='512226'>
<a class='timestamp' href='#512226'><time timestamp='2016-11-21T17:05:00Z'>17:05</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
sdaftuar, sipa: <a href="http://pastebin.com/ZzLpLiLU" class="link" target="_blank">http://pastebin.com/ZzLpLiLU</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479747900' id='512227'>
<a class='timestamp' href='#512227'><time timestamp='2016-11-21T17:05:00Z'>17:05</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
this is the stripped down log from the node sending the TX (behind the proxy)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479747900' id='512228'>
<a class='timestamp' href='#512228'><time timestamp='2016-11-21T17:05:00Z'>17:05</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
the issue occured several times after importing a privkey
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748020' id='512229'>
<a class='timestamp' href='#512229'><time timestamp='2016-11-21T17:07:00Z'>17:07</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
ah.  i wonder if your node was too busy to respond to ping messages, causing a disconnect?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748020' id='512230'>
<a class='timestamp' href='#512230'><time timestamp='2016-11-21T17:07:00Z'>17:07</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
that might be
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748020' id='512231'>
<a class='timestamp' href='#512231'><time timestamp='2016-11-21T17:07:00Z'>17:07</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
it seems the import did block everything else
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748020' id='512232'>
<a class='timestamp' href='#512232'><time timestamp='2016-11-21T17:07:00Z'>17:07</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
and directly after the import the TX was created (while being disconnected from the proxy)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748080' id='512233'>
<a class='timestamp' href='#512233'><time timestamp='2016-11-21T17:08:00Z'>17:08</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
should timeouts be upped on our nodes?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748080' id='512234'>
<a class='timestamp' href='#512234'><time timestamp='2016-11-21T17:08:00Z'>17:08</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
the second disconnect seems a bit different though
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748080' id='512235'>
<a class='timestamp' href='#512235'><time timestamp='2016-11-21T17:08:00Z'>17:08</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
yeah
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748140' id='512236'>
<a class='timestamp' href='#512236'><time timestamp='2016-11-21T17:09:00Z'>17:09</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
it&#x27;s directly after
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748140' id='512237'>
<a class='timestamp' href='#512237'><time timestamp='2016-11-21T17:09:00Z'>17:09</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
Erased 100 orphan tx from peer 1
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748140' id='512238'>
<a class='timestamp' href='#512238'><time timestamp='2016-11-21T17:09:00Z'>17:09</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
should the nodes behind the proxy whitelist the proxy-ip, too?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748140' id='512239'>
<a class='timestamp' href='#512239'><time timestamp='2016-11-21T17:09:00Z'>17:09</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
at the moment only the proxy has whitelisted the client ips
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748200' id='512240'>
<a class='timestamp' href='#512240'><time timestamp='2016-11-21T17:10:00Z'>17:10</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
thermoman: i don&#x27;t think it would hurt, though i&#x27;m not sure yet what&#x27;s going on
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748440' id='512241'>
<a class='timestamp' href='#512241'><time timestamp='2016-11-21T17:14:00Z'>17:14</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
ok i guess the interesting thing about the second disconnect is that your node tried to connect to it at 15:28:07, and then didn&#x27;t send the version message untl 15:51
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748440' id='512242'>
<a class='timestamp' href='#512242'><time timestamp='2016-11-21T17:14:00Z'>17:14</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
so this looks like the wallet operation is contending with the p2p code, and network timeouts are being hit
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748500' id='512243'>
<a class='timestamp' href='#512243'><time timestamp='2016-11-21T17:15:00Z'>17:15</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
ah ok, didn&#x27;t miss the connection between &quot;Added connection&quot; and &quot;sending version message&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748500' id='512244'>
<a class='timestamp' href='#512244'><time timestamp='2016-11-21T17:15:00Z'>17:15</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
s/didn&#x27;t/did/
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748560' id='512245'>
<a class='timestamp' href='#512245'><time timestamp='2016-11-21T17:16:00Z'>17:16</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
current workaround for us is to wait a minute after importing is done
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748620' id='512246'>
<a class='timestamp' href='#512246'><time timestamp='2016-11-21T17:17:00Z'>17:17</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
thermoman: seems like a reasonable workaround for now.  thanks for reporting this, i think this is something we should look into and improve
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748920' id='512247'>
<a class='timestamp' href='#512247'><time timestamp='2016-11-21T17:22:00Z'>17:22</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
do you add an issue in github or should I?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479748980' id='512248'>
<a class='timestamp' href='#512248'><time timestamp='2016-11-21T17:23:00Z'>17:23</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
we&#x27;ve only seen this issue after upgrading the proxy node von 0.11.2 to 0.13.1
<br>
</div>

<div class='talk op-msg' data-timestamp='1479749040' id='512249'>
<a class='timestamp' href='#512249'><time timestamp='2016-11-21T17:24:00Z'>17:24</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
the node with the TX was running 0.11.2 until some hours ago and we noticed this behaviour with 0.11.2 and even after upgrading the node to 0.13.1
<br>
</div>

<div class='talk op-msg' data-timestamp='1479749040' id='512250'>
<a class='timestamp' href='#512250'><time timestamp='2016-11-21T17:24:00Z'>17:24</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
so it seems to have started after upgrading the proxy node
<br>
</div>

<div class='talk op-msg' data-timestamp='1479749100' id='512251'>
<a class='timestamp' href='#512251'><time timestamp='2016-11-21T17:25:00Z'>17:25</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
if I don&#x27;t hear from you I&#x27;ll open an issue on github tomorrow
<br>
</div>

<div class='talk op-msg' data-timestamp='1479749100' id='512252'>
<a class='timestamp' href='#512252'><time timestamp='2016-11-21T17:25:00Z'>17:25</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
hmm, this issue really seems like it&#x27;s specific to the internal node.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479749100' id='512253'>
<a class='timestamp' href='#512253'><time timestamp='2016-11-21T17:25:00Z'>17:25</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
please go ahead and open the issue, thanks!
<br>
</div>

<div class='talk op-msg' data-timestamp='1479749100' id='512254'>
<a class='timestamp' href='#512254'><time timestamp='2016-11-21T17:25:00Z'>17:25</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
we never had this with 0.11.2 on both nodes
<br>
</div>

<div class='talk op-msg' data-timestamp='1479749100' id='512255'>
<a class='timestamp' href='#512255'><time timestamp='2016-11-21T17:25:00Z'>17:25</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
(or didn&#x27;t notice?)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479749160' id='512256'>
<a class='timestamp' href='#512256'><time timestamp='2016-11-21T17:26:00Z'>17:26</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
my memory is failing me right now about when and whether we&#x27;ve made changes from 0.11 to 0.13 with locking/thread contention.  so in my view it&#x27;s possible there&#x27;s a performance regression, i&#x27;d need to investigate more.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479749160' id='512257'>
<a class='timestamp' href='#512257'><time timestamp='2016-11-21T17:26:00Z'>17:26</time></a>
&lt;<span class='nick nick-11'> thermoman</span>&gt;
ok, thanks so far. will open the issue tomorrow
<br>
</div>

<div class='talk op-msg' data-timestamp='1479750180' id='512258'>
<a class='timestamp' href='#512258'><time timestamp='2016-11-21T17:43:00Z'>17:43</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
thermoman: do you often call importprivkey in your setup, ie you were doing that on 0.11.2 as well as regularly on your 0.13.1 nodes?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479750240' id='512259'>
<a class='timestamp' href='#512259'><time timestamp='2016-11-21T17:44:00Z'>17:44</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
it looks to me like that is always a slow operation, and will cause bitcoind to be unresponsive while rescanning
<br>
</div>

<div class='talk op-msg' data-timestamp='1479750420' id='512260'>
<a class='timestamp' href='#512260'><time timestamp='2016-11-21T17:47:00Z'>17:47</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
(and i think this would have been true in 0.11.2 as well)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479751440' id='512261'>
<a class='timestamp' href='#512261'><time timestamp='2016-11-21T18:04:00Z'>18:04</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sdaftuar: importing a private key with rescan caused timeouts and disconnects for me w/ 0.12 too. If thermoman saw a change it could have also just been a bit of chain growth taking it above threshold.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479752580' id='512262'>
<a class='timestamp' href='#512262'><time timestamp='2016-11-21T18:23:00Z'>18:23</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: or rescans became a bit slower since
<br>
</div>

<div class='talk op-msg' data-timestamp='1479755040' id='512263'>
<a class='timestamp' href='#512263'><time timestamp='2016-11-21T19:04:00Z'>19:04</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
instagibbs: in #9194, wouldn&#x27;t it make sense (if we&#x27;re going down this road) to also support legacy serializations for zmq and rest?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479755040' id='512264'>
<a class='timestamp' href='#512264'><time timestamp='2016-11-21T19:04:00Z'>19:04</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/9194" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/9194</a> | Add flags to getrawtransaction and getblock to return non-segwit seri… by instagibbs · Pull Request #9194 · bitcoin/bitcoin · GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1479755400' id='512265'>
<a class='timestamp' href='#512265'><time timestamp='2016-11-21T19:10:00Z'>19:10</time></a>
&lt;<span class='nick nick-11'> instagibbs</span>&gt;
sdaftuar, yes, I have literally no experience with those interfaces, what would that entail
<br>
</div>

<div class='talk op-msg' data-timestamp='1479755580' id='512266'>
<a class='timestamp' href='#512266'><time timestamp='2016-11-21T19:13:00Z'>19:13</time></a>
&lt;<span class='nick nick-11'> instagibbs</span>&gt;
fwiw I think the number of spots we&#x27;ll need this for is basically two, the ones I&#x27;ve done. We support backwards compatbility when talking to non-segwit nodes(and maybe future serializations!), I&#x27;m just giving an option for that at rpc level.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479755580' id='512267'>
<a class='timestamp' href='#512267'><time timestamp='2016-11-21T19:13:00Z'>19:13</time></a>
&lt;<span class='nick nick-11'> instagibbs</span>&gt;
so whatever makes sense for that
<br>
</div>

<div class='talk op-msg' data-timestamp='1479756480' id='512268'>
<a class='timestamp' href='#512268'><time timestamp='2016-11-21T19:28:00Z'>19:28</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
instagibbs: see for instance rest.cpp:371
<br>
</div>

<div class='talk op-msg' data-timestamp='1479756540' id='512269'>
<a class='timestamp' href='#512269'><time timestamp='2016-11-21T19:29:00Z'>19:29</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
oh wait, i made a mistake
<br>
</div>

<div class='talk op-msg' data-timestamp='1479756660' id='512270'>
<a class='timestamp' href='#512270'><time timestamp='2016-11-21T19:31:00Z'>19:31</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
oh maybe not -- sorry i&#x27;ve never really looked at this code. looks like that function gets a transaction and serializes it for a user
<br>
</div>

<div class='talk op-msg' data-timestamp='1479756720' id='512271'>
<a class='timestamp' href='#512271'><time timestamp='2016-11-21T19:32:00Z'>19:32</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
similarly in the rest_block() function in that same file
<br>
</div>

<div class='talk op-msg' data-timestamp='1479756720' id='512272'>
<a class='timestamp' href='#512272'><time timestamp='2016-11-21T19:32:00Z'>19:32</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
and then i think there are two analogous places in zmq/zmqpublishnotifier.cpp
<br>
</div>

<div class='talk op-msg' data-timestamp='1479756780' id='512273'>
<a class='timestamp' href='#512273'><time timestamp='2016-11-21T19:33:00Z'>19:33</time></a>
&lt;<span class='nick nick-13'> sdaftuar</span>&gt;
maybe that&#x27;s it though... if your changes were comprehensive for the RPC stuff (sorry I need to review still), then perhaps this isn&#x27;t as bad as I feared
<br>
</div>

<div class='talk op-msg' data-timestamp='1479758280' id='512274'>
<a class='timestamp' href='#512274'><time timestamp='2016-11-21T19:58:00Z'>19:58</time></a>
&lt;<span class='nick nick-11'> instagibbs</span>&gt;
gettransaction also returns a hex field I&#x27;m not converting, but it feels weird messing with an api that is wallet-based for this purpose.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479758340' id='512275'>
<a class='timestamp' href='#512275'><time timestamp='2016-11-21T19:59:00Z'>19:59</time></a>
&lt;<span class='nick nick-11'> instagibbs</span>&gt;
I think &quot;raw&quot; apis are a better fit for these changes. If you&#x27;re using wallet features, just use wallet and what the wallet understands
<br>
</div>

<div class='talk op-msg' data-timestamp='1479758520' id='512276'>
<a class='timestamp' href='#512276'><time timestamp='2016-11-21T20:02:00Z'>20:02</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
the overall goal should be &quot;no one should need to hesitate to install 0.13.1+ simply because they haven&#x27;t updated their applications yet&quot;.  This was part of the attractiveness of having the segwit code in a release ahead of activation and avoiding behavior changes at activation time.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479760440' id='512277'>
<a class='timestamp' href='#512277'><time timestamp='2016-11-21T20:34:00Z'>20:34</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
should there be a nonce in rpc client requests? otherwise how does sendmany work if you had a socket timeout on the response? or other must-only-run-once critical rcp endpoints.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479760500' id='512278'>
<a class='timestamp' href='#512278'><time timestamp='2016-11-21T20:35:00Z'>20:35</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
&#x27;scuse me, *rpc endpoints
<br>
</div>

<div class='talk op-msg' data-timestamp='1479760560' id='512279'>
<a class='timestamp' href='#512279'><time timestamp='2016-11-21T20:36:00Z'>20:36</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
kanzure: &#x27;check listtransactions&#x27; :-/  you&#x27;re right, it should have a nonce. Well the whole rpc thing was not well designed.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479760560' id='512280'>
<a class='timestamp' href='#512280'><time timestamp='2016-11-21T20:36:00Z'>20:36</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
alternatively, you could say &quot;well, just call an event log, and check before you retry&quot; (someone posted a &quot;retry all rpc requests&quot; to petertodd&#x27;s python-bitcoinlib repo and it raised my eyebrow)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479760620' id='512281'>
<a class='timestamp' href='#512281'><time timestamp='2016-11-21T20:37:00Z'>20:37</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
if sending money is the only scenario where something bad happens, then listtransactions is probably sufficient...
<br>
</div>

<div class='talk op-msg' data-timestamp='1479760620' id='512282'>
<a class='timestamp' href='#512282'><time timestamp='2016-11-21T20:37:00Z'>20:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
(or, better, a nonce, sequence number pair, and a nonce can be reused but only with a strictly greater sequence number)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479760740' id='512283'>
<a class='timestamp' href='#512283'><time timestamp='2016-11-21T20:39:00Z'>20:39</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
what about: in RPC request to sendmany (or whatever else is broken here), include expected state and also the actual request. and if the expected state doesn&#x27;t match, then raise error or don&#x27;t send.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479760920' id='512284'>
<a class='timestamp' href='#512284'><time timestamp='2016-11-21T20:42:00Z'>20:42</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
someone outside the channel proposes, &#x27;if you want to enforce balance checking, make the server require the client to make a balance call before making a send call.&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479761460' id='512285'>
<a class='timestamp' href='#512285'><time timestamp='2016-11-21T20:51:00Z'>20:51</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
do these problems exist in the http api?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479761760' id='512286'>
<a class='timestamp' href='#512286'><time timestamp='2016-11-21T20:56:00Z'>20:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you mean the REST api? that&#x27;s read only
<br>
</div>

<div class='talk op-msg' data-timestamp='1479761760' id='512287'>
<a class='timestamp' href='#512287'><time timestamp='2016-11-21T20:56:00Z'>20:56</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and only for public data (nothing wallet related)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479762180' id='512288'>
<a class='timestamp' href='#512288'><time timestamp='2016-11-21T21:03:00Z'>21:03</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gcc 7.0 has -Wmisleading-indentation 
<br>
</div>

<div class='talk op-msg' data-timestamp='1479763920' id='512289'>
<a class='timestamp' href='#512289'><time timestamp='2016-11-21T21:32:00Z'>21:32</time></a>
&lt;<span class='nick nick-15'> Chris_Stewart_5</span>&gt;
Just to be clear, there is no compact size uint to indicate how many CTxInWitness inside of the serialization of a tx right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479763920' id='512290'>
<a class='timestamp' href='#512290'><time timestamp='2016-11-21T21:32:00Z'>21:32</time></a>
&lt;<span class='nick nick-15'> Chris_Stewart_5</span>&gt;
You need to infer it from the number of inputs?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479764820' id='512291'>
<a class='timestamp' href='#512291'><time timestamp='2016-11-21T21:47:00Z'>21:47</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
Chris_Stewart_5: indeed
<br>
</div>

<div class='talk op-msg' data-timestamp='1479764940' id='512292'>
<a class='timestamp' href='#512292'><time timestamp='2016-11-21T21:49:00Z'>21:49</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
okay i posted an issue about the abovementioned rpc replay protection concerns <a href="https://github.com/bitcoin/bitcoin/issues/9197" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/9197</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479765360' id='512293'>
<a class='timestamp' href='#512293'><time timestamp='2016-11-21T21:56:00Z'>21:56</time></a>
&lt;<span class='nick nick-15'> Chris_Stewart_5</span>&gt;
Thanks sipa 
<br>
</div>

<div class='talk op-msg' data-timestamp='1479765900' id='512294'>
<a class='timestamp' href='#512294'><time timestamp='2016-11-21T22:05:00Z'>22:05</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
Are there any RPC requests that would NOT be idempotent?  I think kanzure&#x27;s suggestion is that bitcoind always complete the action of an RPC call even in event of an I/O error while sending the response.  Is it possible that this wouldn&#x27;t be the case?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479765900' id='512295'>
<a class='timestamp' href='#512295'><time timestamp='2016-11-21T22:05:00Z'>22:05</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
Further, is it possible for a truncated RPC request to end up being valid and acted upon?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479765960' id='512296'>
<a class='timestamp' href='#512296'><time timestamp='2016-11-21T22:06:00Z'>22:06</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
BTW I think this is probably RPC &quot;atomicity&quot; not &quot;idempotency&quot;.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766260' id='512297'>
<a class='timestamp' href='#512297'><time timestamp='2016-11-21T22:11:00Z'>22:11</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
no, my suggestion is not &quot;always complete the action of an RPC call even in event of an I/O error while sending the response&quot; -- that&#x27;s a related topic i guess.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766260' id='512298'>
<a class='timestamp' href='#512298'><time timestamp='2016-11-21T22:11:00Z'>22:11</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
Nah kanzure&#x27;s right in using idempotent -- CS lingo.  Too much math over here.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766320' id='512299'>
<a class='timestamp' href='#512299'><time timestamp='2016-11-21T22:12:00Z'>22:12</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
my suggestion is &quot;change from &#x27;always execute any RPC request&#x27; to &#x27;check whether the nonce is the same first, and fail if the nonce is the same&#x27;&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766380' id='512300'>
<a class='timestamp' href='#512300'><time timestamp='2016-11-21T22:13:00Z'>22:13</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
Sure.  From the client&#x27;s perspective the two situations are the same...he didn&#x27;t get the response and doesn&#x27;t know if the RPC sendmany was executed.  So he retries with the same nonce...
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766440' id='512301'>
<a class='timestamp' href='#512301'><time timestamp='2016-11-21T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
yes, retrying with the same nonce would be OK
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766440' id='512302'>
<a class='timestamp' href='#512302'><time timestamp='2016-11-21T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
an alternative is having meta support for any asynchronous command
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766440' id='512303'>
<a class='timestamp' href='#512303'><time timestamp='2016-11-21T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
I like that idea...
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766440' id='512304'>
<a class='timestamp' href='#512304'><time timestamp='2016-11-21T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
(I like kanzure&#x27;s nonce idea).  What&#x27;s meta support?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766440' id='512305'>
<a class='timestamp' href='#512305'><time timestamp='2016-11-21T22:14:00Z'>22:14</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you call an RPC &quot;schedule&quot; with 3 args: 1) command 2) command args 3) call id
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766500' id='512306'>
<a class='timestamp' href='#512306'><time timestamp='2016-11-21T22:15:00Z'>22:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
and then you have a separate RPC through which you can chrck the result
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766500' id='512307'>
<a class='timestamp' href='#512307'><time timestamp='2016-11-21T22:15:00Z'>22:15</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
have you poked at database internals before, like transactional concept?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766500' id='512308'>
<a class='timestamp' href='#512308'><time timestamp='2016-11-21T22:15:00Z'>22:15</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
define &#x27;poked&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766560' id='512309'>
<a class='timestamp' href='#512309'><time timestamp='2016-11-21T22:16:00Z'>22:16</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: that kind of framework is <u>_necessary_</u> for some commands.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766560' id='512310'>
<a class='timestamp' href='#512310'><time timestamp='2016-11-21T22:16:00Z'>22:16</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
eh, &#x27;poked&#x27; could be reading i guess :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766560' id='512311'>
<a class='timestamp' href='#512311'><time timestamp='2016-11-21T22:16:00Z'>22:16</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
For example automatic sendmany batching and replacement will not know the txid until later. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766620' id='512312'>
<a class='timestamp' href='#512312'><time timestamp='2016-11-21T22:17:00Z'>22:17</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
daisychaining and &#x27;schedule&#x27; sure. although if you require some of the prior information before generating the next call, ... can&#x27;t send all at once.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766680' id='512313'>
<a class='timestamp' href='#512313'><time timestamp='2016-11-21T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
To be clear -- the issue we&#x27;re having is that bitcoind closes its RPC connections on a timer.  These are connections on localhost and python-bitcoinlib doesn&#x27;t reopen them (I consider that it&#x27;s bug).  But this could also be improved on the bitcoind side if we could configure it to not close RPC connections...
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766680' id='512314'>
<a class='timestamp' href='#512314'><time timestamp='2016-11-21T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
That&#x27;s separate from calling RPC&#x27;s over a flaky connection...
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766680' id='512315'>
<a class='timestamp' href='#512315'><time timestamp='2016-11-21T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
rpc connection closing behavior is somewhat unrelated; your application still needs to know whether to retry. and currently it can&#x27;t possibly know that.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766680' id='512316'>
<a class='timestamp' href='#512316'><time timestamp='2016-11-21T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
Yep yep
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766680' id='512317'>
<a class='timestamp' href='#512317'><time timestamp='2016-11-21T22:18:00Z'>22:18</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
&quot;not close RPC connections.&quot; &lt; guarentees file descriptor exhaustion.  And is unlike any http server ever.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766740' id='512318'>
<a class='timestamp' href='#512318'><time timestamp='2016-11-21T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
bsm1175321: I think your concern is just a &quot;fix the client&quot; concern. (the python-bitcoinlib behavior has burned me many times too)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766740' id='512319'>
<a class='timestamp' href='#512319'><time timestamp='2016-11-21T22:19:00Z'>22:19</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
But there&#x27;s only one RPC user and it&#x27;s on localhost.  I think this is a common configuration.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766800' id='512320'>
<a class='timestamp' href='#512320'><time timestamp='2016-11-21T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
gmaxwell: I agree.  I&#x27;m gonna fix it to re-open and not bother me with I/O exceptions.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766800' id='512321'>
<a class='timestamp' href='#512321'><time timestamp='2016-11-21T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
&quot;only one rpc user&quot; what?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766800' id='512322'>
<a class='timestamp' href='#512322'><time timestamp='2016-11-21T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
didn&#x27;t we fix that issue in our in-tree fork of python-bitcoinlib?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766800' id='512323'>
<a class='timestamp' href='#512323'><time timestamp='2016-11-21T22:20:00Z'>22:20</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
often still results in exhaustion, e.g. when you get long idle connection objects that aren&#x27;t GCed yet and so they&#x27;ve left their connections open.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479766920' id='512324'>
<a class='timestamp' href='#512324'><time timestamp='2016-11-21T22:22:00Z'>22:22</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
sipa: yes it looks like it is fixed there.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767040' id='512325'>
<a class='timestamp' href='#512325'><time timestamp='2016-11-21T22:24:00Z'>22:24</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
oh there is an &quot;id&quot; parameter sent <a href="https://github.com/petertodd/python-bitcoinlib/blob/2e4d51a482a4331d91de9bae2ab7be56229e664a/bitcoin/rpc.py#L188" class="link" target="_blank">https://github.com/petertodd/python-bitcoinlib/blob/2e4d51a482a4331d91de9bae2ab7be56229e664a/bitcoin/rpc.py#L188</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767040' id='512326'>
<a class='timestamp' href='#512326'><time timestamp='2016-11-21T22:24:00Z'>22:24</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
.. which is auto-incremented in this particular client library..
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767160' id='512327'>
<a class='timestamp' href='#512327'><time timestamp='2016-11-21T22:26:00Z'>22:26</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
sipa: the fix here: <a href="https://github.com/bitcoin/bitcoin/blob/master/qa/rpc-tests/test_framework/authproxy.py#L134" class="link" target="_blank">https://github.com/bitcoin/bitcoin/blob/master/qa/rpc-tests/test_framework/authproxy.py#L134</a> looks like it is effectively a retry, and would, e.g. sendmany again.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767340' id='512328'>
<a class='timestamp' href='#512328'><time timestamp='2016-11-21T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
connection handling is distinct from client state management. i think kanzure&#x27;s concern is that it seems possible for a bitcoind client to say &quot;hey, i didn&#x27;t receive a reply&quot; and then resend the same request to bitcoind - perhaps resulting in the accidental execution of two identical requests. banks used to behave this way when you clicked &quot;do wire transfer&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767340' id='512329'>
<a class='timestamp' href='#512329'><time timestamp='2016-11-21T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
then pressed &quot;back&quot; in internet explorer - they&#x27;d do another POST to send the wire transfer again. now we have idempotency via request nonces for the web, so it&#x27;s not a problem - your nonce is considered expired once the nonce&#x27;s corresponding request is processed. with python-bitcoinlib in particular, i think the concern is that you can still get &quot;oops i
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767340' id='512330'>
<a class='timestamp' href='#512330'><time timestamp='2016-11-21T22:29:00Z'>22:29</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
sent wire transfer twice&quot; type behavior, due to no client state management facilities in bitcoind to code against.. is that right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767460' id='512331'>
<a class='timestamp' href='#512331'><time timestamp='2016-11-21T22:31:00Z'>22:31</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
skyraider: applications can check list transactions to determine if the order has been executed yet.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767460' id='512332'>
<a class='timestamp' href='#512332'><time timestamp='2016-11-21T22:31:00Z'>22:31</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
kanzure: that&#x27;s just for ordering of responses within one connection
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767520' id='512333'>
<a class='timestamp' href='#512333'><time timestamp='2016-11-21T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
A common model is to poll outstanding requests, check list transactions, anything not paid yet, pay... anything already paid remove from the list.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767520' id='512334'>
<a class='timestamp' href='#512334'><time timestamp='2016-11-21T22:32:00Z'>22:32</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
gmaxwell: no, that doesn&#x27;t work.   listtransactions will  not matter because you might have anohter concurrent attempt. then both sendmanys execute one after another.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767580' id='512335'>
<a class='timestamp' href='#512335'><time timestamp='2016-11-21T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
ok well at the very least we should insist that client librares implement that pattern, maybe by rejecting sendmany rpc requests if previous required rpc requests have not been detected
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767580' id='512336'>
<a class='timestamp' href='#512336'><time timestamp='2016-11-21T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
&quot;Don&#x27;t do that.&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767580' id='512337'>
<a class='timestamp' href='#512337'><time timestamp='2016-11-21T22:33:00Z'>22:33</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I&#x27;m just describing to you an architecture I&#x27;ve seen before, which has generally acceptable properties.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767640' id='512338'>
<a class='timestamp' href='#512338'><time timestamp='2016-11-21T22:34:00Z'>22:34</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I don&#x27;t disagree that an optional nonce/sequence with replay protection would be good-- though it has some scalability challenges. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767700' id='512339'>
<a class='timestamp' href='#512339'><time timestamp='2016-11-21T22:35:00Z'>22:35</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
sipa: oh like for ordering responses to the _batch call?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767760' id='512340'>
<a class='timestamp' href='#512340'><time timestamp='2016-11-21T22:36:00Z'>22:36</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
kanzure: you can send two rpcs with the same id, and you could get two different answers with the same id back
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767820' id='512341'>
<a class='timestamp' href='#512341'><time timestamp='2016-11-21T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell, kanzure: a more lightway idea, just for send* calls, is passing as an argument to the rpc the expected wallet balance
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767820' id='512342'>
<a class='timestamp' href='#512342'><time timestamp='2016-11-21T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
anything that actually interferes would cause failure, while other rpcs could still happen concurrently
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767820' id='512343'>
<a class='timestamp' href='#512343'><time timestamp='2016-11-21T22:37:00Z'>22:37</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
wallet balance isn&#x27;t good either... many simultaneous deposits/debits could put you back to the same balance anyway.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767880' id='512344'>
<a class='timestamp' href='#512344'><time timestamp='2016-11-21T22:38:00Z'>22:38</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
excuse me, credits/debits
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767880' id='512345'>
<a class='timestamp' href='#512345'><time timestamp='2016-11-21T22:38:00Z'>22:38</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
so &#x27;read before you try to send lots of bitcoin&#x27; - alright. but if another RPC connection writes in the meantime, won&#x27;t my read be stale, or is there transaction isolation somehow? is the recommended policy therefore &#x27;only ever use a single RPC writer&#x27; ?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767880' id='512346'>
<a class='timestamp' href='#512346'><time timestamp='2016-11-21T22:38:00Z'>22:38</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: ugh. so if you send some and recieve the same amount ... the double payment still goes through?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767940' id='512347'>
<a class='timestamp' href='#512347'><time timestamp='2016-11-21T22:39:00Z'>22:39</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
&#x27;transaction isolation&#x27; probably means database-kind of transaction model, not transactions?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767940' id='512348'>
<a class='timestamp' href='#512348'><time timestamp='2016-11-21T22:39:00Z'>22:39</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
uh, yeah, not bitcoin transaction. isolation as in the I from ACID.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479767940' id='512349'>
<a class='timestamp' href='#512349'><time timestamp='2016-11-21T22:39:00Z'>22:39</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
skyraider: yes, you just retry in that model.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768000' id='512350'>
<a class='timestamp' href='#512350'><time timestamp='2016-11-21T22:40:00Z'>22:40</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
isn&#x27;t that a failure
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768000' id='512351'>
<a class='timestamp' href='#512351'><time timestamp='2016-11-21T22:40:00Z'>22:40</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
the idea is to prevent stales from causing you to retry
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768060' id='512352'>
<a class='timestamp' href='#512352'><time timestamp='2016-11-21T22:41:00Z'>22:41</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
why would that be a failure? The retry causes no harm. The system is concurrent and you want an atomic change, there will always be retries needed.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768060' id='512353'>
<a class='timestamp' href='#512353'><time timestamp='2016-11-21T22:41:00Z'>22:41</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
you mean existing system, or proposed system is concurrent?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768060' id='512354'>
<a class='timestamp' href='#512354'><time timestamp='2016-11-21T22:41:00Z'>22:41</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
kanzure: so going back to the nonce, how do you propose avoding having to store nonces forever?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768120' id='512355'>
<a class='timestamp' href='#512355'><time timestamp='2016-11-21T22:42:00Z'>22:42</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
gmaxwell: sorry, could you clarify please - is RPC safe for concurrent writes at the moment, or are you saying stale reads (if you have, say, two concurrent connections) are possible, and therefore one should use a single RPC writer?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768180' id='512356'>
<a class='timestamp' href='#512356'><time timestamp='2016-11-21T22:43:00Z'>22:43</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
skyraider: your question is underspecified. It&#x27;s perfectly fine to make concurrent writes.  But kanzure is asking about what happens when you get a socket failure on one of your writes. 
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768180' id='512357'>
<a class='timestamp' href='#512357'><time timestamp='2016-11-21T22:43:00Z'>22:43</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
If you just retry you may double pay.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768180' id='512358'>
<a class='timestamp' href='#512358'><time timestamp='2016-11-21T22:43:00Z'>22:43</time></a>
&lt;<span class='nick nick-5'> midnightmagic</span>&gt;
wtf man another earthquake near fukushima?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768420' id='512359'>
<a class='timestamp' href='#512359'><time timestamp='2016-11-21T22:47:00Z'>22:47</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
right, i don&#x27;t mean to ask whether the application will crash if you do concurrent writes. rather, whether a client can expect the situation of &quot;1) read balance in client thread A, 2) write balance in client thread B that makes 1&#x27;s read stale, 3) write balance in client thread A&quot; can result in the client double paying, due to making a decision based upon the
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768420' id='512360'>
<a class='timestamp' href='#512360'><time timestamp='2016-11-21T22:47:00Z'>22:47</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
balance data in read 1).
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768480' id='512361'>
<a class='timestamp' href='#512361'><time timestamp='2016-11-21T22:48:00Z'>22:48</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
skyraider: there is no &#x27;write balance&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768540' id='512362'>
<a class='timestamp' href='#512362'><time timestamp='2016-11-21T22:49:00Z'>22:49</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
there is &#x27;attempt to make a transaction&#x27;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768540' id='512363'>
<a class='timestamp' href='#512363'><time timestamp='2016-11-21T22:49:00Z'>22:49</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
yes, sorry, shorthand for &quot;try to send some bitcoin&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768660' id='512364'>
<a class='timestamp' href='#512364'><time timestamp='2016-11-21T22:51:00Z'>22:51</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
skyraider: I think you&#x27;re overthinking things now.  If you call send* you will probably send.  If you call send once per payment you want to make you will never double pay.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768660' id='512365'>
<a class='timestamp' href='#512365'><time timestamp='2016-11-21T22:51:00Z'>22:51</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
if you are doing things based on &#x27;balance&#x27; then god knows what will happen, as balance is not monotone. :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768660' id='512366'>
<a class='timestamp' href='#512366'><time timestamp='2016-11-21T22:51:00Z'>22:51</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
skyraider: if you &quot;attempt to make a transaction&quot; twice, it will obviously send twice... anything else would be highly unexpected behaviour
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768720' id='512367'>
<a class='timestamp' href='#512367'><time timestamp='2016-11-21T22:52:00Z'>22:52</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
i think bitcoind seems to really very strongly want all applications to have only one rpc connection
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768720' id='512368'>
<a class='timestamp' href='#512368'><time timestamp='2016-11-21T22:52:00Z'>22:52</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
kanzure: not at all.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768720' id='512369'>
<a class='timestamp' href='#512369'><time timestamp='2016-11-21T22:52:00Z'>22:52</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
there is no protection against stale reads at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768720' id='512370'>
<a class='timestamp' href='#512370'><time timestamp='2016-11-21T22:52:00Z'>22:52</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
there is nothing in here at all like ACID
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768780' id='512371'>
<a class='timestamp' href='#512371'><time timestamp='2016-11-21T22:53:00Z'>22:53</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
which is orthorgonal to &quot;have only one rpc connection&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479768780' id='512372'>
<a class='timestamp' href='#512372'><time timestamp='2016-11-21T22:53:00Z'>22:53</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
look i&#x27;m fine with one rpc client in serial. that&#x27;s fine with me.  but i&#x27;m not sure everyone else knows to do that.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769020' id='512373'>
<a class='timestamp' href='#512373'><time timestamp='2016-11-21T22:57:00Z'>22:57</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
it might help to put on a client&#x27;s shoes here. context was <a href="https://github.com/petertodd/python-bitcoinlib/pull/128" class="link" target="_blank">https://github.com/petertodd/python-bitcoinlib/pull/128</a> in which a blind retry python decorator was considered. turns out this can a) result in actually sending bitcoin multiple times, b) result in decisions made on stale read data (balance was just an example - really any bitcoind state subject to
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769020' id='512374'>
<a class='timestamp' href='#512374'><time timestamp='2016-11-21T22:57:00Z'>22:57</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
change via concurrent writes). it seems a safe solution for b) is &quot;only ever execute RPC writes serially&quot; and for a), &quot;because we are doing serial writes, in which another write can&#x27;t occur after my safety-check-read, we can query to see whether the send already occurred (the safety-check-read) before retrying.&quot; tldr; serial writes enables &quot;should i retry?&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769020' id='512375'>
<a class='timestamp' href='#512375'><time timestamp='2016-11-21T22:57:00Z'>22:57</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
logic in a safe way.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769080' id='512376'>
<a class='timestamp' href='#512376'><time timestamp='2016-11-21T22:58:00Z'>22:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I disagree.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769080' id='512377'>
<a class='timestamp' href='#512377'><time timestamp='2016-11-21T22:58:00Z'>22:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
What you want is a write which is ordered with respect to a read.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769080' id='512378'>
<a class='timestamp' href='#512378'><time timestamp='2016-11-21T22:58:00Z'>22:58</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Have you already paid is not something which can become untrue.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769080' id='512379'>
<a class='timestamp' href='#512379'><time timestamp='2016-11-21T22:58:00Z'>22:58</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
previous answer to &quot;have you already paid&quot; can become untrue
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769140' id='512380'>
<a class='timestamp' href='#512380'><time timestamp='2016-11-21T22:59:00Z'>22:59</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
yes but only by performing a write that makes that payment.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769140' id='512381'>
<a class='timestamp' href='#512381'><time timestamp='2016-11-21T22:59:00Z'>22:59</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
yes, a write ordered with respect to a particular read (i.e., transaction isolation in the database sense) is a more general and better solution than serial writes.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769260' id='512382'>
<a class='timestamp' href='#512382'><time timestamp='2016-11-21T23:01:00Z'>23:01</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Both of you keep repeating serial, and that is just wrong and in a meaningful way compared to typical usage.  You can perform as many sends as you want. But if you want to retry a send you must read first to make sure the send wasn&#x27;t already performed.   Running two sends for the same payment in parallel is insanity in any case, as you have no way of knowing if the other went through (and usuall
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769260' id='512383'>
<a class='timestamp' href='#512383'><time timestamp='2016-11-21T23:01:00Z'>23:01</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
y it does).
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769440' id='512384'>
<a class='timestamp' href='#512384'><time timestamp='2016-11-21T23:04:00Z'>23:04</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
Of course, there are probably many people performing this logic now, since the &quot;commit&quot; of a send doesn&#x27;t actually occur until it&#x27;s mined.  The need to fee-bump is probably a more common cause of retries than RPC connection drops...
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769440' id='512385'>
<a class='timestamp' href='#512385'><time timestamp='2016-11-21T23:04:00Z'>23:04</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
if you are e.g. running a group of ec2 servers or something and experience a temporary DNS failure of the kind that&#x27;s common on AWS, that python-bitcoinlib decorator could result in probably 1-50 double payments per month, assuming you are sending every 30 seconds or so. serial writes seems to be a quick, safe way to get don&#x27;t-pay-twice safety while querying
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769440' id='512386'>
<a class='timestamp' href='#512386'><time timestamp='2016-11-21T23:04:00Z'>23:04</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
the current version of bitcoind. as to running sends concurrently, yes, it seems unusual / nonrealistic use case to do this.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769500' id='512387'>
<a class='timestamp' href='#512387'><time timestamp='2016-11-21T23:05:00Z'>23:05</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
fwiw i don&#x27;t actually use sendmany
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769620' id='512388'>
<a class='timestamp' href='#512388'><time timestamp='2016-11-21T23:07:00Z'>23:07</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
or any spends for that matter... heh.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769620' id='512389'>
<a class='timestamp' href='#512389'><time timestamp='2016-11-21T23:07:00Z'>23:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you hodler
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769680' id='512390'>
<a class='timestamp' href='#512390'><time timestamp='2016-11-21T23:08:00Z'>23:08</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
(yeah who would ever want to spend coins??)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769800' id='512391'>
<a class='timestamp' href='#512391'><time timestamp='2016-11-21T23:10:00Z'>23:10</time></a>
&lt;<span class='nick nick-5'> midnightmagic</span>&gt;
gmaxwell: that&#x27;s how MP (operating manually) managed to rip himself off.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769980' id='512392'>
<a class='timestamp' href='#512392'><time timestamp='2016-11-21T23:13:00Z'>23:13</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
midnightmagic: go on?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769980' id='512393'>
<a class='timestamp' href='#512393'><time timestamp='2016-11-21T23:13:00Z'>23:13</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
and yeah i understand the criticism about serial writes - it seems at first it should be more like &#x27;read before you write&#x27;.  but, you have to be careful with that because your read could easily be stale. and if you are running concurrent bitcoind sends in different client-application-level thread of execution, well - you shouldn&#x27;t do this. you should write
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769980' id='512394'>
<a class='timestamp' href='#512394'><time timestamp='2016-11-21T23:13:00Z'>23:13</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
in one thread because the lack of transaction isolation (read/write ordering) means client implementors might not know to handle what happens when a balance they just checked is now gone.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479769980' id='512395'>
<a class='timestamp' href='#512395'><time timestamp='2016-11-21T23:13:00Z'>23:13</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
but, yes, this is not an actual real-world use case over here at the moment. so admitted.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479770040' id='512396'>
<a class='timestamp' href='#512396'><time timestamp='2016-11-21T23:14:00Z'>23:14</time></a>
&lt;<span class='nick nick-4'> skyraider</span>&gt;
thanks
<br>
</div>

<div class='talk op-msg' data-timestamp='1479770040' id='512397'>
<a class='timestamp' href='#512397'><time timestamp='2016-11-21T23:14:00Z'>23:14</time></a>
&lt;<span class='nick nick-5'> midnightmagic</span>&gt;
kanzure: not respending himself, instead sending multiple sends to the same destination more than once, and the receivers obviously refused to give anything back (which was fair by MP&#x27;s own mercenrary rules.) If he had properly respent himself, updated his sends, or otherwise presumed the sends could be mined at any time, he wouldn&#x27;t have lost anything.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479770580' id='512398'>
<a class='timestamp' href='#512398'><time timestamp='2016-11-21T23:23:00Z'>23:23</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
is the assumption that there is always a single node worker and never more than one? if so, we should probably add this to docs.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479770580' id='512399'>
<a class='timestamp' href='#512399'><time timestamp='2016-11-21T23:23:00Z'>23:23</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
*node worker (rpc client communicating to bitcoind)
<br>
</div>

<div class='talk op-msg' data-timestamp='1479770700' id='512400'>
<a class='timestamp' href='#512400'><time timestamp='2016-11-21T23:25:00Z'>23:25</time></a>
&lt;<span class='nick nick-6'> bsm1175321</span>&gt;
Having more than one violates the Isolation requirement of ACID.  Would it be interesting to require isolation on open wallets WRT rpc clients?  That is, two RPC connections must have mutually exclusive wallets?
<br>
</div>

<div class='talk op-msg' data-timestamp='1479771000' id='512401'>
<a class='timestamp' href='#512401'><time timestamp='2016-11-21T23:30:00Z'>23:30</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
kanzure: I keep telling you that there is no such assumption.
<br>
</div>

<div class='talk op-msg' data-timestamp='1479771180' id='512402'>
<a class='timestamp' href='#512402'><time timestamp='2016-11-21T23:33:00Z'>23:33</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
kanzure: that also doesn&#x27;t in any way help with the double issue problem
<br>
</div>

<div class='talk op-msg' data-timestamp='1479772380' id='512403'>
<a class='timestamp' href='#512403'><time timestamp='2016-11-21T23:53:00Z'>23:53</time></a>
&lt;<span class='nick nick-4'> kanzure</span>&gt;
ah, there is a lockunspent at least.
<br>
</div>

</div>
</section>

</body>
</html>
