<!DOCTYPE html>
<html>
<title>
#bitcoin-core-dev
 on 2018-06-09
 — 
searchable irc log
</title>
<meta charset='utf-8'>
<meta content='IE=9' http-equiv='X-UA-Compatible'>
<link href='/style-light.css' id='stylesheet' rel='stylesheet'>
<link href='/favicon.png' rel='shortcut icon'>
<link href='http://chaincode.com/bitcoin-core-dev/2018-06-09' rel='canonical'>
<meta content='channel #bitcoin-core-dev IRC chat logs' name='description'>
<script src='/jquery.min.js'></script>
<script src='/jquery.ba-hashchange.min.js'></script>
<script src='/cookies.min.js'></script>
<script src='/application.js'></script>
<body>
<section id='sidebar'>
<section id='calendar'>
<pre class='clock'>17:22 UTC</pre>
<pre><a href="/bitcoin-core-dev/2018-05-09">&lt;</a><span class='header'>    June 2018     </span><a href="/bitcoin-core-dev/2018-07-09">&gt;</a>&#x000A;<span class='header'>Su Mo Tu We Th Fr Sa  </span>&#x000A;                <a class="" href="/bitcoin-core-dev/2018-06-01">1</a>  <a class="" href="/bitcoin-core-dev/2018-06-02">2</a>  &#x000A; <a class="" href="/bitcoin-core-dev/2018-06-03">3</a>  <a class="" href="/bitcoin-core-dev/2018-06-04">4</a>  <a class="" href="/bitcoin-core-dev/2018-06-05">5</a>  <a class="" href="/bitcoin-core-dev/2018-06-06">6</a>  <a class="" href="/bitcoin-core-dev/2018-06-07">7</a>  <a class="" href="/bitcoin-core-dev/2018-06-08">8</a>  <a class="current" href="/bitcoin-core-dev/2018-06-09">9</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-06-10">10</a> <a class="" href="/bitcoin-core-dev/2018-06-11">11</a> <a class="" href="/bitcoin-core-dev/2018-06-12">12</a> <a class="" href="/bitcoin-core-dev/2018-06-13">13</a> <a class="" href="/bitcoin-core-dev/2018-06-14">14</a> <a class="" href="/bitcoin-core-dev/2018-06-15">15</a> <a class="" href="/bitcoin-core-dev/2018-06-16">16</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-06-17">17</a> <a class="" href="/bitcoin-core-dev/2018-06-18">18</a> <a class="" href="/bitcoin-core-dev/2018-06-19">19</a> <a class="" href="/bitcoin-core-dev/2018-06-20">20</a> <a class="" href="/bitcoin-core-dev/2018-06-21">21</a> <a class="" href="/bitcoin-core-dev/2018-06-22">22</a> <a class="" href="/bitcoin-core-dev/2018-06-23">23</a>  &#x000A;<a class="" href="/bitcoin-core-dev/2018-06-24">24</a> <a class="" href="/bitcoin-core-dev/2018-06-25">25</a> <a class="" href="/bitcoin-core-dev/2018-06-26">26</a> <a class="" href="/bitcoin-core-dev/2018-06-27">27</a> <a class="" href="/bitcoin-core-dev/2018-06-28">28</a> <a class="" href="/bitcoin-core-dev/2018-06-29">29</a> <a class="" href="/bitcoin-core-dev/2018-06-30">30</a></pre>
</section>
<section id='options'>
<form action='/bitcoin-core-dev/search'>
<input id='search-box' name='q' placeholder='Enter keywords'>
<input type='submit' value='Search'>
<br/>
<br/>
<p>This is a searchable archive of <a href=/bitcoin-core-dev>#bitcoin-core-dev</a> irc</p>
<br/>
<small>
<b>Examples</b>
<br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=bitcoin">bitcoin</a>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=*BIP*">*BIP*</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22bitcoin-git%22">bitcoin-git</a><br/>
<a href="http://bitcoin-irc.chaincode.com/bitcoin-core-dev/search?q=%22core-meetingbot%22">core-meetingbot</a>
<br/>
<br/>
</small>
<small>Search supports standard MySQL <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">fulltext search operations</a></small>
<br/>
<br/>
<small>Click on the timestamp of a message for a sharable link</small>
<br/>
<br/>
<small>Message timestamps are in UTC</small>
<br/>
<br/>
<small>This archive is hosted by <a href="http://chaincode.com">Chaincode</a> and runs on <a href="https://github.com/whitequark/irclogger">irclogger</a></small>
<br/>
</form>
</section>
</section>
<section class='without-noise' data-channel='#bitcoin-core-dev' id='log'>
<aside id='log-panel'>
<a href='#' id='light_dark'></a>
<label for='filter'>
Filter:
</label>
<input id='filter'>
<span class='clear-input' id='clear_filter' style='display:none'></span>
<div class='input-group'>
<input id='show_noise' type='checkbox'>
<label for='show_noise'>
Show join/leave messages
</label>
</div>
</aside>
<div class='log-messages with-panel'>
<div class='talk op-msg' data-timestamp='1528507740' id='617002'>
<a class='timestamp' href='#617002'><time timestamp='2018-06-09T01:29:00Z'>01:29</time></a>
&lt;<span class='nick nick-8'> fanquake</span>&gt;
Empact Am alive and well :p
<br>
</div>

<div class='talk op-msg' data-timestamp='1528522620' id='617003'>
<a class='timestamp' href='#617003'><time timestamp='2018-06-09T05:37:00Z'>05:37</time></a>
&lt;<span class='nick nick-8'> murrayn</span>&gt;
Is there a reason -O2 is specifically enabled in configure with --enable-debug? Should this not be -Og?
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562040' id='617004'>
<a class='timestamp' href='#617004'><time timestamp='2018-06-09T16:34:00Z'>16:34</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: linked on your SHANI pr is an implementation where someone else noticed the throuput/latency relationship that I noticed.. they also do a 4way and it&#x27;s faster (by a small amount) than 2-way.
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562040' id='617005'>
<a class='timestamp' href='#617005'><time timestamp='2018-06-09T16:34:00Z'>16:34</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
they get 18% speedup for 2way over 1way, and 21% for 4-way over two-way.
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562100' id='617006'>
<a class='timestamp' href='#617006'><time timestamp='2018-06-09T16:35:00Z'>16:35</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
I&#x27;m not sure if that difference is even worth it, though perhaps throughput might increase for later cpus.
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562220' id='617007'>
<a class='timestamp' href='#617007'><time timestamp='2018-06-09T16:37:00Z'>16:37</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
interesting, i&#x27;ll try that too
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562220' id='617008'>
<a class='timestamp' href='#617008'><time timestamp='2018-06-09T16:37:00Z'>16:37</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
Their implementation might be interesting to look at to see if they had some smarter way of dealing with register pressure.
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562280' id='617009'>
<a class='timestamp' href='#617009'><time timestamp='2018-06-09T16:38:00Z'>16:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
another remarkable thing i noticed: the speedup of 64-specialized shani over variable length shani was close to 2x
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562280' id='617010'>
<a class='timestamp' href='#617010'><time timestamp='2018-06-09T16:38:00Z'>16:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
far higher than the ratio observed elsewhere
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562280' id='617011'>
<a class='timestamp' href='#617011'><time timestamp='2018-06-09T16:38:00Z'>16:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: from what i can see it&#x27;s just interleaving
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562340' id='617012'>
<a class='timestamp' href='#617012'><time timestamp='2018-06-09T16:39:00Z'>16:39</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
(presumably register churn is why their attempt at 8-way was slower 2/4 way)
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562400' id='617013'>
<a class='timestamp' href='#617013'><time timestamp='2018-06-09T16:40:00Z'>16:40</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
sipa: The 64-specialized saves expander work, which I guess isn&#x27;t as fast with shani?  or maybe it&#x27;s just that shani is faster so calling overhead (which the specialized reduces) matters more?
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562460' id='617014'>
<a class='timestamp' href='#617014'><time timestamp='2018-06-09T16:41:00Z'>16:41</time></a>
&lt;<span class='nick nick-15'> provoostenator</span>&gt;
Memory management is a pain. I have a device with 1 GB RAM, trying to squeeze as much as possible out of it during IBD. Without swap, if I set it slight too high, it crashes when dbcache gets too large. With swap, it starts using the swap, which presumably defeats the purpose. Is there any way to <u>_have_</u> swap but prevent dbcache from using it? 
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562520' id='617015'>
<a class='timestamp' href='#617015'><time timestamp='2018-06-09T16:42:00Z'>16:42</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
provoostenator: I doubt swapping is actually defeating the purpose, at least if it isn&#x27;t doing it heavily.
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562520' id='617016'>
<a class='timestamp' href='#617016'><time timestamp='2018-06-09T16:42:00Z'>16:42</time></a>
&lt;<span class='nick nick-14'> gmaxwell</span>&gt;
The data that gets swapped is infrequently used stuff first...
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562700' id='617017'>
<a class='timestamp' href='#617017'><time timestamp='2018-06-09T16:45:00Z'>16:45</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: SHANI has special instructions both for expansion and transform
<br>
</div>

<div class='talk op-msg' data-timestamp='1528562700' id='617018'>
<a class='timestamp' href='#617018'><time timestamp='2018-06-09T16:45:00Z'>16:45</time></a>
&lt;<span class='nick nick-15'> provoostenator</span>&gt;
It indeed didn&#x27;t seem very slow, so maybe it&#x27;s not too bad in practice then. 450 MB dbcache (with maxmempool=5) seems about the max without swap.
<br>
</div>

<div class='talk op-msg' data-timestamp='1528564140' id='617019'>
<a class='timestamp' href='#617019'><time timestamp='2018-06-09T17:09:00Z'>17:09</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
gmaxwell: 4-way seems a bit slower here, but that may be due to less than perfectly interleaved code being emitted
<br>
</div>

<div class='talk op-msg' data-timestamp='1528578240' id='617020'>
<a class='timestamp' href='#617020'><time timestamp='2018-06-09T21:04:00Z'>21:04</time></a>
&lt;<span class='nick nick-15'> provoostenator</span>&gt;
I have a new theory as to why my aggresive pruning IBD branch is <u>_slower_</u> than master. Namely that dirty CCoinsCacheEntry read/write doesn&#x27;t perform well for very large cache sizes. See See also <a href="https://github.com/bitcoin/bitcoin/pull/12404#issuecomment-395998702" class="link" target="_blank">https://github.com/bitcoin/bitcoin/pull/12404#issuecomment-395998702</a>
<br>
</div>

<div class='talk op-msg' data-timestamp='1528578300' id='617021'>
<a class='timestamp' href='#617021'><time timestamp='2018-06-09T21:05:00Z'>21:05</time></a>
&lt;<span class='nick nick-15'> provoostenator</span>&gt;
(theory, still have to measure this)
<br>
</div>

<div class='talk op-msg' data-timestamp='1528579620' id='617022'>
<a class='timestamp' href='#617022'><time timestamp='2018-06-09T21:27:00Z'>21:27</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
provoostenator, aggressive pruning?
<br>
</div>

<div class='talk op-msg' data-timestamp='1528579620' id='617023'>
<a class='timestamp' href='#617023'><time timestamp='2018-06-09T21:27:00Z'>21:27</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
phantomcircuit: #12404
<br>
</div>

<div class='talk op-msg' data-timestamp='1528579620' id='617024'>
<a class='timestamp' href='#617024'><time timestamp='2018-06-09T21:27:00Z'>21:27</time></a>
&lt;<span class='nick nick-9'> gribble</span>&gt;
<a href="https://github.com/bitcoin/bitcoin/issues/12404" class="link" target="_blank">https://github.com/bitcoin/bitcoin/issues/12404</a> | Prune more aggressively during IBD by Sjors · Pull Request #12404 · bitcoin/bitcoin · GitHub
<br>
</div>

<div class='talk op-msg' data-timestamp='1528579680' id='617025'>
<a class='timestamp' href='#617025'><time timestamp='2018-06-09T21:28:00Z'>21:28</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
oh     
<br>
</div>

<div class='talk op-msg' data-timestamp='1528580040' id='617026'>
<a class='timestamp' href='#617026'><time timestamp='2018-06-09T21:34:00Z'>21:34</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, does flushing the cache still remove everything?
<br>
</div>

<div class='talk op-msg' data-timestamp='1528580100' id='617027'>
<a class='timestamp' href='#617027'><time timestamp='2018-06-09T21:35:00Z'>21:35</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
yes     
<br>
</div>

<div class='talk op-msg' data-timestamp='1528580220' id='617028'>
<a class='timestamp' href='#617028'><time timestamp='2018-06-09T21:37:00Z'>21:37</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, and there&#x27;s no way to flush &quot;upto block x&quot; right?
<br>
</div>

<div class='talk op-msg' data-timestamp='1528580280' id='617029'>
<a class='timestamp' href='#617029'><time timestamp='2018-06-09T21:38:00Z'>21:38</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
phantomcircuit: indeed, because there may have been entries created before x, but spent after x, which wouldn&#x27;t be present on disk
<br>
</div>

<div class='talk op-msg' data-timestamp='1528580340' id='617030'>
<a class='timestamp' href='#617030'><time timestamp='2018-06-09T21:39:00Z'>21:39</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it is possible with the non-atomic flushing since 0.15 (which writes to disk a range of blocks rather than a single up-to-x point)
<br>
</div>

<div class='talk op-msg' data-timestamp='1528580340' id='617031'>
<a class='timestamp' href='#617031'><time timestamp='2018-06-09T21:39:00Z'>21:39</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
though it&#x27;s pretty complicated to reason about
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581540' id='617032'>
<a class='timestamp' href='#617032'><time timestamp='2018-06-09T21:59:00Z'>21:59</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, so to enable that you&#x27;d need to keep around entries that are a record of an entry being deleted?
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581660' id='617033'>
<a class='timestamp' href='#617033'><time timestamp='2018-06-09T22:01:00Z'>22:01</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
phantomcircuit: you actually don&#x27;t
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581720' id='617034'>
<a class='timestamp' href='#617034'><time timestamp='2018-06-09T22:02:00Z'>22:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
you just need to accurately keep track of (a) the block up to which you&#x27;ve flushed everything and (b) the block up to which effects may be present on disk, and at startup replay the blocks&#x27; UTXO effects between those 2
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581720' id='617035'>
<a class='timestamp' href='#617035'><time timestamp='2018-06-09T22:02:00Z'>22:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
that&#x27;s already implemented even
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581720' id='617036'>
<a class='timestamp' href='#617036'><time timestamp='2018-06-09T22:02:00Z'>22:02</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
however, once you introduce partial flushing during reorgs which may overlap etc... it becomes far more complicated
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581780' id='617037'>
<a class='timestamp' href='#617037'><time timestamp='2018-06-09T22:03:00Z'>22:03</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
yeah wasn&#x27;t thinking about reorgs
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581840' id='617038'>
<a class='timestamp' href='#617038'><time timestamp='2018-06-09T22:04:00Z'>22:04</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
all of this is doable, and i think i know all the algorithms necessary to implement it
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581900' id='617039'>
<a class='timestamp' href='#617039'><time timestamp='2018-06-09T22:05:00Z'>22:05</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
with the goal of being able to have a background process that just periodically (and asynchronously) flushes the oldest dirty UTXO entries (and wipes the oldest non-dirty ones)
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581900' id='617040'>
<a class='timestamp' href='#617040'><time timestamp='2018-06-09T22:05:00Z'>22:05</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
but it&#x27;s a pretty big amount of work without knowing if it&#x27;ll actually speed things up :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581960' id='617041'>
<a class='timestamp' href='#617041'><time timestamp='2018-06-09T22:06:00Z'>22:06</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, i had a patch which did this, but broke consensus across reorgs
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581960' id='617042'>
<a class='timestamp' href='#617042'><time timestamp='2018-06-09T22:06:00Z'>22:06</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
it was a substantial speed up
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581960' id='617043'>
<a class='timestamp' href='#617043'><time timestamp='2018-06-09T22:06:00Z'>22:06</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
but that was a while ago, so possibly it wouldn&#x27;t be as large anymore?
<br>
</div>

<div class='talk op-msg' data-timestamp='1528581960' id='617044'>
<a class='timestamp' href='#617044'><time timestamp='2018-06-09T22:06:00Z'>22:06</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
since per-txout in 0.15 performance profiles of such things may have shifted drastically
<br>
</div>

<div class='talk op-msg' data-timestamp='1528582020' id='617045'>
<a class='timestamp' href='#617045'><time timestamp='2018-06-09T22:07:00Z'>22:07</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it could be less or more of a speedup now :)
<br>
</div>

<div class='talk op-msg' data-timestamp='1528582260' id='617046'>
<a class='timestamp' href='#617046'><time timestamp='2018-06-09T22:11:00Z'>22:11</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
yeah
<br>
</div>

<div class='talk op-msg' data-timestamp='1528582260' id='617047'>
<a class='timestamp' href='#617047'><time timestamp='2018-06-09T22:11:00Z'>22:11</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
iirc it was really simple to do
<br>
</div>

<div class='talk op-msg' data-timestamp='1528587540' id='617048'>
<a class='timestamp' href='#617048'><time timestamp='2018-06-09T23:39:00Z'>23:39</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, the FRESH flag looks a bit confusing
<br>
</div>

<div class='talk op-msg' data-timestamp='1528587660' id='617049'>
<a class='timestamp' href='#617049'><time timestamp='2018-06-09T23:41:00Z'>23:41</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
the idea is that if an entry is added and spent before a flush it&#x27;s effectively a noop ?
<br>
</div>

<div class='talk op-msg' data-timestamp='1528587660' id='617050'>
<a class='timestamp' href='#617050'><time timestamp='2018-06-09T23:41:00Z'>23:41</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
it just means &quot;this entry does not exist in the parent cache, so if it is spent, we can just forget about it&quot;
<br>
</div>

<div class='talk op-msg' data-timestamp='1528587660' id='617051'>
<a class='timestamp' href='#617051'><time timestamp='2018-06-09T23:41:00Z'>23:41</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
phantomcircuit: it&#x27;s <b>*the*</b> major performance gain our cache gives
<br>
</div>

<div class='talk op-msg' data-timestamp='1528587660' id='617052'>
<a class='timestamp' href='#617052'><time timestamp='2018-06-09T23:41:00Z'>23:41</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
ok i get that
<br>
</div>

<div class='talk op-msg' data-timestamp='1528587720' id='617053'>
<a class='timestamp' href='#617053'><time timestamp='2018-06-09T23:42:00Z'>23:42</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
yeah
<br>
</div>

<div class='talk op-msg' data-timestamp='1528587780' id='617054'>
<a class='timestamp' href='#617054'><time timestamp='2018-06-09T23:43:00Z'>23:43</time></a>
&lt;<span class='nick nick-13'> sipa</span>&gt;
because it avoids entries ever hitting disk at all
<br>
</div>

<div class='talk op-msg' data-timestamp='1528588020' id='617055'>
<a class='timestamp' href='#617055'><time timestamp='2018-06-09T23:47:00Z'>23:47</time></a>
&lt;<span class='nick nick-4'> phantomcircuit</span>&gt;
sipa, yup i definitely get it
<br>
</div>

</div>
</section>

</body>
</html>
